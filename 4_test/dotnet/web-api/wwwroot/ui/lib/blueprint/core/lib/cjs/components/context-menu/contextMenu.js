"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isOpen=exports.hide=exports.show=void 0;var contextMenuElement,contextMenu,tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),ReactDOM=tslib_1.__importStar(require("react-dom")),react_lifecycles_compat_1=require("react-lifecycles-compat"),common_1=require("../../common"),popover_1=require("../popover/popover"),POPPER_MODIFIERS={preventOverflow:{boundariesElement:"viewport"}},TRANSITION_DURATION=100,ContextMenu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDarkTheme:!1,isOpen:!1},t.cancelContextMenu=function(e){return e.preventDefault()},t.handleBackdropContextMenu=function(e){e.persist(),e.preventDefault(),t.setTimeout((function(){var t=document.elementFromPoint(e.clientX,e.clientY),n=(e.view,tslib_1.__rest(e,["view"]));null==t||t.dispatchEvent(new MouseEvent("contextmenu",n))}),TRANSITION_DURATION)},t.handlePopoverInteraction=function(e){e||t.requestAnimationFrame((function(){return t.hide()}))},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e,t=React.createElement("div",{onContextMenu:this.cancelContextMenu},this.state.menu),n=classnames_1.default(((e={})[common_1.Classes.DARK]=this.state.isDarkTheme,e)),o=void 0===this.state.offset?"":this.state.offset.left+"x"+this.state.offset.top;return React.createElement("div",{className:common_1.Classes.CONTEXT_MENU_POPOVER_TARGET,style:this.state.offset},React.createElement(popover_1.Popover,tslib_1.__assign({},this.props,{backdropProps:{onContextMenu:this.handleBackdropContextMenu},content:t,enforceFocus:!1,key:o,hasBackdrop:!0,isOpen:this.state.isOpen,minimal:!0,modifiers:POPPER_MODIFIERS,onInteraction:this.handlePopoverInteraction,position:common_1.Position.RIGHT_TOP,popoverClassName:n,target:React.createElement("div",null),transitionDuration:TRANSITION_DURATION})))},t.prototype.show=function(e,t,n,o){void 0===o&&(o=!1),this.setState({isOpen:!0,menu:e,offset:t,onClose:n,isDarkTheme:o})},t.prototype.hide=function(){var e,t;null===(t=(e=this.state).onClose)||void 0===t||t.call(e),this.setState({isOpen:!1,onClose:void 0})},tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(common_1.AbstractPureComponent2);function show(e,t,n,o){void 0===contextMenuElement&&((contextMenuElement=document.createElement("div")).classList.add(common_1.Classes.CONTEXT_MENU),document.body.appendChild(contextMenuElement),contextMenu=ReactDOM.render(React.createElement(ContextMenu,{onClosed:remove}),contextMenuElement)),contextMenu.show(e,t,n,o)}function hide(){null==contextMenu||contextMenu.hide()}function isOpen(){return null!=contextMenu&&contextMenu.state.isOpen}function remove(){null!=contextMenuElement&&(ReactDOM.unmountComponentAtNode(contextMenuElement),contextMenuElement.remove(),contextMenuElement=void 0,contextMenu=void 0)}exports.show=show,exports.hide=hide,exports.isOpen=isOpen;