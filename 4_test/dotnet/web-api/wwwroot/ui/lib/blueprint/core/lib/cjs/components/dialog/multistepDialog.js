"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultistepDialog=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_lifecycles_compat_1=require("react-lifecycles-compat"),common_1=require("../../common"),props_1=require("../../common/props"),buttons_1=require("../button/buttons"),dialog_1=require("./dialog"),dialogStep_1=require("./dialogStep"),PADDING_BOTTOM=0,MIN_WIDTH=800,MultistepDialog=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getInitialIndexFromProps(t.props),t.renderDialogStep=function(e,s){var n,o=s+1,i=t.state.lastViewedIndex>=s,a=t.state.selectedIndex===s;return React.createElement("div",{className:classnames_1.default(common_1.Classes.DIALOG_STEP_CONTAINER,(n={},n[common_1.Classes.ACTIVE]=a,n[common_1.Classes.DIALOG_STEP_VIEWED]=i,n)),key:s},React.createElement("div",{className:common_1.Classes.DIALOG_STEP,onClick:t.handleClickDialogStep(s)},React.createElement("div",{className:common_1.Classes.DIALOG_STEP_ICON},o),React.createElement("div",{className:common_1.Classes.DIALOG_STEP_TITLE},e.props.title)))},t.handleClickDialogStep=function(e){if(!(e>t.state.lastViewedIndex))return t.getDialogStepChangeHandler(e)},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.showCloseButtonInFooter,s=e.isCloseButtonShown,n=tslib_1.__rest(e,["showCloseButtonInFooter","isCloseButtonShown"]),o=!t&&s;return React.createElement(dialog_1.Dialog,tslib_1.__assign({isCloseButtonShown:o},n,{style:this.getDialogStyle()}),React.createElement("div",{className:common_1.Classes.MULTISTEP_DIALOG_PANELS},this.renderLeftPanel(),this.maybeRenderRightPanel()))},t.prototype.componentDidUpdate=function(e){!e.resetOnClose&&e.initialStepIndex===this.props.initialStepIndex||e.isOpen||!this.props.isOpen||this.setState(this.getInitialIndexFromProps(this.props))},t.prototype.getDialogStyle=function(){return tslib_1.__assign({minWidth:MIN_WIDTH,paddingBottom:PADDING_BOTTOM},this.props.style)},t.prototype.renderLeftPanel=function(){return React.createElement("div",{className:common_1.Classes.MULTISTEP_DIALOG_LEFT_PANEL},this.getDialogStepChildren().filter(isDialogStepElement).map(this.renderDialogStep))},t.prototype.maybeRenderRightPanel=function(){var e=this.getDialogStepChildren();if(e.length<=this.state.selectedIndex)return null;var t=e[this.state.selectedIndex].props,s=t.className,n=t.panel,o=t.panelClassName;return React.createElement("div",{className:classnames_1.default(common_1.Classes.MULTISTEP_DIALOG_RIGHT_PANEL,s,o)},n,this.renderFooter())},t.prototype.renderFooter=function(){var e=this.props,t=e.closeButtonProps,s=e.isCloseButtonShown,n=e.showCloseButtonInFooter,o=e.onClose,i=n&&s?React.createElement(buttons_1.Button,tslib_1.__assign({text:"Close",onClick:o},t)):void 0;return React.createElement("div",{className:common_1.Classes.MULTISTEP_DIALOG_FOOTER},i,React.createElement("div",{className:common_1.Classes.DIALOG_FOOTER_ACTIONS},this.renderButtons()))},t.prototype.renderButtons=function(){var e,t,s=this.state.selectedIndex,n=this.getDialogStepChildren(),o=[];if(this.state.selectedIndex>0){var i=null!==(e=n[s].props.backButtonProps)&&void 0!==e?e:this.props.backButtonProps;o.push(React.createElement(buttons_1.Button,tslib_1.__assign({key:"back",onClick:this.getDialogStepChangeHandler(s-1),text:"Back"},i)))}if(s===this.getDialogStepChildren().length-1)o.push(React.createElement(buttons_1.Button,tslib_1.__assign({intent:"primary",key:"final",text:"Submit"},this.props.finalButtonProps)));else{var a=null!==(t=n[s].props.nextButtonProps)&&void 0!==t?t:this.props.nextButtonProps;o.push(React.createElement(buttons_1.Button,tslib_1.__assign({intent:"primary",key:"next",onClick:this.getDialogStepChangeHandler(s+1),text:"Next"},a)))}return o},t.prototype.getDialogStepChangeHandler=function(e){var t=this;return function(s){if(void 0!==t.props.onChange){var n=t.getDialogStepChildren(),o=n[t.state.selectedIndex].props.id,i=n[e].props.id;t.props.onChange(i,o,s)}t.setState({lastViewedIndex:Math.max(t.state.lastViewedIndex,e),selectedIndex:e})}},t.prototype.getDialogStepChildren=function(e){return void 0===e&&(e=this.props),React.Children.toArray(e.children).filter(isDialogStepElement)},t.prototype.getInitialIndexFromProps=function(e){if(void 0!==e.initialStepIndex){var t=Math.max(0,Math.min(e.initialStepIndex,this.getDialogStepChildren(e).length-1));return{lastViewedIndex:t,selectedIndex:t}}return{lastViewedIndex:0,selectedIndex:0}},t.displayName=props_1.DISPLAYNAME_PREFIX+".MultistepDialog",t.defaultProps={canOutsideClickClose:!0,isOpen:!1,resetOnClose:!0,showCloseButtonInFooter:!1},tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(common_1.AbstractPureComponent2);function isDialogStepElement(e){return common_1.Utils.isElementOfType(e,dialogStep_1.DialogStep)}exports.MultistepDialog=MultistepDialog;