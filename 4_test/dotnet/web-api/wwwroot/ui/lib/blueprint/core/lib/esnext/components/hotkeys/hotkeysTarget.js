import*as React from"react";import{HOTKEYS_WARN_DECORATOR_NEEDS_REACT_ELEMENT,HOTKEYS_WARN_DECORATOR_NO_METHOD}from"../../common/errors";import{getDisplayName,isFunction}from"../../common/utils";import{HotkeyScope,HotkeysEvents}from"./hotkeysEvents";export function HotkeysTarget(e){var t;return isFunction(e.prototype.renderHotkeys)||console.warn(HOTKEYS_WARN_DECORATOR_NO_METHOD),t=class extends e{constructor(){super(...arguments),this.globalHotkeysEvents=new HotkeysEvents(HotkeyScope.GLOBAL),this.localHotkeysEvents=new HotkeysEvents(HotkeyScope.LOCAL)}componentDidMount(){null!=super.componentDidMount&&super.componentDidMount(),document.addEventListener("keydown",this.globalHotkeysEvents.handleKeyDown),document.addEventListener("keyup",this.globalHotkeysEvents.handleKeyUp)}componentWillUnmount(){super.componentWillUnmount?.(),document.removeEventListener("keydown",this.globalHotkeysEvents.handleKeyDown),document.removeEventListener("keyup",this.globalHotkeysEvents.handleKeyUp),this.globalHotkeysEvents.clear(),this.localHotkeysEvents.clear()}render(){const e=super.render();if(null==e)return e;if(!React.isValidElement(e))return console.warn(HOTKEYS_WARN_DECORATOR_NEEDS_REACT_ELEMENT),e;if(isFunction(this.renderHotkeys)){const t=this.renderHotkeys();if(this.localHotkeysEvents&&this.localHotkeysEvents.setHotkeys(t.props),this.globalHotkeysEvents&&this.globalHotkeysEvents.setHotkeys(t.props),this.localHotkeysEvents.count()>0){const o=void 0===t.props.tabIndex?0:t.props.tabIndex,{onKeyDown:n,onKeyUp:s}=e.props,r=e=>{this.localHotkeysEvents.handleKeyDown(e.nativeEvent),n?.(e)},l=e=>{this.localHotkeysEvents.handleKeyUp(e.nativeEvent),s?.(e)};return React.cloneElement(e,{onKeyDown:r,onKeyUp:l,tabIndex:o})}}return e}},t.displayName=`HotkeysTarget(${getDisplayName(e)})`,t}