"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useHotkeys=void 0;var tslib_1=require("tslib"),React=tslib_1.__importStar(require("react")),hotkeyParser_1=require("../../components/hotkeys/hotkeyParser"),context_1=require("../../context");function useHotkeys(e,t){void 0===t&&(t={});var o=t.document,n=void 0===o?getDefaultDocument():o,r=t.showDialogKeyCombo,a=void 0===r?"?":r,u=React.useMemo((function(){return e.filter((function(e){return!e.global})).map((function(e){return{combo:hotkeyParser_1.parseKeyCombo(e.combo),config:e}}))}),[e]),i=React.useMemo((function(){return e.filter((function(e){return e.global})).map((function(e){return{combo:hotkeyParser_1.parseKeyCombo(e.combo),config:e}}))}),[e]),c=React.useContext(context_1.HotkeysContext)[1];React.useEffect((function(){var e=tslib_1.__spreadArrays(i.map((function(e){return e.config})),u.map((function(e){return e.config})));return c({type:"ADD_HOTKEYS",payload:e}),function(){return c({type:"REMOVE_HOTKEYS",payload:e})}}),[e]);var s=function(e,t,o,n){for(var r,a,c=isTargetATextInput(n),s=0,l=e?i:u;s<l.length;s++){var y=l[s],f=y.config,p=f.allowInInput,v=void 0!==p&&p,d=f.disabled,m=void 0!==d&&d,b=f.preventDefault,k=void 0!==b&&b,g=f.stopPropagation,_=void 0!==g&&g;!(c&&!v||m)&&hotkeyParser_1.comboMatches(y.combo,t)&&(k&&n.preventDefault(),_&&(n.isPropagationStopped=!0,n.stopPropagation()),null===(a=(r=y.config)[o])||void 0===a||a.call(r,n))}},l=React.useCallback((function(e){var t=hotkeyParser_1.getKeyCombo(e);!isTargetATextInput(e)&&hotkeyParser_1.comboMatches(hotkeyParser_1.parseKeyCombo(a),t)?c({type:"OPEN_DIALOG"}):s(!0,hotkeyParser_1.getKeyCombo(e),"onKeyDown",e)}),[i]),y=React.useCallback((function(e){return s(!0,hotkeyParser_1.getKeyCombo(e),"onKeyUp",e)}),[i]),f=React.useCallback((function(e){return s(!1,hotkeyParser_1.getKeyCombo(e.nativeEvent),"onKeyDown",e.nativeEvent)}),[u]),p=React.useCallback((function(e){return s(!1,hotkeyParser_1.getKeyCombo(e.nativeEvent),"onKeyUp",e.nativeEvent)}),[u]);return React.useEffect((function(){return n.addEventListener("keydown",l),n.addEventListener("keyup",y),function(){n.removeEventListener("keydown",l),n.removeEventListener("keyup",y)}}),[l,y]),{handleKeyDown:f,handleKeyUp:p}}function isTargetATextInput(e){var t=e.target;if(null==t||null==t.closest)return!1;var o=t.closest("input, textarea, [contenteditable=true]");if(null==o)return!1;if("input"===o.tagName.toLowerCase()){var n=o.type;if("checkbox"===n||"radio"===n)return!1}return!o.readOnly}function getDefaultDocument(){if("undefined"!=typeof window)return window.document}exports.useHotkeys=useHotkeys;