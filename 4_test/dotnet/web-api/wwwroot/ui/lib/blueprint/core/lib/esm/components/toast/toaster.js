import{__assign,__decorate,__extends,__spreadArrays}from"tslib";import classNames from"classnames";import*as React from"react";import*as ReactDOM from"react-dom";import{polyfill}from"react-lifecycles-compat";import{AbstractPureComponent2,Classes,Position}from"../../common";import{TOASTER_CREATE_NULL,TOASTER_MAX_TOASTS_INVALID,TOASTER_WARN_INLINE}from"../../common/errors";import{ESCAPE}from"../../common/keys";import{DISPLAYNAME_PREFIX}from"../../common/props";import{isNodeEnv}from"../../common/utils";import{Overlay}from"../overlay/overlay";import{Toast}from"./toast";var Toaster=function(t){function s(){var s=null!==t&&t.apply(this,arguments)||this;return s.state={toasts:[]},s.toastId=0,s.renderToast=function(t){return React.createElement(Toast,__assign({},t,{onDismiss:s.getDismissHandler(t)}))},s.getDismissHandler=function(t){return function(o){s.dismiss(t.key,o)}},s.handleClose=function(t){t.which===ESCAPE&&s.clear()},s}var o;return __extends(s,t),o=s,s.create=function(t,s){void 0===s&&(s=document.body),null==t||null==t.usePortal||isNodeEnv("production")||console.warn(TOASTER_WARN_INLINE);var e=document.createElement("div");s.appendChild(e);var r=ReactDOM.render(React.createElement(o,__assign({},t,{usePortal:!1})),e);if(null==r)throw new Error(TOASTER_CREATE_NULL);return r},s.prototype.show=function(t,s){this.props.maxToasts&&this.dismissIfAtLimit();var o=this.createToastOptions(t,s);return void 0===s||this.isNewToastKey(s)?this.setState((function(t){return{toasts:__spreadArrays([o],t.toasts)}})):this.setState((function(t){return{toasts:t.toasts.map((function(t){return t.key===s?o:t}))}})),o.key},s.prototype.dismiss=function(t,s){void 0===s&&(s=!1),this.setState((function(o){return{toasts:o.toasts.filter((function(o){var e,r=o.key===t;return r&&(null===(e=o.onDismiss)||void 0===e||e.call(o,s)),!r}))}}))},s.prototype.clear=function(){this.state.toasts.forEach((function(t){var s;return null===(s=t.onDismiss)||void 0===s?void 0:s.call(t,!1)})),this.setState({toasts:[]})},s.prototype.getToasts=function(){return this.state.toasts},s.prototype.render=function(){var t=classNames(Classes.TOAST_CONTAINER,this.getPositionClasses(),this.props.className);return React.createElement(Overlay,{autoFocus:this.props.autoFocus,canEscapeKeyClose:this.props.canEscapeKeyClear,canOutsideClickClose:!1,className:t,enforceFocus:!1,hasBackdrop:!1,isOpen:this.state.toasts.length>0||null!=this.props.children,onClose:this.handleClose,shouldReturnFocusOnClose:!1,transitionDuration:350,transitionName:Classes.TOAST,usePortal:this.props.usePortal},this.state.toasts.map(this.renderToast,this),this.props.children)},s.prototype.validateProps=function(t){var s=t.maxToasts;if(void 0!==s&&s<1)throw new Error(TOASTER_MAX_TOASTS_INVALID)},s.prototype.isNewToastKey=function(t){return this.state.toasts.every((function(s){return s.key!==t}))},s.prototype.dismissIfAtLimit=function(){this.state.toasts.length===this.props.maxToasts&&this.dismiss(this.state.toasts[this.state.toasts.length-1].key)},s.prototype.createToastOptions=function(t,s){return void 0===s&&(s="toast-"+this.toastId++),__assign(__assign({},t),{key:s})},s.prototype.getPositionClasses=function(){var t=this.props.position.split("-");return __spreadArrays(t.map((function(t){return Classes.TOAST_CONTAINER+"-"+t.toLowerCase()})),[Classes.TOAST_CONTAINER+"-"+(this.props.usePortal?"in-portal":"inline")])},s.displayName=DISPLAYNAME_PREFIX+".Toaster",s.defaultProps={autoFocus:!1,canEscapeKeyClear:!0,position:Position.TOP,usePortal:!0},o=__decorate([polyfill],s)}(AbstractPureComponent2);export{Toaster};export var OverlayToaster=Toaster;