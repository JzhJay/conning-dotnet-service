"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultiSlider=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_lifecycles_compat_1=require("react-lifecycles-compat"),common_1=require("../../common"),Errors=tslib_1.__importStar(require("../../common/errors")),props_1=require("../../common/props"),Utils=tslib_1.__importStar(require("../../common/utils")),handle_1=require("./handle"),handleProps_1=require("./handleProps"),sliderUtils_1=require("./sliderUtils"),MultiSliderHandle=function(){return null};MultiSliderHandle.displayName=props_1.DISPLAYNAME_PREFIX+".MultiSliderHandle";var MultiSlider=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={labelPrecision:getLabelPrecision(t.props),tickSize:0,tickSizeRatio:0},t.handleElements=[],t.trackElement=null,t.addHandleRef=function(e){null!=e&&t.handleElements.push(e)},t.maybeHandleTrackClick=function(e){if(t.canHandleTrackEvent(e)){var r=t.nearestHandleForValue(t.handleElements,(function(t){return t.mouseEventClientOffset(e)}));r&&r.beginHandleMovement(e)}},t.maybeHandleTrackTouch=function(e){if(t.canHandleTrackEvent(e)){var r=t.nearestHandleForValue(t.handleElements,(function(t){return t.touchEventClientOffset(e)}));r&&r.beginHandleTouchMovement(e)}},t.canHandleTrackEvent=function(e){var r=e.target;return!t.props.disabled&&null==r.closest("."+common_1.Classes.SLIDER_HANDLE)},t.getHandlerForIndex=function(e,r){return function(n){null==r||r(t.getNewHandleValues(n,e))}},t.handleChange=function(e){var r,n,l=getSortedInteractiveHandleProps(t.props),a=l.map((function(e){return e.value}));Utils.arraysEqual(e,a)||(null===(n=(r=t.props).onChange)||void 0===n||n.call(r,e),l.forEach((function(t,r){var n;a[r]!==e[r]&&(null===(n=t.onChange)||void 0===n||n.call(t,e[r]))})))},t.handleRelease=function(e){var r,n,l=getSortedInteractiveHandleProps(t.props);null===(n=(r=t.props).onRelease)||void 0===n||n.call(r,e),l.forEach((function(t,r){var n;null===(n=t.onRelease)||void 0===n||n.call(t,e[r])}))},t}var r;return tslib_1.__extends(t,e),r=t,t.getDerivedStateFromProps=function(e){return{labelPrecision:r.getLabelPrecision(e)}},t.getLabelPrecision=function(e){var t=e.labelPrecision,r=e.stepSize;return null==t?Utils.countDecimalPlaces(r):t},t.prototype.getSnapshotBeforeUpdate=function(e){var t=getSortedInteractiveHandleProps(e);return getSortedInteractiveHandleProps(this.props).length!==t.length&&(this.handleElements=[]),null},t.prototype.render=function(){var e,t=this,r=classnames_1.default(common_1.Classes.SLIDER,((e={})[common_1.Classes.DISABLED]=this.props.disabled,e[common_1.Classes.SLIDER+"-unlabeled"]=!1===this.props.labelRenderer,e[common_1.Classes.VERTICAL]=this.props.vertical,e),this.props.className);return React.createElement("div",{className:r,onMouseDown:this.maybeHandleTrackClick,onTouchStart:this.maybeHandleTrackTouch},React.createElement("div",{className:common_1.Classes.SLIDER_TRACK,ref:function(e){return t.trackElement=e}},this.renderTracks()),React.createElement("div",{className:common_1.Classes.SLIDER_AXIS},this.renderLabels()),this.renderHandles())},t.prototype.componentDidMount=function(){this.updateTickSize()},t.prototype.componentDidUpdate=function(t,r){e.prototype.componentDidUpdate.call(this,t,r),this.updateTickSize()},t.prototype.validateProps=function(e){if(e.stepSize<=0)throw new Error(Errors.SLIDER_ZERO_STEP);if(void 0!==e.labelStepSize&&void 0!==e.labelValues)throw new Error(Errors.MULTISLIDER_WARN_LABEL_STEP_SIZE_LABEL_VALUES_MUTEX);if(void 0!==e.labelStepSize&&e.labelStepSize<=0)throw new Error(Errors.SLIDER_ZERO_LABEL_STEP);var t=!1;if(React.Children.forEach(e.children,(function(e){e&&!Utils.isElementOfType(e,r.Handle)&&(t=!0)})),t)throw new Error(Errors.MULTISLIDER_INVALID_CHILD)},t.prototype.formatLabel=function(e,t){void 0===t&&(t=!1);var r=this.props.labelRenderer;return!1===r?void 0:Utils.isFunction(r)?r(e,{isHandleTooltip:t}):e.toFixed(this.state.labelPrecision)},t.prototype.renderLabels=function(){var e=this;if(!1===this.props.labelRenderer)return null;var t=this.getLabelValues(),r=this.props,n=r.max,l=r.min;return t.map((function(t,r){var a=sliderUtils_1.formatPercentage((t-l)/(n-l)),i=e.props.vertical?{bottom:a}:{left:a};return React.createElement("div",{className:common_1.Classes.SLIDER_LABEL,key:r,style:i},e.formatLabel(t))}))},t.prototype.renderTracks=function(){var e=getSortedHandleProps(this.props);e.push({value:this.props.max});for(var t={value:this.props.min},r=[],n=0;n<e.length;n++){var l=e[n];r.push(this.renderTrackFill(n,t,l)),t=l}return r},t.prototype.renderTrackFill=function(e,t,r){var n=[this.getOffsetRatio(t.value),this.getOffsetRatio(r.value)].sort((function(e,t){return e-t})),l=n[0],a=n[1],i=sliderUtils_1.formatPercentage(l),o=sliderUtils_1.formatPercentage(1-a),s=this.props.vertical?{bottom:i,top:o,left:0}:{left:i,right:o,top:0},c=tslib_1.__assign(tslib_1.__assign({},s),t.trackStyleAfter||r.trackStyleBefore||{}),u=classnames_1.default(common_1.Classes.SLIDER_PROGRESS,common_1.Classes.intentClass(this.getTrackIntent(t,r)));return React.createElement("div",{key:"track-"+e,className:u,style:c})},t.prototype.renderHandles=function(){var e=this,t=this.props,r=t.disabled,n=t.max,l=t.min,a=t.stepSize,i=t.vertical,o=getSortedInteractiveHandleProps(this.props);return 0===o.length?null:o.map((function(t,s){var c,u=t.value,d=t.type,p=t.className;return React.createElement(handle_1.Handle,{className:classnames_1.default((c={},c[common_1.Classes.START]=d===handleProps_1.HandleType.START,c[common_1.Classes.END]=d===handleProps_1.HandleType.END,c),p),disabled:r,key:s+"-"+o.length,label:e.formatLabel(u,!0),max:n,min:l,onChange:e.getHandlerForIndex(s,e.handleChange),onRelease:e.getHandlerForIndex(s,e.handleRelease),ref:e.addHandleRef,stepSize:a,tickSize:e.state.tickSize,tickSizeRatio:e.state.tickSizeRatio,value:u,vertical:i})}))},t.prototype.nearestHandleForValue=function(e,t){return sliderUtils_1.argMin(e,(function(e){var r=t(e),n=e.clientToValue(r),l=e.props.value;return Math.abs(n-l)}))},t.prototype.getNewHandleValues=function(e,t){var r=getSortedInteractiveHandleProps(this.props).map((function(e){return e.value})),n=r.slice();n[t]=e,n.sort((function(e,t){return e-t}));var l=n.indexOf(e),a=this.findFirstLockedHandleIndex(t,l);if(-1!==a){var i=r[a];return sliderUtils_1.fillValues(r,t,a,i),r}return sliderUtils_1.fillValues(n,t,l,e),n},t.prototype.findFirstLockedHandleIndex=function(e,t){for(var r=e<t?1:-1,n=getSortedInteractiveHandleProps(this.props),l=e+r;l!==t+r;l+=r)if(n[l].interactionKind!==handleProps_1.HandleInteractionKind.PUSH)return l;return-1},t.prototype.getLabelValues=function(){var e=this.props,t=e.labelStepSize,r=e.labelValues,n=e.min,l=e.max,a=[];if(void 0!==r)a=r;else for(var i=n;i<l||Utils.approxEqual(i,l);i+=null!=t?t:1)a.push(i);return a},t.prototype.getOffsetRatio=function(e){return Utils.clamp((e-this.props.min)*this.state.tickSizeRatio,0,1)},t.prototype.getTrackIntent=function(e,t){return this.props.showTrackFill?void 0!==e.intentAfter?e.intentAfter:void 0!==t&&void 0!==t.intentBefore?t.intentBefore:this.props.defaultTrackIntent:common_1.Intent.NONE},t.prototype.updateTickSize=function(){if(null!=this.trackElement){var e=this.props.vertical?this.trackElement.clientHeight:this.trackElement.clientWidth,t=1/(this.props.max-this.props.min),r=e*t;this.setState({tickSize:r,tickSizeRatio:t})}},t.defaultSliderProps={disabled:!1,max:10,min:0,showTrackFill:!0,stepSize:1,vertical:!1},t.defaultProps=tslib_1.__assign(tslib_1.__assign({},r.defaultSliderProps),{defaultTrackIntent:common_1.Intent.NONE}),t.displayName=props_1.DISPLAYNAME_PREFIX+".MultiSlider",t.Handle=MultiSliderHandle,r=tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(common_1.AbstractPureComponent2);function getLabelPrecision(e){var t=e.labelPrecision,r=e.stepSize,n=void 0===r?MultiSlider.defaultSliderProps.stepSize:r;return null==t?Utils.countDecimalPlaces(n):t}function getSortedInteractiveHandleProps(e){return getSortedHandleProps(e,(function(e){return e.interactionKind!==handleProps_1.HandleInteractionKind.NONE}))}function getSortedHandleProps(e,t){var r=e.children;void 0===t&&(t=function(){return!0});var n=React.Children.map(r,(function(e){return Utils.isElementOfType(e,MultiSlider.Handle)&&t(e.props)?e.props:null})),l=null!=n?n:[];return(l=l.filter((function(e){return null!==e}))).sort((function(e,t){return e.value-t.value})),l}exports.MultiSlider=MultiSlider;