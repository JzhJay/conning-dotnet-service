"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Handle=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_lifecycles_compat_1=require("react-lifecycles-compat"),common_1=require("../../common"),props_1=require("../../common/props"),utils_1=require("../../common/utils"),sliderUtils_1=require("./sliderUtils"),NUMBER_PROPS=["max","min","stepSize","tickSize","value"],Handle=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={isMoving:!1},n.handleElement=null,n.refHandlers={handle:function(e){return n.handleElement=e}},n.beginHandleMovement=function(e){document.addEventListener("mousemove",n.handleHandleMovement),document.addEventListener("mouseup",n.endHandleMovement),n.setState({isMoving:!0}),n.changeValue(n.clientToValue(n.mouseEventClientOffset(e)))},n.beginHandleTouchMovement=function(e){document.addEventListener("touchmove",n.handleHandleTouchMovement),document.addEventListener("touchend",n.endHandleTouchMovement),document.addEventListener("touchcancel",n.endHandleTouchMovement),n.setState({isMoving:!0}),n.changeValue(n.clientToValue(n.touchEventClientOffset(e)))},n.getStyleProperties=function(){if(null==n.handleElement)return{};var e=n.props,t=e.min,o=void 0===t?0:t,i=e.tickSizeRatio,l=e.value,a=e.vertical,s=n.getHandleMidpointAndOffset(n.handleElement,!0).handleMidpoint,r=(l-o)*i,c="calc("+sliderUtils_1.formatPercentage(r)+" - "+s+"px)";return a?{bottom:c}:{left:c}},n.endHandleMovement=function(e){n.handleMoveEndedAt(n.mouseEventClientOffset(e))},n.endHandleTouchMovement=function(e){n.handleMoveEndedAt(n.touchEventClientOffset(e))},n.handleMoveEndedAt=function(e){var t,o;n.removeDocumentEventListeners(),n.setState({isMoving:!1});var i=n.changeValue(n.clientToValue(e));null===(o=(t=n.props).onRelease)||void 0===o||o.call(t,i)},n.handleHandleMovement=function(e){n.handleMovedTo(n.mouseEventClientOffset(e))},n.handleHandleTouchMovement=function(e){n.handleMovedTo(n.touchEventClientOffset(e))},n.handleMovedTo=function(e){n.state.isMoving&&!n.props.disabled&&n.changeValue(n.clientToValue(e))},n.handleKeyDown=function(e){var t=n.props,o=t.stepSize,i=t.value,l=e.which;l===common_1.Keys.ARROW_DOWN||l===common_1.Keys.ARROW_LEFT?(n.changeValue(i-o),e.preventDefault()):l!==common_1.Keys.ARROW_UP&&l!==common_1.Keys.ARROW_RIGHT||(n.changeValue(i+o),e.preventDefault())},n.handleKeyUp=function(e){var t,o;[common_1.Keys.ARROW_UP,common_1.Keys.ARROW_DOWN,common_1.Keys.ARROW_LEFT,common_1.Keys.ARROW_RIGHT].indexOf(e.which)>=0&&(null===(o=(t=n.props).onRelease)||void 0===o||o.call(t,n.props.value))},n}return tslib_1.__extends(n,e),n.prototype.componentDidMount=function(){this.forceUpdate()},n.prototype.render=function(){var e,n=this.props,t=n.className,o=n.disabled,i=n.label,l=this.state.isMoving;return React.createElement("span",{className:classnames_1.default(common_1.Classes.SLIDER_HANDLE,(e={},e[common_1.Classes.ACTIVE]=l,e),t),onKeyDown:o?void 0:this.handleKeyDown,onKeyUp:o?void 0:this.handleKeyUp,onMouseDown:o?void 0:this.beginHandleMovement,onTouchStart:o?void 0:this.beginHandleTouchMovement,ref:this.refHandlers.handle,style:this.getStyleProperties(),tabIndex:0},null==i?null:React.createElement("span",{className:common_1.Classes.SLIDER_LABEL},i))},n.prototype.componentWillUnmount=function(){this.removeDocumentEventListeners()},n.prototype.clientToValue=function(e){var n=this.props,t=n.stepSize,o=n.tickSize,i=n.value,l=n.vertical;if(null==this.handleElement)return i;var a=(l?window.innerHeight-e:e)-this.getHandleElementCenterPixel(this.handleElement);return isNaN(a)?i:i+Math.round(a/(o*t))*t},n.prototype.mouseEventClientOffset=function(e){return this.props.vertical?e.clientY:e.clientX},n.prototype.touchEventClientOffset=function(e){var n=e.changedTouches[0];return this.props.vertical?n.clientY:n.clientX},n.prototype.validateProps=function(e){for(var n=0,t=NUMBER_PROPS;n<t.length;n++){var o=t[n];if("number"!=typeof e[o])throw new Error("[Blueprint] <Handle> requires number value for "+o+" prop")}},n.prototype.changeValue=function(e,n){return void 0===n&&(n=this.props.onChange),e=this.clamp(e),isNaN(e)||this.props.value===e||null==n||n(e),e},n.prototype.clamp=function(e){return utils_1.clamp(e,this.props.min,this.props.max)},n.prototype.getHandleElementCenterPixel=function(e){var n=this.getHandleMidpointAndOffset(e),t=n.handleMidpoint;return n.handleOffset+t},n.prototype.getHandleMidpointAndOffset=function(e,n){if(void 0===n&&(n=!1),null==e)return{handleMidpoint:0,handleOffset:0};var t=this.props.vertical,o=e.getBoundingClientRect(),i=t?n?"width":"height":n?"height":"width",l=t?window.innerHeight-(o.top+o[i]):o.left;return{handleMidpoint:o[i]/2,handleOffset:l}},n.prototype.removeDocumentEventListeners=function(){document.removeEventListener("mousemove",this.handleHandleMovement),document.removeEventListener("mouseup",this.endHandleMovement),document.removeEventListener("touchmove",this.handleHandleTouchMovement),document.removeEventListener("touchend",this.endHandleTouchMovement),document.removeEventListener("touchcancel",this.endHandleTouchMovement)},n.displayName=props_1.DISPLAYNAME_PREFIX+".SliderHandle",tslib_1.__decorate([react_lifecycles_compat_1.polyfill],n)}(common_1.AbstractPureComponent2);exports.Handle=Handle;