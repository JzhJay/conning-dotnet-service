import{__spreadArrays}from"tslib";import*as React from"react";import{comboMatches,getKeyCombo,parseKeyCombo}from"../../components/hotkeys/hotkeyParser";import{HotkeysContext}from"../../context";export function useHotkeys(e,t){void 0===t&&(t={});var o=t.document,n=void 0===o?getDefaultDocument():o,r=t.showDialogKeyCombo,a=void 0===r?"?":r,u=React.useMemo((function(){return e.filter((function(e){return!e.global})).map((function(e){return{combo:parseKeyCombo(e.combo),config:e}}))}),[e]),i=React.useMemo((function(){return e.filter((function(e){return e.global})).map((function(e){return{combo:parseKeyCombo(e.combo),config:e}}))}),[e]),c=React.useContext(HotkeysContext)[1];React.useEffect((function(){var e=__spreadArrays(i.map((function(e){return e.config})),u.map((function(e){return e.config})));return c({type:"ADD_HOTKEYS",payload:e}),function(){return c({type:"REMOVE_HOTKEYS",payload:e})}}),[e]);var f=function(e,t,o,n){for(var r,a,c=isTargetATextInput(n),f=0,s=e?i:u;f<s.length;f++){var p=s[f],l=p.config,m=l.allowInInput,y=void 0!==m&&m,v=l.disabled,d=void 0!==v&&v,b=l.preventDefault,g=void 0!==b&&b,C=l.stopPropagation,K=void 0!==C&&C;!(c&&!y||d)&&comboMatches(p.combo,t)&&(g&&n.preventDefault(),K&&(n.isPropagationStopped=!0,n.stopPropagation()),null===(a=(r=p.config)[o])||void 0===a||a.call(r,n))}},s=React.useCallback((function(e){var t=getKeyCombo(e);!isTargetATextInput(e)&&comboMatches(parseKeyCombo(a),t)?c({type:"OPEN_DIALOG"}):f(!0,getKeyCombo(e),"onKeyDown",e)}),[i]),p=React.useCallback((function(e){return f(!0,getKeyCombo(e),"onKeyUp",e)}),[i]),l=React.useCallback((function(e){return f(!1,getKeyCombo(e.nativeEvent),"onKeyDown",e.nativeEvent)}),[u]),m=React.useCallback((function(e){return f(!1,getKeyCombo(e.nativeEvent),"onKeyUp",e.nativeEvent)}),[u]);return React.useEffect((function(){return n.addEventListener("keydown",s),n.addEventListener("keyup",p),function(){n.removeEventListener("keydown",s),n.removeEventListener("keyup",p)}}),[s,p]),{handleKeyDown:l,handleKeyUp:m}}function isTargetATextInput(e){var t=e.target;if(null==t||null==t.closest)return!1;var o=t.closest("input, textarea, [contenteditable=true]");if(null==o)return!1;if("input"===o.tagName.toLowerCase()){var n=o.type;if("checkbox"===n||"radio"===n)return!1}return!o.readOnly}function getDefaultDocument(){if("undefined"!=typeof window)return window.document}