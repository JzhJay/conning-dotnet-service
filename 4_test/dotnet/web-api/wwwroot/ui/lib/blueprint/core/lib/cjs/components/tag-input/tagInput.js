"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagInput=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_lifecycles_compat_1=require("react-lifecycles-compat"),common_1=require("../../common"),props_1=require("../../common/props"),icon_1=require("../icon/icon"),tag_1=require("../tag/tag"),NONE=-1,TagInput=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={activeIndex:NONE,inputValue:t.props.inputValue||"",isInputFocused:!1},t.inputElement=null,t.handleRef=common_1.refHandler(t,"inputElement",t.props.inputRef),t.addTags=function(e,n){void 0===n&&(n="default");var a=t.props,o=a.inputValue,s=a.onAdd,i=a.onChange,l=a.values,r=t.getValues(e),u=!1!==(null==s?void 0:s(r,n))&&void 0===o;common_1.Utils.isFunction(i)&&(u=!1!==i(tslib_1.__spreadArrays(l,r))&&u),u&&t.setState({inputValue:""})},t.maybeRenderTag=function(e,n){if(!e)return null;var a=t.props,o=a.large,s=a.tagProps,i=common_1.Utils.isFunction(s)?s(e,n):s;return React.createElement(tag_1.Tag,tslib_1.__assign({active:n===t.state.activeIndex,"data-tag-index":n,key:e+"__"+n,large:o,onRemove:t.props.disabled?void 0:t.handleRemoveTag},i),e)},t.handleContainerClick=function(){var e;null===(e=t.inputElement)||void 0===e||e.focus()},t.handleContainerBlur=function(e){var n=e.currentTarget;t.requestAnimationFrame((function(){n.contains(document.activeElement)||(t.props.addOnBlur&&void 0!==t.state.inputValue&&t.state.inputValue.length>0&&t.addTags(t.state.inputValue,"blur"),t.setState({activeIndex:NONE,isInputFocused:!1}))}))},t.handleInputFocus=function(e){var n,a;t.setState({isInputFocused:!0}),null===(a=null===(n=t.props.inputProps)||void 0===n?void 0:n.onFocus)||void 0===a||a.call(n,e)},t.handleInputChange=function(e){var n,a,o,s;t.setState({activeIndex:NONE,inputValue:e.currentTarget.value}),null===(a=(n=t.props).onInputChange)||void 0===a||a.call(n,e),null===(s=null===(o=t.props.inputProps)||void 0===o?void 0:o.onChange)||void 0===s||s.call(o,e)},t.handleInputKeyDown=function(e){var n=e.currentTarget,a=n.selectionEnd,o=n.value,s=t.state.activeIndex,i=s;if(e.which===common_1.Keys.ENTER&&o.length>0)t.addTags(o,"default");else if(0===a&&t.props.values.length>0)if(e.which===common_1.Keys.ARROW_LEFT||e.which===common_1.Keys.ARROW_RIGHT){var l=t.getNextActiveIndex(e.which===common_1.Keys.ARROW_RIGHT?1:-1);l!==s&&(e.stopPropagation(),i=l,t.setState({activeIndex:l}))}else e.which===common_1.Keys.BACKSPACE?t.handleBackspaceToRemove(e):e.which===common_1.Keys.DELETE&&t.handleDeleteToRemove(e);t.invokeKeyPressCallback("onKeyDown",e,i)},t.handleInputKeyUp=function(e){t.invokeKeyPressCallback("onKeyUp",e,t.state.activeIndex)},t.handleInputPaste=function(e){var n=t.props.separator,a=e.clipboardData.getData("text");t.props.addOnPaste&&0!==a.length&&!1!==n&&1!==a.split(n).length&&(e.preventDefault(),t.addTags(a,"paste"))},t.handleRemoveTag=function(e){var n=+e.currentTarget.parentElement.getAttribute("data-tag-index");t.removeIndexFromValues(n)},t}return tslib_1.__extends(t,e),t.getDerivedStateFromProps=function(e,t){return e.inputValue!==t.prevInputValueProp?{inputValue:e.inputValue,prevInputValueProp:e.inputValue}:null},t.prototype.render=function(){var e,t=this.props,n=t.className,a=t.disabled,o=t.fill,s=t.inputProps,i=t.intent,l=t.large,r=t.leftIcon,u=t.placeholder,p=t.values,c=classnames_1.default(common_1.Classes.INPUT,common_1.Classes.TAG_INPUT,((e={})[common_1.Classes.ACTIVE]=this.state.isInputFocused,e[common_1.Classes.DISABLED]=a,e[common_1.Classes.FILL]=o,e[common_1.Classes.LARGE]=l,e),common_1.Classes.intentClass(i),n),d=c.indexOf(common_1.Classes.LARGE)>NONE,m=p.some((function(e){return!!e})),h=null==u||m?null==s?void 0:s.placeholder:u;return React.createElement("div",{className:c,onBlur:this.handleContainerBlur,onClick:this.handleContainerClick},React.createElement(icon_1.Icon,{className:common_1.Classes.TAG_INPUT_ICON,icon:r,size:d?icon_1.IconSize.LARGE:icon_1.IconSize.STANDARD}),React.createElement("div",{className:common_1.Classes.TAG_INPUT_VALUES},p.map(this.maybeRenderTag),this.props.children,React.createElement("input",tslib_1.__assign({value:this.state.inputValue},s,{onFocus:this.handleInputFocus,onChange:this.handleInputChange,onKeyDown:this.handleInputKeyDown,onKeyUp:this.handleInputKeyUp,onPaste:this.handleInputPaste,placeholder:h,ref:this.handleRef,className:classnames_1.default(common_1.Classes.INPUT_GHOST,null==s?void 0:s.className),disabled:a}))),this.props.rightElement)},t.prototype.componentDidUpdate=function(e){e.inputRef!==this.props.inputRef&&(common_1.setRef(e.inputRef,null),this.handleRef=common_1.refHandler(this,"inputElement",this.props.inputRef),common_1.setRef(this.props.inputRef,this.inputElement))},t.prototype.getNextActiveIndex=function(e){var t=this.state.activeIndex;return t===NONE?e<0?this.findNextIndex(this.props.values.length,-1):NONE:this.findNextIndex(t,e)},t.prototype.findNextIndex=function(e,t){for(var n=this.props.values,a=e+t;a>0&&a<n.length&&!n[a];)a+=t;return common_1.Utils.clamp(a,0,n.length)},t.prototype.getValues=function(e){var t=this.props.separator;return(!1===t?[e]:e.split(t)).map((function(e){return e.trim()})).filter((function(e){return e.length>0}))},t.prototype.handleBackspaceToRemove=function(e){var t=this.state.activeIndex;this.setState({activeIndex:this.getNextActiveIndex(-1)}),this.isValidIndex(t)&&(e.stopPropagation(),this.removeIndexFromValues(t))},t.prototype.handleDeleteToRemove=function(e){var t=this.state.activeIndex;this.isValidIndex(t)&&(e.stopPropagation(),this.removeIndexFromValues(t))},t.prototype.removeIndexFromValues=function(e){var t=this.props,n=t.onChange,a=t.onRemove,o=t.values;null==a||a(o[e],e),common_1.Utils.isFunction(n)&&n(o.filter((function(t,n){return n!==e})))},t.prototype.invokeKeyPressCallback=function(e,t,n){var a,o,s,i;null===(o=(a=this.props)[e])||void 0===o||o.call(a,t,n===NONE?void 0:n),null===(i=(s=this.props.inputProps)[e])||void 0===i||i.call(s,t)},t.prototype.isValidIndex=function(e){return e!==NONE&&e<this.props.values.length},t.displayName=props_1.DISPLAYNAME_PREFIX+".TagInput",t.defaultProps={addOnBlur:!1,addOnPaste:!0,inputProps:{},separator:/[,\n\r]/,tagProps:{}},tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(common_1.AbstractPureComponent2);exports.TagInput=TagInput;