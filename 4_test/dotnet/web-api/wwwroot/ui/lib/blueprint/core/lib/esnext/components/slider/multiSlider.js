var MultiSlider_1;import{__decorate}from"tslib";import classNames from"classnames";import*as React from"react";import{polyfill}from"react-lifecycles-compat";import{AbstractPureComponent2,Classes,Intent}from"../../common";import*as Errors from"../../common/errors";import{DISPLAYNAME_PREFIX}from"../../common/props";import*as Utils from"../../common/utils";import{Handle}from"./handle";import{HandleInteractionKind,HandleType}from"./handleProps";import{argMin,fillValues,formatPercentage}from"./sliderUtils";const MultiSliderHandle=()=>null;MultiSliderHandle.displayName=`${DISPLAYNAME_PREFIX}.MultiSliderHandle`;let MultiSlider=MultiSlider_1=class extends AbstractPureComponent2{constructor(){super(...arguments),this.state={labelPrecision:getLabelPrecision(this.props),tickSize:0,tickSizeRatio:0},this.handleElements=[],this.trackElement=null,this.addHandleRef=e=>{null!=e&&this.handleElements.push(e)},this.maybeHandleTrackClick=e=>{if(this.canHandleTrackEvent(e)){const t=this.nearestHandleForValue(this.handleElements,(t=>t.mouseEventClientOffset(e)));t&&t.beginHandleMovement(e)}},this.maybeHandleTrackTouch=e=>{if(this.canHandleTrackEvent(e)){const t=this.nearestHandleForValue(this.handleElements,(t=>t.touchEventClientOffset(e)));t&&t.beginHandleTouchMovement(e)}},this.canHandleTrackEvent=e=>{const t=e.target;return!this.props.disabled&&null==t.closest(`.${Classes.SLIDER_HANDLE}`)},this.getHandlerForIndex=(e,t)=>l=>{t?.(this.getNewHandleValues(l,e))},this.handleChange=e=>{const t=getSortedInteractiveHandleProps(this.props),l=t.map((e=>e.value));Utils.arraysEqual(e,l)||(this.props.onChange?.(e),t.forEach(((t,s)=>{l[s]!==e[s]&&t.onChange?.(e[s])})))},this.handleRelease=e=>{const t=getSortedInteractiveHandleProps(this.props);this.props.onRelease?.(e),t.forEach(((t,l)=>{t.onRelease?.(e[l])}))}}static getDerivedStateFromProps(e){return{labelPrecision:MultiSlider_1.getLabelPrecision(e)}}static getLabelPrecision({labelPrecision:e,stepSize:t}){return null==e?Utils.countDecimalPlaces(t):e}getSnapshotBeforeUpdate(e){const t=getSortedInteractiveHandleProps(e);return getSortedInteractiveHandleProps(this.props).length!==t.length&&(this.handleElements=[]),null}render(){const e=classNames(Classes.SLIDER,{[Classes.DISABLED]:this.props.disabled,[`${Classes.SLIDER}-unlabeled`]:!1===this.props.labelRenderer,[Classes.VERTICAL]:this.props.vertical},this.props.className);return React.createElement("div",{className:e,onMouseDown:this.maybeHandleTrackClick,onTouchStart:this.maybeHandleTrackTouch},React.createElement("div",{className:Classes.SLIDER_TRACK,ref:e=>this.trackElement=e},this.renderTracks()),React.createElement("div",{className:Classes.SLIDER_AXIS},this.renderLabels()),this.renderHandles())}componentDidMount(){this.updateTickSize()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.updateTickSize()}validateProps(e){if(e.stepSize<=0)throw new Error(Errors.SLIDER_ZERO_STEP);if(void 0!==e.labelStepSize&&void 0!==e.labelValues)throw new Error(Errors.MULTISLIDER_WARN_LABEL_STEP_SIZE_LABEL_VALUES_MUTEX);if(void 0!==e.labelStepSize&&e.labelStepSize<=0)throw new Error(Errors.SLIDER_ZERO_LABEL_STEP);let t=!1;if(React.Children.forEach(e.children,(e=>{e&&!Utils.isElementOfType(e,MultiSlider_1.Handle)&&(t=!0)})),t)throw new Error(Errors.MULTISLIDER_INVALID_CHILD)}formatLabel(e,t=!1){const{labelRenderer:l}=this.props;return!1===l?void 0:Utils.isFunction(l)?l(e,{isHandleTooltip:t}):e.toFixed(this.state.labelPrecision)}renderLabels(){if(!1===this.props.labelRenderer)return null;const e=this.getLabelValues(),{max:t,min:l}=this.props;return e.map(((e,s)=>{const r=formatPercentage((e-l)/(t-l)),i=this.props.vertical?{bottom:r}:{left:r};return React.createElement("div",{className:Classes.SLIDER_LABEL,key:s,style:i},this.formatLabel(e))}))}renderTracks(){const e=getSortedHandleProps(this.props);e.push({value:this.props.max});let t={value:this.props.min};const l=[];for(let s=0;s<e.length;s++){const r=e[s];l.push(this.renderTrackFill(s,t,r)),t=r}return l}renderTrackFill(e,t,l){const[s,r]=[this.getOffsetRatio(t.value),this.getOffsetRatio(l.value)].sort(((e,t)=>e-t)),i=formatPercentage(s),a=formatPercentage(1-r),n={...this.props.vertical?{bottom:i,top:a,left:0}:{left:i,right:a,top:0},...t.trackStyleAfter||l.trackStyleBefore||{}},o=classNames(Classes.SLIDER_PROGRESS,Classes.intentClass(this.getTrackIntent(t,l)));return React.createElement("div",{key:`track-${e}`,className:o,style:n})}renderHandles(){const{disabled:e,max:t,min:l,stepSize:s,vertical:r}=this.props,i=getSortedInteractiveHandleProps(this.props);return 0===i.length?null:i.map((({value:a,type:n,className:o},d)=>React.createElement(Handle,{className:classNames({[Classes.START]:n===HandleType.START,[Classes.END]:n===HandleType.END},o),disabled:e,key:`${d}-${i.length}`,label:this.formatLabel(a,!0),max:t,min:l,onChange:this.getHandlerForIndex(d,this.handleChange),onRelease:this.getHandlerForIndex(d,this.handleRelease),ref:this.addHandleRef,stepSize:s,tickSize:this.state.tickSize,tickSizeRatio:this.state.tickSizeRatio,value:a,vertical:r})))}nearestHandleForValue(e,t){return argMin(e,(e=>{const l=t(e),s=e.clientToValue(l),r=e.props.value;return Math.abs(s-r)}))}getNewHandleValues(e,t){const l=getSortedInteractiveHandleProps(this.props).map((e=>e.value)),s=l.slice();s[t]=e,s.sort(((e,t)=>e-t));const r=s.indexOf(e),i=this.findFirstLockedHandleIndex(t,r);if(-1!==i){const e=l[i];return fillValues(l,t,i,e),l}return fillValues(s,t,r,e),s}findFirstLockedHandleIndex(e,t){const l=e<t?1:-1,s=getSortedInteractiveHandleProps(this.props);for(let r=e+l;r!==t+l;r+=l)if(s[r].interactionKind!==HandleInteractionKind.PUSH)return r;return-1}getLabelValues(){const{labelStepSize:e,labelValues:t,min:l,max:s}=this.props;let r=[];if(void 0!==t)r=t;else for(let t=l;t<s||Utils.approxEqual(t,s);t+=e??1)r.push(t);return r}getOffsetRatio(e){return Utils.clamp((e-this.props.min)*this.state.tickSizeRatio,0,1)}getTrackIntent(e,t){return this.props.showTrackFill?void 0!==e.intentAfter?e.intentAfter:void 0!==t&&void 0!==t.intentBefore?t.intentBefore:this.props.defaultTrackIntent:Intent.NONE}updateTickSize(){if(null!=this.trackElement){const e=this.props.vertical?this.trackElement.clientHeight:this.trackElement.clientWidth,t=1/(this.props.max-this.props.min),l=e*t;this.setState({tickSize:l,tickSizeRatio:t})}}};MultiSlider.defaultSliderProps={disabled:!1,max:10,min:0,showTrackFill:!0,stepSize:1,vertical:!1},MultiSlider.defaultProps={...MultiSlider_1.defaultSliderProps,defaultTrackIntent:Intent.NONE},MultiSlider.displayName=`${DISPLAYNAME_PREFIX}.MultiSlider`,MultiSlider.Handle=MultiSliderHandle,MultiSlider=MultiSlider_1=__decorate([polyfill],MultiSlider);export{MultiSlider};function getLabelPrecision({labelPrecision:e,stepSize:t=MultiSlider.defaultSliderProps.stepSize}){return null==e?Utils.countDecimalPlaces(t):e}function getSortedInteractiveHandleProps(e){return getSortedHandleProps(e,(e=>e.interactionKind!==HandleInteractionKind.NONE))}function getSortedHandleProps({children:e},t=(()=>!0)){const l=React.Children.map(e,(e=>Utils.isElementOfType(e,MultiSlider.Handle)&&t(e.props)?e.props:null));let s=null!=l?l:[];return s=s.filter((e=>null!==e)),s.sort(((e,t)=>e.value-t.value)),s}