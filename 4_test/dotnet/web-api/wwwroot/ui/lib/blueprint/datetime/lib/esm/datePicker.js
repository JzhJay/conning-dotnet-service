import{__assign,__decorate,__extends,__spreadArrays}from"tslib";import classNames from"classnames";import*as React from"react";import DayPicker from"react-day-picker";import{polyfill}from"react-lifecycles-compat";import{AbstractPureComponent2,Button,DISPLAYNAME_PREFIX,Divider}from"@blueprintjs/core";import*as Classes from"./common/classes";import*as DateUtils from"./common/dateUtils";import*as Errors from"./common/errors";import{DatePickerCaption}from"./datePickerCaption";import{getDefaultMaxDate,getDefaultMinDate}from"./datePickerCore";import{DatePickerNavbar}from"./datePickerNavbar";import{Shortcuts}from"./shortcuts";import{TimePicker}from"./timePicker";var DatePicker=function(e){function t(t,a){var r=e.call(this,t,a)||this;r.ignoreNextMonthChange=!1,r.shouldHighlightCurrentDay=function(e){return r.props.highlightCurrentDay&&DateUtils.isToday(e)},r.getDatePickerModifiers=function(){var e=r.props.modifiers;return __assign({isToday:r.shouldHighlightCurrentDay},e)},r.renderDay=function(e){var t=e.getDate();return React.createElement("div",{className:Classes.DATEPICKER_DAY_WRAPPER},t)},r.disabledDays=function(e){return!DateUtils.isDayInRange(e,[r.props.minDate,r.props.maxDate])},r.getDisabledDaysModifier=function(){var e=r.props.dayPickerProps.disabledDays;return Array.isArray(e)?__spreadArrays([r.disabledDays],e):[r.disabledDays,e]},r.renderCaption=function(e){return React.createElement(DatePickerCaption,__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate,onDateChange:r.handleMonthChange,reverseMonthAndYearMenus:r.props.reverseMonthAndYearMenus}))},r.renderNavbar=function(e){return React.createElement(DatePickerNavbar,__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate}))},r.handleDayClick=function(e,t,a){var n,i;if(null===(i=(n=r.props.dayPickerProps).onDayClick)||void 0===i||i.call(n,e,t,a),!t.disabled){r.updateDay(e);var o=r.props.canClearSelection&&t.selected?null:DateUtils.getDateTime(e,r.state.value);r.updateValue(o,!0)}},r.handleShortcutClick=function(e,t){var a=r.props,n=a.onShortcutChange,i=a.selectedShortcutIndex,o=e.dateRange,s=e.includeTime,l=o[0],c=s?l:DateUtils.getDateTime(l,r.state.value);r.updateDay(l),r.updateValue(c,!0),void 0===i&&r.setState({selectedShortcutIndex:t});var u=__assign(__assign({},e),{date:e.dateRange[0]});null==n||n(u,t)},r.updateDay=function(e){void 0===r.props.value&&r.setState({displayMonth:e.getMonth(),displayYear:e.getFullYear(),selectedDay:e.getDate()}),null!=r.state.value&&r.state.value.getMonth()!==e.getMonth()&&(r.ignoreNextMonthChange=!0)},r.handleClearClick=function(){return r.updateValue(null,!0)},r.handleMonthChange=function(e){var t,a,n=r.computeValidDateInSpecifiedMonthYear(e.getFullYear(),e.getMonth());r.setState({displayMonth:n.getMonth(),displayYear:n.getFullYear()}),null!==r.state.value&&(r.updateValue(n,!1,r.ignoreNextMonthChange),r.ignoreNextMonthChange=!1),null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n)},r.handleTodayClick=function(){var e=new Date,t=e.getMonth(),a=e.getFullYear(),n=e.getDate();r.setState({displayMonth:t,displayYear:a,selectedDay:n}),r.updateValue(e,!0)},r.handleTimeChange=function(e){var t,a;null===(a=null===(t=r.props.timePickerProps)||void 0===t?void 0:t.onChange)||void 0===a||a.call(t,e);var n=r.state.value,i=DateUtils.getDateTime(null!=n?n:new Date,e);r.updateValue(i,!0)};var n=getInitialValue(t),i=getInitialMonth(t,n);return r.state={displayMonth:i.getMonth(),displayYear:i.getFullYear(),selectedDay:null==n?null:n.getDate(),selectedShortcutIndex:void 0!==r.props.selectedShortcutIndex?r.props.selectedShortcutIndex:-1,value:n},r}return __extends(t,e),t.prototype.render=function(){var e,t=this.props,a=t.className,r=t.dayPickerProps,n=t.locale,i=t.localeUtils,o=t.maxDate,s=t.minDate,l=t.showActionsBar,c=this.state,u=c.displayMonth,d=c.displayYear;return React.createElement("div",{className:classNames(Classes.DATEPICKER,a)},this.maybeRenderShortcuts(),React.createElement("div",null,React.createElement(DayPicker,__assign({showOutsideDays:!0,locale:n,localeUtils:i,modifiers:this.getDatePickerModifiers()},r,{canChangeMonth:!0,captionElement:this.renderCaption,navbarElement:this.renderNavbar,disabledDays:this.getDisabledDaysModifier(),fromMonth:s,month:new Date(d,u),onDayClick:this.handleDayClick,onMonthChange:this.handleMonthChange,selectedDays:this.state.value,toMonth:o,renderDay:null!==(e=null==r?void 0:r.renderDay)&&void 0!==e?e:this.renderDay})),this.maybeRenderTimePicker(),l&&this.renderOptionsBar()))},t.prototype.componentDidUpdate=function(t,a){e.prototype.componentDidUpdate.call(this,t,a);var r=this.props.value;r!==t.value&&(null==r?this.setState({value:r}):this.setState({displayMonth:r.getMonth(),displayYear:r.getFullYear(),selectedDay:r.getDate(),value:r}),this.props.selectedShortcutIndex!==t.selectedShortcutIndex&&this.setState({selectedShortcutIndex:this.props.selectedShortcutIndex}))},t.prototype.validateProps=function(e){var t=e.defaultValue,a=e.initialMonth,r=e.maxDate,n=e.minDate,i=e.value;null==t||DateUtils.isDayInRange(t,[n,r])||console.error(Errors.DATEPICKER_DEFAULT_VALUE_INVALID),null==a||DateUtils.isMonthInRange(a,[n,r])||console.error(Errors.DATEPICKER_INITIAL_MONTH_INVALID),null!=r&&null!=n&&r<n&&!DateUtils.areSameDay(r,n)&&console.error(Errors.DATEPICKER_MAX_DATE_INVALID),null==i||DateUtils.isDayInRange(i,[n,r])||console.error(Errors.DATEPICKER_VALUE_INVALID)},t.prototype.renderOptionsBar=function(){var e=this.props,t=e.clearButtonText,a=e.todayButtonText;return[React.createElement(Divider,{key:"div"}),React.createElement("div",{className:Classes.DATEPICKER_FOOTER,key:"footer"},React.createElement(Button,{minimal:!0,onClick:this.handleTodayClick,text:a}),React.createElement(Button,{minimal:!0,onClick:this.handleClearClick,text:t}))]},t.prototype.maybeRenderTimePicker=function(){var e=this.props,t=e.timePrecision,a=e.timePickerProps,r=e.minDate,n=e.maxDate;if(null==t&&void 0===a)return null;var i=DateUtils.areSameDay(this.state.value,r),o=DateUtils.areSameDay(this.state.value,n);return React.createElement("div",{className:Classes.DATEPICKER_TIMEPICKER_WRAPPER},React.createElement(TimePicker,__assign({precision:t,minTime:i?r:void 0,maxTime:o?n:void 0},a,{onChange:this.handleTimeChange,value:this.state.value})))},t.prototype.maybeRenderShortcuts=function(){var e=this.props.shortcuts;if(null==e||!1===e)return null;var t=this.state.selectedShortcutIndex,a=this.props,r=a.maxDate,n=a.minDate,i=a.timePrecision,o=!0===e||e.map((function(e){return __assign(__assign({},e),{dateRange:[e.date,void 0]})}));return[React.createElement(Shortcuts,__assign({key:"shortcuts"},{allowSingleDayRange:!0,maxDate:r,minDate:n,selectedShortcutIndex:t,shortcuts:o,timePrecision:i},{onShortcutClick:this.handleShortcutClick,useSingleDateShortcuts:!0})),React.createElement(Divider,{key:"div"})]},t.prototype.computeValidDateInSpecifiedMonthYear=function(e,t){var a=this.props,r=a.minDate,n=a.maxDate,i=this.state.selectedDay,o=new Date(e,t+1,0).getDate(),s=null==i?1:Math.min(i,o),l=DateUtils.getDateTime(new Date(e,t,s,12),this.state.value);return l<r?r:l>n?n:l},t.prototype.updateValue=function(e,t,a){var r,n;void 0===a&&(a=!1),a||null===(n=(r=this.props).onChange)||void 0===n||n.call(r,e,t),void 0===this.props.value&&this.setState({value:e})},t.defaultProps={canClearSelection:!0,clearButtonText:"Clear",dayPickerProps:{},highlightCurrentDay:!1,maxDate:getDefaultMaxDate(),minDate:getDefaultMinDate(),reverseMonthAndYearMenus:!1,shortcuts:!1,showActionsBar:!1,todayButtonText:"Today"},t.displayName=DISPLAYNAME_PREFIX+".DatePicker",__decorate([polyfill],t)}(AbstractPureComponent2);export{DatePicker};function getInitialValue(e){return void 0!==e.value?e.value:void 0!==e.defaultValue?e.defaultValue:null}function getInitialMonth(e,t){var a=new Date;return null!=e.initialMonth?e.initialMonth:null!=t?t:DateUtils.isDayInRange(a,[e.minDate,e.maxDate])?a:DateUtils.getDateBetween([e.minDate,e.maxDate])}