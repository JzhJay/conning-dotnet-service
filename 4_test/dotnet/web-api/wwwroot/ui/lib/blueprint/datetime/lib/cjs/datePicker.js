"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DatePicker=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_day_picker_1=tslib_1.__importDefault(require("react-day-picker")),react_lifecycles_compat_1=require("react-lifecycles-compat"),core_1=require("@blueprintjs/core"),Classes=tslib_1.__importStar(require("./common/classes")),DateUtils=tslib_1.__importStar(require("./common/dateUtils")),Errors=tslib_1.__importStar(require("./common/errors")),datePickerCaption_1=require("./datePickerCaption"),datePickerCore_1=require("./datePickerCore"),datePickerNavbar_1=require("./datePickerNavbar"),shortcuts_1=require("./shortcuts"),timePicker_1=require("./timePicker"),DatePicker=function(e){function t(t,a){var r=e.call(this,t,a)||this;r.ignoreNextMonthChange=!1,r.shouldHighlightCurrentDay=function(e){return r.props.highlightCurrentDay&&DateUtils.isToday(e)},r.getDatePickerModifiers=function(){var e=r.props.modifiers;return tslib_1.__assign({isToday:r.shouldHighlightCurrentDay},e)},r.renderDay=function(e){var t=e.getDate();return React.createElement("div",{className:Classes.DATEPICKER_DAY_WRAPPER},t)},r.disabledDays=function(e){return!DateUtils.isDayInRange(e,[r.props.minDate,r.props.maxDate])},r.getDisabledDaysModifier=function(){var e=r.props.dayPickerProps.disabledDays;return Array.isArray(e)?tslib_1.__spreadArrays([r.disabledDays],e):[r.disabledDays,e]},r.renderCaption=function(e){return React.createElement(datePickerCaption_1.DatePickerCaption,tslib_1.__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate,onDateChange:r.handleMonthChange,reverseMonthAndYearMenus:r.props.reverseMonthAndYearMenus}))},r.renderNavbar=function(e){return React.createElement(datePickerNavbar_1.DatePickerNavbar,tslib_1.__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate}))},r.handleDayClick=function(e,t,a){var i,n;if(null===(n=(i=r.props.dayPickerProps).onDayClick)||void 0===n||n.call(i,e,t,a),!t.disabled){r.updateDay(e);var s=r.props.canClearSelection&&t.selected?null:DateUtils.getDateTime(e,r.state.value);r.updateValue(s,!0)}},r.handleShortcutClick=function(e,t){var a=r.props,i=a.onShortcutChange,n=a.selectedShortcutIndex,s=e.dateRange,l=e.includeTime,o=s[0],c=l?o:DateUtils.getDateTime(o,r.state.value);r.updateDay(o),r.updateValue(c,!0),void 0===n&&r.setState({selectedShortcutIndex:t});var u=tslib_1.__assign(tslib_1.__assign({},e),{date:e.dateRange[0]});null==i||i(u,t)},r.updateDay=function(e){void 0===r.props.value&&r.setState({displayMonth:e.getMonth(),displayYear:e.getFullYear(),selectedDay:e.getDate()}),null!=r.state.value&&r.state.value.getMonth()!==e.getMonth()&&(r.ignoreNextMonthChange=!0)},r.handleClearClick=function(){return r.updateValue(null,!0)},r.handleMonthChange=function(e){var t,a,i=r.computeValidDateInSpecifiedMonthYear(e.getFullYear(),e.getMonth());r.setState({displayMonth:i.getMonth(),displayYear:i.getFullYear()}),null!==r.state.value&&(r.updateValue(i,!1,r.ignoreNextMonthChange),r.ignoreNextMonthChange=!1),null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,i)},r.handleTodayClick=function(){var e=new Date,t=e.getMonth(),a=e.getFullYear(),i=e.getDate();r.setState({displayMonth:t,displayYear:a,selectedDay:i}),r.updateValue(e,!0)},r.handleTimeChange=function(e){var t,a;null===(a=null===(t=r.props.timePickerProps)||void 0===t?void 0:t.onChange)||void 0===a||a.call(t,e);var i=r.state.value,n=DateUtils.getDateTime(null!=i?i:new Date,e);r.updateValue(n,!0)};var i=getInitialValue(t),n=getInitialMonth(t,i);return r.state={displayMonth:n.getMonth(),displayYear:n.getFullYear(),selectedDay:null==i?null:i.getDate(),selectedShortcutIndex:void 0!==r.props.selectedShortcutIndex?r.props.selectedShortcutIndex:-1,value:i},r}return tslib_1.__extends(t,e),t.prototype.render=function(){var e,t=this.props,a=t.className,r=t.dayPickerProps,i=t.locale,n=t.localeUtils,s=t.maxDate,l=t.minDate,o=t.showActionsBar,c=this.state,u=c.displayMonth,d=c.displayYear;return React.createElement("div",{className:classnames_1.default(Classes.DATEPICKER,a)},this.maybeRenderShortcuts(),React.createElement("div",null,React.createElement(react_day_picker_1.default,tslib_1.__assign({showOutsideDays:!0,locale:i,localeUtils:n,modifiers:this.getDatePickerModifiers()},r,{canChangeMonth:!0,captionElement:this.renderCaption,navbarElement:this.renderNavbar,disabledDays:this.getDisabledDaysModifier(),fromMonth:l,month:new Date(d,u),onDayClick:this.handleDayClick,onMonthChange:this.handleMonthChange,selectedDays:this.state.value,toMonth:s,renderDay:null!==(e=null==r?void 0:r.renderDay)&&void 0!==e?e:this.renderDay})),this.maybeRenderTimePicker(),o&&this.renderOptionsBar()))},t.prototype.componentDidUpdate=function(t,a){e.prototype.componentDidUpdate.call(this,t,a);var r=this.props.value;r!==t.value&&(null==r?this.setState({value:r}):this.setState({displayMonth:r.getMonth(),displayYear:r.getFullYear(),selectedDay:r.getDate(),value:r}),this.props.selectedShortcutIndex!==t.selectedShortcutIndex&&this.setState({selectedShortcutIndex:this.props.selectedShortcutIndex}))},t.prototype.validateProps=function(e){var t=e.defaultValue,a=e.initialMonth,r=e.maxDate,i=e.minDate,n=e.value;null==t||DateUtils.isDayInRange(t,[i,r])||console.error(Errors.DATEPICKER_DEFAULT_VALUE_INVALID),null==a||DateUtils.isMonthInRange(a,[i,r])||console.error(Errors.DATEPICKER_INITIAL_MONTH_INVALID),null!=r&&null!=i&&r<i&&!DateUtils.areSameDay(r,i)&&console.error(Errors.DATEPICKER_MAX_DATE_INVALID),null==n||DateUtils.isDayInRange(n,[i,r])||console.error(Errors.DATEPICKER_VALUE_INVALID)},t.prototype.renderOptionsBar=function(){var e=this.props,t=e.clearButtonText,a=e.todayButtonText;return[React.createElement(core_1.Divider,{key:"div"}),React.createElement("div",{className:Classes.DATEPICKER_FOOTER,key:"footer"},React.createElement(core_1.Button,{minimal:!0,onClick:this.handleTodayClick,text:a}),React.createElement(core_1.Button,{minimal:!0,onClick:this.handleClearClick,text:t}))]},t.prototype.maybeRenderTimePicker=function(){var e=this.props,t=e.timePrecision,a=e.timePickerProps,r=e.minDate,i=e.maxDate;if(null==t&&void 0===a)return null;var n=DateUtils.areSameDay(this.state.value,r),s=DateUtils.areSameDay(this.state.value,i);return React.createElement("div",{className:Classes.DATEPICKER_TIMEPICKER_WRAPPER},React.createElement(timePicker_1.TimePicker,tslib_1.__assign({precision:t,minTime:n?r:void 0,maxTime:s?i:void 0},a,{onChange:this.handleTimeChange,value:this.state.value})))},t.prototype.maybeRenderShortcuts=function(){var e=this.props.shortcuts;if(null==e||!1===e)return null;var t=this.state.selectedShortcutIndex,a=this.props,r=a.maxDate,i=a.minDate,n=a.timePrecision,s=!0===e||e.map((function(e){return tslib_1.__assign(tslib_1.__assign({},e),{dateRange:[e.date,void 0]})}));return[React.createElement(shortcuts_1.Shortcuts,tslib_1.__assign({key:"shortcuts"},{allowSingleDayRange:!0,maxDate:r,minDate:i,selectedShortcutIndex:t,shortcuts:s,timePrecision:n},{onShortcutClick:this.handleShortcutClick,useSingleDateShortcuts:!0})),React.createElement(core_1.Divider,{key:"div"})]},t.prototype.computeValidDateInSpecifiedMonthYear=function(e,t){var a=this.props,r=a.minDate,i=a.maxDate,n=this.state.selectedDay,s=new Date(e,t+1,0).getDate(),l=null==n?1:Math.min(n,s),o=DateUtils.getDateTime(new Date(e,t,l,12),this.state.value);return o<r?r:o>i?i:o},t.prototype.updateValue=function(e,t,a){var r,i;void 0===a&&(a=!1),a||null===(i=(r=this.props).onChange)||void 0===i||i.call(r,e,t),void 0===this.props.value&&this.setState({value:e})},t.defaultProps={canClearSelection:!0,clearButtonText:"Clear",dayPickerProps:{},highlightCurrentDay:!1,maxDate:datePickerCore_1.getDefaultMaxDate(),minDate:datePickerCore_1.getDefaultMinDate(),reverseMonthAndYearMenus:!1,shortcuts:!1,showActionsBar:!1,todayButtonText:"Today"},t.displayName=core_1.DISPLAYNAME_PREFIX+".DatePicker",tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(core_1.AbstractPureComponent2);function getInitialValue(e){return void 0!==e.value?e.value:void 0!==e.defaultValue?e.defaultValue:null}function getInitialMonth(e,t){var a=new Date;return null!=e.initialMonth?e.initialMonth:null!=t?t:DateUtils.isDayInRange(a,[e.minDate,e.maxDate])?a:DateUtils.getDateBetween([e.minDate,e.maxDate])}exports.DatePicker=DatePicker;