import{__assign,__extends,__rest}from"tslib";import classNames from"classnames";import*as React from"react";import{AbstractPureComponent2,Classes as CoreClasses,DISPLAYNAME_PREFIX,Keys,Popover,PopoverInteractionKind,Position,TagInput,refHandler,setRef}from"@blueprintjs/core";import{Classes}from"../../common";import{QueryList}from"../query-list/queryList";var MultiSelect=function(e){function n(){var n,t=e.apply(this,arguments)||this;return t.state={isOpen:t.props.popoverProps&&t.props.popoverProps.isOpen||!1},t.TypedQueryList=QueryList.ofType(),t.input=null,t.queryList=null,t.refHandlers={input:refHandler(t,"input",null===(n=t.props.tagInputProps)||void 0===n?void 0:n.inputRef),queryList:function(e){return t.queryList=e}},t.renderQueryList=function(e){var n,o=t.props,s=o.fill,r=o.tagInputProps,p=void 0===r?{}:r,a=o.popoverProps,i=void 0===a?{}:a,l=o.selectedItems,u=void 0===l?[]:l,c=o.placeholder,d=e.handlePaste,v=e.handleKeyDown,m=e.handleKeyUp;s&&(i.fill=!0,p.fill=!0);var f=__assign(__assign({},p.inputProps),{className:classNames(null===(n=p.inputProps)||void 0===n?void 0:n.className,Classes.MULTISELECT_TAG_INPUT_INPUT)});return React.createElement(Popover,__assign({autoFocus:!1,canEscapeKeyClose:!0,enforceFocus:!1,isOpen:t.state.isOpen,position:Position.BOTTOM_LEFT},i,{className:classNames(e.className,i.className),interactionKind:PopoverInteractionKind.CLICK,onInteraction:t.handlePopoverInteraction,popoverClassName:classNames(Classes.MULTISELECT_POPOVER,i.popoverClassName),onOpened:t.handlePopoverOpened}),React.createElement("div",{onKeyDown:t.getTagInputKeyDownHandler(v),onKeyUp:t.getTagInputKeyUpHandler(m)},React.createElement(TagInput,__assign({placeholder:c},p,{className:classNames(Classes.MULTISELECT,p.className),inputRef:t.refHandlers.input,inputProps:f,inputValue:e.query,onAdd:function(e,n){"paste"===n&&d(e)},onInputChange:e.handleQueryChange,onRemove:t.handleTagRemove,values:u.map(t.props.tagRenderer)}))),React.createElement("div",{onKeyDown:v,onKeyUp:m},e.itemList))},t.handleItemSelect=function(e,n){var o,s;null!=t.input&&t.input.focus(),null===(s=(o=t.props).onItemSelect)||void 0===s||s.call(o,e,n)},t.handleQueryChange=function(e,n){var o,s;t.setState({isOpen:e.length>0||!t.props.openOnKeyDown}),null===(s=(o=t.props).onQueryChange)||void 0===s||s.call(o,e,n)},t.handlePopoverInteraction=function(e,n){return t.requestAnimationFrame((function(){var o,s,r=t.input===document.activeElement;null==t.input||r?t.props.openOnKeyDown||t.setState({isOpen:!0}):t.setState({isOpen:!1}),null===(s=null===(o=t.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===s||s.call(o,e,n)}))},t.handlePopoverOpened=function(e){var n,o;null!=t.queryList&&t.queryList.scrollActiveItemIntoView(),null===(o=null===(n=t.props.popoverProps)||void 0===n?void 0:n.onOpened)||void 0===o||o.call(n,e)},t.handleTagRemove=function(e,n){var o,s=t.props,r=s.selectedItems,p=void 0===r?[]:r,a=s.onRemove,i=s.tagInputProps;null==a||a(p[n],n),null===(o=null==i?void 0:i.onRemove)||void 0===o||o.call(i,e,n)},t.getTagInputKeyDownHandler=function(e){return function(n){var o=n.which;o===Keys.ESCAPE||o===Keys.TAB?(null!=t.input&&t.input.blur(),t.setState({isOpen:!1})):o!==Keys.BACKSPACE&&o!==Keys.ARROW_LEFT&&o!==Keys.ARROW_RIGHT&&t.setState({isOpen:!0});var s=null!=n.target.closest("."+CoreClasses.TAG_REMOVE);t.state.isOpen&&!s&&(null==e||e(n))}},t.getTagInputKeyUpHandler=function(e){return function(n){var o=n.target.classList.contains(Classes.MULTISELECT_TAG_INPUT_INPUT);t.state.isOpen&&o&&(null==e||e(n))}},t}return __extends(n,e),n.ofType=function(){return n},n.prototype.componentDidUpdate=function(e){var n,t,o,s,r;(null===(n=e.tagInputProps)||void 0===n?void 0:n.inputRef)!==(null===(t=this.props.tagInputProps)||void 0===t?void 0:t.inputRef)&&(setRef(null===(o=e.tagInputProps)||void 0===o?void 0:o.inputRef,null),this.refHandlers.input=refHandler(this,"input",null===(s=this.props.tagInputProps)||void 0===s?void 0:s.inputRef),setRef(null===(r=this.props.tagInputProps)||void 0===r?void 0:r.inputRef,this.input))},n.prototype.render=function(){var e=this.props,n=(e.openOnKeyDown,e.popoverProps,e.tagInputProps,__rest(e,["openOnKeyDown","popoverProps","tagInputProps"]));return React.createElement(this.TypedQueryList,__assign({},n,{onItemSelect:this.handleItemSelect,onQueryChange:this.handleQueryChange,ref:this.refHandlers.queryList,renderer:this.renderQueryList}))},n.displayName=DISPLAYNAME_PREFIX+".MultiSelect",n.defaultProps={fill:!1,placeholder:"Search..."},n}(AbstractPureComponent2);export{MultiSelect};