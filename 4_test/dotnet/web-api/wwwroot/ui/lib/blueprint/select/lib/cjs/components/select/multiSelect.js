"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultiSelect=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),common_1=require("../../common"),queryList_1=require("../query-list/queryList"),MultiSelect=function(e){function n(){var n,t=e.apply(this,arguments)||this;return t.state={isOpen:t.props.popoverProps&&t.props.popoverProps.isOpen||!1},t.TypedQueryList=queryList_1.QueryList.ofType(),t.input=null,t.queryList=null,t.refHandlers={input:core_1.refHandler(t,"input",null===(n=t.props.tagInputProps)||void 0===n?void 0:n.inputRef),queryList:function(e){return t.queryList=e}},t.renderQueryList=function(e){var n,o=t.props,s=o.fill,r=o.tagInputProps,i=void 0===r?{}:r,l=o.popoverProps,p=void 0===l?{}:l,a=o.selectedItems,u=void 0===a?[]:a,c=o.placeholder,d=e.handlePaste,_=e.handleKeyDown,v=e.handleKeyUp;s&&(p.fill=!0,i.fill=!0);var m=tslib_1.__assign(tslib_1.__assign({},i.inputProps),{className:classnames_1.default(null===(n=i.inputProps)||void 0===n?void 0:n.className,common_1.Classes.MULTISELECT_TAG_INPUT_INPUT)});return React.createElement(core_1.Popover,tslib_1.__assign({autoFocus:!1,canEscapeKeyClose:!0,enforceFocus:!1,isOpen:t.state.isOpen,position:core_1.Position.BOTTOM_LEFT},p,{className:classnames_1.default(e.className,p.className),interactionKind:core_1.PopoverInteractionKind.CLICK,onInteraction:t.handlePopoverInteraction,popoverClassName:classnames_1.default(common_1.Classes.MULTISELECT_POPOVER,p.popoverClassName),onOpened:t.handlePopoverOpened}),React.createElement("div",{onKeyDown:t.getTagInputKeyDownHandler(_),onKeyUp:t.getTagInputKeyUpHandler(v)},React.createElement(core_1.TagInput,tslib_1.__assign({placeholder:c},i,{className:classnames_1.default(common_1.Classes.MULTISELECT,i.className),inputRef:t.refHandlers.input,inputProps:m,inputValue:e.query,onAdd:function(e,n){"paste"===n&&d(e)},onInputChange:e.handleQueryChange,onRemove:t.handleTagRemove,values:u.map(t.props.tagRenderer)}))),React.createElement("div",{onKeyDown:_,onKeyUp:v},e.itemList))},t.handleItemSelect=function(e,n){var o,s;null!=t.input&&t.input.focus(),null===(s=(o=t.props).onItemSelect)||void 0===s||s.call(o,e,n)},t.handleQueryChange=function(e,n){var o,s;t.setState({isOpen:e.length>0||!t.props.openOnKeyDown}),null===(s=(o=t.props).onQueryChange)||void 0===s||s.call(o,e,n)},t.handlePopoverInteraction=function(e,n){return t.requestAnimationFrame((function(){var o,s,r=t.input===document.activeElement;null==t.input||r?t.props.openOnKeyDown||t.setState({isOpen:!0}):t.setState({isOpen:!1}),null===(s=null===(o=t.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===s||s.call(o,e,n)}))},t.handlePopoverOpened=function(e){var n,o;null!=t.queryList&&t.queryList.scrollActiveItemIntoView(),null===(o=null===(n=t.props.popoverProps)||void 0===n?void 0:n.onOpened)||void 0===o||o.call(n,e)},t.handleTagRemove=function(e,n){var o,s=t.props,r=s.selectedItems,i=void 0===r?[]:r,l=s.onRemove,p=s.tagInputProps;null==l||l(i[n],n),null===(o=null==p?void 0:p.onRemove)||void 0===o||o.call(p,e,n)},t.getTagInputKeyDownHandler=function(e){return function(n){var o=n.which;o===core_1.Keys.ESCAPE||o===core_1.Keys.TAB?(null!=t.input&&t.input.blur(),t.setState({isOpen:!1})):o!==core_1.Keys.BACKSPACE&&o!==core_1.Keys.ARROW_LEFT&&o!==core_1.Keys.ARROW_RIGHT&&t.setState({isOpen:!0});var s=null!=n.target.closest("."+core_1.Classes.TAG_REMOVE);t.state.isOpen&&!s&&(null==e||e(n))}},t.getTagInputKeyUpHandler=function(e){return function(n){var o=n.target.classList.contains(common_1.Classes.MULTISELECT_TAG_INPUT_INPUT);t.state.isOpen&&o&&(null==e||e(n))}},t}return tslib_1.__extends(n,e),n.ofType=function(){return n},n.prototype.componentDidUpdate=function(e){var n,t,o,s,r;(null===(n=e.tagInputProps)||void 0===n?void 0:n.inputRef)!==(null===(t=this.props.tagInputProps)||void 0===t?void 0:t.inputRef)&&(core_1.setRef(null===(o=e.tagInputProps)||void 0===o?void 0:o.inputRef,null),this.refHandlers.input=core_1.refHandler(this,"input",null===(s=this.props.tagInputProps)||void 0===s?void 0:s.inputRef),core_1.setRef(null===(r=this.props.tagInputProps)||void 0===r?void 0:r.inputRef,this.input))},n.prototype.render=function(){var e=this.props,n=(e.openOnKeyDown,e.popoverProps,e.tagInputProps,tslib_1.__rest(e,["openOnKeyDown","popoverProps","tagInputProps"]));return React.createElement(this.TypedQueryList,tslib_1.__assign({},n,{onItemSelect:this.handleItemSelect,onQueryChange:this.handleQueryChange,ref:this.refHandlers.queryList,renderer:this.renderQueryList}))},n.displayName=core_1.DISPLAYNAME_PREFIX+".MultiSelect",n.defaultProps={fill:!1,placeholder:"Search..."},n}(core_1.AbstractPureComponent2);exports.MultiSelect=MultiSelect;