"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Select=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),common_1=require("../../common"),queryList_1=require("../query-list/queryList"),Select=function(e){function t(){var t,n=e.apply(this,arguments)||this;return n.state={isOpen:!1},n.TypedQueryList=queryList_1.QueryList.ofType(),n.inputElement=null,n.queryList=null,n.handleInputRef=core_1.refHandler(n,"inputElement",null===(t=n.props.inputProps)||void 0===t?void 0:t.inputRef),n.handleQueryListRef=function(e){return n.queryList=e},n.renderQueryList=function(e){var t,o=n.props,r=o.fill,i=o.filterable,s=void 0===i||i,l=o.disabled,p=void 0!==l&&l,u=o.inputProps,a=void 0===u?{}:u,c=o.popoverProps,d=void 0===c?{}:c,v=o.matchTargetWidth;r&&(d.fill=!0),v&&(null==d.modifiers&&(d.modifiers={}),d.modifiers.minWidth={enabled:!0,fn:function(e){return e.styles.width=e.offsets.reference.width+"px",e},order:800},d.usePortal=!1,d.wrapperTagName="div");var m=React.createElement(core_1.InputGroup,tslib_1.__assign({leftIcon:"search",placeholder:"Filter...",rightElement:n.maybeRenderClearButton(e.query)},a,{inputRef:n.handleInputRef,onChange:e.handleQueryChange,value:e.query})),f=e.handleKeyDown,h=e.handleKeyUp;return React.createElement(core_1.Popover,tslib_1.__assign({autoFocus:!1,enforceFocus:!1,isOpen:n.state.isOpen,disabled:p,position:core_1.Position.BOTTOM_LEFT},d,{className:classnames_1.default(e.className,d.className),onInteraction:n.handlePopoverInteraction,popoverClassName:classnames_1.default(common_1.Classes.SELECT_POPOVER,d.popoverClassName,(t={},t[common_1.Classes.SELECT_MATCH_TARGET_WIDTH]=v,t)),onOpening:n.handlePopoverOpening,onOpened:n.handlePopoverOpened,onClosing:n.handlePopoverClosing}),React.createElement("div",{onKeyDown:n.state.isOpen?f:n.handleTargetKeyDown,onKeyUp:n.state.isOpen?h:void 0},n.props.children),React.createElement("div",{onKeyDown:f,onKeyUp:h},s?m:void 0,e.itemList))},n.handleTargetKeyDown=function(e){e.which!==core_1.Keys.ARROW_UP&&e.which!==core_1.Keys.ARROW_DOWN||(e.preventDefault(),n.setState({isOpen:!0}))},n.handleItemSelect=function(e,t){var o,r;n.setState({isOpen:!1}),null===(r=(o=n.props).onItemSelect)||void 0===r||r.call(o,e,t)},n.handlePopoverInteraction=function(e,t){var o,r;n.setState({isOpen:e}),null===(r=null===(o=n.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===r||r.call(o,e,t)},n.handlePopoverOpening=function(e){var t,o;n.previousFocusedElement=document.activeElement,n.props.resetOnClose&&n.resetQuery(),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpening)||void 0===o||o.call(t,e)},n.handlePopoverOpened=function(e){var t,o;null!=n.queryList&&n.queryList.scrollActiveItemIntoView(),n.requestAnimationFrame((function(){var e,t=n.props.inputProps;!1!==(void 0===t?{}:t).autoFocus&&(null===(e=n.inputElement)||void 0===e||e.focus())})),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpened)||void 0===o||o.call(t,e)},n.handlePopoverClosing=function(e){var t,o;n.requestAnimationFrame((function(){void 0!==n.previousFocusedElement&&(n.previousFocusedElement.focus(),n.previousFocusedElement=void 0)})),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onClosing)||void 0===o||o.call(t,e)},n.resetQuery=function(){return n.queryList&&n.queryList.setQuery("",!0)},n}return tslib_1.__extends(t,e),t.ofType=function(){return t},t.prototype.render=function(){var e=this.props,t=(e.filterable,e.inputProps,e.popoverProps,tslib_1.__rest(e,["filterable","inputProps","popoverProps"]));return React.createElement(this.TypedQueryList,tslib_1.__assign({},t,{onItemSelect:this.handleItemSelect,ref:this.handleQueryListRef,renderer:this.renderQueryList}))},t.prototype.componentDidUpdate=function(e,t){var n,o,r,i,s;(null===(n=e.inputProps)||void 0===n?void 0:n.inputRef)!==(null===(o=this.props.inputProps)||void 0===o?void 0:o.inputRef)&&(core_1.setRef(null===(r=e.inputProps)||void 0===r?void 0:r.inputRef,null),this.handleInputRef=core_1.refHandler(this,"inputElement",null===(i=this.props.inputProps)||void 0===i?void 0:i.inputRef),core_1.setRef(null===(s=this.props.inputProps)||void 0===s?void 0:s.inputRef,this.inputElement)),this.state.isOpen&&!t.isOpen&&null!=this.queryList&&this.queryList.scrollActiveItemIntoView()},t.prototype.maybeRenderClearButton=function(e){return e.length>0?React.createElement(core_1.Button,{icon:"cross",minimal:!0,onClick:this.resetQuery}):void 0},t.displayName=core_1.DISPLAYNAME_PREFIX+".Select",t}(core_1.AbstractPureComponent2);exports.Select=Select;