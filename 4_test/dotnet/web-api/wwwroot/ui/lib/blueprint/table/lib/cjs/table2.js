"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Table2=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),column_1=require("./column"),Classes=tslib_1.__importStar(require("./common/classes")),context_1=require("./common/context"),Errors=tslib_1.__importStar(require("./common/errors")),grid_1=require("./common/grid"),FocusedCellUtils=tslib_1.__importStar(require("./common/internal/focusedCellUtils")),ScrollUtils=tslib_1.__importStar(require("./common/internal/scrollUtils")),rect_1=require("./common/rect"),renderMode_1=require("./common/renderMode"),utils_1=require("./common/utils"),columnHeader_1=require("./headers/columnHeader"),columnHeaderCell_1=require("./headers/columnHeaderCell"),rowHeader_1=require("./headers/rowHeader"),resizeSensor_1=require("./interactions/resizeSensor"),guides_1=require("./layers/guides"),regions_1=require("./layers/regions"),locator_1=require("./locator"),tableQuadrant_1=require("./quadrants/tableQuadrant"),tableQuadrantStack_1=require("./quadrants/tableQuadrantStack"),regions_2=require("./regions"),resizeRows_1=require("./resizeRows"),table2Utils_1=require("./table2Utils"),tableBody_1=require("./tableBody"),tableHotkeys_1=require("./tableHotkeys"),tableUtils_1=require("./tableUtils"),Table2=function(e){function t(n,o){var r=e.call(this,n,o)||this;r.hotkeys=[],r.refHandlers={cellContainer:function(e){return r.cellContainerElement=e},columnHeader:function(e){return r.columnHeaderElement=e},quadrantStack:function(e){return r.quadrantStackInstance=e},rootTable:function(e){return r.rootTableElement=e},rowHeader:function(e){return r.rowHeaderElement=e},scrollContainer:function(e){return r.scrollContainerElement=e}},r.didCompletelyMount=!1,r.renderTableContents=function(e){var t,n=e.handleKeyDown,o=e.handleKeyUp,l=r.props,i=l.children,s=l.className,a=l.enableRowHeader,d=l.loadingOptions,u=l.numRows,c=l.enableColumnInteractionBar,g=r.state,h=g.horizontalGuides,R=g.numFrozenColumnsClamped,p=g.numFrozenRowsClamped,m=g.verticalGuides;r.gridDimensionsMatchProps()||r.invalidateGrid(),r.validateGrid();var _=classnames_1.default(Classes.TABLE_CONTAINER,((t={})[Classes.TABLE_REORDERING]=r.state.isReordering,t[Classes.TABLE_NO_VERTICAL_SCROLL]=r.shouldDisableVerticalScroll(),t[Classes.TABLE_NO_HORIZONTAL_SCROLL]=r.shouldDisableHorizontalScroll(),t[Classes.TABLE_SELECTION_ENABLED]=table2Utils_1.isSelectionModeEnabled(r.props,regions_2.RegionCardinality.CELLS),t[Classes.TABLE_NO_ROWS]=0===u,t),s);return React.createElement("div",{className:_,ref:r.refHandlers.rootTable,onScroll:r.handleRootScroll,onKeyDown:n,onKeyUp:o,tabIndex:0},React.createElement(tableQuadrantStack_1.TableQuadrantStack,{bodyRef:r.refHandlers.cellContainer,bodyRenderer:r.renderBody,columnHeaderCellRenderer:r.renderColumnHeader,columnHeaderRef:r.refHandlers.columnHeader,enableColumnInteractionBar:c,enableRowHeader:a,grid:r.grid,handleColumnResizeGuide:r.handleColumnResizeGuide,handleColumnsReordering:r.handleColumnsReordering,handleRowResizeGuide:r.handleRowResizeGuide,handleRowsReordering:r.handleRowsReordering,isHorizontalScrollDisabled:r.shouldDisableHorizontalScroll(),isVerticalScrollDisabled:r.shouldDisableVerticalScroll(),loadingOptions:d,numColumns:React.Children.count(i),numFrozenColumns:R,numFrozenRows:p,numRows:u,onScroll:r.handleBodyScroll,ref:r.refHandlers.quadrantStack,menuRenderer:r.renderMenu,rowHeaderCellRenderer:r.renderRowHeader,rowHeaderRef:r.refHandlers.rowHeader,scrollContainerRef:r.refHandlers.scrollContainer}),React.createElement("div",{className:classnames_1.default(Classes.TABLE_OVERLAY_LAYER,Classes.TABLE_OVERLAY_REORDERING_CURSOR)}),React.createElement(guides_1.GuideLayer,{className:Classes.TABLE_RESIZE_GUIDES,verticalGuides:m,horizontalGuides:h}))},r.renderMenu=function(e){var t,n=classnames_1.default(Classes.TABLE_MENU,((t={})[Classes.TABLE_SELECTION_ENABLED]=table2Utils_1.isSelectionModeEnabled(r.props,regions_2.RegionCardinality.FULL_TABLE),t));return React.createElement("div",{className:n,ref:e,onMouseDown:r.handleMenuMouseDown},r.maybeRenderRegions(r.styleMenuRegion))},r.handleMenuMouseDown=function(e){r.selectAll(!e.shiftKey)},r.selectAll=function(e){if(r.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_TABLE)([regions_2.Regions.table()]),e){var t=regions_2.Regions.getFocusCellCoordinatesFromRegion(regions_2.Regions.table());r.handleFocus(FocusedCellUtils.toFullCoordinates(t))}},r.columnHeaderCellRenderer=function(e){var t=r.getColumnProps(e);if(void 0===t)return null;t.id;var n=t.loadingOptions,o=(t.cellRenderer,t.columnHeaderCellRenderer),l=tslib_1.__rest(t,["id","loadingOptions","cellRenderer","columnHeaderCellRenderer"]),i=tableUtils_1.hasLoadingOption(n,regions_2.ColumnLoadingOption.HEADER);if(null!=o){var s=o(e),a=s.props.loading,d={loading:null!=a?a:i};return React.cloneElement(s,d)}var u=tslib_1.__assign({index:e,loading:i},l);return null!=t.name?React.createElement(columnHeaderCell_1.ColumnHeaderCell,tslib_1.__assign({},u)):React.createElement(columnHeaderCell_1.ColumnHeaderCell,tslib_1.__assign({},u,{name:utils_1.Utils.toBase26Alpha(e)}))},r.renderColumnHeader=function(e,t,n,o){var l;void 0===o&&(o=!1);var i=r.state,s=i.focusedCell,a=i.selectedRegions,d=i.viewportRect,u=r.props,c=u.enableMultipleSelection,g=u.enableGhostCells,h=u.enableColumnReordering,R=u.enableColumnResizing,p=u.loadingOptions,m=u.maxColumnWidth,_=u.minColumnWidth,C=u.selectedRegionTransform,E=classnames_1.default(Classes.TABLE_COLUMN_HEADERS,((l={})[Classes.TABLE_SELECTION_ENABLED]=table2Utils_1.isSelectionModeEnabled(r.props,regions_2.RegionCardinality.FULL_COLUMNS),l)),S=r.grid.getColumnIndicesInRect(d,g),f=o?0:S.columnIndexStart,w=o?r.getMaxFrozenColumnIndex():S.columnIndexEnd;return React.createElement("div",{className:E},React.createElement(columnHeader_1.ColumnHeader,{enableMultipleSelection:c,cellRenderer:r.columnHeaderCellRenderer,focusedCell:s,grid:r.grid,isReorderable:h,isResizable:R,loading:tableUtils_1.hasLoadingOption(p,regions_2.TableLoadingOption.COLUMN_HEADERS),locator:r.locator,maxColumnWidth:m,measurableElementRef:e,minColumnWidth:_,onColumnWidthChanged:r.handleColumnWidthChanged,onFocusedCell:r.handleFocus,onLayoutLock:r.handleLayoutLock,onReordered:r.handleColumnsReordered,onReordering:n,onResizeGuide:t,onSelection:r.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_COLUMNS),selectedRegions:a,selectedRegionTransform:C,columnIndexStart:f,columnIndexEnd:w},r.props.children),r.maybeRenderRegions(r.styleColumnHeaderRegion))},r.renderRowHeader=function(e,t,n,o){var l;void 0===o&&(o=!1);var i=r.state,s=i.focusedCell,a=i.selectedRegions,d=i.viewportRect,u=r.props,c=u.enableMultipleSelection,g=u.enableGhostCells,h=u.enableRowReordering,R=u.enableRowResizing,p=u.loadingOptions,m=u.maxRowHeight,_=u.minRowHeight,C=u.rowHeaderCellRenderer,E=u.selectedRegionTransform,S=classnames_1.default(Classes.TABLE_ROW_HEADERS,((l={})[Classes.TABLE_SELECTION_ENABLED]=table2Utils_1.isSelectionModeEnabled(r.props,regions_2.RegionCardinality.FULL_ROWS),l)),f=r.grid.getRowIndicesInRect(d,g),w=o?0:f.rowIndexStart,b=o?r.getMaxFrozenRowIndex():f.rowIndexEnd;return React.createElement("div",{className:S,ref:e},React.createElement(rowHeader_1.RowHeader,{enableMultipleSelection:c,focusedCell:s,grid:r.grid,locator:r.locator,isReorderable:h,isResizable:R,loading:tableUtils_1.hasLoadingOption(p,regions_2.TableLoadingOption.ROW_HEADERS),maxRowHeight:m,minRowHeight:_,onFocusedCell:r.handleFocus,onLayoutLock:r.handleLayoutLock,onResizeGuide:t,onReordered:r.handleRowsReordered,onReordering:n,onRowHeightChanged:r.handleRowHeightChanged,onSelection:r.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_ROWS),rowHeaderCellRenderer:C,selectedRegions:a,selectedRegionTransform:E,rowIndexStart:w,rowIndexEnd:b}),r.maybeRenderRegions(r.styleRowHeaderRegion))},r.bodyCellRenderer=function(e,t){var n=r.getColumnProps(t);if(void 0===n)return null;n.id;var o=n.loadingOptions,l=n.cellRenderer,i=(n.columnHeaderCellRenderer,n.name,n.nameRenderer,tslib_1.__rest(n,["id","loadingOptions","cellRenderer","columnHeaderCellRenderer","name","nameRenderer"])),s=l(e,t),a=s.props.loading,d=void 0===a?tableUtils_1.hasLoadingOption(o,regions_2.ColumnLoadingOption.CELLS):a,u=tslib_1.__assign(tslib_1.__assign({},i),{loading:d});return React.cloneElement(s,u)},r.renderBody=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var o=r.state,l=o.focusedCell,i=o.numFrozenColumnsClamped,s=o.numFrozenRowsClamped,a=o.selectedRegions,d=o.viewportRect,u=r.props,c=u.enableMultipleSelection,g=u.enableGhostCells,h=u.loadingOptions,R=u.bodyContextMenuRenderer,p=u.selectedRegionTransform,m=r.grid.getRowIndicesInRect(d,g),_=r.grid.getColumnIndicesInRect(d,g),C=n?0:_.columnIndexStart+i,E=t?0:m.rowIndexStart+s,S=n?i-1:_.columnIndexEnd,f=t?s-1:m.rowIndexEnd,w=e===tableQuadrant_1.QuadrantType.MAIN?r.handleCompleteRender:void 0;return React.createElement("div",null,React.createElement(tableBody_1.TableBody,{enableMultipleSelection:c,cellRenderer:r.bodyCellRenderer,focusedCell:l,grid:r.grid,loading:tableUtils_1.hasLoadingOption(h,regions_2.TableLoadingOption.CELLS),locator:r.locator,onCompleteRender:w,onFocusedCell:r.handleFocus,onSelection:r.getEnabledSelectionHandler(regions_2.RegionCardinality.CELLS),bodyContextMenuRenderer:R,renderMode:r.getNormalizedRenderMode(),selectedRegions:a,selectedRegionTransform:p,viewportRect:d,columnIndexStart:C,columnIndexEnd:S,rowIndexStart:E,rowIndexEnd:f,numFrozenColumns:n?i:void 0,numFrozenRows:t?s:void 0}),r.maybeRenderRegions(r.styleBodyRegion,e))},r.getEnabledSelectionHandler=function(e){return table2Utils_1.isSelectionModeEnabled(r.props,e)?r.handleSelection:r.clearSelection},r.handleCompleteRender=function(){var e,t;null!=r.state.viewportRect&&(null===(t=(e=r.props).onCompleteRender)||void 0===t||t.call(e),r.didCompletelyMount=!0)},r.styleBodyRegion=function(e,t){var n=r.props.numFrozenColumns,o=regions_2.Regions.getRegionCardinality(e),l=r.grid.getRegionStyle(e),i=(t===tableQuadrant_1.QuadrantType.TOP_LEFT||t===tableQuadrant_1.QuadrantType.LEFT)&&null!=n&&n>0,s=r.grid.getHeight(),a=r.grid.getWidth(),d="-1px";switch(o){case regions_2.RegionCardinality.CELLS:return l;case regions_2.RegionCardinality.FULL_COLUMNS:return l.top=d,l.height=s+1,l;case regions_2.RegionCardinality.FULL_ROWS:return l.left=d,l.width=a+1,i&&(l.right=d),l;case regions_2.RegionCardinality.FULL_TABLE:return l.left=d,l.top=d,l.width=a+1,l.height=s+1,i&&(l.right=d),l;default:return{display:"none"}}},r.styleMenuRegion=function(e){if(null==r.state.viewportRect)return{};var t=regions_2.Regions.getRegionCardinality(e),n=r.grid.getRegionStyle(e);return t===regions_2.RegionCardinality.FULL_TABLE?(n.right="0px",n.bottom="0px",n.top="0px",n.left="0px",n.borderBottom="none",n.borderRight="none",n):{display:"none"}},r.styleColumnHeaderRegion=function(e){if(null==r.state.viewportRect)return{};var t=regions_2.Regions.getRegionCardinality(e),n=r.grid.getRegionStyle(e);switch(t){case regions_2.RegionCardinality.FULL_TABLE:return n.left="-1px",n.borderLeft="none",n.bottom="-1px",n;case regions_2.RegionCardinality.FULL_COLUMNS:return n.bottom="-1px",n;default:return{display:"none"}}},r.styleRowHeaderRegion=function(e){if(null==r.state.viewportRect)return{};var t=regions_2.Regions.getRegionCardinality(e),n=r.grid.getRegionStyle(e);switch(t){case regions_2.RegionCardinality.FULL_TABLE:return n.top="-1px",n.borderTop="none",n.right="-1px",n;case regions_2.RegionCardinality.FULL_ROWS:return n.right="-1px",n;default:return{display:"none"}}},r.handleColumnWidthChanged=function(e,t){var n=r.state.selectedRegions,o=r.state.columnWidths.slice();if(regions_2.Regions.hasFullTable(n))for(var l=0;l<o.length;l++)o[l]=t;regions_2.Regions.hasFullColumn(n,e)?regions_2.Regions.eachUniqueFullColumn(n,(function(e){o[e]=t})):o[e]=t,r.invalidateGrid(),r.setState({columnWidths:o});var i=r.props.onColumnWidthChanged;null!=i&&i(e,t)},r.handleRowHeightChanged=function(e,t){var n=r.state.selectedRegions,o=r.state.rowHeights.slice();if(regions_2.Regions.hasFullTable(n))for(var l=0;l<o.length;l++)o[l]=t;regions_2.Regions.hasFullRow(n,e)?regions_2.Regions.eachUniqueFullRow(n,(function(e){o[e]=t})):o[e]=t,r.invalidateGrid(),r.setState({rowHeights:o});var i=r.props.onRowHeightChanged;null!=i&&i(e,t)},r.handleRootScroll=function(e){null!=r.rootTableElement&&(r.rootTableElement.scrollLeft=0,r.rootTableElement.scrollTop=0)},r.handleBodyScroll=function(e){if(e.stopPropagation(),null!=r.locator&&!r.state.isLayoutLocked){var t=r.locator.getViewportRect();r.updateViewportRect(t)}},r.clearSelection=function(e){r.handleSelection([])},r.syncViewportPosition=function(e){var t=e.nextScrollLeft,n=e.nextScrollTop,o=r.state.viewportRect;if(void 0!==t||void 0!==n){if(void 0!==n){var l=r.shouldDisableVerticalScroll()?0:r.columnHeaderElement.clientHeight;r.scrollContainerElement.scrollTop=n+l}if(void 0!==t){var i=r.shouldDisableHorizontalScroll()||null==r.rowHeaderElement?0:r.rowHeaderElement.clientWidth;r.scrollContainerElement.scrollLeft=t+i}var s=new rect_1.Rect(t,n,o.width,o.height);r.updateViewportRect(s)}},r.handleFocus=function(e){var t,n;r.props.enableFocusedCell&&(null==r.props.focusedCell&&r.setState({focusedCell:e}),null===(n=(t=r.props).onFocusedCell)||void 0===n||n.call(t,e))},r.handleSelection=function(e){null==r.props.selectedRegions&&r.setState({selectedRegions:e});var t=r.props.onSelection;null!=t&&t(e)},r.handleColumnsReordering=function(e){r.setState({isReordering:!0,verticalGuides:e})},r.handleColumnsReordered=function(e,t,n){var o,l;r.setState({isReordering:!1,verticalGuides:void 0}),null===(l=(o=r.props).onColumnsReordered)||void 0===l||l.call(o,e,t,n)},r.handleRowsReordering=function(e){r.setState({isReordering:!0,horizontalGuides:e})},r.handleRowsReordered=function(e,t,n){var o,l;r.setState({isReordering:!1,horizontalGuides:void 0}),null===(l=(o=r.props).onRowsReordered)||void 0===l||l.call(o,e,t,n)},r.handleLayoutLock=function(e){void 0===e&&(e=!1),r.setState({isLayoutLocked:e})},r.updateViewportRect=function(e){var t=r.state.viewportRect;r.setState({viewportRect:e}),(null!=t&&!t.equals(e)||null==t&&null!=e)&&r.invokeOnVisibleCellsChangeCallback(e)},r.getMaxFrozenColumnIndex=function(){var e=r.state.numFrozenColumnsClamped;return null!=e?e-1:void 0},r.getMaxFrozenRowIndex=function(){var e=r.state.numFrozenRowsClamped;return null!=e?e-1:void 0},r.handleColumnResizeGuide=function(e){r.setState({verticalGuides:e})},r.handleRowResizeGuide=function(e){r.setState({horizontalGuides:e})};var l=r.props,i=l.children,s=l.columnWidths,a=l.defaultRowHeight,d=l.defaultColumnWidth,u=l.numRows,c=l.rowHeights,g=React.Children.toArray(i),h=t.createColumnIdIndex(g),R=g.map((function(){return d}));R=utils_1.Utils.assignSparseValues(R,s);var p=utils_1.Utils.times(u,(function(){return a}));p=utils_1.Utils.assignSparseValues(p,c);var m=null==n.selectedRegions?[]:n.selectedRegions,_=FocusedCellUtils.getInitialFocusedCell(n.enableFocusedCell,n.focusedCell,void 0,m);return r.state={childrenArray:g,columnIdToIndex:h,columnWidths:R,focusedCell:_,isLayoutLocked:!1,isReordering:!1,numFrozenColumnsClamped:tableUtils_1.clampNumFrozenColumns(n),numFrozenRowsClamped:tableUtils_1.clampNumFrozenRows(n),rowHeights:p,selectedRegions:m},r.hotkeysImpl=new tableHotkeys_1.TableHotkeys(n,r.state,r.grid,{getEnabledSelectionHandler:r.getEnabledSelectionHandler,handleFocus:r.handleFocus,handleSelection:r.handleSelection,syncViewportPosition:r.syncViewportPosition}),r.hotkeys=table2Utils_1.getHotkeysFromProps(n,r.hotkeysImpl),r}return tslib_1.__extends(t,e),t.getDerivedStateFromProps=function(e,n){var o=e.children,r=e.defaultColumnWidth,l=e.defaultRowHeight,i=e.enableFocusedCell,s=e.focusedCell,a=e.numRows,d=e.selectedRegions,u=e.selectionModes,c=e.columnWidths,g=e.rowHeights;null==c&&(c=n.columnWidths),null==g&&(g=n.rowHeights);var h=React.Children.toArray(o),R=h!==n.childrenArray,p=h.length,m=c;if(c!==n.columnWidths||R){var _=h.map((function(e,t){var o=n.columnIdToIndex[e.props.id];return n.columnWidths[null!=o?o:t]}));m=utils_1.Utils.arrayOfLength(m,p,r),m=utils_1.Utils.assignSparseValues(m,_),m=utils_1.Utils.assignSparseValues(m,c)}var C=g;g===n.rowHeights&&a===n.rowHeights.length||(C=utils_1.Utils.arrayOfLength(C,a,l),C=utils_1.Utils.assignSparseValues(C,g));var E=d;null==d&&(E=n.selectedRegions.filter((function(t){var n=regions_2.Regions.getRegionCardinality(t);return table2Utils_1.isSelectionModeEnabled(e,n,u)&&regions_2.Regions.isRegionValidForTable(t,a,p)})));var S=FocusedCellUtils.getInitialFocusedCell(i,s,n.focusedCell,E),f={childrenArray:h,columnIdToIndex:R?t.createColumnIdIndex(h):n.columnIdToIndex,columnWidths:m,focusedCell:S,numFrozenColumnsClamped:tableUtils_1.clampNumFrozenColumns(e),numFrozenRowsClamped:tableUtils_1.clampNumFrozenRows(e),rowHeights:C,selectedRegions:E};return core_1.Utils.deepCompareKeys(n,f,t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST)?null:f},t.createColumnIdIndex=function(e){for(var t={},n=0;n<e.length;n++){var o=e[n].props.id;null!=o&&(t[String(o)]=n)}return t},t.prototype.resizeRowsByApproximateHeight=function(e,t){var n=resizeRows_1.resizeRowsByApproximateHeight(this.props.numRows,this.state.columnWidths,e,t);this.invalidateGrid(),this.setState({rowHeights:n})},t.prototype.resizeRowsByTallestCell=function(e){var t=resizeRows_1.resizeRowsByTallestCell(this.grid,this.state.viewportRect,this.locator,this.state.rowHeights.length,e);this.invalidateGrid(),this.setState({rowHeights:t})},t.prototype.scrollToRegion=function(e){var t=this.state,n=t.numFrozenColumnsClamped,o=t.numFrozenRowsClamped,r=this.state.viewportRect,l=r.left,i=r.top,s=ScrollUtils.getScrollPositionForRegion(e,l,i,this.grid.getCumulativeWidthBefore,this.grid.getCumulativeHeightBefore,o,n),a=s.scrollLeft,d=s.scrollTop,u=this.shouldDisableHorizontalScroll()?0:a,c=this.shouldDisableVerticalScroll()?0:d;this.quadrantStackInstance.scrollToPosition(u,c)},t.prototype.getChildContext=function(){return{enableColumnInteractionBar:this.props.enableColumnInteractionBar}},t.prototype.shouldComponentUpdate=function(e,n){var o={exclude:t.SHALLOW_COMPARE_PROP_KEYS_DENYLIST},r={exclude:t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST};return!(core_1.Utils.shallowCompareKeys(this.props,e,o)&&core_1.Utils.shallowCompareKeys(this.state,n,r)&&core_1.Utils.deepCompareKeys(this.props,e,t.SHALLOW_COMPARE_PROP_KEYS_DENYLIST)&&core_1.Utils.deepCompareKeys(this.state,n,t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST))},t.prototype.render=function(){return React.createElement(core_1.HotkeysTarget2,{hotkeys:this.hotkeys},this.renderTableContents)},t.prototype.componentDidMount=function(){var e=this;this.validateGrid(),this.locator=new locator_1.Locator(this.rootTableElement,this.scrollContainerElement,this.cellContainerElement),this.updateLocator(),this.updateViewportRect(this.locator.getViewportRect()),this.resizeSensorDetach=resizeSensor_1.ResizeSensor.attach(this.rootTableElement,(function(){e.state.isLayoutLocked||e.updateViewportRect(e.locator.getViewportRect())}))},t.prototype.componentWillUnmount=function(){null!=this.resizeSensorDetach&&(this.resizeSensorDetach(),delete this.resizeSensorDetach),this.didCompletelyMount=!1},t.prototype.getSnapshotBeforeUpdate=function(){var e=this.state.viewportRect;this.validateGrid();var t=this.grid.getCumulativeHeightAt(this.grid.numRows-1),n=this.grid.getCumulativeWidthAt(this.grid.numCols-1),o=t<e.top+e.height?Math.max(0,t-e.height):void 0;return{nextScrollLeft:n<e.left+e.width?Math.max(0,n-e.width):void 0,nextScrollTop:o}},t.prototype.componentDidUpdate=function(t,n,o){e.prototype.componentDidUpdate.call(this,t,n,o),this.hotkeysImpl.setState(this.state),this.hotkeysImpl.setProps(this.props),(React.Children.toArray(this.props.children)!==this.state.childrenArray||this.props.columnWidths!==n.columnWidths||this.props.rowHeights!==n.rowHeights||this.props.numRows!==t.numRows||this.props.forceRerenderOnSelectionChange&&this.props.selectedRegions!==t.selectedRegions)&&this.invalidateGrid(),null!=this.locator&&(this.validateGrid(),this.updateLocator()),(!core_1.Utils.arraysEqual(this.state.columnWidths,n.columnWidths)||!core_1.Utils.arraysEqual(this.state.rowHeights,n.rowHeights))&&(this.quadrantStackInstance.synchronizeQuadrantViews(),this.syncViewportPosition(o)),(this.props.getCellClipboardData!==t.getCellClipboardData||this.props.enableFocusedCell!==t.enableFocusedCell||this.props.enableMultipleSelection!==t.enableMultipleSelection||this.props.selectionModes!==t.selectionModes)&&(this.hotkeys=table2Utils_1.getHotkeysFromProps(this.props,this.hotkeysImpl))},t.prototype.validateProps=function(e){var t=e.children,n=e.columnWidths,o=e.numFrozenColumns,r=e.numFrozenRows,l=e.numRows,i=e.rowHeights,s=React.Children.count(t);if(null!=l&&l<0)throw new Error(Errors.TABLE_NUM_ROWS_NEGATIVE);if(null!=r&&r<0)throw new Error(Errors.TABLE_NUM_FROZEN_ROWS_NEGATIVE);if(null!=o&&o<0)throw new Error(Errors.TABLE_NUM_FROZEN_COLUMNS_NEGATIVE);if(null!=l&&null!=i&&i.length!==l)throw new Error(Errors.TABLE_NUM_ROWS_ROW_HEIGHTS_MISMATCH);if(null!=s&&null!=n&&n.length!==s)throw new Error(Errors.TABLE_NUM_COLUMNS_COLUMN_WIDTHS_MISMATCH);React.Children.forEach(t,(function(e){if(!core_1.Utils.isElementOfType(e,column_1.Column))throw new Error(Errors.TABLE_NON_COLUMN_CHILDREN_WARNING)})),null!=r&&null!=l&&r>l&&console.warn(Errors.TABLE_NUM_FROZEN_ROWS_BOUND_WARNING),null!=o&&o>s&&console.warn(Errors.TABLE_NUM_FROZEN_COLUMNS_BOUND_WARNING)},t.prototype.gridDimensionsMatchProps=function(){var e=this.props,t=e.children,n=e.numRows;return null!=this.grid&&this.grid.numCols===React.Children.count(t)&&this.grid.numRows===n},t.prototype.shouldDisableVerticalScroll=function(){var e=this.props.enableGhostCells,t=this.state.viewportRect,n=this.grid.getRowIndicesInRect(t,e),o=null!=t&&0===t.top,r=tableUtils_1.hasLoadingOption(this.props.loadingOptions,regions_2.TableLoadingOption.ROW_HEADERS);return e&&this.grid.isGhostIndex(n.rowIndexEnd-1,0)&&(o||r)},t.prototype.shouldDisableHorizontalScroll=function(){var e=this.props.enableGhostCells,t=this.state.viewportRect,n=this.grid.getColumnIndicesInRect(t,e),o=null!=t&&0===t.left,r=e&&this.grid.isGhostColumn(n.columnIndexEnd),l=tableUtils_1.hasLoadingOption(this.props.loadingOptions,regions_2.TableLoadingOption.COLUMN_HEADERS);return r&&(o||l)},t.prototype.getColumnProps=function(e){var t=this.state.childrenArray[e];return void 0===t?void 0:t.props},t.prototype.isGuidesShowing=function(){return null!=this.state.verticalGuides||null!=this.state.horizontalGuides},t.prototype.invalidateGrid=function(){this.grid=null},t.prototype.validateGrid=function(){if(null==this.grid){var e=this.props,t=e.defaultRowHeight,n=e.defaultColumnWidth,o=this.state,r=o.rowHeights,l=o.columnWidths;this.grid=new grid_1.Grid(r,l,grid_1.Grid.DEFAULT_BLEED,t,n),this.invokeOnVisibleCellsChangeCallback(this.state.viewportRect),this.hotkeysImpl.setGrid(this.grid)}},t.prototype.maybeRenderRegions=function(e,t){if(!this.isGuidesShowing()||this.state.isReordering)return regions_2.Regions.joinStyledRegionGroups(this.state.selectedRegions,this.props.styledRegionGroups,this.state.focusedCell).map((function(n,o){var r=n.regions.map((function(n){return e(n,t)}));return React.createElement(regions_1.RegionLayer,{className:classnames_1.default(n.className),key:o,regions:n.regions,regionStyles:r})}))},t.prototype.updateLocator=function(){this.locator.setGrid(this.grid).setNumFrozenRows(this.state.numFrozenRowsClamped).setNumFrozenColumns(this.state.numFrozenColumnsClamped)},t.prototype.invokeOnVisibleCellsChangeCallback=function(e){var t,n,o=this.grid.getColumnIndicesInRect(e),r=this.grid.getRowIndicesInRect(e);null===(n=(t=this.props).onVisibleCellsChange)||void 0===n||n.call(t,r,o)},t.prototype.getNormalizedRenderMode=function(){var e=this.props.renderMode;return e===renderMode_1.RenderMode.BATCH||e===renderMode_1.RenderMode.BATCH_ON_UPDATE&&this.didCompletelyMount?renderMode_1.RenderMode.BATCH:renderMode_1.RenderMode.NONE},t.displayName=core_1.DISPLAYNAME_PREFIX+".Table2",t.defaultProps={defaultColumnWidth:150,defaultRowHeight:20,enableFocusedCell:!1,enableGhostCells:!1,enableMultipleSelection:!0,enableRowHeader:!0,forceRerenderOnSelectionChange:!1,loadingOptions:[],minColumnWidth:50,minRowHeight:20,numFrozenColumns:0,numFrozenRows:0,numRows:0,renderMode:renderMode_1.RenderMode.BATCH_ON_UPDATE,rowHeaderCellRenderer:rowHeader_1.renderDefaultRowHeader,selectionModes:regions_2.SelectionModes.ALL},t.childContextTypes=context_1.columnInteractionBarContextTypes,t.SHALLOW_COMPARE_PROP_KEYS_DENYLIST=["selectedRegions"],t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST=["selectedRegions","viewportRect"],t}(core_1.AbstractComponent2);exports.Table2=Table2;