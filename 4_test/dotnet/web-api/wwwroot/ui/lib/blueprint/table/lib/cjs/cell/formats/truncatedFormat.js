"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TruncatedFormat=exports.TruncatedPopoverMode=void 0;var TruncatedPopoverMode,tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),Classes=tslib_1.__importStar(require("../../common/classes")),utils_1=require("../../common/utils"),locator_1=require("../../locator"),CONTENT_DIV_WIDTH_DELTA=25;!function(e){e.ALWAYS="always",e.NEVER="never",e.WHEN_TRUNCATED="when-truncated",e.WHEN_TRUNCATED_APPROX="when-truncated-approx"}(TruncatedPopoverMode=exports.TruncatedPopoverMode||(exports.TruncatedPopoverMode={}));var TruncatedFormat=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isPopoverOpen:!1,isTruncated:!1},t.handleContentDivRef=function(e){return t.contentDiv=e},t.handlePopoverOpen=function(){t.setState({isPopoverOpen:!0})},t.handlePopoverClose=function(){t.setState({isPopoverOpen:!1})},t}return tslib_1.__extends(t,e),t.prototype.componentDidMount=function(){this.setTruncationState()},t.prototype.componentDidUpdate=function(){this.setTruncationState()},t.prototype.render=function(){var e=this.props,t=e.children,r=e.detectTruncation,o=e.truncateLength,n=e.truncationSuffix,s=""+t,a=s;if(!r&&o>0&&a.length>o&&(a=a.substring(0,o)+n),this.shouldShowPopover(s)){var i=classnames_1.default(this.props.className,Classes.TABLE_TRUNCATED_FORMAT);return React.createElement("div",{className:i},React.createElement("div",{className:Classes.TABLE_TRUNCATED_VALUE,ref:this.handleContentDivRef},a),this.renderPopover())}return i=classnames_1.default(this.props.className,Classes.TABLE_TRUNCATED_FORMAT_TEXT),React.createElement("div",{className:i,ref:this.handleContentDivRef},a)},t.prototype.renderPopover=function(){var e=this.props,t=e.children,r=e.preformatted;if(this.state.isPopoverOpen){var o=classnames_1.default(Classes.TABLE_TRUNCATED_POPOVER,r?Classes.TABLE_POPOVER_WHITESPACE_PRE:Classes.TABLE_POPOVER_WHITESPACE_NORMAL),n=React.createElement("div",{className:o},t);return React.createElement(core_1.Popover,{className:Classes.TABLE_TRUNCATED_POPOVER_TARGET,modifiers:{preventOverflow:{boundariesElement:"window"}},content:n,position:core_1.Position.BOTTOM,isOpen:!0,onClose:this.handlePopoverClose},React.createElement(core_1.Icon,{icon:"more"}))}return React.createElement("span",{className:Classes.TABLE_TRUNCATED_POPOVER_TARGET,onClick:this.handlePopoverOpen},React.createElement(core_1.Icon,{icon:"more"}))},t.prototype.shouldShowPopover=function(e){var t=this.props,r=t.detectTruncation,o=t.measureByApproxOptions,n=t.showPopover,s=t.truncateLength;switch(n){case TruncatedPopoverMode.ALWAYS:return!0;case TruncatedPopoverMode.NEVER:return!1;case TruncatedPopoverMode.WHEN_TRUNCATED:return r?this.state.isTruncated:s>0&&e.length>s;case TruncatedPopoverMode.WHEN_TRUNCATED_APPROX:if(!r)return s>0&&e.length>s;if(null==this.props.parentCellHeight||null==this.props.parentCellWidth)return!1;var a=o.approximateCharWidth,i=o.approximateLineHeight,c=o.cellHorizontalPadding,p=o.numBufferLines,l=this.props.parentCellWidth;return utils_1.Utils.getApproxCellHeight(e,l,a,i,c,p)>this.props.parentCellHeight;default:return!1}},t.prototype.setTruncationState=function(){if(this.props.detectTruncation&&this.props.showPopover===TruncatedPopoverMode.WHEN_TRUNCATED)if(void 0!==this.contentDiv){var e=this.state.isTruncated,t=this.contentDiv,r=t.clientHeight,o=t.clientWidth,n=t.scrollHeight,s=t.scrollWidth,a=e?s-CONTENT_DIV_WIDTH_DELTA:s,i=e&&a===o||a>o||n>r;this.setState({isTruncated:i})}else this.setState({isTruncated:!1})},t.displayName=core_1.DISPLAYNAME_PREFIX+".TruncatedFormat",t.defaultProps={detectTruncation:!1,measureByApproxOptions:{approximateCharWidth:8,approximateLineHeight:18,cellHorizontalPadding:2*locator_1.Locator.CELL_HORIZONTAL_PADDING,numBufferLines:0},preformatted:!1,showPopover:TruncatedPopoverMode.WHEN_TRUNCATED,truncateLength:2e3,truncationSuffix:"..."},t}(React.PureComponent);exports.TruncatedFormat=TruncatedFormat;