"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cellClassNames=exports.TableBodyCells=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),cell_1=require("./cell/cell"),batcher_1=require("./common/batcher"),Classes=tslib_1.__importStar(require("./common/classes")),rect_1=require("./common/rect"),renderMode_1=require("./common/renderMode"),SHALLOW_COMPARE_DENYLIST=["viewportRect"],BATCHER_RESET_PROP_KEYS_DENYLIST=["columnIndexEnd","columnIndexStart","rowIndexEnd","rowIndexStart"],TableBodyCells=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.batcher=new batcher_1.Batcher,t.renderNewCell=function(e,r){var l=t.props,n=l.columnIndexEnd,s=l.grid,o=l.rowIndexEnd,a=s.getExtremaClasses(e,r,o,n),c=s.isGhostIndex(e,r);return t.renderCell(e,r,a,c)},t.renderCell=function(e,l,n,s){var o,a=t.props,c=a.cellRenderer,d=a.focusedCell,i=a.loading,p=a.grid,u=s?cell_1.emptyCellRenderer():c(e,l);u=null==u?cell_1.emptyCellRenderer():u;var _=classnames_1.default(cellClassNames(e,l),n,((o={})[Classes.TABLE_CELL_GHOST]=s,o[Classes.TABLE_CELL_LEDGER_ODD]=e%2==1,o[Classes.TABLE_CELL_LEDGER_EVEN]=e%2==0,o),u.props.className),C=r.cellReactKey(e,l),h=s?p.getGhostCellRect(e,l):p.getCellRect(e,l),m=null!=u.props.loading?u.props.loading:i,E=tslib_1.__assign(tslib_1.__assign({},u.props.style),rect_1.Rect.style(h)),b=null!=d&&d.row===e&&d.col===l;return React.cloneElement(u,{className:_,isFocused:b,key:C,loading:m,style:E})},t.didViewportRectChange=function(e,r){return!(null==e&&null==r||null!=e&&null!=r&&e.equals(r))},t}return tslib_1.__extends(r,e),r.cellReactKey=function(e,r){return"cell-"+e+"-"+r},r.prototype.componentDidMount=function(){this.maybeInvokeOnCompleteRender()},r.prototype.shouldComponentUpdate=function(e){return!core_1.Utils.shallowCompareKeys(e,this.props,{exclude:SHALLOW_COMPARE_DENYLIST})||this.didViewportRectChange(e.viewportRect,this.props.viewportRect)},r.prototype.componentDidUpdate=function(e){!core_1.Utils.shallowCompareKeys(e,this.props,{exclude:BATCHER_RESET_PROP_KEYS_DENYLIST})&&this.batcher.reset(),this.maybeInvokeOnCompleteRender()},r.prototype.componentWillUnmount=function(){this.batcher.cancelOutstandingCallback()},r.prototype.render=function(){var e=this.props.renderMode===renderMode_1.RenderMode.BATCH?this.renderBatchedCells():this.renderAllCells();return React.createElement("div",{className:Classes.TABLE_BODY_CELLS},e)},r.prototype.renderBatchedCells=function(){var e=this,r=this.props,t=r.columnIndexEnd,l=r.columnIndexStart,n=r.rowIndexEnd,s=r.rowIndexStart;this.batcher.startNewBatch();for(var o=s;o<=n;o++)for(var a=l;a<=t;a++)this.batcher.addArgsToBatch(o,a);return this.batcher.removeOldAddNew(this.renderNewCell),this.batcher.isDone()||this.batcher.idleCallback((function(){return e.forceUpdate()})),this.batcher.getList()},r.prototype.renderAllCells=function(){for(var e=this.props,r=e.columnIndexEnd,t=e.columnIndexStart,l=e.rowIndexEnd,n=[],s=[],o=e.rowIndexStart;o<=l;o++)for(var a=t;a<=r;a++)n.push(this.renderNewCell(o,a)),s.push([o,a]);return this.batcher.setList(s,n),n},r.prototype.maybeInvokeOnCompleteRender=function(){var e=this.props,r=e.onCompleteRender,t=e.renderMode;(t===renderMode_1.RenderMode.NONE||t===renderMode_1.RenderMode.BATCH&&this.batcher.isDone())&&(null==r||r())},r.defaultProps={renderMode:renderMode_1.RenderMode.BATCH},r}(core_1.AbstractComponent2);function cellClassNames(e,r){return[Classes.rowCellIndexClass(e),Classes.columnCellIndexClass(r)]}exports.TableBodyCells=TableBodyCells,exports.cellClassNames=cellClassNames;