import{__extends}from"tslib";import classNames from"classnames";import*as React from"react";import{DISPLAYNAME_PREFIX,Icon,Popover,Position}from"@blueprintjs/core";import*as Classes from"../../common/classes";import{Utils}from"../../common/utils";import{Locator}from"../../locator";var CONTENT_DIV_WIDTH_DELTA=25;export var TruncatedPopoverMode;!function(e){e.ALWAYS="always",e.NEVER="never",e.WHEN_TRUNCATED="when-truncated",e.WHEN_TRUNCATED_APPROX="when-truncated-approx"}(TruncatedPopoverMode||(TruncatedPopoverMode={}));var TruncatedFormat=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isPopoverOpen:!1,isTruncated:!1},t.handleContentDivRef=function(e){return t.contentDiv=e},t.handlePopoverOpen=function(){t.setState({isPopoverOpen:!0})},t.handlePopoverClose=function(){t.setState({isPopoverOpen:!1})},t}return __extends(t,e),t.prototype.componentDidMount=function(){this.setTruncationState()},t.prototype.componentDidUpdate=function(){this.setTruncationState()},t.prototype.render=function(){var e=this.props,t=e.children,o=e.detectTruncation,r=e.truncateLength,n=e.truncationSuffix,s=""+t,a=s;if(!o&&r>0&&a.length>r&&(a=a.substring(0,r)+n),this.shouldShowPopover(s)){var i=classNames(this.props.className,Classes.TABLE_TRUNCATED_FORMAT);return React.createElement("div",{className:i},React.createElement("div",{className:Classes.TABLE_TRUNCATED_VALUE,ref:this.handleContentDivRef},a),this.renderPopover())}return i=classNames(this.props.className,Classes.TABLE_TRUNCATED_FORMAT_TEXT),React.createElement("div",{className:i,ref:this.handleContentDivRef},a)},t.prototype.renderPopover=function(){var e=this.props,t=e.children,o=e.preformatted;if(this.state.isPopoverOpen){var r=classNames(Classes.TABLE_TRUNCATED_POPOVER,o?Classes.TABLE_POPOVER_WHITESPACE_PRE:Classes.TABLE_POPOVER_WHITESPACE_NORMAL),n=React.createElement("div",{className:r},t);return React.createElement(Popover,{className:Classes.TABLE_TRUNCATED_POPOVER_TARGET,modifiers:{preventOverflow:{boundariesElement:"window"}},content:n,position:Position.BOTTOM,isOpen:!0,onClose:this.handlePopoverClose},React.createElement(Icon,{icon:"more"}))}return React.createElement("span",{className:Classes.TABLE_TRUNCATED_POPOVER_TARGET,onClick:this.handlePopoverOpen},React.createElement(Icon,{icon:"more"}))},t.prototype.shouldShowPopover=function(e){var t=this.props,o=t.detectTruncation,r=t.measureByApproxOptions,n=t.showPopover,s=t.truncateLength;switch(n){case TruncatedPopoverMode.ALWAYS:return!0;case TruncatedPopoverMode.NEVER:return!1;case TruncatedPopoverMode.WHEN_TRUNCATED:return o?this.state.isTruncated:s>0&&e.length>s;case TruncatedPopoverMode.WHEN_TRUNCATED_APPROX:if(!o)return s>0&&e.length>s;if(null==this.props.parentCellHeight||null==this.props.parentCellWidth)return!1;var a=r.approximateCharWidth,i=r.approximateLineHeight,p=r.cellHorizontalPadding,c=r.numBufferLines,l=this.props.parentCellWidth;return Utils.getApproxCellHeight(e,l,a,i,p,c)>this.props.parentCellHeight;default:return!1}},t.prototype.setTruncationState=function(){if(this.props.detectTruncation&&this.props.showPopover===TruncatedPopoverMode.WHEN_TRUNCATED)if(void 0!==this.contentDiv){var e=this.state.isTruncated,t=this.contentDiv,o=t.clientHeight,r=t.clientWidth,n=t.scrollHeight,s=t.scrollWidth,a=e?s-CONTENT_DIV_WIDTH_DELTA:s,i=e&&a===r||a>r||n>o;this.setState({isTruncated:i})}else this.setState({isTruncated:!1})},t.displayName=DISPLAYNAME_PREFIX+".TruncatedFormat",t.defaultProps={detectTruncation:!1,measureByApproxOptions:{approximateCharWidth:8,approximateLineHeight:18,cellHorizontalPadding:2*Locator.CELL_HORIZONTAL_PADDING,numBufferLines:0},preformatted:!1,showPopover:TruncatedPopoverMode.WHEN_TRUNCATED,truncateLength:2e3,truncationSuffix:"..."},t}(React.PureComponent);export{TruncatedFormat};