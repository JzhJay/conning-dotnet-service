"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TableHotkeys=void 0;var tslib_1=require("tslib"),React=tslib_1.__importStar(require("react")),clipboard_1=require("./common/clipboard"),direction_1=require("./common/direction"),FocusedCellUtils=tslib_1.__importStar(require("./common/internal/focusedCellUtils")),SelectionUtils=tslib_1.__importStar(require("./common/internal/selectionUtils")),regions_1=require("./regions"),TableHotkeys=function(){function e(e,o,t,n){var l=this;this.props=e,this.state=o,this.grid=t,this.tableHandlers=n,this.selectAll=function(e){if(l.tableHandlers.getEnabledSelectionHandler(regions_1.RegionCardinality.FULL_TABLE)([regions_1.Regions.table()]),e){var o=regions_1.Regions.getFocusCellCoordinatesFromRegion(regions_1.Regions.table());l.tableHandlers.handleFocus(FocusedCellUtils.toFullCoordinates(o))}},this.handleSelectAllHotkey=function(e){e.preventDefault(),e.stopPropagation(),l.selectAll(!1)},this.handleSelectionResizeUp=function(e){return l.handleSelectionResize(e,direction_1.Direction.UP)},this.handleSelectionResizeDown=function(e){return l.handleSelectionResize(e,direction_1.Direction.DOWN)},this.handleSelectionResizeLeft=function(e){return l.handleSelectionResize(e,direction_1.Direction.LEFT)},this.handleSelectionResizeRight=function(e){return l.handleSelectionResize(e,direction_1.Direction.RIGHT)},this.handleSelectionResize=function(e,o){e.preventDefault(),e.stopPropagation();var t=l.state,n=t.focusedCell,i=t.selectedRegions;if(0!==i.length){var s=FocusedCellUtils.getFocusedOrLastSelectedIndex(i,n),r=i[s],c=SelectionUtils.resizeRegion(r,o,n);l.updateSelectedRegionAtIndex(c,s)}},this.handleFocusMoveLeft=function(e){return l.handleFocusMove(e,"left")},this.handleFocusMoveLeftInternal=function(e){return l.handleFocusMoveInternal(e,"left")},this.handleFocusMoveRight=function(e){return l.handleFocusMove(e,"right")},this.handleFocusMoveRightInternal=function(e){return l.handleFocusMoveInternal(e,"right")},this.handleFocusMoveUp=function(e){return l.handleFocusMove(e,"up")},this.handleFocusMoveUpInternal=function(e){return l.handleFocusMoveInternal(e,"up")},this.handleFocusMoveDown=function(e){return l.handleFocusMove(e,"down")},this.handleFocusMoveDownInternal=function(e){return l.handleFocusMoveInternal(e,"down")},this.handleFocusMove=function(e,o){e.preventDefault(),e.stopPropagation();var t=l.state.focusedCell;if(null!=t){var n={col:t.col,focusSelectionIndex:0,row:t.row};switch(o){case"up":n.row-=1;break;case"down":n.row+=1;break;case"left":n.col-=1;break;case"right":n.col+=1}if(!(n.row<0||n.row>=l.grid.numRows||n.col<0||n.col>=l.grid.numCols)){var i=[regions_1.Regions.cell(n.row,n.col)],s=l.props.selectedRegionTransform,r=null!=s?i.map((function(o){return s(o,e)})):i;l.tableHandlers.handleSelection(r),l.tableHandlers.handleFocus(n),l.scrollBodyToFocusedCell(n)}}},this.handleFocusMoveInternal=function(e,o){e.preventDefault(),e.stopPropagation();var t=l.state,n=t.focusedCell,i=t.selectedRegions;if(null!=n){var s={col:n.col,focusSelectionIndex:n.focusSelectionIndex,row:n.row};if(null==n.focusSelectionIndex&&i.length>0)s={col:(r=regions_1.Regions.getCellRegionFromRegion(i[0],l.grid.numRows,l.grid.numCols)).cols[0],focusSelectionIndex:0,row:r.rows[0]};else{if(0===i.length)return void l.handleFocusMove(e,o);var r;if((r=regions_1.Regions.getCellRegionFromRegion(i[n.focusSelectionIndex],l.grid.numRows,l.grid.numCols)).cols[0]===r.cols[1]&&r.rows[0]===r.rows[1]&&1===i.length)return void l.handleFocusMove(e,o);switch(o){case"up":s=l.moveFocusCell("row","col",!0,s,r);break;case"left":s=l.moveFocusCell("col","row",!0,s,r);break;case"down":s=l.moveFocusCell("row","col",!1,s,r);break;case"right":s=l.moveFocusCell("col","row",!1,s,r)}}s.row<0||s.row>=l.grid.numRows||s.col<0||s.col>=l.grid.numCols||(l.tableHandlers.handleFocus(s),l.scrollBodyToFocusedCell(s))}},this.scrollBodyToFocusedCell=function(e){var o=e.row,t=e.col,n=l.state.viewportRect,i=n.top,s=n.left+n.width,r=n.top+n.height,c=n.left,a=l.grid.getCumulativeHeightBefore(o),u=l.grid.getCumulativeWidthAt(t),d=l.grid.getCumulativeHeightAt(o),h=l.grid.getCumulativeWidthBefore(t),g=d-a,f=u-h>n.width,p=g>n.height,v={};if(a<i||p)v.nextScrollTop=Math.max(0,a-1);else if(d>r){var R=d-r;v.nextScrollTop=i+R}h<c||f?v.nextScrollLeft=Math.max(0,h-1):u>s&&(R=u-s,v.nextScrollLeft=c+R),l.tableHandlers.syncViewportPosition(v)},this.handleCopy=function(e){var o=l.props,t=o.getCellClipboardData,n=o.onCopy,i=l.state.selectedRegions;if(null!=t){e.preventDefault(),e.stopPropagation();var s=regions_1.Regions.enumerateUniqueCells(i,l.grid.numRows,l.grid.numCols),r=regions_1.Regions.sparseMapCells(s,t);if(null!=r){var c=clipboard_1.Clipboard.copyCells(r);null==n||n(c)}}}}return e.prototype.setGrid=function(e){this.grid=e},e.prototype.setProps=function(e){this.props=e},e.prototype.setState=function(e){this.state=e},e.prototype.updateSelectedRegionAtIndex=function(e,o){var t=this.props,n=t.children,l=t.numRows,i=this.state.selectedRegions,s=React.Children.count(n),r=Math.max(0,l-1),c=Math.max(0,s-1),a=regions_1.Regions.clampRegion(e,r,c),u=regions_1.Regions.update(i,a,o);this.tableHandlers.handleSelection(u)},e.prototype.moveFocusCell=function(e,o,t,n,l){var i=this.state.selectedRegions,s="row"===e?"rows":"cols",r="row"===o?"rows":"cols",c=t?-1:1,a=t?1:0;if(n[e]+=c,(t?n[e]<l[s][0]:n[e]>l[s][1])&&(n[e]=l[s][a],n[o]+=c,t?n[o]<l[r][0]:n[o]>l[r][1])){var u=n.focusSelectionIndex+c;(t?u<0:u>=i.length)&&(u=t?i.length-1:0);var d=regions_1.Regions.getCellRegionFromRegion(i[u],this.grid.numRows,this.grid.numCols);n={col:d.cols[a],focusSelectionIndex:u,row:d.rows[a]}}return n},e}();exports.TableHotkeys=TableHotkeys;