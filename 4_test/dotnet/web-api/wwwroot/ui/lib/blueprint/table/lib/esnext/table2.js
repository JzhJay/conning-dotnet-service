import classNames from"classnames";import*as React from"react";import{AbstractComponent2,DISPLAYNAME_PREFIX,HotkeysTarget2,Utils as CoreUtils}from"@blueprintjs/core";import{Column}from"./column";import*as Classes from"./common/classes";import{columnInteractionBarContextTypes}from"./common/context";import*as Errors from"./common/errors";import{Grid}from"./common/grid";import*as FocusedCellUtils from"./common/internal/focusedCellUtils";import*as ScrollUtils from"./common/internal/scrollUtils";import{Rect}from"./common/rect";import{RenderMode}from"./common/renderMode";import{Utils}from"./common/utils";import{ColumnHeader}from"./headers/columnHeader";import{ColumnHeaderCell}from"./headers/columnHeaderCell";import{renderDefaultRowHeader,RowHeader}from"./headers/rowHeader";import{ResizeSensor}from"./interactions/resizeSensor";import{GuideLayer}from"./layers/guides";import{RegionLayer}from"./layers/regions";import{Locator}from"./locator";import{QuadrantType}from"./quadrants/tableQuadrant";import{TableQuadrantStack}from"./quadrants/tableQuadrantStack";import{ColumnLoadingOption,RegionCardinality,Regions,SelectionModes,TableLoadingOption}from"./regions";import{resizeRowsByApproximateHeight,resizeRowsByTallestCell}from"./resizeRows";import{getHotkeysFromProps,isSelectionModeEnabled}from"./table2Utils";import{TableBody}from"./tableBody";import{TableHotkeys}from"./tableHotkeys";import{clampNumFrozenColumns,clampNumFrozenRows,hasLoadingOption}from"./tableUtils";export class Table2 extends AbstractComponent2{constructor(e,t){super(e,t),this.hotkeys=[],this.refHandlers={cellContainer:e=>this.cellContainerElement=e,columnHeader:e=>this.columnHeaderElement=e,quadrantStack:e=>this.quadrantStackInstance=e,rootTable:e=>this.rootTableElement=e,rowHeader:e=>this.rowHeaderElement=e,scrollContainer:e=>this.scrollContainerElement=e},this.didCompletelyMount=!1,this.renderTableContents=({handleKeyDown:e,handleKeyUp:t})=>{const{children:o,className:s,enableRowHeader:n,loadingOptions:i,numRows:l,enableColumnInteractionBar:r}=this.props,{horizontalGuides:a,numFrozenColumnsClamped:d,numFrozenRowsClamped:h,verticalGuides:c}=this.state;this.gridDimensionsMatchProps()||this.invalidateGrid(),this.validateGrid();const u=classNames(Classes.TABLE_CONTAINER,{[Classes.TABLE_REORDERING]:this.state.isReordering,[Classes.TABLE_NO_VERTICAL_SCROLL]:this.shouldDisableVerticalScroll(),[Classes.TABLE_NO_HORIZONTAL_SCROLL]:this.shouldDisableHorizontalScroll(),[Classes.TABLE_SELECTION_ENABLED]:isSelectionModeEnabled(this.props,RegionCardinality.CELLS),[Classes.TABLE_NO_ROWS]:0===l},s);return React.createElement("div",{className:u,ref:this.refHandlers.rootTable,onScroll:this.handleRootScroll,onKeyDown:e,onKeyUp:t,tabIndex:0},React.createElement(TableQuadrantStack,{bodyRef:this.refHandlers.cellContainer,bodyRenderer:this.renderBody,columnHeaderCellRenderer:this.renderColumnHeader,columnHeaderRef:this.refHandlers.columnHeader,enableColumnInteractionBar:r,enableRowHeader:n,grid:this.grid,handleColumnResizeGuide:this.handleColumnResizeGuide,handleColumnsReordering:this.handleColumnsReordering,handleRowResizeGuide:this.handleRowResizeGuide,handleRowsReordering:this.handleRowsReordering,isHorizontalScrollDisabled:this.shouldDisableHorizontalScroll(),isVerticalScrollDisabled:this.shouldDisableVerticalScroll(),loadingOptions:i,numColumns:React.Children.count(o),numFrozenColumns:d,numFrozenRows:h,numRows:l,onScroll:this.handleBodyScroll,ref:this.refHandlers.quadrantStack,menuRenderer:this.renderMenu,rowHeaderCellRenderer:this.renderRowHeader,rowHeaderRef:this.refHandlers.rowHeader,scrollContainerRef:this.refHandlers.scrollContainer}),React.createElement("div",{className:classNames(Classes.TABLE_OVERLAY_LAYER,Classes.TABLE_OVERLAY_REORDERING_CURSOR)}),React.createElement(GuideLayer,{className:Classes.TABLE_RESIZE_GUIDES,verticalGuides:c,horizontalGuides:a}))},this.renderMenu=e=>{const t=classNames(Classes.TABLE_MENU,{[Classes.TABLE_SELECTION_ENABLED]:isSelectionModeEnabled(this.props,RegionCardinality.FULL_TABLE)});return React.createElement("div",{className:t,ref:e,onMouseDown:this.handleMenuMouseDown},this.maybeRenderRegions(this.styleMenuRegion))},this.handleMenuMouseDown=e=>{this.selectAll(!e.shiftKey)},this.selectAll=e=>{if(this.getEnabledSelectionHandler(RegionCardinality.FULL_TABLE)([Regions.table()]),e){const e=Regions.getFocusCellCoordinatesFromRegion(Regions.table());this.handleFocus(FocusedCellUtils.toFullCoordinates(e))}},this.columnHeaderCellRenderer=e=>{const t=this.getColumnProps(e);if(void 0===t)return null;const{id:o,loadingOptions:s,cellRenderer:n,columnHeaderCellRenderer:i,...l}=t,r=hasLoadingOption(s,ColumnLoadingOption.HEADER);if(null!=i){const t=i(e),o=t.props.loading,s={loading:null!=o?o:r};return React.cloneElement(t,s)}const a={index:e,loading:r,...l};return null!=t.name?React.createElement(ColumnHeaderCell,Object.assign({},a)):React.createElement(ColumnHeaderCell,Object.assign({},a,{name:Utils.toBase26Alpha(e)}))},this.renderColumnHeader=(e,t,o,s=!1)=>{const{focusedCell:n,selectedRegions:i,viewportRect:l}=this.state,{enableMultipleSelection:r,enableGhostCells:a,enableColumnReordering:d,enableColumnResizing:h,loadingOptions:c,maxColumnWidth:u,minColumnWidth:m,selectedRegionTransform:R}=this.props,p=classNames(Classes.TABLE_COLUMN_HEADERS,{[Classes.TABLE_SELECTION_ENABLED]:isSelectionModeEnabled(this.props,RegionCardinality.FULL_COLUMNS)}),g=this.grid.getColumnIndicesInRect(l,a),C=s?0:g.columnIndexStart,E=s?this.getMaxFrozenColumnIndex():g.columnIndexEnd;return React.createElement("div",{className:p},React.createElement(ColumnHeader,{enableMultipleSelection:r,cellRenderer:this.columnHeaderCellRenderer,focusedCell:n,grid:this.grid,isReorderable:d,isResizable:h,loading:hasLoadingOption(c,TableLoadingOption.COLUMN_HEADERS),locator:this.locator,maxColumnWidth:u,measurableElementRef:e,minColumnWidth:m,onColumnWidthChanged:this.handleColumnWidthChanged,onFocusedCell:this.handleFocus,onLayoutLock:this.handleLayoutLock,onReordered:this.handleColumnsReordered,onReordering:o,onResizeGuide:t,onSelection:this.getEnabledSelectionHandler(RegionCardinality.FULL_COLUMNS),selectedRegions:i,selectedRegionTransform:R,columnIndexStart:C,columnIndexEnd:E},this.props.children),this.maybeRenderRegions(this.styleColumnHeaderRegion))},this.renderRowHeader=(e,t,o,s=!1)=>{const{focusedCell:n,selectedRegions:i,viewportRect:l}=this.state,{enableMultipleSelection:r,enableGhostCells:a,enableRowReordering:d,enableRowResizing:h,loadingOptions:c,maxRowHeight:u,minRowHeight:m,rowHeaderCellRenderer:R,selectedRegionTransform:p}=this.props,g=classNames(Classes.TABLE_ROW_HEADERS,{[Classes.TABLE_SELECTION_ENABLED]:isSelectionModeEnabled(this.props,RegionCardinality.FULL_ROWS)}),C=this.grid.getRowIndicesInRect(l,a),E=s?0:C.rowIndexStart,S=s?this.getMaxFrozenRowIndex():C.rowIndexEnd;return React.createElement("div",{className:g,ref:e},React.createElement(RowHeader,{enableMultipleSelection:r,focusedCell:n,grid:this.grid,locator:this.locator,isReorderable:d,isResizable:h,loading:hasLoadingOption(c,TableLoadingOption.ROW_HEADERS),maxRowHeight:u,minRowHeight:m,onFocusedCell:this.handleFocus,onLayoutLock:this.handleLayoutLock,onResizeGuide:t,onReordered:this.handleRowsReordered,onReordering:o,onRowHeightChanged:this.handleRowHeightChanged,onSelection:this.getEnabledSelectionHandler(RegionCardinality.FULL_ROWS),rowHeaderCellRenderer:R,selectedRegions:i,selectedRegionTransform:p,rowIndexStart:E,rowIndexEnd:S}),this.maybeRenderRegions(this.styleRowHeaderRegion))},this.bodyCellRenderer=(e,t)=>{const o=this.getColumnProps(t);if(void 0===o)return null;const{id:s,loadingOptions:n,cellRenderer:i,columnHeaderCellRenderer:l,name:r,nameRenderer:a,...d}=o,h=i(e,t),{loading:c=hasLoadingOption(n,ColumnLoadingOption.CELLS)}=h.props,u={...d,loading:c};return React.cloneElement(h,u)},this.renderBody=(e,t=!1,o=!1)=>{const{focusedCell:s,numFrozenColumnsClamped:n,numFrozenRowsClamped:i,selectedRegions:l,viewportRect:r}=this.state,{enableMultipleSelection:a,enableGhostCells:d,loadingOptions:h,bodyContextMenuRenderer:c,selectedRegionTransform:u}=this.props,m=this.grid.getRowIndicesInRect(r,d),R=this.grid.getColumnIndicesInRect(r,d),p=o?0:R.columnIndexStart+n,g=t?0:m.rowIndexStart+i,C=o?n-1:R.columnIndexEnd,E=t?i-1:m.rowIndexEnd,S=e===QuadrantType.MAIN?this.handleCompleteRender:void 0;return React.createElement("div",null,React.createElement(TableBody,{enableMultipleSelection:a,cellRenderer:this.bodyCellRenderer,focusedCell:s,grid:this.grid,loading:hasLoadingOption(h,TableLoadingOption.CELLS),locator:this.locator,onCompleteRender:S,onFocusedCell:this.handleFocus,onSelection:this.getEnabledSelectionHandler(RegionCardinality.CELLS),bodyContextMenuRenderer:c,renderMode:this.getNormalizedRenderMode(),selectedRegions:l,selectedRegionTransform:u,viewportRect:r,columnIndexStart:p,columnIndexEnd:C,rowIndexStart:g,rowIndexEnd:E,numFrozenColumns:o?n:void 0,numFrozenRows:t?i:void 0}),this.maybeRenderRegions(this.styleBodyRegion,e))},this.getEnabledSelectionHandler=e=>isSelectionModeEnabled(this.props,e)?this.handleSelection:this.clearSelection,this.handleCompleteRender=()=>{null!=this.state.viewportRect&&(this.props.onCompleteRender?.(),this.didCompletelyMount=!0)},this.styleBodyRegion=(e,t)=>{const{numFrozenColumns:o}=this.props,s=Regions.getRegionCardinality(e),n=this.grid.getRegionStyle(e),i=(t===QuadrantType.TOP_LEFT||t===QuadrantType.LEFT)&&null!=o&&o>0,l=this.grid.getHeight(),r=this.grid.getWidth(),a="-1px";switch(s){case RegionCardinality.CELLS:return n;case RegionCardinality.FULL_COLUMNS:return n.top=a,n.height=l+1,n;case RegionCardinality.FULL_ROWS:return n.left=a,n.width=r+1,i&&(n.right=a),n;case RegionCardinality.FULL_TABLE:return n.left=a,n.top=a,n.width=r+1,n.height=l+1,i&&(n.right=a),n;default:return{display:"none"}}},this.styleMenuRegion=e=>{const{viewportRect:t}=this.state;if(null==t)return{};const o=Regions.getRegionCardinality(e),s=this.grid.getRegionStyle(e);return o===RegionCardinality.FULL_TABLE?(s.right="0px",s.bottom="0px",s.top="0px",s.left="0px",s.borderBottom="none",s.borderRight="none",s):{display:"none"}},this.styleColumnHeaderRegion=e=>{const{viewportRect:t}=this.state;if(null==t)return{};const o=Regions.getRegionCardinality(e),s=this.grid.getRegionStyle(e);switch(o){case RegionCardinality.FULL_TABLE:return s.left="-1px",s.borderLeft="none",s.bottom="-1px",s;case RegionCardinality.FULL_COLUMNS:return s.bottom="-1px",s;default:return{display:"none"}}},this.styleRowHeaderRegion=e=>{const{viewportRect:t}=this.state;if(null==t)return{};const o=Regions.getRegionCardinality(e),s=this.grid.getRegionStyle(e);switch(o){case RegionCardinality.FULL_TABLE:return s.top="-1px",s.borderTop="none",s.right="-1px",s;case RegionCardinality.FULL_ROWS:return s.right="-1px",s;default:return{display:"none"}}},this.handleColumnWidthChanged=(e,t)=>{const o=this.state.selectedRegions,s=this.state.columnWidths.slice();if(Regions.hasFullTable(o))for(let e=0;e<s.length;e++)s[e]=t;Regions.hasFullColumn(o,e)?Regions.eachUniqueFullColumn(o,(e=>{s[e]=t})):s[e]=t,this.invalidateGrid(),this.setState({columnWidths:s});const{onColumnWidthChanged:n}=this.props;null!=n&&n(e,t)},this.handleRowHeightChanged=(e,t)=>{const o=this.state.selectedRegions,s=this.state.rowHeights.slice();if(Regions.hasFullTable(o))for(let e=0;e<s.length;e++)s[e]=t;Regions.hasFullRow(o,e)?Regions.eachUniqueFullRow(o,(e=>{s[e]=t})):s[e]=t,this.invalidateGrid(),this.setState({rowHeights:s});const{onRowHeightChanged:n}=this.props;null!=n&&n(e,t)},this.handleRootScroll=e=>{null!=this.rootTableElement&&(this.rootTableElement.scrollLeft=0,this.rootTableElement.scrollTop=0)},this.handleBodyScroll=e=>{if(e.stopPropagation(),null!=this.locator&&!this.state.isLayoutLocked){const e=this.locator.getViewportRect();this.updateViewportRect(e)}},this.clearSelection=e=>{this.handleSelection([])},this.syncViewportPosition=({nextScrollLeft:e,nextScrollTop:t})=>{const{viewportRect:o}=this.state;if(void 0!==e||void 0!==t){if(void 0!==t){const e=this.shouldDisableVerticalScroll()?0:this.columnHeaderElement.clientHeight;this.scrollContainerElement.scrollTop=t+e}if(void 0!==e){const t=this.shouldDisableHorizontalScroll()||null==this.rowHeaderElement?0:this.rowHeaderElement.clientWidth;this.scrollContainerElement.scrollLeft=e+t}const s=new Rect(e,t,o.width,o.height);this.updateViewportRect(s)}},this.handleFocus=e=>{this.props.enableFocusedCell&&(null==this.props.focusedCell&&this.setState({focusedCell:e}),this.props.onFocusedCell?.(e))},this.handleSelection=e=>{null==this.props.selectedRegions&&this.setState({selectedRegions:e});const{onSelection:t}=this.props;null!=t&&t(e)},this.handleColumnsReordering=e=>{this.setState({isReordering:!0,verticalGuides:e})},this.handleColumnsReordered=(e,t,o)=>{this.setState({isReordering:!1,verticalGuides:void 0}),this.props.onColumnsReordered?.(e,t,o)},this.handleRowsReordering=e=>{this.setState({isReordering:!0,horizontalGuides:e})},this.handleRowsReordered=(e,t,o)=>{this.setState({isReordering:!1,horizontalGuides:void 0}),this.props.onRowsReordered?.(e,t,o)},this.handleLayoutLock=(e=!1)=>{this.setState({isLayoutLocked:e})},this.updateViewportRect=e=>{const{viewportRect:t}=this.state;this.setState({viewportRect:e}),(null!=t&&!t.equals(e)||null==t&&null!=e)&&this.invokeOnVisibleCellsChangeCallback(e)},this.getMaxFrozenColumnIndex=()=>{const{numFrozenColumnsClamped:e}=this.state;return null!=e?e-1:void 0},this.getMaxFrozenRowIndex=()=>{const{numFrozenRowsClamped:e}=this.state;return null!=e?e-1:void 0},this.handleColumnResizeGuide=e=>{this.setState({verticalGuides:e})},this.handleRowResizeGuide=e=>{this.setState({horizontalGuides:e})};const{children:o,columnWidths:s,defaultRowHeight:n,defaultColumnWidth:i,numRows:l,rowHeights:r}=this.props,a=React.Children.toArray(o),d=Table2.createColumnIdIndex(a);let h=a.map((()=>i));h=Utils.assignSparseValues(h,s);let c=Utils.times(l,(()=>n));c=Utils.assignSparseValues(c,r);const u=null==e.selectedRegions?[]:e.selectedRegions,m=FocusedCellUtils.getInitialFocusedCell(e.enableFocusedCell,e.focusedCell,void 0,u);this.state={childrenArray:a,columnIdToIndex:d,columnWidths:h,focusedCell:m,isLayoutLocked:!1,isReordering:!1,numFrozenColumnsClamped:clampNumFrozenColumns(e),numFrozenRowsClamped:clampNumFrozenRows(e),rowHeights:c,selectedRegions:u},this.hotkeysImpl=new TableHotkeys(e,this.state,this.grid,{getEnabledSelectionHandler:this.getEnabledSelectionHandler,handleFocus:this.handleFocus,handleSelection:this.handleSelection,syncViewportPosition:this.syncViewportPosition}),this.hotkeys=getHotkeysFromProps(e,this.hotkeysImpl)}static getDerivedStateFromProps(e,t){const{children:o,defaultColumnWidth:s,defaultRowHeight:n,enableFocusedCell:i,focusedCell:l,numRows:r,selectedRegions:a,selectionModes:d}=e;let{columnWidths:h,rowHeights:c}=e;null==h&&(h=t.columnWidths),null==c&&(c=t.rowHeights);const u=React.Children.toArray(o),m=u!==t.childrenArray,R=u.length;let p=h;if(h!==t.columnWidths||m){const e=u.map(((e,o)=>{const s=t.columnIdToIndex[e.props.id];return t.columnWidths[null!=s?s:o]}));p=Utils.arrayOfLength(p,R,s),p=Utils.assignSparseValues(p,e),p=Utils.assignSparseValues(p,h)}let g=c;c===t.rowHeights&&r===t.rowHeights.length||(g=Utils.arrayOfLength(g,r,n),g=Utils.assignSparseValues(g,c));let C=a;null==a&&(C=t.selectedRegions.filter((t=>{const o=Regions.getRegionCardinality(t);return isSelectionModeEnabled(e,o,d)&&Regions.isRegionValidForTable(t,r,R)})));const E=FocusedCellUtils.getInitialFocusedCell(i,l,t.focusedCell,C),S={childrenArray:u,columnIdToIndex:m?Table2.createColumnIdIndex(u):t.columnIdToIndex,columnWidths:p,focusedCell:E,numFrozenColumnsClamped:clampNumFrozenColumns(e),numFrozenRowsClamped:clampNumFrozenRows(e),rowHeights:g,selectedRegions:C};return CoreUtils.deepCompareKeys(t,S,Table2.SHALLOW_COMPARE_STATE_KEYS_DENYLIST)?null:S}static createColumnIdIndex(e){const t={};for(let o=0;o<e.length;o++){const s=e[o].props.id;null!=s&&(t[String(s)]=o)}return t}resizeRowsByApproximateHeight(e,t){const o=resizeRowsByApproximateHeight(this.props.numRows,this.state.columnWidths,e,t);this.invalidateGrid(),this.setState({rowHeights:o})}resizeRowsByTallestCell(e){const t=resizeRowsByTallestCell(this.grid,this.state.viewportRect,this.locator,this.state.rowHeights.length,e);this.invalidateGrid(),this.setState({rowHeights:t})}scrollToRegion(e){const{numFrozenColumnsClamped:t,numFrozenRowsClamped:o}=this.state,{left:s,top:n}=this.state.viewportRect,{scrollLeft:i,scrollTop:l}=ScrollUtils.getScrollPositionForRegion(e,s,n,this.grid.getCumulativeWidthBefore,this.grid.getCumulativeHeightBefore,o,t),r=this.shouldDisableHorizontalScroll()?0:i,a=this.shouldDisableVerticalScroll()?0:l;this.quadrantStackInstance.scrollToPosition(r,a)}getChildContext(){return{enableColumnInteractionBar:this.props.enableColumnInteractionBar}}shouldComponentUpdate(e,t){const o={exclude:Table2.SHALLOW_COMPARE_PROP_KEYS_DENYLIST},s={exclude:Table2.SHALLOW_COMPARE_STATE_KEYS_DENYLIST};return!(CoreUtils.shallowCompareKeys(this.props,e,o)&&CoreUtils.shallowCompareKeys(this.state,t,s)&&CoreUtils.deepCompareKeys(this.props,e,Table2.SHALLOW_COMPARE_PROP_KEYS_DENYLIST)&&CoreUtils.deepCompareKeys(this.state,t,Table2.SHALLOW_COMPARE_STATE_KEYS_DENYLIST))}render(){return React.createElement(HotkeysTarget2,{hotkeys:this.hotkeys},this.renderTableContents)}componentDidMount(){this.validateGrid(),this.locator=new Locator(this.rootTableElement,this.scrollContainerElement,this.cellContainerElement),this.updateLocator(),this.updateViewportRect(this.locator.getViewportRect()),this.resizeSensorDetach=ResizeSensor.attach(this.rootTableElement,(()=>{this.state.isLayoutLocked||this.updateViewportRect(this.locator.getViewportRect())}))}componentWillUnmount(){null!=this.resizeSensorDetach&&(this.resizeSensorDetach(),delete this.resizeSensorDetach),this.didCompletelyMount=!1}getSnapshotBeforeUpdate(){const{viewportRect:e}=this.state;this.validateGrid();const t=this.grid.getCumulativeHeightAt(this.grid.numRows-1),o=this.grid.getCumulativeWidthAt(this.grid.numCols-1),s=t<e.top+e.height?Math.max(0,t-e.height):void 0;return{nextScrollLeft:o<e.left+e.width?Math.max(0,o-e.width):void 0,nextScrollTop:s}}componentDidUpdate(e,t,o){super.componentDidUpdate(e,t,o),this.hotkeysImpl.setState(this.state),this.hotkeysImpl.setProps(this.props),(React.Children.toArray(this.props.children)!==this.state.childrenArray||this.props.columnWidths!==t.columnWidths||this.props.rowHeights!==t.rowHeights||this.props.numRows!==e.numRows||this.props.forceRerenderOnSelectionChange&&this.props.selectedRegions!==e.selectedRegions)&&this.invalidateGrid(),null!=this.locator&&(this.validateGrid(),this.updateLocator()),(!CoreUtils.arraysEqual(this.state.columnWidths,t.columnWidths)||!CoreUtils.arraysEqual(this.state.rowHeights,t.rowHeights))&&(this.quadrantStackInstance.synchronizeQuadrantViews(),this.syncViewportPosition(o)),(this.props.getCellClipboardData!==e.getCellClipboardData||this.props.enableFocusedCell!==e.enableFocusedCell||this.props.enableMultipleSelection!==e.enableMultipleSelection||this.props.selectionModes!==e.selectionModes)&&(this.hotkeys=getHotkeysFromProps(this.props,this.hotkeysImpl))}validateProps(e){const{children:t,columnWidths:o,numFrozenColumns:s,numFrozenRows:n,numRows:i,rowHeights:l}=e,r=React.Children.count(t);if(null!=i&&i<0)throw new Error(Errors.TABLE_NUM_ROWS_NEGATIVE);if(null!=n&&n<0)throw new Error(Errors.TABLE_NUM_FROZEN_ROWS_NEGATIVE);if(null!=s&&s<0)throw new Error(Errors.TABLE_NUM_FROZEN_COLUMNS_NEGATIVE);if(null!=i&&null!=l&&l.length!==i)throw new Error(Errors.TABLE_NUM_ROWS_ROW_HEIGHTS_MISMATCH);if(null!=r&&null!=o&&o.length!==r)throw new Error(Errors.TABLE_NUM_COLUMNS_COLUMN_WIDTHS_MISMATCH);React.Children.forEach(t,(e=>{if(!CoreUtils.isElementOfType(e,Column))throw new Error(Errors.TABLE_NON_COLUMN_CHILDREN_WARNING)})),null!=n&&null!=i&&n>i&&console.warn(Errors.TABLE_NUM_FROZEN_ROWS_BOUND_WARNING),null!=s&&s>r&&console.warn(Errors.TABLE_NUM_FROZEN_COLUMNS_BOUND_WARNING)}gridDimensionsMatchProps(){const{children:e,numRows:t}=this.props;return null!=this.grid&&this.grid.numCols===React.Children.count(e)&&this.grid.numRows===t}shouldDisableVerticalScroll(){const{enableGhostCells:e}=this.props,{viewportRect:t}=this.state,o=this.grid.getRowIndicesInRect(t,e),s=null!=t&&0===t.top,n=hasLoadingOption(this.props.loadingOptions,TableLoadingOption.ROW_HEADERS);return e&&this.grid.isGhostIndex(o.rowIndexEnd-1,0)&&(s||n)}shouldDisableHorizontalScroll(){const{enableGhostCells:e}=this.props,{viewportRect:t}=this.state,o=this.grid.getColumnIndicesInRect(t,e),s=null!=t&&0===t.left,n=e&&this.grid.isGhostColumn(o.columnIndexEnd),i=hasLoadingOption(this.props.loadingOptions,TableLoadingOption.COLUMN_HEADERS);return n&&(s||i)}getColumnProps(e){const t=this.state.childrenArray[e];return void 0===t?void 0:t.props}isGuidesShowing(){return null!=this.state.verticalGuides||null!=this.state.horizontalGuides}invalidateGrid(){this.grid=null}validateGrid(){if(null==this.grid){const{defaultRowHeight:e,defaultColumnWidth:t}=this.props,{rowHeights:o,columnWidths:s}=this.state;this.grid=new Grid(o,s,Grid.DEFAULT_BLEED,e,t),this.invokeOnVisibleCellsChangeCallback(this.state.viewportRect),this.hotkeysImpl.setGrid(this.grid)}}maybeRenderRegions(e,t){if(!this.isGuidesShowing()||this.state.isReordering)return Regions.joinStyledRegionGroups(this.state.selectedRegions,this.props.styledRegionGroups,this.state.focusedCell).map(((o,s)=>{const n=o.regions.map((o=>e(o,t)));return React.createElement(RegionLayer,{className:classNames(o.className),key:s,regions:o.regions,regionStyles:n})}))}updateLocator(){this.locator.setGrid(this.grid).setNumFrozenRows(this.state.numFrozenRowsClamped).setNumFrozenColumns(this.state.numFrozenColumnsClamped)}invokeOnVisibleCellsChangeCallback(e){const t=this.grid.getColumnIndicesInRect(e),o=this.grid.getRowIndicesInRect(e);this.props.onVisibleCellsChange?.(o,t)}getNormalizedRenderMode(){const{renderMode:e}=this.props;return e===RenderMode.BATCH||e===RenderMode.BATCH_ON_UPDATE&&this.didCompletelyMount?RenderMode.BATCH:RenderMode.NONE}}Table2.displayName=`${DISPLAYNAME_PREFIX}.Table2`,Table2.defaultProps={defaultColumnWidth:150,defaultRowHeight:20,enableFocusedCell:!1,enableGhostCells:!1,enableMultipleSelection:!0,enableRowHeader:!0,forceRerenderOnSelectionChange:!1,loadingOptions:[],minColumnWidth:50,minRowHeight:20,numFrozenColumns:0,numFrozenRows:0,numRows:0,renderMode:RenderMode.BATCH_ON_UPDATE,rowHeaderCellRenderer:renderDefaultRowHeader,selectionModes:SelectionModes.ALL},Table2.childContextTypes=columnInteractionBarContextTypes,Table2.SHALLOW_COMPARE_PROP_KEYS_DENYLIST=["selectedRegions"],Table2.SHALLOW_COMPARE_STATE_KEYS_DENYLIST=["selectedRegions","viewportRect"];