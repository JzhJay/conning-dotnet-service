import{__assign,__extends}from"tslib";import classNames from"classnames";import*as React from"react";import{AbstractComponent2,Utils as CoreUtils}from"@blueprintjs/core";import{emptyCellRenderer}from"./cell/cell";import{Batcher}from"./common/batcher";import*as Classes from"./common/classes";import{Rect}from"./common/rect";import{RenderMode}from"./common/renderMode";var SHALLOW_COMPARE_DENYLIST=["viewportRect"],BATCHER_RESET_PROP_KEYS_DENYLIST=["columnIndexEnd","columnIndexStart","rowIndexEnd","rowIndexStart"],TableBodyCells=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.batcher=new Batcher,r.renderNewCell=function(e,t){var n=r.props,o=n.columnIndexEnd,l=n.grid,s=n.rowIndexEnd,a=l.getExtremaClasses(e,t,s,o),d=l.isGhostIndex(e,t);return r.renderCell(e,t,a,d)},r.renderCell=function(e,n,o,l){var s,a=r.props,d=a.cellRenderer,c=a.focusedCell,i=a.loading,p=a.grid,m=l?emptyCellRenderer():d(e,n);m=null==m?emptyCellRenderer():m;var u=classNames(cellClassNames(e,n),o,((s={})[Classes.TABLE_CELL_GHOST]=l,s[Classes.TABLE_CELL_LEDGER_ODD]=e%2==1,s[Classes.TABLE_CELL_LEDGER_EVEN]=e%2==0,s),m.props.className),C=t.cellReactKey(e,n),h=l?p.getGhostCellRect(e,n):p.getCellRect(e,n),E=null!=m.props.loading?m.props.loading:i,R=__assign(__assign({},m.props.style),Rect.style(h)),f=null!=c&&c.row===e&&c.col===n;return React.cloneElement(m,{className:u,isFocused:f,key:C,loading:E,style:R})},r.didViewportRectChange=function(e,t){return!(null==e&&null==t||null!=e&&null!=t&&e.equals(t))},r}return __extends(t,e),t.cellReactKey=function(e,t){return"cell-"+e+"-"+t},t.prototype.componentDidMount=function(){this.maybeInvokeOnCompleteRender()},t.prototype.shouldComponentUpdate=function(e){return!CoreUtils.shallowCompareKeys(e,this.props,{exclude:SHALLOW_COMPARE_DENYLIST})||this.didViewportRectChange(e.viewportRect,this.props.viewportRect)},t.prototype.componentDidUpdate=function(e){!CoreUtils.shallowCompareKeys(e,this.props,{exclude:BATCHER_RESET_PROP_KEYS_DENYLIST})&&this.batcher.reset(),this.maybeInvokeOnCompleteRender()},t.prototype.componentWillUnmount=function(){this.batcher.cancelOutstandingCallback()},t.prototype.render=function(){var e=this.props.renderMode===RenderMode.BATCH?this.renderBatchedCells():this.renderAllCells();return React.createElement("div",{className:Classes.TABLE_BODY_CELLS},e)},t.prototype.renderBatchedCells=function(){var e=this,t=this.props,r=t.columnIndexEnd,n=t.columnIndexStart,o=t.rowIndexEnd,l=t.rowIndexStart;this.batcher.startNewBatch();for(var s=l;s<=o;s++)for(var a=n;a<=r;a++)this.batcher.addArgsToBatch(s,a);return this.batcher.removeOldAddNew(this.renderNewCell),this.batcher.isDone()||this.batcher.idleCallback((function(){return e.forceUpdate()})),this.batcher.getList()},t.prototype.renderAllCells=function(){for(var e=this.props,t=e.columnIndexEnd,r=e.columnIndexStart,n=e.rowIndexEnd,o=[],l=[],s=e.rowIndexStart;s<=n;s++)for(var a=r;a<=t;a++)o.push(this.renderNewCell(s,a)),l.push([s,a]);return this.batcher.setList(l,o),o},t.prototype.maybeInvokeOnCompleteRender=function(){var e=this.props,t=e.onCompleteRender,r=e.renderMode;(r===RenderMode.NONE||r===RenderMode.BATCH&&this.batcher.isDone())&&(null==t||t())},t.defaultProps={renderMode:RenderMode.BATCH},t}(AbstractComponent2);export{TableBodyCells};export function cellClassNames(e,t){return[Classes.rowCellIndexClass(e),Classes.columnCellIndexClass(t)]}