"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Locator=void 0;var tslib_1=require("tslib"),Classes=tslib_1.__importStar(require("./common/classes")),rect_1=require("./common/rect"),utils_1=require("./common/utils"),Locator=function(){function t(t,e,n){var o=this;this.tableElement=t,this.scrollContainerElement=e,this.cellContainerElement=n,this.convertCellIndexToClientX=function(t){return o.grid.getCumulativeWidthAt(t)},this.convertCellMidpointToClientX=function(t){return(o.grid.getCumulativeWidthBefore(t)+o.grid.getCumulativeWidthAt(t))/2},this.convertCellIndexToClientY=function(t){return o.grid.getCumulativeHeightAt(t)},this.convertCellMidpointToClientY=function(t){return(o.grid.getCumulativeHeightBefore(t)+o.grid.getCumulativeHeightAt(t))/2},this.toGridX=function(t){var e=o.cellContainerElement.getBoundingClientRect().left,n=o.scrollContainerElement.scrollLeft,l=t-(e+n);return null!=o.numFrozenColumns&&o.numFrozenColumns>0&&l<=o.grid.getCumulativeWidthBefore(o.numFrozenColumns)?l:l+n},this.toGridY=function(t){var e=o.cellContainerElement.getBoundingClientRect().top,n=o.scrollContainerElement.scrollTop,l=t-(e+n);return null!=o.numFrozenRows&&o.numFrozenRows>0&&l<=o.grid.getCumulativeHeightBefore(o.numFrozenRows)?l:l+n},this.numFrozenRows=0,this.numFrozenColumns=0}return t.prototype.setGrid=function(t){return this.grid=t,this},t.prototype.setNumFrozenRows=function(t){return this.numFrozenRows=t,this},t.prototype.setNumFrozenColumns=function(t){return this.numFrozenColumns=t,this},t.prototype.getViewportRect=function(){return new rect_1.Rect(this.scrollContainerElement.scrollLeft||0,this.scrollContainerElement.scrollTop||0,this.scrollContainerElement.clientWidth,this.scrollContainerElement.clientHeight)},t.prototype.getWidestVisibleCellInColumn=function(e){for(var n=this.getColumnCellSelector(e),o=this.tableElement.querySelectorAll(n),l=0,r=0;r<o.length;r++){var i=utils_1.Utils.measureElementTextContent(o.item(r)).width,s=Math.ceil(i)+2*t.CELL_HORIZONTAL_PADDING;s>l&&(l=s)}return l},t.prototype.getTallestVisibleCellInColumn=function(t){for(var e=this.getColumnCellSelector(t),n=this.tableElement.querySelectorAll(e+"."+Classes.TABLE_CELL),o=0,l=0;l<n.length;l++){var r,i=n.item(l),s=i.querySelector("."+Classes.TABLE_TRUNCATED_VALUE),u=i.querySelector("."+Classes.TABLE_TRUNCATED_FORMAT_TEXT),c=i.querySelector("."+Classes.TABLE_TRUNCATED_TEXT);(r=null!=s?s.scrollHeight:null!=u?u.scrollHeight:null!=c?c.scrollHeight:i.scrollHeight)>o&&(o=r)}return o},t.prototype.convertPointToColumn=function(t,e){if(!this.getTableRect().containsX(t))return-1;var n=this.toGridX(t),o=e?this.grid.numCols:this.grid.numCols-1,l=e?this.convertCellMidpointToClientX:this.convertCellIndexToClientX;return utils_1.Utils.binarySearch(n,o,l)},t.prototype.convertPointToRow=function(t,e){if(!this.getTableRect().containsY(t))return-1;var n=this.toGridY(t),o=e?this.grid.numRows:this.grid.numRows-1,l=e?this.convertCellMidpointToClientY:this.convertCellIndexToClientY;return utils_1.Utils.binarySearch(n,o,l)},t.prototype.convertPointToCell=function(t,e){var n=this.toGridX(t),o=this.toGridY(e);return{col:utils_1.Utils.binarySearch(n,this.grid.numCols-1,this.convertCellIndexToClientX),row:utils_1.Utils.binarySearch(o,this.grid.numRows-1,this.convertCellIndexToClientY)}},t.prototype.getColumnCellSelector=function(t){return"."+(t<this.numFrozenColumns?Classes.TABLE_QUADRANT_LEFT:Classes.TABLE_QUADRANT_MAIN)+" ."+Classes.columnCellIndexClass(t)},t.prototype.getTableRect=function(){return rect_1.Rect.wrap(this.tableElement.getBoundingClientRect())},t.CELL_HORIZONTAL_PADDING=10,t}();exports.Locator=Locator;