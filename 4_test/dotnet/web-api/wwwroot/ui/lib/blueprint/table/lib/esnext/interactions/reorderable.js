import*as React from"react";import{Utils as CoreUtils}from"@blueprintjs/core";import{Utils}from"../common/utils";import{RegionCardinality,Regions}from"../regions";import{Draggable}from"./draggable";export class DragReorderable extends React.PureComponent{constructor(){super(...arguments),this.handleActivate=e=>{if(this.shouldIgnoreMouseDown(e))return!1;const t=this.props.locateClick(e);if(!Regions.isValid(t))return!1;const o=Regions.getRegionCardinality(t),s=o===RegionCardinality.FULL_COLUMNS,i=o===RegionCardinality.FULL_ROWS;if(!s&&!i)return!1;const{selectedRegions:n}=this.props,r=Regions.findContainingRegion(n,t);if(r>=0){const e=n[r];if(Regions.getRegionCardinality(e)!==o)return!1;const t=i?e.rows:e.cols;this.selectedRegionStartIndex=t[0],this.selectedRegionLength=t[1]-t[0]+1}else{this.maybeSelectRegion(t);const e=i?t.rows:t.cols;this.selectedRegionStartIndex=e[0],this.selectedRegionLength=e[1]-e[0]+1}return!0},this.handleDragMove=(e,t)=>{const o=this.selectedRegionStartIndex,s=this.props.locateDrag(e,t),i=this.selectedRegionLength,n=Utils.guideIndexToReorderedIndex(o,s,i);this.props.onReordering(o,n,i)},this.handleDragEnd=(e,t)=>{const o=this.selectedRegionStartIndex,s=this.props.locateDrag(e,t),i=this.selectedRegionLength,n=Utils.guideIndexToReorderedIndex(o,s,i);this.props.onReordered(o,n,i);const r=this.props.toRegion(n,n+i-1);this.maybeSelectRegion(r),this.selectedRegionStartIndex=void 0,this.selectedRegionLength=void 0}}render(){const e=this.getDraggableProps();return React.createElement(Draggable,Object.assign({},e,{preventDefault:!1}),this.props.children)}getDraggableProps(){return null==this.props.onReordered?{}:{onActivate:this.handleActivate,onDragEnd:this.handleDragEnd,onDragMove:this.handleDragMove}}shouldIgnoreMouseDown(e){const{disabled:t}=this.props,o=CoreUtils.isFunction(t)?t?.(e):t;return!Utils.isLeftClick(e)||o}maybeSelectRegion(e){const t=[e];CoreUtils.deepCompareKeys(t,this.props.selectedRegions)||(this.props.onSelection(t),this.props.onFocusedCell({...Regions.getFocusCellCoordinatesFromRegion(e),focusSelectionIndex:0}))}}DragReorderable.defaultProps={selectedRegions:[]};