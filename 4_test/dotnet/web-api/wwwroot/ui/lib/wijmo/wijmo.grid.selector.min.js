/*! For license information please see wijmo.grid.selector.min.js.LICENSE.txt */
var wijmo,__extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();!function(e){var t;!function(t){var i="wj-column-selector",o=function(){function t(t,i){this._col=null,this._grid=null,this._isFixedCol=!1,this._isBound=!1,this._showCheckAll=!0,this._clickBnd=this._click.bind(this),this._mousedownBnd=this._mousedown.bind(this),this.columnChanging=new e.Event,this.columnChanged=new e.Event,this.itemChecked=new e.Event,this._initialize(),this.column=this._getColumn(t),e.copy(this,i)}return Object.defineProperty(t.prototype,"column",{get:function(){return this._col},set:function(t){if((t=this._getColumn(t))!=this._col&&this.onColumnChanging(new e.CancelEventArgs)){var i=this._grid;if(i){var o=i.hostElement;i.formatItem.removeHandler(this._formatItem,this),i.removeEventListener(o,"click",this._clickBnd),i.removeEventListener(o,"mousedown",this._mousedownBnd)}var n=this._col=e.asType(t,e.grid.Column,!0);this._grid=i=n?n.grid:null,this._isFixedCol=!!i&&i.columns.indexOf(n)<0,n&&!this._isBound&&(n.allowMerging=!1),i&&!this._isBound&&(i.selectionMode=e.grid.SelectionMode.Cell),i&&(o=i.hostElement,i.formatItem.addHandler(this._formatItem,this),i.addEventListener(o,"click",this._clickBnd,!0),i.addEventListener(o,"mousedown",this._mousedownBnd,!0)),this.onColumnChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCheckAll",{get:function(){return this._showCheckAll},set:function(t){t!=this._showCheckAll&&(this._showCheckAll=e.asBoolean(t),this._grid&&this._grid.invalidate())},enumerable:!0,configurable:!0}),t.prototype.onColumnChanging=function(e){return this.columnChanging.raise(this,e),!e.cancel},t.prototype.onColumnChanged=function(e){this.columnChanged.raise(this,e)},t.prototype.onItemChecked=function(e){this.itemChecked.raise(this,e)},t.prototype._initialize=function(){},t.prototype._click=function(t){if(!t.defaultPrevented&&t.target instanceof HTMLElement){var o=this._grid,n=this._col,s=t.target,r=o.hitTest(s);if(n&&r&&r.getColumn()==n){if(s instanceof HTMLInputElement&&e.hasClass(s,i)){var l=void 0,c=r.panel.rows,d=c[r.range.topRow];if(c==o.columnHeaders.rows){if(l=new e.grid.CellRange(0,0,o.rows.length-1,0),this._isBound){var a=o.selection;a.col=a.col2=n.index,o.select(a)}}else l=this._isGroupRow(d)?d.getCellRange():r.range;return l.isValid&&(this._setRangeChecked(s.checked,l),this.onItemChecked()),o.invalidate(),void t.preventDefault()}if(e.hasClass(s,"wj-cell")&&o.bigCheckboxes&&this._isBound&&(this._isFixedCol||this._isGroupRow(r.getRow()))){var h=s.querySelector("input."+i);h instanceof HTMLInputElement&&(h.click(),t.preventDefault())}}}},t.prototype._mousedown=function(t){var i=this._grid,o=this._col,n=i.editableCollectionView;if(this._isBound&&o&&n&&n.currentEditItem){var s=i.hitTest(t);if(s.getColumn()==o&&this._isGroupRow(s.getRow())){var r=e.closestClass(t.target,"wj-column-selector-group");r instanceof HTMLInputElement&&r.click()}}},t.prototype._isGroupRow=function(t){return t instanceof e.grid.GroupRow&&(!this._grid.childItemsPath||t.getCellRange().rowSpan>1)},t.prototype._getRowChecked=function(e,t){void 0===t&&(t=e);for(var i=0,o=0,n=this._col._binding,s=e;s<=t&&(!i||!o);s++){var r=this._grid.rows[s],l=r.dataItem;l&&!this._isGroupRow(r)&&((this._isBound?n.getValue(l):r.isSelected)?i++:o++)}return!(!i||o)||!(o&&!i)&&null},t.prototype._setRangeChecked=function(t,i){var o=this,n=this._grid,s=n.rows,r=this._col,l=r?r._binding:null,c=n.selection,d=this._isBound?n.editableCollectionView:null;if(!this._isBound||!n.isReadOnly&&d&&l){var a=!1;if(d){var h=!0;d instanceof e.collections.CollectionView&&!d.refreshOnEdit&&(h=!1),h&&(a=!0,d.beginUpdate())}n.deferUpdate((function(){for(var c=i.bottomRow;c>=i.topRow;c--){var a=s[c],h=a.dataItem;if(h)if(o._isGroupRow(a))n.childItemsPath&&!o._isBound&&(a.isSelected=t);else if(o._isBound){if(h[r.binding]!=t){d&&d.editItem(h);var u=new e.grid.CellRange(c,r.index),g=new e.grid.CellEditEndingEventArgs(n.cells,u,h[r.binding]);n.onCellEditEnding(g)&&(l.setValue(h,t),n.onCellEditEnded(g))}}else a.isSelected=t}})),d&&(d.commitEdit(),a&&d.endUpdate(),n.selection=c)}},t.prototype._formatItem=function(t,o){var n=o.getColumn(),s=t.editRange;if(n&&n==this._col&&(!s||!s.contains(o.row,o.col))&&o.panel.rows!=t.columnFooters.rows){var r=o.getRow(),l=o.cell,c="",d=void 0;if(o.panel.rows==t.columnHeaders.rows)this._showCheckAll&&o.range.bottomRow==o.panel.rows.length-1&&(d=this._getRowChecked(0,t.rows.length-1),c=i+" wj-column-selector-group");else if(this._isGroupRow(r)){var a=r.getCellRange();d=this._getRowChecked(a.row,a.row2),c=i+" wj-column-selector-group"}else r.dataItem&&!this._isBound&&(d=this._getRowChecked(o.row),c=i);if(c){if(this._isFixedCol||this._isBound&&this._isGroupRow(r)&&n.aggregate&&n.index>t.columns.firstVisibleIndex){var h=l.querySelector("."+e.grid.CellFactory._WJC_COLLAPSE);l.textContent="",h&&l.appendChild(h)}var u=e.createElement('<label><input type="checkbox" class="'+c+'" tabindex="-1"><span></span></label>'),g=u.querySelector("input");e.setChecked(g,d),this._isBound&&(n.isReadOnly||t.selectionMode==e.grid.SelectionMode.None)&&(g.disabled=!0,g.style.cursor="default"),l.insertBefore(u,l.firstChild)}}},t.prototype._getColumn=function(t){if(t instanceof e.grid.FlexGrid){var i=t,o=i.rowHeaders.columns;t=i.headersVisibility&e.grid.HeadersVisibility.Row&&o.length?o[0]:i.columns[0]}return this._grid&&(e.isString(t)||e.isNumber(t))&&(t=this._grid.getColumn(t)),t instanceof e.grid.Column?t:null},t}();t.Selector=o;var n=function(t){function i(e,i){return t.call(this,e,i)||this}return __extends(i,t),i.prototype.onColumnChanged=function(i){var o=this.column,n=o?o.dataType:null;e.assert(!o||null==n||n==e.DataType.Boolean,"BooleanChecker should be bound to boolean columns"),t.prototype.onColumnChanged.call(this,i)},i.prototype._initialize=function(){this._isBound=!0},i}(o);t.BooleanChecker=n}((t=e.grid||(e.grid={})).selector||(t.selector={}))}(wijmo||(wijmo={})),function(e){var t;(t=e.grid||(e.grid={})).selector||(t.selector={}),e._registerModule("wijmo.grid.selector",e.grid.selector)}(wijmo||(wijmo={}));