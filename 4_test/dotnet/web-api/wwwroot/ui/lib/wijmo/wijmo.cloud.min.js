/*! For license information please see wijmo.cloud.min.js.LICENSE.txt */
var wijmo,__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){!function(t){var r=function(){function t(t,r,n,i){var o=this;if(this.userChanged=new e.Event,this.error=new e.Event,this._gapi=window.gapi,this._gapi)this._gapiLoaded(t,r,n);else{var s=document.createElement("script");s.src="https://apis.google.com/js/api.js",s.onload=function(){return o._gapiLoaded(t,r,n)},document.head.appendChild(s)}e.copy(this,i)}return Object.defineProperty(t.prototype,"user",{get:function(){var e=this._auth();if(e&&e.isSignedIn.get()){var t=e.currentUser.get().getBasicProfile();return{id:t.getId(),name:t.getName(),firstName:t.getGivenName(),lastName:t.getFamilyName(),imageUrl:t.getImageUrl(),eMail:t.getEmail()}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.access_token:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.id_token:null},enumerable:!0,configurable:!0}),t.prototype.signIn=function(){var e=this;this._auth().signIn().then((function(e){}),(function(t){"popup_closed_by_user"!=t&&e.onError(new n(t))}))},t.prototype.signOut=function(){this._auth().signOut()},t.prototype.onUserChanged=function(e){this.userChanged.raise(this,e)},t.prototype.onError=function(e){this.error.raise(this,e)},t.prototype._gapiLoaded=function(t,r,i){var o=this,s=this._gapi=window.gapi;e.assert(s,"Failed to load google gapi."),s.load("client:auth2",(function(){var e=i&&i.length?i.join(" "):"";e=e||"https://www.googleapis.com/auth/userinfo.email",s.client.init({apiKey:t,clientId:r,scope:e}).then((function(){o._auth().isSignedIn.listen((function(){o.onUserChanged()})),o.onUserChanged()}),(function(e){o.onError(new n(e))}))}))},t.prototype._auth=function(){return this._gapi&&this._gapi.auth2?this._gapi.auth2.getAuthInstance():null},t}();t.OAuth2=r;var n=function(e){function t(t){var r=e.call(this)||this;return r._error=t,r}return __extends(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),t}(e.EventArgs);t.OAuthError=n}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={})),function(e){!function(t){var r=function(t){function r(r,n){var i=t.call(this)||this;return i._loading=!1,i._deferCommits=!1,i._hasPendingChanges=!1,i.loading=new e.Event,i.loaded=new e.Event,i.error=new e.Event,i.hasPendingChangesChanged=new e.Event,i._checkType("CollectionReference",r,"firestore","doc","onSnapshot"),i._collection=r,e.copy(i,n),i.itemsEdited.collectionChanged.addHandler(i._updateHasChanges,i),i.itemsAdded.collectionChanged.addHandler(i._updateHasChanges,i),i.itemsRemoved.collectionChanged.addHandler(i._updateHasChanges,i),i._getData(),i}return __extends(r,t),Object.defineProperty(r.prototype,"query",{get:function(){return this._query},set:function(e){e!=this._query&&(this._checkType("Query",e,"firestore","onSnapshot"),this._query=e,this._getData())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t),this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0}),r.prototype.commitChanges=function(){var e=this;if(this.deferCommits&&this.hasPendingChanges){var t=this._collection.firestore.batch();this.itemsEdited.forEach((function(r){var n=e._getItemDoc(r),i=e._getItemData(r);t.update(n,i)})),this.itemsAdded.forEach((function(r){var n=e._getItemDoc(r),i=e._getItemData(r);t.set(n,i)})),this.itemsRemoved.forEach((function(r){var n=e._getItemDoc(r);t.delete(n)})),t.commit().then((function(){e.clearChanges(),e._getData(!0)})).catch((function(t){return e._raiseError(t,!0)}))}},r.prototype.cancelChanges=function(){this.deferCommits&&(this.clearChanges(),this._getData(!0))},Object.defineProperty(r.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),r.prototype.load=function(e){this._getData(e)},r.prototype.onLoading=function(e){return this.loading.raise(this,e),!e.cancel},r.prototype.onLoaded=function(e){this.loaded.raise(this,e)},r.prototype.onError=function(e){return this._loading&&(this._loading=!1,this.onLoaded()),this.error.raise(this,e),!e.cancel},r.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)},r.prototype.commitNew=function(){var e=this;if(!this.deferCommits){var r=this.currentAddItem;r&&this._collection.add(this._getItemData(r)).catch((function(t){return e._raiseError(t,!0)}))}t.prototype.commitNew.call(this)},r.prototype.commitEdit=function(){var e=this;if(!this.deferCommits){var r=this.currentEditItem;if(r&&!this.currentAddItem&&this._getChangedFields(r,this._edtClone)){var n=this._getItemDoc(r),i=this._getItemData(r);n.update(i).catch((function(t){return e._raiseError(t,!0)}))}}t.prototype.commitEdit.call(this)},r.prototype.remove=function(e){var r=this;!this.deferCommits&&e&&e!=this.currentAddItem&&this._getItemDoc(e).delete().catch((function(e){return r._raiseError(e,!0)})),t.prototype.remove.call(this,e)},r.prototype._raiseError=function(e,t){this.onError(new n(e)),t&&this._getData(!0)},r.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;e!=this._hasPendingChanges&&(this._hasPendingChanges=e,this.onHasPendingChangesChanged())},r.prototype._getItemDoc=function(e){var t=e&&e.$META?e.$META.id:this._generateID();return this._collection.doc(t)},r.prototype._getItemData=function(e){var t={},r=this.calculatedFields;for(var n in e)r&&n in r||"$META"!=n&&(t[n]=e[n]);return t},r.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData),this._toGetData=setTimeout((function(){r._toGetData=null,r._loading=!0,r.onLoading(new e.CancelEventArgs)&&(r._unsubscribe&&r._unsubscribe(),r._unsubscribe=r._getQuery().onSnapshot((function(e){var n=[],i=t||!r._loading?r.currentPosition:null;e.forEach((function(e){n.push(__assign({$META:{id:e.id}},e.data()))})),r.sourceCollection=n,null!=i&&r.moveCurrentToPosition(i),r._loading&&(r._loading=!1,r.onLoaded())}),(function(e){return r._raiseError(e,!0)})))}),e.Control._REFRESH_INTERVAL)},r.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e},r.prototype._checkType=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(null!=r)for(var o=0;o<n.length;o++){var s=n[o];null==r[s]&&e.assert(!1,'Expected "'+t+'" but the value does not have "'+s+'".')}},r.prototype._getQuery=function(){return this._query||this._collection},r}(e.collections.CollectionView);t.Snapshot=r;var n=function(e){function t(t){var r=e.call(this)||this;return r._error=t,r}return __extends(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._error.message},enumerable:!0,configurable:!0}),t}(e.CancelEventArgs);t.FirestoreErrorEventArgs=n}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={})),function(e){var t,r;t=e.cloud||(e.cloud={}),r=function(t){function r(r,n,i){var o=t.call(this)||this;return o._loading=!1,o.loading=new e.Event,o.loaded=new e.Event,o.error=new e.Event,o._gSheet=r,o._title=n,o._id=i,o._getData(),r.accessTokenChanged.addHandler((function(){r.accessToken&&!o.items.length&&o._getData(!0)})),o}return __extends(r,t),Object.defineProperty(r.prototype,"googleSheet",{get:function(){return this._gSheet},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0}),r.prototype.load=function(e){this._getData(e)},Object.defineProperty(r.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),r.prototype.onLoading=function(e){return this.loading.raise(this,e),!e.cancel},r.prototype.onLoaded=function(e){this.loaded.raise(this,e)},r.prototype.onError=function(e){return this._loading&&(this._loading=!1,this.onLoaded()),this.error.raise(this,e),!e.cancel},r.prototype.commitNew=function(){var e=this.currentAddItem;e&&this._saveItem(e),t.prototype.commitNew.call(this)},r.prototype.commitEdit=function(){var e=this.currentEditItem;e&&!this.currentAddItem&&this._getChangedFields(e,this._edtClone)&&this._saveItem(e),t.prototype.commitEdit.call(this)},r.prototype.remove=function(r){var n=this;if(r&&r!=this.currentAddItem){var i=this.sourceCollection.indexOf(r);e.assert(i>-1,"Item not found.");var o=i+1;e.assert(null!=this._id,"Sheet doesn't have an ID ? ");var s=this.googleSheet,a=s._getUrl(":batchUpdate");e.httpRequest(a,{method:"POST",requestHeaders:s._getRequestHeaders(),data:{requests:[{deleteDimension:{range:{sheetId:this._id,dimension:"ROWS",startIndex:o,endIndex:o+1}}}]},error:function(e){return n._handleError(e,!1)}})}t.prototype.remove.call(this,r)},r.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData),this._toGetData=setTimeout((function(){if(r._loading=!0,r._itemKeys=null,r.onLoading(new e.CancelEventArgs)){var n=r.currentPosition,i=r.googleSheet,o=i._getUrl("/values/"+r.title+"!2:2");e.httpRequest(o,{requestHeaders:i._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING"},success:function(o){var s=JSON.parse(o.responseText).values[0],a=i._getUrl("/values/"+r.title);e.httpRequest(a,{requestHeaders:i._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"SERIAL_NUMBER"},success:function(e){var i=JSON.parse(e.responseText).values;r.sourceCollection=r._parseData(i,s),t&&r.moveCurrentToPosition(n),r._loading=!1,r.onLoaded()},error:function(e){return r._handleError(e,!1)}})},error:function(e){return r._handleError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)},r.prototype._parseData=function(t,r){for(var n=[],i=t[0],o=!0,s=0;s<i.length&&o;s++){var a=i[s];a&&e.isString(a)&&i.indexOf(a)==s||(o=!1)}if(o)t.splice(0,1);else{var u=[];for(s=0;s<i.length;s++)u.push(this._toSheetHeader(s));i=u}this._itemKeys=i;var c=[],h=this._gSheet.columnDataTypes,l=e.DataType;return i.forEach((function(e){var t=l.Object;h&&h.forEach((function(r){r.pattern.test(e)&&(t=r.dataType)})),c.push(t)})),t.forEach((function(t){var o={};i.forEach((function(n,i){var s=t[i],a=r[i],u=c[i];u==l.Object&&e.isNumber(s)&&e.isString(a)&&a.length&&(u=l.Date),u!=l.Object&&(s=u==l.Date&&e.isNumber(s)?new Date(86400*(s-25568)*1e3):e.changeType(s,u)),o[n]=s})),n.push(o)})),n},r.prototype._toSheetHeader=function(e){return e<26?String.fromCharCode(65+e):this._toSheetHeader(Math.floor(e/26)-1)+this._toSheetHeader(e%26)},r.prototype._saveItem=function(t){var r=this,n=this.sourceCollection.indexOf(t);e.assert(n>-1,"Item not found?");var i=[];this._itemKeys.forEach((function(e){var r=t[e];i.push(null!=r?r.toString():"")}));var o=this.googleSheet,s=(n+2).toString(),a=this.title+"!A"+s+":Z"+s,u=o._getUrl("/values/"+a);u+=(u.indexOf("?key=")>-1?"&":"?")+"valueInputOption=USER_ENTERED",e.httpRequest(u,{method:"PUT",requestHeaders:o._getRequestHeaders(),data:{range:a,values:[i]},error:function(e){return r._handleError(e,!0)}})},r.prototype._handleError=function(t,r){this.onError(new e.RequestErrorEventArgs(t)),r&&this._getData(!0)},r}(e.collections.CollectionView),t.Sheet=r}(wijmo||(wijmo={})),function(e){var t,r;t=e.cloud||(e.cloud={}),r=function(){function r(t,r,n){this._sheetId="",this._accessToken="",this._apiKey="",this._loading=!1,this._sheets=new e.collections.ObservableArray,this.loading=new e.Event,this.loaded=new e.Event,this.error=new e.Event,this.accessTokenChanged=new e.Event,this._sheetId=e.asString(t,!1),this._apiKey=e.asString(r,!1),e.copy(this,n),this._getSheetInfo()}return Object.defineProperty(r.prototype,"sheetId",{get:function(){return this._sheetId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){t!=this._accessToken&&(this._accessToken=e.asString(t),this.onAccessTokenChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnDataTypes",{get:function(){return this._colTypes},set:function(e){this._colTypes=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sheets",{get:function(){return this._sheets},enumerable:!0,configurable:!0}),r.prototype.getSheet=function(e){for(var t=0;t<this._sheets.length;t++){var r=this._sheets[t];if(r.title==e)return r}return null},Object.defineProperty(r.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),r.prototype.onLoading=function(e){this.loading.raise(this,e)},r.prototype.onLoaded=function(e){this.loaded.raise(this,e)},r.prototype.onError=function(e){return this._loading&&(this._loading=!1,this.onLoaded()),this.error.raise(this,e),!e.cancel},r.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)},r.prototype._copy=function(r,n){var i=this;return!("sheets"!=r||!e.isArray(n)||(n.forEach((function(e){var r=new t.Sheet(i,e);i.sheets.push(r)})),0))},r.prototype._getUrl=function(e){var t="https://sheets.googleapis.com/v4/spreadsheets/"+this.sheetId;return e&&(t+=e),this.apiKey&&(t+="?key="+this.apiKey),t},r.prototype._getRequestHeaders=function(){var e={"Content-Type":"application/json"};return this.accessToken&&(e.Authorization="Bearer "+this.accessToken),e},r.prototype._getSheetInfo=function(){var r=this;this._loading=!0,this.onLoading(),e.httpRequest(this._getUrl(),{requestHeaders:this._getRequestHeaders(),data:{fields:"sheets.properties"},success:function(n){var i=JSON.parse(n.responseText),o=i.sheets;r.sheets.length?r.sheets.forEach((function(t){for(var r=0;r<o.length;r++){var n=o[r].properties;if(n.title==t.title){t._id=n.sheetId;break}}e.assert(null!=t._id,'Could not find sheet "'+t.title+'".')})):i.sheets.forEach((function(e){var n=e.properties;if("GRID"==n.sheetType){var i=new t.Sheet(r,n.title,n.sheetId);r.sheets.push(i)}}))},error:function(t){r.onError(new e.RequestErrorEventArgs(t))},complete:function(e){r._loading=!1,r.onLoaded()}})},r}(),t.GoogleSheet=r}(wijmo||(wijmo={})),function(e){var t,r;t=e.cloud||(e.cloud={}),r=function(){function r(t,r,n){this._projectId="",this._collections=new e.collections.ObservableArray,this._accessToken="",this._idToken="",this._fbToken="",this._apiKey="",this.accessTokenChanged=new e.Event,this._projectId=e.asString(t,!1),this._apiKey=e.asString(r,!1),e.copy(this,n)}return Object.defineProperty(r.prototype,"projectId",{get:function(){return this._projectId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){t!=this._accessToken&&(this._accessToken=e.asString(t),this.onAccessTokenChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"idToken",{get:function(){return this._idToken},set:function(t){var r=this;if(t!=this._idToken)if(this._idToken=e.asString(t),this._idToken){var n="https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key="+this._apiKey;e.httpRequest(n,{method:"POST",data:{requestUri:window.location.href,postBody:"id_token="+this._idToken+"&providerId=google.com",returnSecureToken:!0,returnIdpCredential:!0},success:function(e){var t=JSON.parse(e.responseText);r._fbToken=t.idToken,r.onAccessTokenChanged()},error:function(e){r._fbToken="",r.onAccessTokenChanged()}})}else this._fbToken="",this.onAccessTokenChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collections",{get:function(){return this._collections},enumerable:!0,configurable:!0}),r.prototype.getCollection=function(e){for(var t=this._collections,r=0;r<t.length;r++){var n=t[r];if(n.name==e)return n}return null},r.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)},r.prototype._copy=function(r,n){var i=this;return!("collections"!=r||!e.isArray(n)||(n.forEach((function(e){var r=new t.Collection(i,e);i.collections.push(r)})),0))},r}(),t.Firestore=r}(wijmo||(wijmo={})),function(e){(e.cloud||(e.cloud={})).softGridFilter=function(){return e._getModule("wijmo.grid.filter")}}(wijmo||(wijmo={})),function(e){var t,r;t=e.cloud||(e.cloud={}),r=function(r){function n(t,n,i){var o=r.call(this)||this;return o._loading=!1,o._sortOnServer=!1,o._pageOnServer=!1,o._filterOnServer=!1,o._deferCommits=!1,o._hasPendingChanges=!1,o._orderBy=[],o._fieldFilters=[],o._limit=0,o.loading=new e.Event,o.loaded=new e.Event,o.error=new e.Event,o.hasPendingChangesChanged=new e.Event,o._store=t,o._name=n,e.copy(o,i),o.sortDescriptions.collectionChanged.addHandler((function(){o.sortOnServer&&!o.hasPendingChanges&&o._getData(!0)})),t.accessTokenChanged.addHandler((function(){t.accessToken&&!o.items.length&&o.load()})),o.itemsEdited.collectionChanged.addHandler(o._updateHasChanges,o),o.itemsAdded.collectionChanged.addHandler(o._updateHasChanges,o),o.itemsRemoved.collectionChanged.addHandler(o._updateHasChanges,o),o._getData(),o}return __extends(n,r),Object.defineProperty(n.prototype,"store",{get:function(){return this._store},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fields",{get:function(){return this._fields},set:function(t){t!=this._fields&&(this._fields=e.asArray(t),this._getData(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"limit",{get:function(){return this._limit},set:function(t){t!=this._limit&&(this._limit=e.asInt(t),this._getData(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(t){t!=this._sortOnServer&&(this._sortOnServer=e.asBoolean(t),this._getData(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageOnServer",{get:function(){return this._pageOnServer},set:function(t){t!=this._pageOnServer&&(this._pageOnServer=e.asBoolean(t),this._getData(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterOnServer",{get:function(){return this._filterOnServer},set:function(r){if(r!=this._filterOnServer){if(this._filterOnServer=e.asBoolean(r),t.softGridFilter())if(null==n._filterCulture&&(n._filterCulture=e.culture.FlexGridFilter),this._filterOnServer){var i=e.culture.FlexGridFilter;i.stringOperators=i.numberOperators}else e.culture.FlexGridFilter=n._filterCulture;this._getData(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t),this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0}),n.prototype.commitChanges=function(t){var r=this;if(this.deferCommits){var n=[];this.itemsEdited.forEach((function(e){n.push({update:r._itemToDoc(e)})})),this.itemsAdded.forEach((function(e){var t=r._itemToDoc(e);t.name="projects/"+r.store.projectId+"/databases/(default)/documents/"+r.name+"/"+r._generateID(),n.push({update:t})})),this.itemsRemoved.forEach((function(e){n.push({delete:e.$META.name})})),n.length&&e.httpRequest(this._getUrl(":beginTransaction"),{method:"POST",requestHeaders:this._getRequestHeaders(),success:function(i){var o=JSON.parse(i.responseText);e.httpRequest(r._getUrl(":commit"),{method:"POST",data:{writes:n,transaction:o.transaction},requestHeaders:r._getRequestHeaders(),success:function(e){r.clearChanges(),r.load()},complete:function(r){e.isFunction(t)&&t(r)},error:function(e){return r._raiseError(e,!0)}})},error:function(e){return r._raiseError(e,!0)}})}},n.prototype.cancelChanges=function(){this.deferCommits&&(this.clearChanges(),this.load())},Object.defineProperty(n.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),n.prototype.load=function(e){this._getData(e)},n.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.fields=e,this},n.prototype.orderBy=function(t,r){return void 0===r&&(r=!0),t?this._orderBy.push(new e.collections.SortDescription(e.asString(t),e.asBoolean(r))):this._orderBy=[],this._getData(!1),this},n.prototype.where=function(t,r,n){if(t){switch(r.toUpperCase()){case"==":r="EQUAL";break;case"!=":r="NOT_EQUAL";break;case">":r="GREATER_THAN";break;case">=":r="GREATER_THAN_OR_EQUAL";break;case"<":r="LESS_THAN";break;case"<=":r="LESS_THAN_OR_EQUAL";break;case"IN":r="IN",e.assert(e.isArray(n),"IN operator requires array values.");break;default:e.assert(!1,"Unknown operator (should be ==, !=, >, >=, <, <=, or IN).")}for(var i=0;i<this._fieldFilters.length;i++){var o=this._fieldFilters[i].fieldFilter;if(o.field.fieldPath==t&&o.op==r){this._fieldFilters.splice(i,1);break}}this._fieldFilters.push({fieldFilter:{field:{fieldPath:t},op:r,value:this._getValueObject(n)}})}else this._fieldFilters=[];return this._getData(!1),this},n.prototype.getSubCollection=function(t,r,i){e.assert(e.isObject(t)&&null!=t.$META,"invalid parent item");var o=new n(this.store,r,i);return o._parentItem=t,o},n.prototype.onLoading=function(e){return this.loading.raise(this,e),!e.cancel},n.prototype.onLoaded=function(e){this.loaded.raise(this,e)},n.prototype.onError=function(e){return this._loading&&(this._loading=!1,this.onLoaded()),this.error.raise(this,e),!e.cancel},n.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)},Object.defineProperty(n.prototype,"totalItemCount",{get:function(){var e=this._totalCount;return this.pageOnServer?null!=e?e:1e9:this._view?this._view.length:0},set:function(t){this._totalCount=e.asInt(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageCount",{get:function(){return this.pageSize?Math.ceil(this.totalItemCount/this.pageSize):1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageSize",{get:function(){return this._pgSz},set:function(t){t!=this._pgSz&&(this._pgSz=e.asInt(t),this.pageOnServer?(this._pgIdx=e.clamp(this._pgIdx,0,this.pageCount-1),this._getData(!0)):this.refresh())},enumerable:!0,configurable:!0}),n.prototype.onPageChanging=function(e){return r.prototype.onPageChanging.call(this,e),!e.cancel&&this.pageOnServer&&(0==this.pageIndex&&0==this.items.length?e.cancel=!0:this._getData(!0)),!e.cancel},n.prototype.commitNew=function(){var t=this;if(!this.deferCommits){var n=this.currentAddItem;if(n){var i=this._itemToDoc(n);e.httpRequest(this._getUrl(),{method:"POST",data:{fields:i.fields},requestHeaders:this._getRequestHeaders(),success:function(r){var i=JSON.parse(r.responseText);t._saveDocName(i,n),e.isNumber(t._totalCount)&&t._totalCount++},error:function(e){return t._raiseError(e,!0)}})}}r.prototype.commitNew.call(this)},n.prototype.commitEdit=function(){var t=this;if(!this.deferCommits){var n=this.currentEditItem;if(n&&!this.currentAddItem&&this._getChangedFields(n,this._edtClone)){var i=this._itemToDoc(n);e.httpRequest(this._getUrl(i),{method:"PATCH",data:{fields:i.fields},requestHeaders:this._getRequestHeaders(),error:function(e){return t._raiseError(e,!0)}})}}r.prototype.commitEdit.call(this)},n.prototype.remove=function(t){var n=this;if(!this.deferCommits&&t&&t!=this.currentAddItem){var i=this._itemToDoc(t);e.httpRequest(this._getUrl(i),{method:"DELETE",requestHeaders:this._getRequestHeaders(),success:function(t){e.isNumber(n._totalCount)&&n._totalCount--},error:function(e){return n._raiseError(e,!0)}})}r.prototype.remove.call(this,t)},n.prototype.updateFilterDefinition=function(e){this._filterProvider=null,this.filterOnServer&&t.softGridFilter()&&e instanceof t.softGridFilter().FlexGridFilter&&(this._filterProvider=e,this._totalCount=null,this.moveCurrentToFirst(),this._getData(!0))},n.prototype._getPageView=function(){return this.pageOnServer?this._view:r.prototype._getPageView.call(this)},n.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e},n.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;e!=this._hasPendingChanges&&(this._hasPendingChanges=e,this.onHasPendingChangesChanged())},n.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData),this._toGetData=setTimeout((function(){if(r._toGetData=null,r._loading=!0,r.onLoading(new e.CancelEventArgs)){var n=r.currentPosition;e.httpRequest(r._getUrl(":runQuery"),{method:"POST",data:r._getQuery(),requestHeaders:r._getRequestHeaders(),success:function(e){var i=JSON.parse(e.responseText),o=r._parseData(i),s=r.pageSize;if(r.pageOnServer&&s&&o.length<s){var a=i[0].skippedResults||0;if(r._totalCount=a+o.length,0==o.length&&r.pageIndex>0)return void r.moveToLastPage()}r.sourceCollection=o,t&&r.moveCurrentToPosition(n),r._loading=!1,r.onLoaded()},error:function(e){return r._raiseError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)},n.prototype._getQuery=function(){var e={from:[{collectionId:this.name}]};this.fields&&this.fields.length&&(e.select={fields:this.fields.map((function(e){return{fieldPath:e}}))});var t=this._fieldFilters;!t.length&&this._filterProvider&&this.filterOnServer&&(t=this._getQueryFilters()),t&&t.length&&(e.where=1==t.length?t[0]:{compositeFilter:{filters:t,op:"AND"}});var r=[];t&&t.length&&t.forEach((function(e){var t=e.fieldFilter;"IN"!=t.op&&"EQUAL"!=t.op&&r.push({field:t.field.fieldPath,asc:!0})})),this._orderBy.forEach((function(e){r.push({field:e.property,asc:e.ascending})})),!r.length&&this.sortOnServer&&this.sortDescriptions.forEach((function(e){r.push({field:e.property,asc:e.ascending})})),r.length&&(e.orderBy=r.map((function(e){return{field:{fieldPath:e.field},direction:e.asc?"ASCENDING":"DESCENDING"}})));var n=this.pageSize;return this.pageOnServer&&n&&(e.limit=n,e.offset=n*this.pageIndex),!e.limit&&this.limit>0&&(e.limit=this.limit),{structuredQuery:e}},n.prototype._parseData=function(t){var r=this,n=[];return e.isArray(t)&&t.forEach((function(e){var t=r._docToItem(e);t&&n.push(t)})),n},n.prototype._raiseError=function(t,r){this.onError(new e.RequestErrorEventArgs(t)),r&&this._getData(!0)},n.prototype._saveDocName=function(e,t){return!(!e.name||t.$META||(t.$META={name:e.name},0))},n.prototype._docToItem=function(e){if(e.name||(e=e.document),!e||!e.name)return null;var t={};for(var r in this._saveDocName(e,t),e.fields)t[r]=this._getDocValue(e.fields[r]);return t},n.prototype._getDocValue=function(e){var t=this,r=null;for(var n in e)switch(r=e[n],n){case"integerValue":r=parseInt(r);break;case"timestampValue":r=new Date(r);break;case"mapValue":var i={};for(var o in r.fields)i[o]=this._getDocValue(r.fields[o]);r=i;break;case"arrayValue":r=r.values?r.values.map((function(e){return t._getDocValue(e)})):[]}return r},n.prototype._itemToDoc=function(e){var t={},r=e.$META,n=this.calculatedFields;for(var i in r&&r.name&&(t.name=r.name),t.fields={},e)n&&i in n||"$META"!=i&&(t.fields[i]=this._getValueObject(e[i]));return t},n.prototype._getValueObject=function(t){var r=this,n={},i=e.DataType;switch(e.getType(t)){case i.String:n.stringValue=t;break;case i.Boolean:n.booleanValue=t;break;case i.Date:n.timestampValue=t.toJSON();break;case i.Number:t==Math.round(t)?n.integerValue=t.toString():n.doubleValue=t;break;case i.Array:n.arrayValue={values:t.map((function(e){return r._getValueObject(e)}))};break;case i.Object:var o={};for(var s in t)o[s]=this._getValueObject(t[s]);n.mapValue={fields:o};break;default:e.assert(!1,"failed to create value object.")}return n},n.prototype._getRequestHeaders=function(){var e={},t=this.store._fbToken||this.store.accessToken;return t&&(e.Authorization="Bearer "+t),e},n.prototype._getUrl=function(t){var r="https://firestore.googleapis.com/v1/";return e.isObject(t)&&t.name?r+t.name:(t||(t="/"+this.name),r+(this._parentItem?this._parentItem.$META.name:"projects/"+this.store.projectId+"/databases/(default)/documents")+t)},n.prototype._getQueryFilters=function(){var e=[],r=this._filterProvider;if(t.softGridFilter()&&r instanceof t.softGridFilter().FlexGridFilter)for(var n=0;n<r.grid.columns.length;n++){var i=r.grid.columns[n],o=r.getColumnFilter(i,!1);if(o&&o.isActive){o.conditionFilter&&o.conditionFilter.isActive?this._getQueryConditionFilter(e,o.conditionFilter):o.valueFilter&&o.valueFilter.isActive&&this._getQueryValueFilter(e,o.valueFilter);break}}return e},n.prototype._getQueryConditionFilter=function(e,t){var r=t.column.binding,n=this._getQuerySimpleFilter(t.condition1,r),i=this._getQuerySimpleFilter(t.condition2,r);n&&i&&t.and?e.push({compositeFilter:{op:t.and?"AND":"OR",filters:[n,i]}}):n?e.push(n):i&&e.push(i)},n.prototype._getQuerySimpleFilter=function(e,r){if(e.isActive){var n=t.softGridFilter().Operator;return e.operator==n.BW?{compositeFilter:{op:"AND",filters:[{fieldFilter:{field:{fieldPath:r},op:"GREATER_THAN_OR_EQUAL",value:this._getValueObject(e.value)}},{fieldFilter:{field:{fieldPath:r},op:"LESS_THAN",value:this._getValueObject(e.value+"")}}]}}:{fieldFilter:{field:{fieldPath:r},op:this._getFilterOperator(e.operator),value:this._getValueObject(e.value)}}}return null},n.prototype._getFilterOperator=function(r){var n=t.softGridFilter().Operator;switch(r){case n.EQ:return"EQUAL";case n.NE:return"NOT_EQUAL";case n.GE:return"GREATER_THAN_OR_EQUAL";case n.GT:return"GREATER_THAN";case n.LE:return"LESS_THAN_OR_EQUAL";case n.LT:return"LESS_THAN"}e.assert(!1,n[r]+" operator not supported (use EQ, NE, GT, GE, LT, or LE)")},n.prototype._getQueryValueFilter=function(t,r){var n=r.column,i=n.dataMap,o=[];for(var s in r.showValues){var a=e.changeType(s,n.dataType,n.format);if(i&&e.isString(a)&&(a=i.getKeyValue(a)),o.push(a),o.length>=10)break}o.length&&t.push({fieldFilter:{field:{fieldPath:n.binding},op:"IN",value:this._getValueObject(o)}})},n._filterCulture=null,n}(e.collections.CollectionView),t.Collection=r}(wijmo||(wijmo={})),function(e){e.cloud||(e.cloud={}),e._registerModule("wijmo.cloud",e.cloud)}(wijmo||(wijmo={}));