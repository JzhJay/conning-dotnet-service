/*! For license information please see wijmo.grid.detail.min.js.LICENSE.txt */
var wijmo,__extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t;!function(t){"use strict";var i=function(e){function t(t){var i=e.call(this)||this;return i.isReadOnly=!0,i}return __extends(t,e),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},set:function(e){this._detail=e},enumerable:!0,configurable:!0}),t}(e.grid.Row);t.DetailRow=i}((t=e.grid||(e.grid={})).detail||(t.detail={}))}(wijmo||(wijmo={})),function(e){var t;!function(t){"use strict";var i=function(i){function r(e){var t=i.call(this)||this;return t._originalMergeManager=e.mergeManager,t}return __extends(r,i),r.prototype.getMergedRange=function(i,r,a,l){switch(void 0===l&&(l=!0),i.cellType){case e.grid.CellType.Cell:if(i.rows[r]instanceof t.DetailRow)return i.columns.frozen>0&&i.grid&&(i.grid.cloneFrozenCells=!1),new e.grid.CellRange(r,0,r,i.columns.length-1);break;case e.grid.CellType.RowHeader:var s=n(i,r),d=o(i,r),c=i.rows[r].dataItem;!c&&r>0&&i.rows[r]instanceof t.DetailRow&&(c=i.rows[r-1].dataItem);for(var u=r;u>0&&i.rows[u-1].dataItem==c&&n(i,u-1)==s&&o(i,u-1)==d;)u--;for(var h=r;h<i.rows.length-1&&i.rows[h+1].dataItem==c&&n(i,h+1)==s&&o(i,h+1)==d;)h++;return h<i.rows.length-1&&i.rows[h+1]instanceof t.DetailRow&&n(i,h+1)==s&&o(i,h+1)==d&&h++,u!=h?new e.grid.CellRange(u,a,h,a):null}return this._originalMergeManager.getMergedRange(i,r,a,l)},r}(e.grid.MergeManager);function n(e,t){return t<e.rows.frozen}function o(t,i){return t.rows[i]instanceof e.grid._NewRowTemplate}t.DetailMergeManager=i}((t=e.grid||(e.grid={})).detail||(t.detail={}))}(wijmo||(wijmo={})),function(e){var t;!function(t){"use strict";var i,n;e._addCultureInfo("FlexGridDetailProvider",{ariaLabels:{toggleDetail:"Toggle Row Detail"}}),function(e){e[e.None=0]="None",e[e.ToggleDetail=1]="ToggleDetail"}(i=t.KeyAction||(t.KeyAction={})),function(e){e[e.Code=0]="Code",e[e.Selection=1]="Selection",e[e.ExpandSingle=2]="ExpandSingle",e[e.ExpandMulti=3]="ExpandMulti"}(n=t.DetailVisibilityMode||(t.DetailVisibilityMode={}));var o=function(){function o(o,r){var a=this;this._maxHeight=null,this._mode=n.ExpandSingle,this._animated=!1,this._keyActionEnter=i.None,this._g=o,o.mergeManager=new t.DetailMergeManager(o),o.rowHeaders.hostElement.addEventListener("click",this._hdrClick.bind(this)),o.rowHeaders.hostElement.addEventListener("mousedown",(function(e){var t=o.editableCollectionView;(o.activeEditor||t&&t.currentEditItem)&&(a._hdrClick(e),e.preventDefault())})),setTimeout((function(){o.formatItem.addHandler(a._formatItem,a)}),100),o.selectionChanged.addHandler(this._selectionChanged,this),o.resizedRow.addHandler(this._resizedRow,this),o.loadingRows.addHandler((function(){return a.hideDetail()})),o.deletingRow.addHandler((function(e,t){a.hideDetail(t.row)})),o.updatedView.addHandler(this._handleFrozenCells,this),o.cloneFrozenCells=!1,o.draggingRow.addHandler((function(e,i){i.row<e.rows.length-1&&e.rows[i.row+1]instanceof t.DetailRow&&(i.cancel=!0,a.hideDetail(i.row))})),o.hostElement.addEventListener("keydown",(function(t){if(t.keyCode==e.Key.Enter&&a._keyActionEnter==i.ToggleDetail){var n=a._g.selection.row;a._toggleRowDetail(n)&&t.preventDefault()}}),!0),o._root.addEventListener("scroll",(function(){e.Control.refreshAll(o._root)})),e.copy(this,r)}return Object.defineProperty(o.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"detailVisibilityMode",{get:function(){return this._mode},set:function(t){(t=e.asEnum(t,n))!=this._mode&&(this._mode=t,this.hideDetail(),this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxHeight",{get:function(){return this._maxHeight},set:function(t){(t=e.asNumber(t,!0))!=this._maxHeight&&(this._maxHeight=t,this.hideDetail())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isAnimated",{get:function(){return this._animated},set:function(t){t!=this._animated&&(this._animated=e.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"keyActionEnter",{get:function(){return this._keyActionEnter},set:function(t){this._keyActionEnter=e.asEnum(t,i)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"createDetailCell",{get:function(){return this._createDetailCellFn},set:function(t){this._createDetailCellFn=e.asFunction(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"disposeDetailCell",{get:function(){return this._disposeDetailCellFn},set:function(t){this._disposeDetailCellFn=e.asFunction(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rowHasDetail",{get:function(){return this._rowHasDetailFn},set:function(t){(t=e.asFunction(t,!0))!=this._rowHasDetailFn&&(this._rowHasDetailFn=t,this.hideDetail(),this._g.invalidate())},enumerable:!0,configurable:!0}),o.prototype.getDetailRow=function(e){for(var i=this._g.rows,n=this._toIndex(e),o=i[n].dataItem;n<i.length;n++){var r=i[n];if(r instanceof t.DetailRow)return r;if(r.dataItem!=o)return null}return null},o.prototype.isDetailVisible=function(e){return null!=this.getDetailRow(e)},o.prototype.isDetailAvailable=function(e){return e=this._toIndex(e),this._hasDetail(e)},o.prototype.hideDetail=function(i){var n=this._g,o=n.rows;if(null!=i){for(var r=this._toIndex(i);!(o[r]instanceof t.DetailRow)&&r<o.length-1;)r++;var a=o[r];if(a instanceof t.DetailRow){var l=a.detail.parentElement;if(l)for(var s=l.querySelectorAll(".wj-control"),d=0;d<s.length;d++){var c=e.Control.getControl(s[d]);c&&c.containsFocus()&&n.focus(!0)}var u=this.disposeDetailCell;u&&u(a)||e.Control.disposeAll(a.detail),o.removeAt(r)}}else for(var h=0;h<o.length;h++)o[h]instanceof t.DetailRow&&this.hideDetail(h)},o.prototype.showDetail=function(i,n){void 0===n&&(n=!1);var o=this._g,r=o.rows,a=this._toIndex(i);a>0&&r[a]instanceof t.DetailRow&&a--;for(var l=r[a].dataItem;a<r.length-1&&r[a+1].dataItem==l;)a++;if(n){for(var s=o.selection,d=!1,c=0;c<r.length-1;c++)c!=a&&r[c+1]instanceof t.DetailRow&&(this.hideDetail(c),c<a&&a--,c<s.row&&(s.row--,s.row2--,d=!0));d&&o.select(s,!1)}if(!this.isDetailVisible(a)&&this._hasDetail(a)){var u=new t.DetailRow(r[a]),h=this._createDetailCell(r[a]);if(u.detail=h,h){r.insert(a+1,u);var g=o.containsFocus();if(this._animated){var f=h.style;f.transform="translateY(-100%)",f.opacity="0",e.animate((function(t){t<1?(f.transform="translateY("+(100*-(1-t)).toFixed(0)+"%)",f.opacity=(t*t).toString()):(f.transform=f.opacity="",e.Control.invalidateAll(h),g&&o.scrollIntoView(a+1,-1))}))}else g&&o.scrollIntoView(a+1,-1,!0)}}},o.prototype._sizeDetailRow=function(t){var i=this._g,n=t.detail;e.Control.refreshAll(n);var o=n.offsetHeight+i._cellPadVert+1,r=this._maxHeight;e.isNumber(r)&&r>0&&o>r&&(o=r),t.height=o,n.style.height||(n.style.height="100%");var a=n.querySelector(".wj-flexgrid");a&&!a.style.height&&(a.style.height="100%")},o.prototype._handleFrozenCells=function(){var t=this._g,i=t.hostElement,n=e.Control.getControl(i.querySelector(".wj-flexgrid"));if(n instanceof e.grid.FlexGrid&&(n.frozenRows||n.frozenColumns)){e.setCss([t._eTL,t._eBL,t._eCHdr,t._eCFtr,t._eRHdr,t._eMarquee],{zIndex:"13"});for(var o=i.querySelectorAll(".wj-frozen"),r=0;r<o.length;r++){var a=o[r];if(e.closest(a,".wj-flexgrid")==i){var l=parseInt(a.style.zIndex);a.style.zIndex=(l%10+10).toString()}}}},o.prototype._toIndex=function(t){return t instanceof e.grid.Row?t.index:e.asNumber(t)},o.prototype._hdrClick=function(t){if(!t.defaultPrevented&&0==t.button&&e.closestClass(t.target,o._WJC_DETAIL)){var i=n;switch(this._mode){case i.ExpandMulti:case i.ExpandSingle:var r=this._g,a=r.hitTest(t.target);a.panel||(a=r.hitTest(t)),a.panel&&this._toggleRowDetail(a.row)&&t.preventDefault()}}},o.prototype._toggleRowDetail=function(t){if(t>-1){if(this.isDetailVisible(t))return this.hideDetail(t),!0;if(this._hasDetail(t)){var i=this._g;return i.select(new e.grid.CellRange(t,0,t,i.columns.length-1)),this.showDetail(t,this._mode==n.ExpandSingle),!0}}return!1},o.prototype._selectionChanged=function(e,t){var i=this;this._mode==n.Selection&&(this._toSel&&clearTimeout(this._toSel),this._toSel=setTimeout((function(){var t=e._selHdl.selection.row;t>-1?i.showDetail(t,!0):i.hideDetail()}),300))},o.prototype._formatItem=function(i,r){var a=this._g,l=r.cell,s=r.getRow(),d=n;if(r.panel==a.cells&&s instanceof t.DetailRow&&null!=s.detail&&!e.hasClass(l,"wj-detail")&&(e.addClass(l,"wj-detail"),l.textContent="",l.style.textAlign=l.style.zIndex="",l.className=l.className.replace(/wj\-align\-[\S]+/g,""),l.appendChild(s.detail),null==s.height?this._sizeDetailRow(s):e.Control.refreshAll(s.detail)),r.panel==a.rowHeaders&&0==r.col&&this._hasDetail(r.row))switch(l.style.cursor="",this._mode){case d.ExpandMulti:case d.ExpandSingle:var c=this.isDetailVisible(r.row),u=c?"minus":"plus",h=o._WJC_DETAIL;l.innerHTML='<div class="wj-btn wj-btn-glyph '+h+'" role="button" tabindex="-1"><span class="wj-glyph-'+u+'"></span></div>';var g=l.children[0],f=e.culture.FlexGridDetailProvider.ariaLabels.toggleDetail;e.setAriaLabel(g,f),e.setAttribute(g,"aria-expanded",c)}},o.prototype._resizedRow=function(i,n){var o=n.getRow();o instanceof t.DetailRow&&o.detail&&e.Control.refreshAll(o.detail)},o.prototype._hasDetail=function(t){var i=this._g.rows[t];return e.isFunction(this._rowHasDetailFn)?this._rowHasDetailFn(i):this._isRegularRow(i)},o.prototype._isRegularRow=function(i){return!(i instanceof e.grid._NewRowTemplate||i instanceof t.DetailRow||i instanceof e.grid.GroupRow&&!this._g.childItemsPath)},o.prototype._createDetailCell=function(e){return this.createDetailCell?this.createDetailCell(e):null},o._WJC_DETAIL="wj-elem-detail",o}();t.FlexGridDetailProvider=o}((t=e.grid||(e.grid={})).detail||(t.detail={}))}(wijmo||(wijmo={})),function(e){var t;(t=e.grid||(e.grid={})).detail||(t.detail={}),e._registerModule("wijmo.grid.detail",e.grid.detail)}(wijmo||(wijmo={}));