import{__assign,__extends,__rest}from"tslib";import classNames from"classnames";import*as React from"react";import{AbstractPureComponent2,DISPLAYNAME_PREFIX,InputGroup,Keys,Popover,PopoverInteractionKind,Position,refHandler,setRef}from"@blueprintjs/core";import{Classes}from"../../common";import{QueryList}from"../query-list/queryList";var Suggest=function(e){function t(){var t,n=e.apply(this,arguments)||this;return n.state={isOpen:null!=n.props.popoverProps&&n.props.popoverProps.isOpen||!1,selectedItem:n.getInitialSelectedItem()},n.TypedQueryList=QueryList.ofType(),n.inputElement=null,n.queryList=null,n.handleInputRef=refHandler(n,"inputElement",null===(t=n.props.inputProps)||void 0===t?void 0:t.inputRef),n.handleQueryListRef=function(e){return n.queryList=e},n.renderQueryList=function(e){var t=n.props,o=t.fill,s=t.inputProps,i=void 0===s?{}:s,p=t.popoverProps,r=void 0===p?{}:p,l=n.state,u=l.isOpen,a=l.selectedItem,d=e.handleKeyDown,c=e.handleKeyUp,v=i.autoComplete,m=void 0===v?"off":v,f=i.placeholder,h=void 0===f?"Search...":f,y=a?n.props.inputValueRenderer(a):"",I=u&&y?y:h,P=u?e.query:y||(n.props.resetOnClose?"":e.query);return o&&(r.fill=!0,i.fill=!0),React.createElement(Popover,__assign({autoFocus:!1,enforceFocus:!1,isOpen:u,position:Position.BOTTOM_LEFT},r,{className:classNames(e.className,r.className),interactionKind:PopoverInteractionKind.CLICK,onInteraction:n.handlePopoverInteraction,popoverClassName:classNames(Classes.SELECT_POPOVER,r.popoverClassName),onOpening:n.handlePopoverOpening,onOpened:n.handlePopoverOpened}),React.createElement(InputGroup,__assign({autoComplete:m,disabled:n.props.disabled},i,{inputRef:n.handleInputRef,onChange:e.handleQueryChange,onFocus:n.handleInputFocus,onKeyDown:n.getTargetKeyDownHandler(d),onKeyUp:n.getTargetKeyUpHandler(c),placeholder:I,value:P})),React.createElement("div",{onKeyDown:d,onKeyUp:c},e.itemList))},n.selectText=function(){n.requestAnimationFrame((function(){var e;null===(e=n.inputElement)||void 0===e||e.setSelectionRange(0,n.inputElement.value.length)}))},n.handleInputFocus=function(e){var t,o;n.selectText(),n.props.openOnKeyDown||n.setState({isOpen:!0}),null===(o=null===(t=n.props.inputProps)||void 0===t?void 0:t.onFocus)||void 0===o||o.call(t,e)},n.handleItemSelect=function(e,t){var o,s,i,p,r;n.props.closeOnSelect?(null===(s=n.inputElement)||void 0===s||s.blur(),r=!1):(null===(o=n.inputElement)||void 0===o||o.focus(),n.selectText(),r=!0),void 0===n.props.selectedItem?n.setState({isOpen:r,selectedItem:e}):n.setState({isOpen:r}),null===(p=(i=n.props).onItemSelect)||void 0===p||p.call(i,e,t)},n.handlePopoverInteraction=function(e,t){return n.requestAnimationFrame((function(){var o,s,i=n.inputElement===document.activeElement;null==n.inputElement||i||n.setState({isOpen:!1}),null===(s=null===(o=n.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===s||s.call(o,e,t)}))},n.handlePopoverOpening=function(e){var t,o;n.props.resetOnClose&&n.queryList&&n.queryList.setQuery("",!0),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpening)||void 0===o||o.call(t,e)},n.handlePopoverOpened=function(e){var t,o;null!=n.queryList&&n.queryList.scrollActiveItemIntoView(),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpened)||void 0===o||o.call(t,e)},n.getTargetKeyDownHandler=function(e){return function(t){var o,s,i,p=t.which;p===Keys.ESCAPE||p===Keys.TAB?(null===(o=n.inputElement)||void 0===o||o.blur(),n.setState({isOpen:!1})):n.props.openOnKeyDown&&p!==Keys.BACKSPACE&&p!==Keys.ARROW_LEFT&&p!==Keys.ARROW_RIGHT&&n.setState({isOpen:!0}),n.state.isOpen&&(null==e||e(t)),null===(i=null===(s=n.props.inputProps)||void 0===s?void 0:s.onKeyDown)||void 0===i||i.call(s,t)}},n.getTargetKeyUpHandler=function(e){return function(t){var o,s;n.state.isOpen&&(null==e||e(t)),null===(s=null===(o=n.props.inputProps)||void 0===o?void 0:o.onKeyUp)||void 0===s||s.call(o,t)}},n}return __extends(t,e),t.ofType=function(){return t},t.prototype.render=function(){var e,t=this.props,n=(t.disabled,t.inputProps,t.popoverProps,__rest(t,["disabled","inputProps","popoverProps"]));return React.createElement(this.TypedQueryList,__assign({},n,{initialActiveItem:null!==(e=this.props.selectedItem)&&void 0!==e?e:void 0,onItemSelect:this.handleItemSelect,ref:this.handleQueryListRef,renderer:this.renderQueryList}))},t.prototype.componentDidUpdate=function(e,t){var n,o,s,i,p,r,l,u=this;if((null===(n=e.inputProps)||void 0===n?void 0:n.inputRef)!==(null===(o=this.props.inputProps)||void 0===o?void 0:o.inputRef)&&(setRef(null===(s=e.inputProps)||void 0===s?void 0:s.inputRef,null),this.handleInputRef=refHandler(this,"inputElement",null===(i=this.props.inputProps)||void 0===i?void 0:i.inputRef),setRef(null===(p=this.props.inputProps)||void 0===p?void 0:p.inputRef,this.inputElement)),void 0!==this.props.selectedItem&&this.props.selectedItem!==this.state.selectedItem&&this.setState({selectedItem:this.props.selectedItem}),!1===this.state.isOpen&&!0===t.isOpen){var a=null!==(l=null===(r=this.props.popoverProps)||void 0===r?void 0:r.transitionDuration)&&void 0!==l?l:Popover.defaultProps.transitionDuration;setTimeout((function(){return u.maybeResetActiveItemToSelectedItem()}),a)}this.state.isOpen&&!t.isOpen&&null!=this.queryList&&this.queryList.scrollActiveItemIntoView()},t.prototype.getInitialSelectedItem=function(){return void 0!==this.props.selectedItem?this.props.selectedItem:void 0!==this.props.defaultSelectedItem?this.props.defaultSelectedItem:null},t.prototype.maybeResetActiveItemToSelectedItem=function(){var e,t=void 0===this.props.activeItem&&null!==this.state.selectedItem&&!this.props.resetOnSelect;null!==this.queryList&&t&&this.queryList.setActiveItem(null!==(e=this.props.selectedItem)&&void 0!==e?e:this.state.selectedItem)},t.displayName=DISPLAYNAME_PREFIX+".Suggest",t.defaultProps={closeOnSelect:!0,fill:!1,openOnKeyDown:!1,resetOnClose:!1},t}(AbstractPureComponent2);export{Suggest};