"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Suggest=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),common_1=require("../../common"),queryList_1=require("../query-list/queryList"),Suggest=function(e){function t(){var t,n=e.apply(this,arguments)||this;return n.state={isOpen:null!=n.props.popoverProps&&n.props.popoverProps.isOpen||!1,selectedItem:n.getInitialSelectedItem()},n.TypedQueryList=queryList_1.QueryList.ofType(),n.inputElement=null,n.queryList=null,n.handleInputRef=core_1.refHandler(n,"inputElement",null===(t=n.props.inputProps)||void 0===t?void 0:t.inputRef),n.handleQueryListRef=function(e){return n.queryList=e},n.renderQueryList=function(e){var t=n.props,o=t.fill,s=t.inputProps,i=void 0===s?{}:s,r=t.popoverProps,l=void 0===r?{}:r,p=n.state,u=p.isOpen,a=p.selectedItem,c=e.handleKeyDown,d=e.handleKeyUp,v=i.autoComplete,m=void 0===v?"off":v,h=i.placeholder,f=void 0===h?"Search...":h,y=a?n.props.inputValueRenderer(a):"",_=u&&y?y:f,I=u?e.query:y||(n.props.resetOnClose?"":e.query);return o&&(l.fill=!0,i.fill=!0),React.createElement(core_1.Popover,tslib_1.__assign({autoFocus:!1,enforceFocus:!1,isOpen:u,position:core_1.Position.BOTTOM_LEFT},l,{className:classnames_1.default(e.className,l.className),interactionKind:core_1.PopoverInteractionKind.CLICK,onInteraction:n.handlePopoverInteraction,popoverClassName:classnames_1.default(common_1.Classes.SELECT_POPOVER,l.popoverClassName),onOpening:n.handlePopoverOpening,onOpened:n.handlePopoverOpened}),React.createElement(core_1.InputGroup,tslib_1.__assign({autoComplete:m,disabled:n.props.disabled},i,{inputRef:n.handleInputRef,onChange:e.handleQueryChange,onFocus:n.handleInputFocus,onKeyDown:n.getTargetKeyDownHandler(c),onKeyUp:n.getTargetKeyUpHandler(d),placeholder:_,value:I})),React.createElement("div",{onKeyDown:c,onKeyUp:d},e.itemList))},n.selectText=function(){n.requestAnimationFrame((function(){var e;null===(e=n.inputElement)||void 0===e||e.setSelectionRange(0,n.inputElement.value.length)}))},n.handleInputFocus=function(e){var t,o;n.selectText(),n.props.openOnKeyDown||n.setState({isOpen:!0}),null===(o=null===(t=n.props.inputProps)||void 0===t?void 0:t.onFocus)||void 0===o||o.call(t,e)},n.handleItemSelect=function(e,t){var o,s,i,r,l;n.props.closeOnSelect?(null===(s=n.inputElement)||void 0===s||s.blur(),l=!1):(null===(o=n.inputElement)||void 0===o||o.focus(),n.selectText(),l=!0),void 0===n.props.selectedItem?n.setState({isOpen:l,selectedItem:e}):n.setState({isOpen:l}),null===(r=(i=n.props).onItemSelect)||void 0===r||r.call(i,e,t)},n.handlePopoverInteraction=function(e,t){return n.requestAnimationFrame((function(){var o,s,i=n.inputElement===document.activeElement;null==n.inputElement||i||n.setState({isOpen:!1}),null===(s=null===(o=n.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===s||s.call(o,e,t)}))},n.handlePopoverOpening=function(e){var t,o;n.props.resetOnClose&&n.queryList&&n.queryList.setQuery("",!0),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpening)||void 0===o||o.call(t,e)},n.handlePopoverOpened=function(e){var t,o;null!=n.queryList&&n.queryList.scrollActiveItemIntoView(),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpened)||void 0===o||o.call(t,e)},n.getTargetKeyDownHandler=function(e){return function(t){var o,s,i,r=t.which;r===core_1.Keys.ESCAPE||r===core_1.Keys.TAB?(null===(o=n.inputElement)||void 0===o||o.blur(),n.setState({isOpen:!1})):n.props.openOnKeyDown&&r!==core_1.Keys.BACKSPACE&&r!==core_1.Keys.ARROW_LEFT&&r!==core_1.Keys.ARROW_RIGHT&&n.setState({isOpen:!0}),n.state.isOpen&&(null==e||e(t)),null===(i=null===(s=n.props.inputProps)||void 0===s?void 0:s.onKeyDown)||void 0===i||i.call(s,t)}},n.getTargetKeyUpHandler=function(e){return function(t){var o,s;n.state.isOpen&&(null==e||e(t)),null===(s=null===(o=n.props.inputProps)||void 0===o?void 0:o.onKeyUp)||void 0===s||s.call(o,t)}},n}return tslib_1.__extends(t,e),t.ofType=function(){return t},t.prototype.render=function(){var e,t=this.props,n=(t.disabled,t.inputProps,t.popoverProps,tslib_1.__rest(t,["disabled","inputProps","popoverProps"]));return React.createElement(this.TypedQueryList,tslib_1.__assign({},n,{initialActiveItem:null!==(e=this.props.selectedItem)&&void 0!==e?e:void 0,onItemSelect:this.handleItemSelect,ref:this.handleQueryListRef,renderer:this.renderQueryList}))},t.prototype.componentDidUpdate=function(e,t){var n,o,s,i,r,l,p,u=this;if((null===(n=e.inputProps)||void 0===n?void 0:n.inputRef)!==(null===(o=this.props.inputProps)||void 0===o?void 0:o.inputRef)&&(core_1.setRef(null===(s=e.inputProps)||void 0===s?void 0:s.inputRef,null),this.handleInputRef=core_1.refHandler(this,"inputElement",null===(i=this.props.inputProps)||void 0===i?void 0:i.inputRef),core_1.setRef(null===(r=this.props.inputProps)||void 0===r?void 0:r.inputRef,this.inputElement)),void 0!==this.props.selectedItem&&this.props.selectedItem!==this.state.selectedItem&&this.setState({selectedItem:this.props.selectedItem}),!1===this.state.isOpen&&!0===t.isOpen){var a=null!==(p=null===(l=this.props.popoverProps)||void 0===l?void 0:l.transitionDuration)&&void 0!==p?p:core_1.Popover.defaultProps.transitionDuration;setTimeout((function(){return u.maybeResetActiveItemToSelectedItem()}),a)}this.state.isOpen&&!t.isOpen&&null!=this.queryList&&this.queryList.scrollActiveItemIntoView()},t.prototype.getInitialSelectedItem=function(){return void 0!==this.props.selectedItem?this.props.selectedItem:void 0!==this.props.defaultSelectedItem?this.props.defaultSelectedItem:null},t.prototype.maybeResetActiveItemToSelectedItem=function(){var e,t=void 0===this.props.activeItem&&null!==this.state.selectedItem&&!this.props.resetOnSelect;null!==this.queryList&&t&&this.queryList.setActiveItem(null!==(e=this.props.selectedItem)&&void 0!==e?e:this.state.selectedItem)},t.displayName=core_1.DISPLAYNAME_PREFIX+".Suggest",t.defaultProps={closeOnSelect:!0,fill:!1,openOnKeyDown:!1,resetOnClose:!1},t}(core_1.AbstractPureComponent2);exports.Suggest=Suggest;