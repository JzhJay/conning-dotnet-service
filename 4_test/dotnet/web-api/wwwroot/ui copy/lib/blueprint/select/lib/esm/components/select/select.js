import{__assign,__extends,__rest}from"tslib";import classNames from"classnames";import*as React from"react";import{AbstractPureComponent2,Button,DISPLAYNAME_PREFIX,InputGroup,Keys,Popover,Position,refHandler,setRef}from"@blueprintjs/core";import{Classes}from"../../common";import{QueryList}from"../query-list/queryList";var Select=function(e){function t(){var t,n=e.apply(this,arguments)||this;return n.state={isOpen:!1},n.TypedQueryList=QueryList.ofType(),n.inputElement=null,n.queryList=null,n.handleInputRef=refHandler(n,"inputElement",null===(t=n.props.inputProps)||void 0===t?void 0:t.inputRef),n.handleQueryListRef=function(e){return n.queryList=e},n.renderQueryList=function(e){var t,o=n.props,r=o.fill,i=o.filterable,s=void 0===i||i,p=o.disabled,l=void 0!==p&&p,u=o.inputProps,a=void 0===u?{}:u,d=o.popoverProps,c=void 0===d?{}:d,v=o.matchTargetWidth;r&&(c.fill=!0),v&&(null==c.modifiers&&(c.modifiers={}),c.modifiers.minWidth={enabled:!0,fn:function(e){return e.styles.width=e.offsets.reference.width+"px",e},order:800},c.usePortal=!1,c.wrapperTagName="div");var m=React.createElement(InputGroup,__assign({leftIcon:"search",placeholder:"Filter...",rightElement:n.maybeRenderClearButton(e.query)},a,{inputRef:n.handleInputRef,onChange:e.handleQueryChange,value:e.query})),f=e.handleKeyDown,h=e.handleKeyUp;return React.createElement(Popover,__assign({autoFocus:!1,enforceFocus:!1,isOpen:n.state.isOpen,disabled:l,position:Position.BOTTOM_LEFT},c,{className:classNames(e.className,c.className),onInteraction:n.handlePopoverInteraction,popoverClassName:classNames(Classes.SELECT_POPOVER,c.popoverClassName,(t={},t[Classes.SELECT_MATCH_TARGET_WIDTH]=v,t)),onOpening:n.handlePopoverOpening,onOpened:n.handlePopoverOpened,onClosing:n.handlePopoverClosing}),React.createElement("div",{onKeyDown:n.state.isOpen?f:n.handleTargetKeyDown,onKeyUp:n.state.isOpen?h:void 0},n.props.children),React.createElement("div",{onKeyDown:f,onKeyUp:h},s?m:void 0,e.itemList))},n.handleTargetKeyDown=function(e){e.which!==Keys.ARROW_UP&&e.which!==Keys.ARROW_DOWN||(e.preventDefault(),n.setState({isOpen:!0}))},n.handleItemSelect=function(e,t){var o,r;n.setState({isOpen:!1}),null===(r=(o=n.props).onItemSelect)||void 0===r||r.call(o,e,t)},n.handlePopoverInteraction=function(e,t){var o,r;n.setState({isOpen:e}),null===(r=null===(o=n.props.popoverProps)||void 0===o?void 0:o.onInteraction)||void 0===r||r.call(o,e,t)},n.handlePopoverOpening=function(e){var t,o;n.previousFocusedElement=document.activeElement,n.props.resetOnClose&&n.resetQuery(),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpening)||void 0===o||o.call(t,e)},n.handlePopoverOpened=function(e){var t,o;null!=n.queryList&&n.queryList.scrollActiveItemIntoView(),n.requestAnimationFrame((function(){var e,t=n.props.inputProps;!1!==(void 0===t?{}:t).autoFocus&&(null===(e=n.inputElement)||void 0===e||e.focus())})),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onOpened)||void 0===o||o.call(t,e)},n.handlePopoverClosing=function(e){var t,o;n.requestAnimationFrame((function(){void 0!==n.previousFocusedElement&&(n.previousFocusedElement.focus(),n.previousFocusedElement=void 0)})),null===(o=null===(t=n.props.popoverProps)||void 0===t?void 0:t.onClosing)||void 0===o||o.call(t,e)},n.resetQuery=function(){return n.queryList&&n.queryList.setQuery("",!0)},n}return __extends(t,e),t.ofType=function(){return t},t.prototype.render=function(){var e=this.props,t=(e.filterable,e.inputProps,e.popoverProps,__rest(e,["filterable","inputProps","popoverProps"]));return React.createElement(this.TypedQueryList,__assign({},t,{onItemSelect:this.handleItemSelect,ref:this.handleQueryListRef,renderer:this.renderQueryList}))},t.prototype.componentDidUpdate=function(e,t){var n,o,r,i,s;(null===(n=e.inputProps)||void 0===n?void 0:n.inputRef)!==(null===(o=this.props.inputProps)||void 0===o?void 0:o.inputRef)&&(setRef(null===(r=e.inputProps)||void 0===r?void 0:r.inputRef,null),this.handleInputRef=refHandler(this,"inputElement",null===(i=this.props.inputProps)||void 0===i?void 0:i.inputRef),setRef(null===(s=this.props.inputProps)||void 0===s?void 0:s.inputRef,this.inputElement)),this.state.isOpen&&!t.isOpen&&null!=this.queryList&&this.queryList.scrollActiveItemIntoView()},t.prototype.maybeRenderClearButton=function(e){return e.length>0?React.createElement(Button,{icon:"cross",minimal:!0,onClick:this.resetQuery}):void 0},t.displayName=DISPLAYNAME_PREFIX+".Select",t}(AbstractPureComponent2);export{Select};