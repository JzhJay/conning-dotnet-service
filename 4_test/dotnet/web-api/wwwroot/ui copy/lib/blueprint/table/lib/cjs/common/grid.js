"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Grid=void 0;var tslib_1=require("tslib"),regions_1=require("../regions"),Classes=tslib_1.__importStar(require("./classes")),rect_1=require("./rect"),utils_1=require("./utils"),Grid=function(){function t(e,i,n,s,o){var r=this;void 0===n&&(n=t.DEFAULT_BLEED),void 0===s&&(s=t.DEFAULT_GHOST_HEIGHT),void 0===o&&(o=t.DEFAULT_GHOST_WIDTH),this.getCumulativeWidthBefore=function(t){return 0===t?0:r.getCumulativeWidthAt(t-1)},this.getCumulativeWidthAt=function(t){return 0===r.numCols?r.ghostWidth*t:t>=r.numCols?r.cumulativeColumnWidths[r.numCols-1]+r.ghostWidth*(t-r.numCols+1):r.cumulativeColumnWidths[t]},this.getCumulativeHeightBefore=function(t){return 0===t?0:r.getCumulativeHeightAt(t-1)},this.getCumulativeHeightAt=function(t){return 0===r.numRows?r.ghostHeight*t:t>=r.numRows?r.cumulativeRowHeights[r.numRows-1]+r.ghostHeight*(t-r.numRows+1):r.cumulativeRowHeights[t]},this.columnWidths=i,this.rowHeights=e,this.cumulativeColumnWidths=utils_1.Utils.accumulate(i),this.cumulativeRowHeights=utils_1.Utils.accumulate(e),this.numCols=i.length,this.numRows=e.length,this.bleed=n,this.ghostHeight=s,this.ghostWidth=o}return t.prototype.getCellRect=function(t,e){var i=this.rowHeights[t],n=this.cumulativeRowHeights[t]-i,s=this.columnWidths[e],o=this.cumulativeColumnWidths[e]-s;return new rect_1.Rect(o,n,s,i)},t.prototype.getGhostCellRect=function(t,e){var i=0,n=0,s=0,o=0;return t>=this.rowHeights.length?(o=this.ghostHeight,n=this.getHeight()+this.ghostHeight*(t-this.numRows)):(o=this.rowHeights[t],n=this.cumulativeRowHeights[t]-o),e>=this.columnWidths.length?(s=this.ghostWidth,i=this.getWidth()+this.ghostWidth*(e-this.numCols)):(s=this.columnWidths[e],i=this.cumulativeColumnWidths[e]-s),new rect_1.Rect(i,n,s,o)},t.prototype.getRowRect=function(t){var e=this.rowHeights[t],i=this.cumulativeRowHeights[t]-e;return new rect_1.Rect(0,i,this.getWidth(),e)},t.prototype.getColumnRect=function(t){var e=this.columnWidths[t],i=this.cumulativeColumnWidths[t]-e;return new rect_1.Rect(i,0,e,this.getHeight())},t.prototype.getWidth=function(){return 0===this.numCols?0:this.cumulativeColumnWidths[this.numCols-1]},t.prototype.getHeight=function(){return 0===this.numRows?0:this.cumulativeRowHeights[this.numRows-1]},t.prototype.getRect=function(){return new rect_1.Rect(0,0,this.getWidth(),this.getHeight())},t.prototype.mapCellsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getRowIndicesInRect(t),s=n.rowIndexStart,o=n.rowIndexEnd,r=this.getColumnIndicesInRect(t),u=r.columnIndexStart,h=r.columnIndexEnd,l=s;l<=o;l++)for(var c=u;c<=h;c++)i.push(e(l,c));return i},t.prototype.mapRowsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getRowIndicesInRect(t),s=n.rowIndexStart,o=n.rowIndexEnd,r=s;r<=o;r++)i.push(e(r));return i},t.prototype.mapColumnsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getColumnIndicesInRect(t),s=n.columnIndexStart,o=n.columnIndexEnd,r=s;r<=o;r++)i.push(e(r));return i},t.prototype.getRowIndicesInRect=function(e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=t.DEFAULT_MAX_ROWS),null==e)return{rowIndexEnd:0,rowIndexStart:0};var s=i?Math.max(this.numRows,t.DEFAULT_MAX_ROWS):this.numRows,o=e.top,r=void 0===o?0:o,u=e.height,h=this.getIndicesInInterval(r,r+u,s,!i,this.getCumulativeHeightAt),l=h.start,c=h.end;return{rowIndexEnd:n>0&&c-l>n?l+n:c,rowIndexStart:l}},t.prototype.getColumnIndicesInRect=function(e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=t.DEFAULT_MAX_COLUMNS),null==e)return{columnIndexEnd:0,columnIndexStart:0};var s=i?Math.max(this.numCols,t.DEFAULT_MAX_COLUMNS):this.numCols,o=e.left,r=void 0===o?0:o,u=e.width,h=this.getIndicesInInterval(r,r+u,s,!i,this.getCumulativeWidthAt),l=h.start,c=h.end;return{columnIndexEnd:n>0&&c-l>n?l+n:c,columnIndexStart:l}},t.prototype.isGhostIndex=function(t,e){return t>=this.numRows||e>=this.numCols},t.prototype.isGhostColumn=function(t){return t>=this.numCols},t.prototype.getExtremaClasses=function(t,e,i,n){return t===i&&e===n?[Classes.TABLE_LAST_IN_COLUMN,Classes.TABLE_LAST_IN_ROW]:t===i?[Classes.TABLE_LAST_IN_COLUMN]:e===n?[Classes.TABLE_LAST_IN_ROW]:[]},t.prototype.getRegionStyle=function(t){switch(regions_1.Regions.getRegionCardinality(t)){case regions_1.RegionCardinality.CELLS:var e=t.rows,i=e[0],n=e[1],s=t.cols,o=s[0],r=s[1];if(this.isGhostIndex(i,o)||this.isGhostIndex(n,r))return{display:"none"};var u=this.getCellRect(i,o),h=this.getCellRect(n,r),l=0===o?0:1,c=0===i?0:1;return(d=u.union(h)).height+=c,d.left-=l,d.width+=l,d.top-=c,tslib_1.__assign(tslib_1.__assign({},d.style()),{display:"block"});case regions_1.RegionCardinality.FULL_COLUMNS:var a=t.cols;return o=a[0],r=a[1],this.isGhostIndex(0,o)||this.isGhostIndex(0,r)?{display:"none"}:(u=this.getCellRect(0,o),h=this.getCellRect(0,r),l=0===o?0:1,{bottom:0,display:"block",left:(d=u.union(h)).left-l,top:0,width:d.width+l});case regions_1.RegionCardinality.FULL_ROWS:var d,g=t.rows;return i=g[0],n=g[1],this.isGhostIndex(i,0)||this.isGhostIndex(n,0)?{display:"none"}:(u=this.getCellRect(i,0),h=this.getCellRect(n,0),c=0===i?0:1,{display:"block",height:(d=u.union(h)).height+c,left:0,right:0,top:d.top-c});case regions_1.RegionCardinality.FULL_TABLE:return{bottom:0,display:"block",left:0,right:0,top:0};default:return{display:"none"}}},t.prototype.getIndicesInInterval=function(t,e,i,n,s){var o=utils_1.Utils.binarySearch(t,i-1,s),r=utils_1.Utils.binarySearch(e,i-1,s);return o>=0&&t===s(o)&&(o+=1),{start:o=Math.max(0,o-this.bleed),end:r=n?Math.min(i-1,r+this.bleed):Math.min(i-1,r)}},t.DEFAULT_BLEED=3,t.DEFAULT_MAX_COLUMNS=50,t.DEFAULT_MAX_ROWS=200,t.DEFAULT_GHOST_HEIGHT=20,t.DEFAULT_GHOST_WIDTH=150,t}();exports.Grid=Grid;