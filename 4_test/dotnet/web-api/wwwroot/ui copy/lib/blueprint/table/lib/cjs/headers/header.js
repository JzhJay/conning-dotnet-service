"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Header=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),Classes=tslib_1.__importStar(require("../common/classes")),utils_1=require("../common/utils"),dragEvents_1=require("../interactions/dragEvents"),reorderable_1=require("../interactions/reorderable"),resizable_1=require("../interactions/resizable"),selectable_1=require("../interactions/selectable"),regions_1=require("../regions"),SHALLOW_COMPARE_PROP_KEYS_DENYLIST=["focusedCell","selectedRegions"],Header=function(e){function r(r,o){var t=e.call(this,r,o)||this;return t.convertEventToIndex=function(e){var r=t.props.getMouseCoordinate(e);return t.props.convertPointToIndex(r)},t.locateClick=function(e){return t.activationIndex=t.convertEventToIndex(e),t.props.toRegion(t.activationIndex)},t.locateDragForSelection=function(e,r,o){void 0===o&&(o=!1);var n=t.props.getDragCoordinate(r.current),l=t.activationIndex,s=t.props.convertPointToIndex(n);return o?t.props.toRegion(s):t.props.toRegion(l,s)},t.locateDragForReordering=function(e,r){var o=t.props.getDragCoordinate(r.current),n=t.props.convertPointToIndex(o,!0);return n<0?void 0:n},t.renderCells=function(){for(var e=t.props,r=e.indexStart,o=e.indexEnd,n=[],l=r;l<=o;l++)n.push(t.renderNewCell(l));return n},t.renderNewCell=function(e){var r=t.props.getCellExtremaClasses(e,t.props.indexEnd);return(t.props.isGhostIndex(e)?t.props.ghostCellRenderer:t.renderCell)(e,r)},t.renderCell=function(e,r){var o,n,l=t.props,s=l.getIndexClass,i=l.selectedRegions,a=t.props.headerCellRenderer(e);if(null==a)return null;var d=null!=a.props.loading?a.props.loading:t.props.loading,c=t.props.isCellSelected(e),p=t.isEntireCellTargetReorderable(e),u=((n={className:classnames_1.default(r,((o={})[Classes.TABLE_HEADER_REORDERABLE]=p,o),t.props.getCellIndexClass(e),a.props.className),index:e})[t.props.headerCellIsSelectedPropName]=c,n[t.props.headerCellIsReorderablePropName]=p,n.loading=d,n.reorderHandle=t.maybeRenderReorderHandle(e),n),R=React.createElement(selectable_1.DragSelectable,{enableMultipleSelection:t.props.enableMultipleSelection,disabled:t.isDragSelectableDisabled,focusedCell:t.props.focusedCell,ignoredSelectors:["."+Classes.TABLE_REORDER_HANDLE_TARGET],key:s(e),locateClick:t.locateClick,locateDrag:t.locateDragForSelection,onFocusedCell:t.props.onFocusedCell,onSelection:t.handleDragSelectableSelection,onSelectionEnd:t.handleDragSelectableSelectionEnd,selectedRegions:i,selectedRegionTransform:t.props.selectedRegionTransform},React.createElement(resizable_1.Resizable,{isResizable:t.props.isResizable,maxSize:t.props.maxSize,minSize:t.props.minSize,onDoubleClick:function(){var r,o;return null===(o=(r=t.props).handleResizeDoubleClick)||void 0===o?void 0:o.call(r,e)},onLayoutLock:t.props.onLayoutLock,onResizeEnd:function(r){return t.props.handleResizeEnd(e,r)},onSizeChanged:function(r){return t.props.handleSizeChanged(e,r)},orientation:t.props.resizeOrientation,size:t.props.getCellSize(e)},React.cloneElement(a,u)));return t.isReorderHandleEnabled()?R:t.wrapInDragReorderable(e,R,t.isDragReorderableDisabled)},t.handleDragSelectableSelection=function(e){t.props.onSelection(e),t.setState({hasValidSelection:!1})},t.handleDragSelectableSelectionEnd=function(){t.activationIndex=null,t.setState({hasValidSelection:!0})},t.isDragSelectableDisabled=function(e){if(dragEvents_1.DragEvents.isAdditive(e))return!1;var r=t.convertEventToIndex(e);return t.isEntireCellTargetReorderable(r)},t.isDragReorderableDisabled=function(e){if(!t.isDragSelectableDisabled(e))return!0;var r=t.convertEventToIndex(e);return!t.isEntireCellTargetReorderable(r)},t.isEntireCellTargetReorderable=function(e){var r=t.props.selectedRegions;return t.props.isReorderable&&t.props.isCellSelected(e)&&t.state.hasValidSelection&&regions_1.Regions.getRegionCardinality(r[0])===t.props.fullRegionCardinality&&1===r.length&&!t.isReorderHandleEnabled()},t.state={hasValidSelection:t.isSelectedRegionsControlledAndNonEmpty(r)},t}return tslib_1.__extends(r,e),r.prototype.componentDidUpdate=function(e,r){var o=this.isSelectedRegionsControlledAndNonEmpty(this.props);r.hasValidSelection!==o&&this.setState({hasValidSelection:o})},r.prototype.shouldComponentUpdate=function(e,r){return!core_1.Utils.shallowCompareKeys(this.state,r)||!core_1.Utils.shallowCompareKeys(this.props,e,{exclude:SHALLOW_COMPARE_PROP_KEYS_DENYLIST})||!core_1.Utils.deepCompareKeys(this.props,e,SHALLOW_COMPARE_PROP_KEYS_DENYLIST)},r.prototype.render=function(){return this.props.wrapCells(this.renderCells())},r.prototype.isSelectedRegionsControlledAndNonEmpty=function(e){return void 0===e&&(e=this.props),null!=e.selectedRegions&&e.selectedRegions.length>0},r.prototype.isReorderHandleEnabled=function(){return this.isColumnHeader()&&this.props.isReorderable},r.prototype.maybeRenderReorderHandle=function(e){return this.isReorderHandleEnabled()?this.wrapInDragReorderable(e,React.createElement("div",{className:Classes.TABLE_REORDER_HANDLE_TARGET},React.createElement("div",{className:classnames_1.default(Classes.TABLE_REORDER_HANDLE,utils_1.CLASSNAME_EXCLUDED_FROM_TEXT_MEASUREMENT)},React.createElement(core_1.Icon,{icon:"drag-handle-vertical",title:"Press down to drag"}))),!1):void 0},r.prototype.isColumnHeader=function(){return this.props.fullRegionCardinality===regions_1.RegionCardinality.FULL_COLUMNS},r.prototype.wrapInDragReorderable=function(e,r,o){return React.createElement(reorderable_1.DragReorderable,{disabled:o,key:this.props.getIndexClass(e),locateClick:this.locateClick,locateDrag:this.locateDragForReordering,onReordered:this.props.onReordered,onReordering:this.props.onReordering,onSelection:this.props.onSelection,onFocusedCell:this.props.onFocusedCell,selectedRegions:this.props.selectedRegions,toRegion:this.props.toRegion},r)},r}(React.Component);exports.Header=Header;