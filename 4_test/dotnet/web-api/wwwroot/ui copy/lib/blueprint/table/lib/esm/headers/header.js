import{__extends}from"tslib";import classNames from"classnames";import*as React from"react";import{Icon,Utils as CoreUtils}from"@blueprintjs/core";import*as Classes from"../common/classes";import{CLASSNAME_EXCLUDED_FROM_TEXT_MEASUREMENT}from"../common/utils";import{DragEvents}from"../interactions/dragEvents";import{DragReorderable}from"../interactions/reorderable";import{Resizable}from"../interactions/resizable";import{DragSelectable}from"../interactions/selectable";import{RegionCardinality,Regions}from"../regions";var SHALLOW_COMPARE_PROP_KEYS_DENYLIST=["focusedCell","selectedRegions"],Header=function(e){function r(r,o){var n=e.call(this,r,o)||this;return n.convertEventToIndex=function(e){var r=n.props.getMouseCoordinate(e);return n.props.convertPointToIndex(r)},n.locateClick=function(e){return n.activationIndex=n.convertEventToIndex(e),n.props.toRegion(n.activationIndex)},n.locateDragForSelection=function(e,r,o){void 0===o&&(o=!1);var t=n.props.getDragCoordinate(r.current),l=n.activationIndex,s=n.props.convertPointToIndex(t);return o?n.props.toRegion(s):n.props.toRegion(l,s)},n.locateDragForReordering=function(e,r){var o=n.props.getDragCoordinate(r.current),t=n.props.convertPointToIndex(o,!0);return t<0?void 0:t},n.renderCells=function(){for(var e=n.props,r=e.indexStart,o=e.indexEnd,t=[],l=r;l<=o;l++)t.push(n.renderNewCell(l));return t},n.renderNewCell=function(e){var r=n.props.getCellExtremaClasses(e,n.props.indexEnd);return(n.props.isGhostIndex(e)?n.props.ghostCellRenderer:n.renderCell)(e,r)},n.renderCell=function(e,r){var o,t,l=n.props,s=l.getIndexClass,i=l.selectedRegions,a=n.props.headerCellRenderer(e);if(null==a)return null;var d=null!=a.props.loading?a.props.loading:n.props.loading,p=n.props.isCellSelected(e),c=n.isEntireCellTargetReorderable(e),R=((t={className:classNames(r,((o={})[Classes.TABLE_HEADER_REORDERABLE]=c,o),n.props.getCellIndexClass(e),a.props.className),index:e})[n.props.headerCellIsSelectedPropName]=p,t[n.props.headerCellIsReorderablePropName]=c,t.loading=d,t.reorderHandle=n.maybeRenderReorderHandle(e),t),g=React.createElement(DragSelectable,{enableMultipleSelection:n.props.enableMultipleSelection,disabled:n.isDragSelectableDisabled,focusedCell:n.props.focusedCell,ignoredSelectors:["."+Classes.TABLE_REORDER_HANDLE_TARGET],key:s(e),locateClick:n.locateClick,locateDrag:n.locateDragForSelection,onFocusedCell:n.props.onFocusedCell,onSelection:n.handleDragSelectableSelection,onSelectionEnd:n.handleDragSelectableSelectionEnd,selectedRegions:i,selectedRegionTransform:n.props.selectedRegionTransform},React.createElement(Resizable,{isResizable:n.props.isResizable,maxSize:n.props.maxSize,minSize:n.props.minSize,onDoubleClick:function(){var r,o;return null===(o=(r=n.props).handleResizeDoubleClick)||void 0===o?void 0:o.call(r,e)},onLayoutLock:n.props.onLayoutLock,onResizeEnd:function(r){return n.props.handleResizeEnd(e,r)},onSizeChanged:function(r){return n.props.handleSizeChanged(e,r)},orientation:n.props.resizeOrientation,size:n.props.getCellSize(e)},React.cloneElement(a,R)));return n.isReorderHandleEnabled()?g:n.wrapInDragReorderable(e,g,n.isDragReorderableDisabled)},n.handleDragSelectableSelection=function(e){n.props.onSelection(e),n.setState({hasValidSelection:!1})},n.handleDragSelectableSelectionEnd=function(){n.activationIndex=null,n.setState({hasValidSelection:!0})},n.isDragSelectableDisabled=function(e){if(DragEvents.isAdditive(e))return!1;var r=n.convertEventToIndex(e);return n.isEntireCellTargetReorderable(r)},n.isDragReorderableDisabled=function(e){if(!n.isDragSelectableDisabled(e))return!0;var r=n.convertEventToIndex(e);return!n.isEntireCellTargetReorderable(r)},n.isEntireCellTargetReorderable=function(e){var r=n.props.selectedRegions;return n.props.isReorderable&&n.props.isCellSelected(e)&&n.state.hasValidSelection&&Regions.getRegionCardinality(r[0])===n.props.fullRegionCardinality&&1===r.length&&!n.isReorderHandleEnabled()},n.state={hasValidSelection:n.isSelectedRegionsControlledAndNonEmpty(r)},n}return __extends(r,e),r.prototype.componentDidUpdate=function(e,r){var o=this.isSelectedRegionsControlledAndNonEmpty(this.props);r.hasValidSelection!==o&&this.setState({hasValidSelection:o})},r.prototype.shouldComponentUpdate=function(e,r){return!CoreUtils.shallowCompareKeys(this.state,r)||!CoreUtils.shallowCompareKeys(this.props,e,{exclude:SHALLOW_COMPARE_PROP_KEYS_DENYLIST})||!CoreUtils.deepCompareKeys(this.props,e,SHALLOW_COMPARE_PROP_KEYS_DENYLIST)},r.prototype.render=function(){return this.props.wrapCells(this.renderCells())},r.prototype.isSelectedRegionsControlledAndNonEmpty=function(e){return void 0===e&&(e=this.props),null!=e.selectedRegions&&e.selectedRegions.length>0},r.prototype.isReorderHandleEnabled=function(){return this.isColumnHeader()&&this.props.isReorderable},r.prototype.maybeRenderReorderHandle=function(e){return this.isReorderHandleEnabled()?this.wrapInDragReorderable(e,React.createElement("div",{className:Classes.TABLE_REORDER_HANDLE_TARGET},React.createElement("div",{className:classNames(Classes.TABLE_REORDER_HANDLE,CLASSNAME_EXCLUDED_FROM_TEXT_MEASUREMENT)},React.createElement(Icon,{icon:"drag-handle-vertical",title:"Press down to drag"}))),!1):void 0},r.prototype.isColumnHeader=function(){return this.props.fullRegionCardinality===RegionCardinality.FULL_COLUMNS},r.prototype.wrapInDragReorderable=function(e,r,o){return React.createElement(DragReorderable,{disabled:o,key:this.props.getIndexClass(e),locateClick:this.locateClick,locateDrag:this.locateDragForReordering,onReordered:this.props.onReordered,onReordering:this.props.onReordering,onSelection:this.props.onSelection,onFocusedCell:this.props.onFocusedCell,selectedRegions:this.props.selectedRegions,toRegion:this.props.toRegion},r)},r}(React.Component);export{Header};