"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Table=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_lifecycles_compat_1=require("react-lifecycles-compat"),core_1=require("@blueprintjs/core"),column_1=require("./column"),Classes=tslib_1.__importStar(require("./common/classes")),context_1=require("./common/context"),Errors=tslib_1.__importStar(require("./common/errors")),grid_1=require("./common/grid"),FocusedCellUtils=tslib_1.__importStar(require("./common/internal/focusedCellUtils")),ScrollUtils=tslib_1.__importStar(require("./common/internal/scrollUtils")),rect_1=require("./common/rect"),renderMode_1=require("./common/renderMode"),utils_1=require("./common/utils"),columnHeader_1=require("./headers/columnHeader"),columnHeaderCell_1=require("./headers/columnHeaderCell"),rowHeader_1=require("./headers/rowHeader"),resizeSensor_1=require("./interactions/resizeSensor"),guides_1=require("./layers/guides"),regions_1=require("./layers/regions"),locator_1=require("./locator"),tableQuadrant_1=require("./quadrants/tableQuadrant"),tableQuadrantStack_1=require("./quadrants/tableQuadrantStack"),regions_2=require("./regions"),resizeRows_1=require("./resizeRows"),tableBody_1=require("./tableBody"),tableHotkeys_1=require("./tableHotkeys"),tableUtils_1=require("./tableUtils"),Table=function(e){function o(o,n){var l=e.call(this,o,n)||this;l.refHandlers={cellContainer:function(e){return l.cellContainerElement=e},columnHeader:function(e){return l.columnHeaderElement=e},quadrantStack:function(e){return l.quadrantStackInstance=e},rootTable:function(e){return l.rootTableElement=e},rowHeader:function(e){return l.rowHeaderElement=e},scrollContainer:function(e){return l.scrollContainerElement=e}},l.didCompletelyMount=!1,l.renderMenu=function(e){var o,n=classnames_1.default(Classes.TABLE_MENU,((o={})[Classes.TABLE_SELECTION_ENABLED]=t.isSelectionModeEnabled(l.props,regions_2.RegionCardinality.FULL_TABLE),o));return React.createElement("div",{className:n,ref:e,onMouseDown:l.handleMenuMouseDown},l.maybeRenderRegions(l.styleMenuRegion))},l.handleMenuMouseDown=function(e){l.selectAll(!e.shiftKey)},l.selectAll=function(e){if(l.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_TABLE)([regions_2.Regions.table()]),e){var o=regions_2.Regions.getFocusCellCoordinatesFromRegion(regions_2.Regions.table());l.handleFocus(FocusedCellUtils.toFullCoordinates(o))}},l.columnHeaderCellRenderer=function(e){var o=l.getColumnProps(e);if(void 0===o)return null;o.id;var t=o.loadingOptions,n=(o.cellRenderer,o.columnHeaderCellRenderer),r=tslib_1.__rest(o,["id","loadingOptions","cellRenderer","columnHeaderCellRenderer"]),i=tableUtils_1.hasLoadingOption(t,regions_2.ColumnLoadingOption.HEADER);if(null!=n){var s=n(e),a=s.props.loading,d={loading:null!=a?a:i};return React.cloneElement(s,d)}var c=tslib_1.__assign({index:e,loading:i},r);return null!=o.name?React.createElement(columnHeaderCell_1.ColumnHeaderCell,tslib_1.__assign({},c)):React.createElement(columnHeaderCell_1.ColumnHeaderCell,tslib_1.__assign({},c,{name:utils_1.Utils.toBase26Alpha(e)}))},l.renderColumnHeader=function(e,o,n,r){var i;void 0===r&&(r=!1);var s=l.state,a=s.focusedCell,d=s.selectedRegions,c=s.viewportRect,u=l.props,h=u.enableMultipleSelection,R=u.enableGhostCells,g=u.enableColumnReordering,p=u.enableColumnResizing,m=u.loadingOptions,_=u.maxColumnWidth,C=u.minColumnWidth,y=u.selectedRegionTransform,f=classnames_1.default(Classes.TABLE_COLUMN_HEADERS,((i={})[Classes.TABLE_SELECTION_ENABLED]=t.isSelectionModeEnabled(l.props,regions_2.RegionCardinality.FULL_COLUMNS),i)),b=l.grid.getColumnIndicesInRect(c,R),E=r?0:b.columnIndexStart,w=r?l.getMaxFrozenColumnIndex():b.columnIndexEnd;return React.createElement("div",{className:f},React.createElement(columnHeader_1.ColumnHeader,{enableMultipleSelection:h,cellRenderer:l.columnHeaderCellRenderer,focusedCell:a,grid:l.grid,isReorderable:g,isResizable:p,loading:tableUtils_1.hasLoadingOption(m,regions_2.TableLoadingOption.COLUMN_HEADERS),locator:l.locator,maxColumnWidth:_,measurableElementRef:e,minColumnWidth:C,onColumnWidthChanged:l.handleColumnWidthChanged,onFocusedCell:l.handleFocus,onLayoutLock:l.handleLayoutLock,onReordered:l.handleColumnsReordered,onReordering:n,onResizeGuide:o,onSelection:l.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_COLUMNS),selectedRegions:d,selectedRegionTransform:y,columnIndexStart:E,columnIndexEnd:w},l.props.children),l.maybeRenderRegions(l.styleColumnHeaderRegion))},l.renderRowHeader=function(e,o,n,r){var i;void 0===r&&(r=!1);var s=l.state,a=s.focusedCell,d=s.selectedRegions,c=s.viewportRect,u=l.props,h=u.enableMultipleSelection,R=u.enableGhostCells,g=u.enableRowReordering,p=u.enableRowResizing,m=u.loadingOptions,_=u.maxRowHeight,C=u.minRowHeight,y=u.rowHeaderCellRenderer,f=u.selectedRegionTransform,b=classnames_1.default(Classes.TABLE_ROW_HEADERS,((i={})[Classes.TABLE_SELECTION_ENABLED]=t.isSelectionModeEnabled(l.props,regions_2.RegionCardinality.FULL_ROWS),i)),E=l.grid.getRowIndicesInRect(c,R),w=r?0:E.rowIndexStart,S=r?l.getMaxFrozenRowIndex():E.rowIndexEnd;return React.createElement("div",{className:b,ref:e},React.createElement(rowHeader_1.RowHeader,{enableMultipleSelection:h,focusedCell:a,grid:l.grid,locator:l.locator,isReorderable:g,isResizable:p,loading:tableUtils_1.hasLoadingOption(m,regions_2.TableLoadingOption.ROW_HEADERS),maxRowHeight:_,minRowHeight:C,onFocusedCell:l.handleFocus,onLayoutLock:l.handleLayoutLock,onResizeGuide:o,onReordered:l.handleRowsReordered,onReordering:n,onRowHeightChanged:l.handleRowHeightChanged,onSelection:l.getEnabledSelectionHandler(regions_2.RegionCardinality.FULL_ROWS),rowHeaderCellRenderer:y,selectedRegions:d,selectedRegionTransform:f,rowIndexStart:w,rowIndexEnd:S}),l.maybeRenderRegions(l.styleRowHeaderRegion))},l.bodyCellRenderer=function(e,o){var t=l.getColumnProps(o);if(void 0===t)return null;t.id;var n=t.loadingOptions,r=t.cellRenderer,i=(t.columnHeaderCellRenderer,t.name,t.nameRenderer,tslib_1.__rest(t,["id","loadingOptions","cellRenderer","columnHeaderCellRenderer","name","nameRenderer"])),s=r(e,o),a=s.props.loading,d=void 0===a?tableUtils_1.hasLoadingOption(n,regions_2.ColumnLoadingOption.CELLS):a,c=tslib_1.__assign(tslib_1.__assign({},i),{loading:d});return React.cloneElement(s,c)},l.renderBody=function(e,o,t){void 0===o&&(o=!1),void 0===t&&(t=!1);var n=l.state,r=n.focusedCell,i=n.numFrozenColumnsClamped,s=n.numFrozenRowsClamped,a=n.selectedRegions,d=n.viewportRect,c=l.props,u=c.enableMultipleSelection,h=c.enableGhostCells,R=c.loadingOptions,g=c.bodyContextMenuRenderer,p=c.selectedRegionTransform,m=l.grid.getRowIndicesInRect(d,h),_=l.grid.getColumnIndicesInRect(d,h),C=t?0:_.columnIndexStart+i,y=o?0:m.rowIndexStart+s,f=t?i-1:_.columnIndexEnd,b=o?s-1:m.rowIndexEnd,E=e===tableQuadrant_1.QuadrantType.MAIN?l.handleCompleteRender:void 0;return React.createElement("div",null,React.createElement(tableBody_1.TableBody,{enableMultipleSelection:u,cellRenderer:l.bodyCellRenderer,focusedCell:r,grid:l.grid,loading:tableUtils_1.hasLoadingOption(R,regions_2.TableLoadingOption.CELLS),locator:l.locator,onCompleteRender:E,onFocusedCell:l.handleFocus,onSelection:l.getEnabledSelectionHandler(regions_2.RegionCardinality.CELLS),bodyContextMenuRenderer:g,renderMode:l.getNormalizedRenderMode(),selectedRegions:a,selectedRegionTransform:p,viewportRect:d,columnIndexStart:C,columnIndexEnd:f,rowIndexStart:y,rowIndexEnd:b,numFrozenColumns:t?i:void 0,numFrozenRows:o?s:void 0}),l.maybeRenderRegions(l.styleBodyRegion,e))},l.getEnabledSelectionHandler=function(e){return t.isSelectionModeEnabled(l.props,e)?l.handleSelection:l.clearSelection},l.handleCompleteRender=function(){var e,o;null!=l.state.viewportRect&&(null===(o=(e=l.props).onCompleteRender)||void 0===o||o.call(e),l.didCompletelyMount=!0)},l.styleBodyRegion=function(e,o){var t=l.props.numFrozenColumns,n=regions_2.Regions.getRegionCardinality(e),r=l.grid.getRegionStyle(e),i=(o===tableQuadrant_1.QuadrantType.TOP_LEFT||o===tableQuadrant_1.QuadrantType.LEFT)&&null!=t&&t>0,s=l.grid.getHeight(),a=l.grid.getWidth(),d="-1px";switch(n){case regions_2.RegionCardinality.CELLS:return r;case regions_2.RegionCardinality.FULL_COLUMNS:return r.top=d,r.height=s+1,r;case regions_2.RegionCardinality.FULL_ROWS:return r.left=d,r.width=a+1,i&&(r.right=d),r;case regions_2.RegionCardinality.FULL_TABLE:return r.left=d,r.top=d,r.width=a+1,r.height=s+1,i&&(r.right=d),r;default:return{display:"none"}}},l.styleMenuRegion=function(e){if(null==l.state.viewportRect)return{};var o=regions_2.Regions.getRegionCardinality(e),t=l.grid.getRegionStyle(e);return o===regions_2.RegionCardinality.FULL_TABLE?(t.right="0px",t.bottom="0px",t.top="0px",t.left="0px",t.borderBottom="none",t.borderRight="none",t):{display:"none"}},l.styleColumnHeaderRegion=function(e){if(null==l.state.viewportRect)return{};var o=regions_2.Regions.getRegionCardinality(e),t=l.grid.getRegionStyle(e);switch(o){case regions_2.RegionCardinality.FULL_TABLE:return t.left="-1px",t.borderLeft="none",t.bottom="-1px",t;case regions_2.RegionCardinality.FULL_COLUMNS:return t.bottom="-1px",t;default:return{display:"none"}}},l.styleRowHeaderRegion=function(e){if(null==l.state.viewportRect)return{};var o=regions_2.Regions.getRegionCardinality(e),t=l.grid.getRegionStyle(e);switch(o){case regions_2.RegionCardinality.FULL_TABLE:return t.top="-1px",t.borderTop="none",t.right="-1px",t;case regions_2.RegionCardinality.FULL_ROWS:return t.right="-1px",t;default:return{display:"none"}}},l.handleColumnWidthChanged=function(e,o){var t=l.state.selectedRegions,n=l.state.columnWidths.slice();if(regions_2.Regions.hasFullTable(t))for(var r=0;r<n.length;r++)n[r]=o;regions_2.Regions.hasFullColumn(t,e)?regions_2.Regions.eachUniqueFullColumn(t,(function(e){n[e]=o})):n[e]=o,l.invalidateGrid(),l.setState({columnWidths:n});var i=l.props.onColumnWidthChanged;null!=i&&i(e,o)},l.handleRowHeightChanged=function(e,o){var t=l.state.selectedRegions,n=l.state.rowHeights.slice();if(regions_2.Regions.hasFullTable(t))for(var r=0;r<n.length;r++)n[r]=o;regions_2.Regions.hasFullRow(t,e)?regions_2.Regions.eachUniqueFullRow(t,(function(e){n[e]=o})):n[e]=o,l.invalidateGrid(),l.setState({rowHeights:n});var i=l.props.onRowHeightChanged;null!=i&&i(e,o)},l.handleRootScroll=function(e){null!=l.rootTableElement&&(l.rootTableElement.scrollLeft=0,l.rootTableElement.scrollTop=0)},l.handleBodyScroll=function(e){if(e.stopPropagation(),null!=l.locator&&!l.state.isLayoutLocked){var o=l.locator.getViewportRect();l.updateViewportRect(o)}},l.clearSelection=function(e){l.handleSelection([])},l.syncViewportPosition=function(e){var o=e.nextScrollLeft,t=e.nextScrollTop,n=l.state.viewportRect;if(void 0!==o||void 0!==t){if(void 0!==t){var r=l.shouldDisableVerticalScroll()?0:l.columnHeaderElement.clientHeight;l.scrollContainerElement.scrollTop=t+r}if(void 0!==o){var i=l.shouldDisableHorizontalScroll()||null==l.rowHeaderElement?0:l.rowHeaderElement.clientWidth;l.scrollContainerElement.scrollLeft=o+i}var s=new rect_1.Rect(o,t,n.width,n.height);l.updateViewportRect(s)}},l.handleFocus=function(e){var o,t;l.props.enableFocusedCell&&(null==l.props.focusedCell&&l.setState({focusedCell:e}),null===(t=(o=l.props).onFocusedCell)||void 0===t||t.call(o,e))},l.handleSelection=function(e){null==l.props.selectedRegions&&l.setState({selectedRegions:e});var o=l.props.onSelection;null!=o&&o(e)},l.handleColumnsReordering=function(e){l.setState({isReordering:!0,verticalGuides:e})},l.handleColumnsReordered=function(e,o,t){var n,r;l.setState({isReordering:!1,verticalGuides:void 0}),null===(r=(n=l.props).onColumnsReordered)||void 0===r||r.call(n,e,o,t)},l.handleRowsReordering=function(e){l.setState({isReordering:!0,horizontalGuides:e})},l.handleRowsReordered=function(e,o,t){var n,r;l.setState({isReordering:!1,horizontalGuides:void 0}),null===(r=(n=l.props).onRowsReordered)||void 0===r||r.call(n,e,o,t)},l.handleLayoutLock=function(e){void 0===e&&(e=!1),l.setState({isLayoutLocked:e})},l.updateViewportRect=function(e){var o=l.state.viewportRect;l.setState({viewportRect:e}),(null!=o&&!o.equals(e)||null==o&&null!=e)&&l.invokeOnVisibleCellsChangeCallback(e)},l.getMaxFrozenColumnIndex=function(){var e=l.state.numFrozenColumnsClamped;return null!=e?e-1:void 0},l.getMaxFrozenRowIndex=function(){var e=l.state.numFrozenRowsClamped;return null!=e?e-1:void 0},l.handleColumnResizeGuide=function(e){l.setState({verticalGuides:e})},l.handleRowResizeGuide=function(e){l.setState({horizontalGuides:e})};var r=l.props,i=r.children,s=r.columnWidths,a=r.defaultRowHeight,d=r.defaultColumnWidth,c=r.numRows,u=r.rowHeights,h=React.Children.toArray(i),R=t.createColumnIdIndex(h),g=h.map((function(){return d}));g=utils_1.Utils.assignSparseValues(g,s);var p=utils_1.Utils.times(c,(function(){return a}));p=utils_1.Utils.assignSparseValues(p,u);var m=null==o.selectedRegions?[]:o.selectedRegions,_=FocusedCellUtils.getInitialFocusedCell(o.enableFocusedCell,o.focusedCell,void 0,m);return l.state={childrenArray:h,columnIdToIndex:R,columnWidths:g,focusedCell:_,isLayoutLocked:!1,isReordering:!1,numFrozenColumnsClamped:tableUtils_1.clampNumFrozenColumns(o),numFrozenRowsClamped:tableUtils_1.clampNumFrozenRows(o),rowHeights:p,selectedRegions:m},l.hotkeysImpl=new tableHotkeys_1.TableHotkeys(o,l.state,l.grid,{getEnabledSelectionHandler:l.getEnabledSelectionHandler,handleFocus:l.handleFocus,handleSelection:l.handleSelection,syncViewportPosition:l.syncViewportPosition}),l}var t;return tslib_1.__extends(o,e),t=o,o.getDerivedStateFromProps=function(e,o){var n=e.children,l=e.defaultColumnWidth,r=e.defaultRowHeight,i=e.enableFocusedCell,s=e.focusedCell,a=e.numRows,d=e.selectedRegions,c=e.selectionModes,u=e.columnWidths,h=e.rowHeights;null==u&&(u=o.columnWidths),null==h&&(h=o.rowHeights);var R=React.Children.toArray(n),g=R!==o.childrenArray,p=R.length,m=u;if(u!==o.columnWidths||g){var _=R.map((function(e,t){var n=o.columnIdToIndex[e.props.id];return o.columnWidths[null!=n?n:t]}));m=utils_1.Utils.arrayOfLength(m,p,l),m=utils_1.Utils.assignSparseValues(m,_),m=utils_1.Utils.assignSparseValues(m,u)}var C=h;h===o.rowHeights&&a===o.rowHeights.length||(C=utils_1.Utils.arrayOfLength(C,a,r),C=utils_1.Utils.assignSparseValues(C,h));var y=d;null==d&&(y=o.selectedRegions.filter((function(o){var n=regions_2.Regions.getRegionCardinality(o);return t.isSelectionModeEnabled(e,n,c)&&regions_2.Regions.isRegionValidForTable(o,a,p)})));var f=FocusedCellUtils.getInitialFocusedCell(i,s,o.focusedCell,y),b={childrenArray:R,columnIdToIndex:g?t.createColumnIdIndex(R):o.columnIdToIndex,columnWidths:m,focusedCell:f,numFrozenColumnsClamped:tableUtils_1.clampNumFrozenColumns(e),numFrozenRowsClamped:tableUtils_1.clampNumFrozenRows(e),rowHeights:C,selectedRegions:y};return core_1.Utils.deepCompareKeys(o,b,t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST)?null:b},o.createColumnIdIndex=function(e){for(var o={},t=0;t<e.length;t++){var n=e[t].props.id;null!=n&&(o[String(n)]=t)}return o},o.isSelectionModeEnabled=function(e,o,t){void 0===t&&(t=e.selectionModes);var n=e.children,l=e.numRows,r=React.Children.count(n);return t.indexOf(o)>=0&&l>0&&r>0},o.prototype.resizeRowsByApproximateHeight=function(e,o){var t=resizeRows_1.resizeRowsByApproximateHeight(this.props.numRows,this.state.columnWidths,e,o);this.invalidateGrid(),this.setState({rowHeights:t})},o.prototype.resizeRowsByTallestCell=function(e){var o=resizeRows_1.resizeRowsByTallestCell(this.grid,this.state.viewportRect,this.locator,this.state.rowHeights.length,e);this.invalidateGrid(),this.setState({rowHeights:o})},o.prototype.scrollToRegion=function(e){var o=this.state,t=o.numFrozenColumnsClamped,n=o.numFrozenRowsClamped,l=this.state.viewportRect,r=l.left,i=l.top,s=ScrollUtils.getScrollPositionForRegion(e,r,i,this.grid.getCumulativeWidthBefore,this.grid.getCumulativeHeightBefore,n,t),a=s.scrollLeft,d=s.scrollTop,c=this.shouldDisableHorizontalScroll()?0:a,u=this.shouldDisableVerticalScroll()?0:d;this.quadrantStackInstance.scrollToPosition(c,u)},o.prototype.getChildContext=function(){return{enableColumnInteractionBar:this.props.enableColumnInteractionBar}},o.prototype.shouldComponentUpdate=function(e,o){var n={exclude:t.SHALLOW_COMPARE_PROP_KEYS_DENYLIST},l={exclude:t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST};return!(core_1.Utils.shallowCompareKeys(this.props,e,n)&&core_1.Utils.shallowCompareKeys(this.state,o,l)&&core_1.Utils.deepCompareKeys(this.props,e,t.SHALLOW_COMPARE_PROP_KEYS_DENYLIST)&&core_1.Utils.deepCompareKeys(this.state,o,t.SHALLOW_COMPARE_STATE_KEYS_DENYLIST))},o.prototype.render=function(){var e,o=this.props,n=o.children,l=o.className,r=o.enableRowHeader,i=o.loadingOptions,s=o.numRows,a=o.enableColumnInteractionBar,d=this.state,c=d.horizontalGuides,u=d.numFrozenColumnsClamped,h=d.numFrozenRowsClamped,R=d.verticalGuides;this.gridDimensionsMatchProps()||this.invalidateGrid(),this.validateGrid();var g=classnames_1.default(Classes.TABLE_CONTAINER,((e={})[Classes.TABLE_REORDERING]=this.state.isReordering,e[Classes.TABLE_NO_VERTICAL_SCROLL]=this.shouldDisableVerticalScroll(),e[Classes.TABLE_NO_HORIZONTAL_SCROLL]=this.shouldDisableHorizontalScroll(),e[Classes.TABLE_SELECTION_ENABLED]=t.isSelectionModeEnabled(this.props,regions_2.RegionCardinality.CELLS),e[Classes.TABLE_NO_ROWS]=0===s,e),l);return React.createElement("div",{className:g,ref:this.refHandlers.rootTable,onScroll:this.handleRootScroll},React.createElement(tableQuadrantStack_1.TableQuadrantStack,{bodyRef:this.refHandlers.cellContainer,bodyRenderer:this.renderBody,columnHeaderCellRenderer:this.renderColumnHeader,columnHeaderRef:this.refHandlers.columnHeader,enableColumnInteractionBar:a,enableRowHeader:r,grid:this.grid,handleColumnResizeGuide:this.handleColumnResizeGuide,handleColumnsReordering:this.handleColumnsReordering,handleRowResizeGuide:this.handleRowResizeGuide,handleRowsReordering:this.handleRowsReordering,isHorizontalScrollDisabled:this.shouldDisableHorizontalScroll(),isVerticalScrollDisabled:this.shouldDisableVerticalScroll(),loadingOptions:i,numColumns:React.Children.count(n),numFrozenColumns:u,numFrozenRows:h,numRows:s,onScroll:this.handleBodyScroll,ref:this.refHandlers.quadrantStack,menuRenderer:this.renderMenu,rowHeaderCellRenderer:this.renderRowHeader,rowHeaderRef:this.refHandlers.rowHeader,scrollContainerRef:this.refHandlers.scrollContainer}),React.createElement("div",{className:classnames_1.default(Classes.TABLE_OVERLAY_LAYER,Classes.TABLE_OVERLAY_REORDERING_CURSOR)}),React.createElement(guides_1.GuideLayer,{className:Classes.TABLE_RESIZE_GUIDES,verticalGuides:R,horizontalGuides:c}))},o.prototype.renderHotkeys=function(){var e=[this.maybeRenderCopyHotkey(),this.maybeRenderSelectAllHotkey(),this.maybeRenderFocusHotkeys(),this.maybeRenderSelectionResizeHotkeys()];return React.createElement(core_1.Hotkeys,null,e.filter((function(e){return void 0!==e})))},o.prototype.componentDidMount=function(){var e=this;this.validateGrid(),this.locator=new locator_1.Locator(this.rootTableElement,this.scrollContainerElement,this.cellContainerElement),this.updateLocator(),this.updateViewportRect(this.locator.getViewportRect()),this.resizeSensorDetach=resizeSensor_1.ResizeSensor.attach(this.rootTableElement,(function(){e.state.isLayoutLocked||e.updateViewportRect(e.locator.getViewportRect())}))},o.prototype.componentWillUnmount=function(){null!=this.resizeSensorDetach&&(this.resizeSensorDetach(),delete this.resizeSensorDetach),this.didCompletelyMount=!1},o.prototype.getSnapshotBeforeUpdate=function(){var e=this.state.viewportRect;this.validateGrid();var o=this.grid.getCumulativeHeightAt(this.grid.numRows-1),t=this.grid.getCumulativeWidthAt(this.grid.numCols-1),n=o<e.top+e.height?Math.max(0,o-e.height):void 0;return{nextScrollLeft:t<e.left+e.width?Math.max(0,t-e.width):void 0,nextScrollTop:n}},o.prototype.componentDidUpdate=function(o,t,n){e.prototype.componentDidUpdate.call(this,o,t,n),this.hotkeysImpl.setState(this.state),this.hotkeysImpl.setProps(this.props),(React.Children.toArray(this.props.children)!==this.state.childrenArray||this.props.columnWidths!==t.columnWidths||this.props.rowHeights!==t.rowHeights||this.props.numRows!==o.numRows||this.props.forceRerenderOnSelectionChange&&this.props.selectedRegions!==o.selectedRegions)&&this.invalidateGrid(),null!=this.locator&&(this.validateGrid(),this.updateLocator()),(!core_1.Utils.arraysEqual(this.state.columnWidths,t.columnWidths)||!core_1.Utils.arraysEqual(this.state.rowHeights,t.rowHeights))&&(this.quadrantStackInstance.synchronizeQuadrantViews(),this.syncViewportPosition(n))},o.prototype.validateProps=function(e){var o=e.children,t=e.columnWidths,n=e.numFrozenColumns,l=e.numFrozenRows,r=e.numRows,i=e.rowHeights,s=React.Children.count(o);if(null!=r&&r<0)throw new Error(Errors.TABLE_NUM_ROWS_NEGATIVE);if(null!=l&&l<0)throw new Error(Errors.TABLE_NUM_FROZEN_ROWS_NEGATIVE);if(null!=n&&n<0)throw new Error(Errors.TABLE_NUM_FROZEN_COLUMNS_NEGATIVE);if(null!=r&&null!=i&&i.length!==r)throw new Error(Errors.TABLE_NUM_ROWS_ROW_HEIGHTS_MISMATCH);if(null!=s&&null!=t&&t.length!==s)throw new Error(Errors.TABLE_NUM_COLUMNS_COLUMN_WIDTHS_MISMATCH);React.Children.forEach(o,(function(e){if(!core_1.Utils.isElementOfType(e,column_1.Column))throw new Error(Errors.TABLE_NON_COLUMN_CHILDREN_WARNING)})),null!=l&&null!=r&&l>r&&console.warn(Errors.TABLE_NUM_FROZEN_ROWS_BOUND_WARNING),null!=n&&n>s&&console.warn(Errors.TABLE_NUM_FROZEN_COLUMNS_BOUND_WARNING)},o.prototype.gridDimensionsMatchProps=function(){var e=this.props,o=e.children,t=e.numRows;return null!=this.grid&&this.grid.numCols===React.Children.count(o)&&this.grid.numRows===t},o.prototype.maybeRenderCopyHotkey=function(){return null!=this.props.getCellClipboardData?React.createElement(core_1.Hotkey,{key:"copy-hotkey",label:"Copy selected table cells",group:"Table",combo:"mod+c",onKeyDown:this.hotkeysImpl.handleCopy}):void 0},o.prototype.maybeRenderSelectionResizeHotkeys=function(){var e=this.props,o=e.enableMultipleSelection,t=e.selectionModes.length>0;return o&&t?[React.createElement(core_1.Hotkey,{key:"resize-selection-up",label:"Resize selection upward",group:"Table",combo:"shift+up",onKeyDown:this.hotkeysImpl.handleSelectionResizeUp}),React.createElement(core_1.Hotkey,{key:"resize-selection-down",label:"Resize selection downward",group:"Table",combo:"shift+down",onKeyDown:this.hotkeysImpl.handleSelectionResizeDown}),React.createElement(core_1.Hotkey,{key:"resize-selection-left",label:"Resize selection leftward",group:"Table",combo:"shift+left",onKeyDown:this.hotkeysImpl.handleSelectionResizeLeft}),React.createElement(core_1.Hotkey,{key:"resize-selection-right",label:"Resize selection rightward",group:"Table",combo:"shift+right",onKeyDown:this.hotkeysImpl.handleSelectionResizeRight})]:void 0},o.prototype.maybeRenderFocusHotkeys=function(){return null!=this.props.enableFocusedCell?[React.createElement(core_1.Hotkey,{key:"move left",label:"Move focus cell left",group:"Table",combo:"left",onKeyDown:this.hotkeysImpl.handleFocusMoveLeft}),React.createElement(core_1.Hotkey,{key:"move right",label:"Move focus cell right",group:"Table",combo:"right",onKeyDown:this.hotkeysImpl.handleFocusMoveRight}),React.createElement(core_1.Hotkey,{key:"move up",label:"Move focus cell up",group:"Table",combo:"up",onKeyDown:this.hotkeysImpl.handleFocusMoveUp}),React.createElement(core_1.Hotkey,{key:"move down",label:"Move focus cell down",group:"Table",combo:"down",onKeyDown:this.hotkeysImpl.handleFocusMoveDown}),React.createElement(core_1.Hotkey,{key:"move tab",label:"Move focus cell tab",group:"Table",combo:"tab",onKeyDown:this.hotkeysImpl.handleFocusMoveRightInternal,allowInInput:!0}),React.createElement(core_1.Hotkey,{key:"move shift-tab",label:"Move focus cell shift tab",group:"Table",combo:"shift+tab",onKeyDown:this.hotkeysImpl.handleFocusMoveLeftInternal,allowInInput:!0}),React.createElement(core_1.Hotkey,{key:"move enter",label:"Move focus cell enter",group:"Table",combo:"enter",onKeyDown:this.hotkeysImpl.handleFocusMoveDownInternal,allowInInput:!0}),React.createElement(core_1.Hotkey,{key:"move shift-enter",label:"Move focus cell shift enter",group:"Table",combo:"shift+enter",onKeyDown:this.hotkeysImpl.handleFocusMoveUpInternal,allowInInput:!0})]:[]},o.prototype.maybeRenderSelectAllHotkey=function(){return t.isSelectionModeEnabled(this.props,regions_2.RegionCardinality.FULL_TABLE)?React.createElement(core_1.Hotkey,{key:"select-all-hotkey",label:"Select all",group:"Table",combo:"mod+a",onKeyDown:this.hotkeysImpl.handleSelectAllHotkey}):void 0},o.prototype.shouldDisableVerticalScroll=function(){var e=this.props.enableGhostCells,o=this.state.viewportRect,t=this.grid.getRowIndicesInRect(o,e),n=null!=o&&0===o.top,l=tableUtils_1.hasLoadingOption(this.props.loadingOptions,regions_2.TableLoadingOption.ROW_HEADERS);return e&&this.grid.isGhostIndex(t.rowIndexEnd-1,0)&&(n||l)},o.prototype.shouldDisableHorizontalScroll=function(){var e=this.props.enableGhostCells,o=this.state.viewportRect,t=this.grid.getColumnIndicesInRect(o,e),n=null!=o&&0===o.left,l=e&&this.grid.isGhostColumn(t.columnIndexEnd),r=tableUtils_1.hasLoadingOption(this.props.loadingOptions,regions_2.TableLoadingOption.COLUMN_HEADERS);return l&&(n||r)},o.prototype.getColumnProps=function(e){var o=this.state.childrenArray[e];return void 0===o?void 0:o.props},o.prototype.isGuidesShowing=function(){return null!=this.state.verticalGuides||null!=this.state.horizontalGuides},o.prototype.invalidateGrid=function(){this.grid=null},o.prototype.validateGrid=function(){if(null==this.grid){var e=this.props,o=e.defaultRowHeight,t=e.defaultColumnWidth,n=this.state,l=n.rowHeights,r=n.columnWidths;this.grid=new grid_1.Grid(l,r,grid_1.Grid.DEFAULT_BLEED,o,t),this.invokeOnVisibleCellsChangeCallback(this.state.viewportRect),this.hotkeysImpl.setGrid(this.grid)}},o.prototype.maybeRenderRegions=function(e,o){if(!this.isGuidesShowing()||this.state.isReordering)return regions_2.Regions.joinStyledRegionGroups(this.state.selectedRegions,this.props.styledRegionGroups,this.state.focusedCell).map((function(t,n){var l=t.regions.map((function(t){return e(t,o)}));return React.createElement(regions_1.RegionLayer,{className:classnames_1.default(t.className),key:n,regions:t.regions,regionStyles:l})}))},o.prototype.updateLocator=function(){this.locator.setGrid(this.grid).setNumFrozenRows(this.state.numFrozenRowsClamped).setNumFrozenColumns(this.state.numFrozenColumnsClamped)},o.prototype.invokeOnVisibleCellsChangeCallback=function(e){var o,t,n=this.grid.getColumnIndicesInRect(e),l=this.grid.getRowIndicesInRect(e);null===(t=(o=this.props).onVisibleCellsChange)||void 0===t||t.call(o,l,n)},o.prototype.getNormalizedRenderMode=function(){var e=this.props.renderMode;return e===renderMode_1.RenderMode.BATCH||e===renderMode_1.RenderMode.BATCH_ON_UPDATE&&this.didCompletelyMount?renderMode_1.RenderMode.BATCH:renderMode_1.RenderMode.NONE},o.displayName=core_1.DISPLAYNAME_PREFIX+".Table",o.defaultProps={defaultColumnWidth:150,defaultRowHeight:20,enableFocusedCell:!1,enableGhostCells:!1,enableMultipleSelection:!0,enableRowHeader:!0,forceRerenderOnSelectionChange:!1,loadingOptions:[],minColumnWidth:50,minRowHeight:20,numFrozenColumns:0,numFrozenRows:0,numRows:0,renderMode:renderMode_1.RenderMode.BATCH_ON_UPDATE,rowHeaderCellRenderer:rowHeader_1.renderDefaultRowHeader,selectionModes:regions_2.SelectionModes.ALL},o.childContextTypes=context_1.columnInteractionBarContextTypes,o.SHALLOW_COMPARE_PROP_KEYS_DENYLIST=["selectedRegions"],o.SHALLOW_COMPARE_STATE_KEYS_DENYLIST=["selectedRegions","viewportRect"],t=tslib_1.__decorate([core_1.HotkeysTarget,react_lifecycles_compat_1.polyfill],o)}(core_1.AbstractComponent2);exports.Table=Table;