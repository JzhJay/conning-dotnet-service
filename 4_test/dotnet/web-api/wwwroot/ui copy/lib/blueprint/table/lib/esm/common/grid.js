import{__assign}from"tslib";import{RegionCardinality,Regions}from"../regions";import*as Classes from"./classes";import{Rect}from"./rect";import{Utils}from"./utils";var Grid=function(){function t(e,i,n,s,o){var h=this;void 0===n&&(n=t.DEFAULT_BLEED),void 0===s&&(s=t.DEFAULT_GHOST_HEIGHT),void 0===o&&(o=t.DEFAULT_GHOST_WIDTH),this.getCumulativeWidthBefore=function(t){return 0===t?0:h.getCumulativeWidthAt(t-1)},this.getCumulativeWidthAt=function(t){return 0===h.numCols?h.ghostWidth*t:t>=h.numCols?h.cumulativeColumnWidths[h.numCols-1]+h.ghostWidth*(t-h.numCols+1):h.cumulativeColumnWidths[t]},this.getCumulativeHeightBefore=function(t){return 0===t?0:h.getCumulativeHeightAt(t-1)},this.getCumulativeHeightAt=function(t){return 0===h.numRows?h.ghostHeight*t:t>=h.numRows?h.cumulativeRowHeights[h.numRows-1]+h.ghostHeight*(t-h.numRows+1):h.cumulativeRowHeights[t]},this.columnWidths=i,this.rowHeights=e,this.cumulativeColumnWidths=Utils.accumulate(i),this.cumulativeRowHeights=Utils.accumulate(e),this.numCols=i.length,this.numRows=e.length,this.bleed=n,this.ghostHeight=s,this.ghostWidth=o}return t.prototype.getCellRect=function(t,e){var i=this.rowHeights[t],n=this.cumulativeRowHeights[t]-i,s=this.columnWidths[e],o=this.cumulativeColumnWidths[e]-s;return new Rect(o,n,s,i)},t.prototype.getGhostCellRect=function(t,e){var i=0,n=0,s=0,o=0;return t>=this.rowHeights.length?(o=this.ghostHeight,n=this.getHeight()+this.ghostHeight*(t-this.numRows)):(o=this.rowHeights[t],n=this.cumulativeRowHeights[t]-o),e>=this.columnWidths.length?(s=this.ghostWidth,i=this.getWidth()+this.ghostWidth*(e-this.numCols)):(s=this.columnWidths[e],i=this.cumulativeColumnWidths[e]-s),new Rect(i,n,s,o)},t.prototype.getRowRect=function(t){var e=this.rowHeights[t],i=this.cumulativeRowHeights[t]-e;return new Rect(0,i,this.getWidth(),e)},t.prototype.getColumnRect=function(t){var e=this.columnWidths[t],i=this.cumulativeColumnWidths[t]-e;return new Rect(i,0,e,this.getHeight())},t.prototype.getWidth=function(){return 0===this.numCols?0:this.cumulativeColumnWidths[this.numCols-1]},t.prototype.getHeight=function(){return 0===this.numRows?0:this.cumulativeRowHeights[this.numRows-1]},t.prototype.getRect=function(){return new Rect(0,0,this.getWidth(),this.getHeight())},t.prototype.mapCellsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getRowIndicesInRect(t),s=n.rowIndexStart,o=n.rowIndexEnd,h=this.getColumnIndicesInRect(t),u=h.columnIndexStart,r=h.columnIndexEnd,l=s;l<=o;l++)for(var a=u;a<=r;a++)i.push(e(l,a));return i},t.prototype.mapRowsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getRowIndicesInRect(t),s=n.rowIndexStart,o=n.rowIndexEnd,h=s;h<=o;h++)i.push(e(h));return i},t.prototype.mapColumnsInRect=function(t,e){var i=[];if(null==t)return i;for(var n=this.getColumnIndicesInRect(t),s=n.columnIndexStart,o=n.columnIndexEnd,h=s;h<=o;h++)i.push(e(h));return i},t.prototype.getRowIndicesInRect=function(e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=t.DEFAULT_MAX_ROWS),null==e)return{rowIndexEnd:0,rowIndexStart:0};var s=i?Math.max(this.numRows,t.DEFAULT_MAX_ROWS):this.numRows,o=e.top,h=void 0===o?0:o,u=e.height,r=this.getIndicesInInterval(h,h+u,s,!i,this.getCumulativeHeightAt),l=r.start,a=r.end;return{rowIndexEnd:n>0&&a-l>n?l+n:a,rowIndexStart:l}},t.prototype.getColumnIndicesInRect=function(e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=t.DEFAULT_MAX_COLUMNS),null==e)return{columnIndexEnd:0,columnIndexStart:0};var s=i?Math.max(this.numCols,t.DEFAULT_MAX_COLUMNS):this.numCols,o=e.left,h=void 0===o?0:o,u=e.width,r=this.getIndicesInInterval(h,h+u,s,!i,this.getCumulativeWidthAt),l=r.start,a=r.end;return{columnIndexEnd:n>0&&a-l>n?l+n:a,columnIndexStart:l}},t.prototype.isGhostIndex=function(t,e){return t>=this.numRows||e>=this.numCols},t.prototype.isGhostColumn=function(t){return t>=this.numCols},t.prototype.getExtremaClasses=function(t,e,i,n){return t===i&&e===n?[Classes.TABLE_LAST_IN_COLUMN,Classes.TABLE_LAST_IN_ROW]:t===i?[Classes.TABLE_LAST_IN_COLUMN]:e===n?[Classes.TABLE_LAST_IN_ROW]:[]},t.prototype.getRegionStyle=function(t){switch(Regions.getRegionCardinality(t)){case RegionCardinality.CELLS:var e=t.rows,i=e[0],n=e[1],s=t.cols,o=s[0],h=s[1];if(this.isGhostIndex(i,o)||this.isGhostIndex(n,h))return{display:"none"};var u=this.getCellRect(i,o),r=this.getCellRect(n,h),l=0===o?0:1,a=0===i?0:1;return(d=u.union(r)).height+=a,d.left-=l,d.width+=l,d.top-=a,__assign(__assign({},d.style()),{display:"block"});case RegionCardinality.FULL_COLUMNS:var c=t.cols;return o=c[0],h=c[1],this.isGhostIndex(0,o)||this.isGhostIndex(0,h)?{display:"none"}:(u=this.getCellRect(0,o),r=this.getCellRect(0,h),l=0===o?0:1,{bottom:0,display:"block",left:(d=u.union(r)).left-l,top:0,width:d.width+l});case RegionCardinality.FULL_ROWS:var d,g=t.rows;return i=g[0],n=g[1],this.isGhostIndex(i,0)||this.isGhostIndex(n,0)?{display:"none"}:(u=this.getCellRect(i,0),r=this.getCellRect(n,0),a=0===i?0:1,{display:"block",height:(d=u.union(r)).height+a,left:0,right:0,top:d.top-a});case RegionCardinality.FULL_TABLE:return{bottom:0,display:"block",left:0,right:0,top:0};default:return{display:"none"}}},t.prototype.getIndicesInInterval=function(t,e,i,n,s){var o=Utils.binarySearch(t,i-1,s),h=Utils.binarySearch(e,i-1,s);return o>=0&&t===s(o)&&(o+=1),{start:o=Math.max(0,o-this.bleed),end:h=n?Math.min(i-1,h+this.bleed):Math.min(i-1,h)}},t.DEFAULT_BLEED=3,t.DEFAULT_MAX_COLUMNS=50,t.DEFAULT_MAX_ROWS=200,t.DEFAULT_GHOST_HEIGHT=20,t.DEFAULT_GHOST_WIDTH=150,t}();export{Grid};