import{__assign,__decorate,__extends,__rest}from"tslib";import classNames from"classnames";import*as React from"react";import*as ReactDOM from"react-dom";import{polyfill}from"react-lifecycles-compat";import{AbstractPureComponent2,Classes,Position}from"../../common";import{Popover}from"../popover/popover";var contextMenuElement,contextMenu,POPPER_MODIFIERS={preventOverflow:{boundariesElement:"viewport"}},TRANSITION_DURATION=100,ContextMenu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDarkTheme:!1,isOpen:!1},t.cancelContextMenu=function(e){return e.preventDefault()},t.handleBackdropContextMenu=function(e){e.persist(),e.preventDefault(),t.setTimeout((function(){var t=document.elementFromPoint(e.clientX,e.clientY),n=(e.view,__rest(e,["view"]));null==t||t.dispatchEvent(new MouseEvent("contextmenu",n))}),TRANSITION_DURATION)},t.handlePopoverInteraction=function(e){e||t.requestAnimationFrame((function(){return t.hide()}))},t}return __extends(t,e),t.prototype.render=function(){var e,t=React.createElement("div",{onContextMenu:this.cancelContextMenu},this.state.menu),n=classNames(((e={})[Classes.DARK]=this.state.isDarkTheme,e)),o=void 0===this.state.offset?"":this.state.offset.left+"x"+this.state.offset.top;return React.createElement("div",{className:Classes.CONTEXT_MENU_POPOVER_TARGET,style:this.state.offset},React.createElement(Popover,__assign({},this.props,{backdropProps:{onContextMenu:this.handleBackdropContextMenu},content:t,enforceFocus:!1,key:o,hasBackdrop:!0,isOpen:this.state.isOpen,minimal:!0,modifiers:POPPER_MODIFIERS,onInteraction:this.handlePopoverInteraction,position:Position.RIGHT_TOP,popoverClassName:n,target:React.createElement("div",null),transitionDuration:TRANSITION_DURATION})))},t.prototype.show=function(e,t,n,o){void 0===o&&(o=!1),this.setState({isOpen:!0,menu:e,offset:t,onClose:n,isDarkTheme:o})},t.prototype.hide=function(){var e,t;null===(t=(e=this.state).onClose)||void 0===t||t.call(e),this.setState({isOpen:!1,onClose:void 0})},__decorate([polyfill],t)}(AbstractPureComponent2);export function show(e,t,n,o){void 0===contextMenuElement&&((contextMenuElement=document.createElement("div")).classList.add(Classes.CONTEXT_MENU),document.body.appendChild(contextMenuElement),contextMenu=ReactDOM.render(React.createElement(ContextMenu,{onClosed:remove}),contextMenuElement)),contextMenu.show(e,t,n,o)}export function hide(){null==contextMenu||contextMenu.hide()}export function isOpen(){return null!=contextMenu&&contextMenu.state.isOpen}function remove(){null!=contextMenuElement&&(ReactDOM.unmountComponentAtNode(contextMenuElement),contextMenuElement.remove(),contextMenuElement=void 0,contextMenu=void 0)}