import{__assign,__decorate,__extends,__rest}from"tslib";import classNames from"classnames";import*as React from"react";import{polyfill}from"react-lifecycles-compat";import{AbstractPureComponent2,Classes,Utils}from"../../common";import{DISPLAYNAME_PREFIX}from"../../common/props";import{Button}from"../button/buttons";import{Dialog}from"./dialog";import{DialogStep}from"./dialogStep";var PADDING_BOTTOM=0,MIN_WIDTH=800,MultistepDialog=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getInitialIndexFromProps(t.props),t.renderDialogStep=function(e,s){var n,o=s+1,a=t.state.lastViewedIndex>=s,i=t.state.selectedIndex===s;return React.createElement("div",{className:classNames(Classes.DIALOG_STEP_CONTAINER,(n={},n[Classes.ACTIVE]=i,n[Classes.DIALOG_STEP_VIEWED]=a,n)),key:s},React.createElement("div",{className:Classes.DIALOG_STEP,onClick:t.handleClickDialogStep(s)},React.createElement("div",{className:Classes.DIALOG_STEP_ICON},o),React.createElement("div",{className:Classes.DIALOG_STEP_TITLE},e.props.title)))},t.handleClickDialogStep=function(e){if(!(e>t.state.lastViewedIndex))return t.getDialogStepChangeHandler(e)},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=e.showCloseButtonInFooter,s=e.isCloseButtonShown,n=__rest(e,["showCloseButtonInFooter","isCloseButtonShown"]),o=!t&&s;return React.createElement(Dialog,__assign({isCloseButtonShown:o},n,{style:this.getDialogStyle()}),React.createElement("div",{className:Classes.MULTISTEP_DIALOG_PANELS},this.renderLeftPanel(),this.maybeRenderRightPanel()))},t.prototype.componentDidUpdate=function(e){!e.resetOnClose&&e.initialStepIndex===this.props.initialStepIndex||e.isOpen||!this.props.isOpen||this.setState(this.getInitialIndexFromProps(this.props))},t.prototype.getDialogStyle=function(){return __assign({minWidth:MIN_WIDTH,paddingBottom:PADDING_BOTTOM},this.props.style)},t.prototype.renderLeftPanel=function(){return React.createElement("div",{className:Classes.MULTISTEP_DIALOG_LEFT_PANEL},this.getDialogStepChildren().filter(isDialogStepElement).map(this.renderDialogStep))},t.prototype.maybeRenderRightPanel=function(){var e=this.getDialogStepChildren();if(e.length<=this.state.selectedIndex)return null;var t=e[this.state.selectedIndex].props,s=t.className,n=t.panel,o=t.panelClassName;return React.createElement("div",{className:classNames(Classes.MULTISTEP_DIALOG_RIGHT_PANEL,s,o)},n,this.renderFooter())},t.prototype.renderFooter=function(){var e=this.props,t=e.closeButtonProps,s=e.isCloseButtonShown,n=e.showCloseButtonInFooter,o=e.onClose,a=n&&s?React.createElement(Button,__assign({text:"Close",onClick:o},t)):void 0;return React.createElement("div",{className:Classes.MULTISTEP_DIALOG_FOOTER},a,React.createElement("div",{className:Classes.DIALOG_FOOTER_ACTIONS},this.renderButtons()))},t.prototype.renderButtons=function(){var e,t,s=this.state.selectedIndex,n=this.getDialogStepChildren(),o=[];if(this.state.selectedIndex>0){var a=null!==(e=n[s].props.backButtonProps)&&void 0!==e?e:this.props.backButtonProps;o.push(React.createElement(Button,__assign({key:"back",onClick:this.getDialogStepChangeHandler(s-1),text:"Back"},a)))}if(s===this.getDialogStepChildren().length-1)o.push(React.createElement(Button,__assign({intent:"primary",key:"final",text:"Submit"},this.props.finalButtonProps)));else{var i=null!==(t=n[s].props.nextButtonProps)&&void 0!==t?t:this.props.nextButtonProps;o.push(React.createElement(Button,__assign({intent:"primary",key:"next",onClick:this.getDialogStepChangeHandler(s+1),text:"Next"},i)))}return o},t.prototype.getDialogStepChangeHandler=function(e){var t=this;return function(s){if(void 0!==t.props.onChange){var n=t.getDialogStepChildren(),o=n[t.state.selectedIndex].props.id,a=n[e].props.id;t.props.onChange(a,o,s)}t.setState({lastViewedIndex:Math.max(t.state.lastViewedIndex,e),selectedIndex:e})}},t.prototype.getDialogStepChildren=function(e){return void 0===e&&(e=this.props),React.Children.toArray(e.children).filter(isDialogStepElement)},t.prototype.getInitialIndexFromProps=function(e){if(void 0!==e.initialStepIndex){var t=Math.max(0,Math.min(e.initialStepIndex,this.getDialogStepChildren(e).length-1));return{lastViewedIndex:t,selectedIndex:t}}return{lastViewedIndex:0,selectedIndex:0}},t.displayName=DISPLAYNAME_PREFIX+".MultistepDialog",t.defaultProps={canOutsideClickClose:!0,isOpen:!1,resetOnClose:!0,showCloseButtonInFooter:!1},__decorate([polyfill],t)}(AbstractPureComponent2);export{MultistepDialog};function isDialogStepElement(e){return Utils.isElementOfType(e,DialogStep)}