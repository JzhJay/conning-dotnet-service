import{__extends,__spreadArrays}from"tslib";import classNames from"classnames";import*as React from"react";import{Boundary}from"../../common/boundary";import*as Classes from"../../common/classes";import{OVERFLOW_LIST_OBSERVE_PARENTS_CHANGED}from"../../common/errors";import{DISPLAYNAME_PREFIX}from"../../common/props";import{shallowCompareKeys}from"../../common/utils";import{ResizeSensor}from"../resize-sensor/resizeSensor";export var OverflowDirection;!function(e){e[e.NONE=0]="NONE",e[e.GROW=1]="GROW",e[e.SHRINK=2]="SHRINK"}(OverflowDirection||(OverflowDirection={}));var OverflowList=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.state={direction:OverflowDirection.NONE,lastOverflowCount:0,overflow:[],visible:r.props.items},r.previousWidths=new Map,r.spacer=null,r.resize=function(e){var t=e.some((function(e){var t=r.previousWidths.get(e.target)||0;return e.contentRect.width>t}));r.repartition(t),e.forEach((function(e){return r.previousWidths.set(e.target,e.contentRect.width)}))},r}return __extends(r,e),r.ofType=function(){return r},r.prototype.componentDidMount=function(){this.repartition(!1)},r.prototype.shouldComponentUpdate=function(e,r){return!(this.state!==r&&shallowCompareKeys(this.state,r))},r.prototype.componentDidUpdate=function(e,r){var t,o;e.observeParents!==this.props.observeParents&&console.warn(OVERFLOW_LIST_OBSERVE_PARENTS_CHANGED),e.collapseFrom===this.props.collapseFrom&&e.items===this.props.items&&e.minVisibleItems===this.props.minVisibleItems&&e.overflowRenderer===this.props.overflowRenderer&&e.alwaysRenderOverflow===this.props.alwaysRenderOverflow&&e.visibleItemRenderer===this.props.visibleItemRenderer||this.setState({direction:OverflowDirection.GROW,lastOverflowCount:0,overflow:[],visible:this.props.items}),shallowCompareKeys(r,this.state)||this.repartition(!1);var s=this.state,i=s.direction,n=s.overflow,l=s.lastOverflowCount;i===OverflowDirection.NONE&&i!==r.direction&&n.length!==l&&(null===(o=(t=this.props).onOverflow)||void 0===o||o.call(t,n))},r.prototype.render=function(){var e=this,r=this.props,t=r.className,o=r.collapseFrom,s=r.observeParents,i=r.style,n=r.tagName,l=void 0===n?"div":n,a=r.visibleItemRenderer,p=this.maybeRenderOverflow(),c=React.createElement(l,{className:classNames(Classes.OVERFLOW_LIST,t),style:i},o===Boundary.START?p:null,this.state.visible.map(a),o===Boundary.END?p:null,React.createElement("div",{className:Classes.OVERFLOW_LIST_SPACER,ref:function(r){return e.spacer=r}}));return React.createElement(ResizeSensor,{onResize:this.resize,observeParents:s},c)},r.prototype.maybeRenderOverflow=function(){var e=this.state.overflow;return 0!==e.length||this.props.alwaysRenderOverflow?this.props.overflowRenderer(e):null},r.prototype.repartition=function(e){var r=this;null!=this.spacer&&(e?this.setState((function(e){return{direction:OverflowDirection.GROW,lastOverflowCount:e.direction===OverflowDirection.NONE?e.overflow.length:e.lastOverflowCount,overflow:[],visible:r.props.items}})):this.spacer.getBoundingClientRect().width<.9?this.setState((function(e){if(e.visible.length<=r.props.minVisibleItems)return null;var t=r.props.collapseFrom===Boundary.START,o=e.visible.slice(),s=t?o.shift():o.pop();if(void 0===s)return null;var i=t?__spreadArrays(e.overflow,[s]):__spreadArrays([s],e.overflow);return{direction:e.direction===OverflowDirection.NONE?OverflowDirection.SHRINK:e.direction,overflow:i,visible:o}})):this.setState({direction:OverflowDirection.NONE}))},r.displayName=DISPLAYNAME_PREFIX+".OverflowList",r.defaultProps={alwaysRenderOverflow:!1,collapseFrom:Boundary.START,minVisibleItems:0},r}(React.Component);export{OverflowList};