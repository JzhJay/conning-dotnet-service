import{Children}from"react";import{isElementOfType}from"../../common/utils";import{Hotkey}from"./hotkey";import{comboMatches,getKeyCombo,parseKeyCombo}from"./hotkeyParser";import{hideHotkeysDialogAfterDelay,isHotkeysDialogShowing,showHotkeysDialog}from"./hotkeysDialog";var SHOW_DIALOG_KEY="?";export var HotkeyScope;!function(o){o.LOCAL="local",o.GLOBAL="global"}(HotkeyScope||(HotkeyScope={}));var HotkeysEvents=function(){function o(o){var t=this;this.scope=o,this.actions=[],this.handleKeyDown=function(o){var e=getKeyCombo(o);t.isTextInput(o)||!comboMatches(parseKeyCombo(SHOW_DIALOG_KEY),e)?isHotkeysDialogShowing()||t.invokeNamedCallbackIfComboRecognized(e,"onKeyDown",o):isHotkeysDialogShowing()?hideHotkeysDialogAfterDelay():showHotkeysDialog(t.actions.map((function(o){return o.props})))},this.handleKeyUp=function(o){isHotkeysDialogShowing()||t.invokeNamedCallbackIfComboRecognized(getKeyCombo(o),"onKeyUp",o)}}return o.prototype.count=function(){return this.actions.length},o.prototype.clear=function(){this.actions=[]},o.prototype.setHotkeys=function(o){var t=this,e=[];Children.forEach(o.children,(function(o){isElementOfType(o,Hotkey)&&t.isScope(o.props)&&e.push({combo:parseKeyCombo(o.props.combo),props:o.props})})),this.actions=e},o.prototype.invokeNamedCallbackIfComboRecognized=function(o,t,e){for(var i,n,r=this.isTextInput(e),s=0,a=this.actions;s<a.length;s++){var p=a[s];!(r&&!p.props.allowInInput||p.props.disabled)&&comboMatches(p.combo,o)&&(p.props.preventDefault&&e.preventDefault(),p.props.stopPropagation&&(e.isPropagationStopped=!0,e.stopPropagation()),null===(n=(i=p.props)[t])||void 0===n||n.call(i,e))}},o.prototype.isScope=function(o){return(o.global?HotkeyScope.GLOBAL:HotkeyScope.LOCAL)===this.scope},o.prototype.isTextInput=function(o){var t=o.target;if(null==t||null==t.closest)return!1;var e=t.closest("input, textarea, [contenteditable=true]");if(null==e)return!1;if("input"===e.tagName.toLowerCase()){var i=e.type;if("checkbox"===i||"radio"===i)return!1}return!e.readOnly},o}();export{HotkeysEvents};