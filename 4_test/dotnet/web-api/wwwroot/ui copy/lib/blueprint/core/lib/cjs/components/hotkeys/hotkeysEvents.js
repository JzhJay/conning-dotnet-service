"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HotkeysEvents=exports.HotkeyScope=void 0;var HotkeyScope,react_1=require("react"),utils_1=require("../../common/utils"),hotkey_1=require("./hotkey"),hotkeyParser_1=require("./hotkeyParser"),hotkeysDialog_1=require("./hotkeysDialog"),SHOW_DIALOG_KEY="?";!function(o){o.LOCAL="local",o.GLOBAL="global"}(HotkeyScope=exports.HotkeyScope||(exports.HotkeyScope={}));var HotkeysEvents=function(){function o(o){var e=this;this.scope=o,this.actions=[],this.handleKeyDown=function(o){var t=hotkeyParser_1.getKeyCombo(o);e.isTextInput(o)||!hotkeyParser_1.comboMatches(hotkeyParser_1.parseKeyCombo(SHOW_DIALOG_KEY),t)?hotkeysDialog_1.isHotkeysDialogShowing()||e.invokeNamedCallbackIfComboRecognized(t,"onKeyDown",o):hotkeysDialog_1.isHotkeysDialogShowing()?hotkeysDialog_1.hideHotkeysDialogAfterDelay():hotkeysDialog_1.showHotkeysDialog(e.actions.map((function(o){return o.props})))},this.handleKeyUp=function(o){hotkeysDialog_1.isHotkeysDialogShowing()||e.invokeNamedCallbackIfComboRecognized(hotkeyParser_1.getKeyCombo(o),"onKeyUp",o)}}return o.prototype.count=function(){return this.actions.length},o.prototype.clear=function(){this.actions=[]},o.prototype.setHotkeys=function(o){var e=this,t=[];react_1.Children.forEach(o.children,(function(o){utils_1.isElementOfType(o,hotkey_1.Hotkey)&&e.isScope(o.props)&&t.push({combo:hotkeyParser_1.parseKeyCombo(o.props.combo),props:o.props})})),this.actions=t},o.prototype.invokeNamedCallbackIfComboRecognized=function(o,e,t){for(var r,s,i=this.isTextInput(t),n=0,a=this.actions;n<a.length;n++){var p=a[n];!(i&&!p.props.allowInInput||p.props.disabled)&&hotkeyParser_1.comboMatches(p.combo,o)&&(p.props.preventDefault&&t.preventDefault(),p.props.stopPropagation&&(t.isPropagationStopped=!0,t.stopPropagation()),null===(s=(r=p.props)[e])||void 0===s||s.call(r,t))}},o.prototype.isScope=function(o){return(o.global?HotkeyScope.GLOBAL:HotkeyScope.LOCAL)===this.scope},o.prototype.isTextInput=function(o){var e=o.target;if(null==e||null==e.closest)return!1;var t=e.closest("input, textarea, [contenteditable=true]");if(null==t)return!1;if("input"===t.tagName.toLowerCase()){var r=t.type;if("checkbox"===r||"radio"===r)return!1}return!t.readOnly},o}();exports.HotkeysEvents=HotkeysEvents;