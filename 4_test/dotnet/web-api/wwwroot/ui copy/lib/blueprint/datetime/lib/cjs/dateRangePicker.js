"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DateRangePicker=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),react_day_picker_1=tslib_1.__importDefault(require("react-day-picker")),react_lifecycles_compat_1=require("react-lifecycles-compat"),core_1=require("@blueprintjs/core"),DateClasses=tslib_1.__importStar(require("./common/classes")),DateUtils=tslib_1.__importStar(require("./common/dateUtils")),Errors=tslib_1.__importStar(require("./common/errors")),monthAndYear_1=require("./common/monthAndYear"),datePickerCaption_1=require("./datePickerCaption"),datePickerCore_1=require("./datePickerCore"),datePickerNavbar_1=require("./datePickerNavbar"),dateRangeSelectionStrategy_1=require("./dateRangeSelectionStrategy"),shortcuts_1=require("./shortcuts"),timePicker_1=require("./timePicker"),DateRangePicker=function(e){function t(t,a){var n,r=e.call(this,t,a)||this;r.modifiers=((n={})[datePickerCore_1.SELECTED_RANGE_MODIFIER]=function(e){var t=r.state.value;return null!=t[0]&&null!=t[1]&&DateUtils.isDayInRange(e,t,!0)},n[datePickerCore_1.SELECTED_RANGE_MODIFIER+"-start"]=function(e){return DateUtils.areSameDay(r.state.value[0],e)},n[datePickerCore_1.SELECTED_RANGE_MODIFIER+"-end"]=function(e){return DateUtils.areSameDay(r.state.value[1],e)},n[datePickerCore_1.HOVERED_RANGE_MODIFIER]=function(e){var t=r.state,a=t.hoverValue,n=t.value,i=n[0],o=n[1];return(null!=i||null!=o)&&null!=a&&null!=a[0]&&null!=a[1]&&DateUtils.isDayInRange(e,a,!0)},n[datePickerCore_1.HOVERED_RANGE_MODIFIER+"-start"]=function(e){var t=r.state.hoverValue;return null!=t&&null!=t[0]&&DateUtils.areSameDay(t[0],e)},n[datePickerCore_1.HOVERED_RANGE_MODIFIER+"-end"]=function(e){var t=r.state.hoverValue;return null!=t&&null!=t[1]&&DateUtils.areSameDay(t[1],e)},n),r.shouldHighlightCurrentDay=function(e){return r.props.highlightCurrentDay&&DateUtils.isToday(e)},r.getDateRangePickerModifiers=function(){var e=r.props.modifiers;return datePickerCore_1.combineModifiers(r.modifiers,tslib_1.__assign({isToday:r.shouldHighlightCurrentDay},e))},r.renderDay=function(e){var t=e.getDate();return React.createElement("div",{className:DateClasses.DATEPICKER_DAY_WRAPPER},t)},r.disabledDays=function(e){return!DateUtils.isDayInRange(e,[r.props.minDate,r.props.maxDate])},r.getDisabledDaysModifier=function(){var e=r.props.dayPickerProps.disabledDays;return e instanceof Array?tslib_1.__spreadArrays([r.disabledDays],e):[r.disabledDays,e]},r.handleTimeChange=function(e,t){var a,n,i,o;null===(n=null===(a=r.props.timePickerProps)||void 0===a?void 0:a.onChange)||void 0===n||n.call(a,e);var l=r.state,s=l.value,h=l.time,u=DateUtils.getDateTime(null!=s[t]?DateUtils.clone(s[t]):new Date,e),c=[s[0],s[1]];c[t]=u;var d=[h[0],h[1]];d[t]=e,null===(o=(i=r.props).onChange)||void 0===o||o.call(i,c),r.setState({value:c,time:d})},r.handleTimeChangeLeftCalendar=function(e){r.handleTimeChange(e,0)},r.handleTimeChangeRightCalendar=function(e){r.handleTimeChange(e,1)},r.renderSingleNavbar=function(e){return React.createElement(datePickerNavbar_1.DatePickerNavbar,tslib_1.__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate}))},r.renderLeftNavbar=function(e){return React.createElement(datePickerNavbar_1.DatePickerNavbar,tslib_1.__assign({},e,{hideRightNavButton:r.props.contiguousCalendarMonths,maxDate:r.props.maxDate,minDate:r.props.minDate}))},r.renderRightNavbar=function(e){return React.createElement(datePickerNavbar_1.DatePickerNavbar,tslib_1.__assign({},e,{hideLeftNavButton:r.props.contiguousCalendarMonths,maxDate:r.props.maxDate,minDate:r.props.minDate}))},r.renderSingleCaption=function(e){return React.createElement(datePickerCaption_1.DatePickerCaption,tslib_1.__assign({},e,{maxDate:r.props.maxDate,minDate:r.props.minDate,onMonthChange:r.handleLeftMonthSelectChange,onYearChange:r.handleLeftYearSelectChange,reverseMonthAndYearMenus:r.props.reverseMonthAndYearMenus}))},r.renderLeftCaption=function(e){return React.createElement(datePickerCaption_1.DatePickerCaption,tslib_1.__assign({},e,{maxDate:DateUtils.getDatePreviousMonth(r.props.maxDate),minDate:r.props.minDate,onMonthChange:r.handleLeftMonthSelectChange,onYearChange:r.handleLeftYearSelectChange,reverseMonthAndYearMenus:r.props.reverseMonthAndYearMenus}))},r.renderRightCaption=function(e){return React.createElement(datePickerCaption_1.DatePickerCaption,tslib_1.__assign({},e,{maxDate:r.props.maxDate,minDate:DateUtils.getDateNextMonth(r.props.minDate),onMonthChange:r.handleRightMonthSelectChange,onYearChange:r.handleRightYearSelectChange,reverseMonthAndYearMenus:r.props.reverseMonthAndYearMenus}))},r.handleDayMouseEnter=function(e,t,a){var n,i,o,l;if(null===(i=(n=r.props.dayPickerProps).onDayMouseEnter)||void 0===i||i.call(n,e,t,a),!t.disabled){var s=dateRangeSelectionStrategy_1.DateRangeSelectionStrategy.getNextState(r.state.value,e,r.props.allowSingleDayRange,r.props.boundaryToModify),h=s.dateRange,u=s.boundary;r.setState({hoverValue:h}),null===(l=(o=r.props).onHoverChange)||void 0===l||l.call(o,h,e,u)}},r.handleDayMouseLeave=function(e,t,a){var n,i,o,l;null===(i=(n=r.props.dayPickerProps).onDayMouseLeave)||void 0===i||i.call(n,e,t,a),t.disabled||(r.setState({hoverValue:void 0}),null===(l=(o=r.props).onHoverChange)||void 0===l||l.call(o,void 0,e,void 0))},r.handleDayClick=function(e,t,a){var n,i;if(null===(i=(n=r.props.dayPickerProps).onDayClick)||void 0===i||i.call(n,e,t,a),t.disabled)r.forceUpdate();else{var o=dateRangeSelectionStrategy_1.DateRangeSelectionStrategy.getNextState(r.state.value,e,r.props.allowSingleDayRange,r.props.boundaryToModify).dateRange;r.handleDayMouseEnter(e,t,a),r.handleNextState(o)}},r.handleShortcutClick=function(e,t){var a=r.props,n=a.onChange,i=a.contiguousCalendarMonths,o=a.onShortcutChange,l=e.dateRange;if(e.includeTime){var s=[l[0],l[1]],h=[l[0],l[1]],u=getStateChange(r.state.value,l,r.state,i);r.setState(tslib_1.__assign(tslib_1.__assign({},u),{time:h})),null==n||n(s)}else r.handleNextState(l);void 0===r.props.selectedShortcutIndex&&r.setState({selectedShortcutIndex:t}),null==o||o(e,t)},r.handleNextState=function(e){var t,a,n=r.state.value;e[0]=DateUtils.getDateTime(e[0],r.state.time[0]),e[1]=DateUtils.getDateTime(e[1],r.state.time[1]);var i=getStateChange(n,e,r.state,r.props.contiguousCalendarMonths);null==r.props.value&&r.setState(i),null===(a=(t=r.props).onChange)||void 0===a||a.call(t,e)},r.handleLeftMonthChange=function(e){var t,a,n=monthAndYear_1.MonthAndYear.fromDate(e);null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate()),r.updateLeftView(n)},r.handleRightMonthChange=function(e){var t,a,n=monthAndYear_1.MonthAndYear.fromDate(e);null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate()),r.updateRightView(n)},r.handleLeftMonthSelectChange=function(e){var t,a,n=new monthAndYear_1.MonthAndYear(e,r.state.leftView.getYear());null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate()),r.updateLeftView(n)},r.handleRightMonthSelectChange=function(e){var t,a,n=new monthAndYear_1.MonthAndYear(e,r.state.rightView.getYear());null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate()),r.updateRightView(n)},r.handleLeftYearSelectChange=function(e){var t,a,n=new monthAndYear_1.MonthAndYear(r.state.leftView.getMonth(),e);null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate());var i=r.props,o=i.minDate,l=i.maxDate,s=DateUtils.getDatePreviousMonth(l),h=new monthAndYear_1.MonthAndYear(o.getMonth(),o.getFullYear()),u=new monthAndYear_1.MonthAndYear(s.getMonth(),s.getFullYear());n.isBefore(h)?n=h:n.isAfter(u)&&(n=u);var c=r.state.rightView.clone();n.isBefore(c)&&!r.props.contiguousCalendarMonths||(c=n.getNextMonth()),r.setViews(n,c)},r.handleRightYearSelectChange=function(e){var t,a,n=new monthAndYear_1.MonthAndYear(r.state.rightView.getMonth(),e);null===(a=(t=r.props.dayPickerProps).onMonthChange)||void 0===a||a.call(t,n.getFullDate());var i=r.props,o=i.minDate,l=i.maxDate,s=DateUtils.getDateNextMonth(o),h=monthAndYear_1.MonthAndYear.fromDate(s),u=monthAndYear_1.MonthAndYear.fromDate(l);n.isBefore(h)?n=h:n.isAfter(u)&&(n=u);var c=r.state.leftView.clone();n.isAfter(c)&&!r.props.contiguousCalendarMonths||(c=n.getPreviousMonth()),r.setViews(c,n)};var i=getInitialValue(t),o=i,l=getInitialMonth(t,i),s=DateUtils.areSameMonth(l,t.minDate),h=DateUtils.areSameMonth(l,t.maxDate);t.singleMonthOnly||s||!h||l.setMonth(l.getMonth()-1);var u=monthAndYear_1.MonthAndYear.fromDate(l),c=i[1],d=t.contiguousCalendarMonths||null==c||DateUtils.areSameMonth(l,c)?u.getNextMonth():monthAndYear_1.MonthAndYear.fromDate(c);return r.state={hoverValue:[null,null],leftView:u,rightView:d,selectedShortcutIndex:void 0!==r.props.selectedShortcutIndex?r.props.selectedShortcutIndex:-1,time:o,value:i},r}var a;return tslib_1.__extends(t,e),a=t,t.prototype.render=function(){var e,t=this.props,a=t.className,n=t.contiguousCalendarMonths,r=t.singleMonthOnly||DateUtils.areSameMonth(this.props.minDate,this.props.maxDate),i=classnames_1.default(DateClasses.DATEPICKER,DateClasses.DATERANGEPICKER,a,((e={})[DateClasses.DATERANGEPICKER_CONTIGUOUS]=n,e[DateClasses.DATERANGEPICKER_SINGLE_MONTH]=r,e));return React.createElement("div",{className:i},this.maybeRenderShortcuts(),React.createElement("div",null,this.renderCalendars(r),this.maybeRenderTimePickers()))},t.prototype.componentDidUpdate=function(t,a){if(e.prototype.componentDidUpdate.call(this,t,a),!DateUtils.areRangesEqual(t.value,this.props.value)||t.contiguousCalendarMonths!==this.props.contiguousCalendarMonths){var n=getStateChange(t.value,this.props.value,this.state,t.contiguousCalendarMonths);this.setState(n)}this.props.selectedShortcutIndex!==t.selectedShortcutIndex&&this.setState({selectedShortcutIndex:this.props.selectedShortcutIndex})},t.prototype.validateProps=function(e){var t=e.defaultValue,a=e.initialMonth,n=e.maxDate,r=e.minDate,i=e.boundaryToModify,o=e.value,l=[r,n];null==t||DateUtils.isDayRangeInRange(t,l)||console.error(Errors.DATERANGEPICKER_DEFAULT_VALUE_INVALID),null==a||DateUtils.isMonthInRange(a,l)||console.error(Errors.DATERANGEPICKER_INITIAL_MONTH_INVALID),null!=n&&null!=r&&n<r&&!DateUtils.areSameDay(n,r)&&console.error(Errors.DATERANGEPICKER_MAX_DATE_INVALID),null==o||DateUtils.isDayRangeInRange(o,l)||console.error(Errors.DATERANGEPICKER_VALUE_INVALID),null!=i&&i!==core_1.Boundary.START&&i!==core_1.Boundary.END&&console.error(Errors.DATERANGEPICKER_PREFERRED_BOUNDARY_TO_MODIFY_INVALID)},t.prototype.maybeRenderShortcuts=function(){var e=this.props.shortcuts;if(null==e||!1===e)return null;var t=this.state.selectedShortcutIndex,a=this.props,n=a.allowSingleDayRange,r=a.maxDate,i=a.minDate,o=a.timePrecision;return[React.createElement(shortcuts_1.Shortcuts,tslib_1.__assign({key:"shortcuts"},{allowSingleDayRange:n,maxDate:r,minDate:i,selectedShortcutIndex:t,shortcuts:e,timePrecision:o},{onShortcutClick:this.handleShortcutClick})),React.createElement(core_1.Divider,{key:"div"})]},t.prototype.maybeRenderTimePickers=function(){var e=this.props,t=e.timePrecision,n=e.timePickerProps;return null==t&&n===a.defaultProps.timePickerProps?null:React.createElement("div",{className:DateClasses.DATERANGEPICKER_TIMEPICKERS},React.createElement(timePicker_1.TimePicker,tslib_1.__assign({precision:t},n,{onChange:this.handleTimeChangeLeftCalendar,value:this.state.time[0]})),React.createElement(timePicker_1.TimePicker,tslib_1.__assign({precision:t},n,{onChange:this.handleTimeChangeRightCalendar,value:this.state.time[1]})))},t.prototype.renderCalendars=function(e){var t,a,n,r=this.props,i=r.dayPickerProps,o=r.locale,l=r.localeUtils,s=r.maxDate,h=r.minDate,u=tslib_1.__assign(tslib_1.__assign({locale:o,localeUtils:l,modifiers:this.getDateRangePickerModifiers(),showOutsideDays:!0},i),{disabledDays:this.getDisabledDaysModifier(),onDayClick:this.handleDayClick,onDayMouseEnter:this.handleDayMouseEnter,onDayMouseLeave:this.handleDayMouseLeave,selectedDays:this.state.value});return e?React.createElement(react_day_picker_1.default,tslib_1.__assign({},u,{captionElement:this.renderSingleCaption,navbarElement:this.renderSingleNavbar,fromMonth:h,month:this.state.leftView.getFullDate(),numberOfMonths:1,onMonthChange:this.handleLeftMonthChange,toMonth:s,renderDay:null!==(t=null==i?void 0:i.renderDay)&&void 0!==t?t:this.renderDay})):[React.createElement(react_day_picker_1.default,tslib_1.__assign({key:"left"},u,{canChangeMonth:!0,captionElement:this.renderLeftCaption,navbarElement:this.renderLeftNavbar,fromMonth:h,month:this.state.leftView.getFullDate(),numberOfMonths:1,onMonthChange:this.handleLeftMonthChange,toMonth:DateUtils.getDatePreviousMonth(s),renderDay:null!==(a=null==i?void 0:i.renderDay)&&void 0!==a?a:this.renderDay})),React.createElement(react_day_picker_1.default,tslib_1.__assign({key:"right"},u,{canChangeMonth:!0,captionElement:this.renderRightCaption,navbarElement:this.renderRightNavbar,fromMonth:DateUtils.getDateNextMonth(h),month:this.state.rightView.getFullDate(),numberOfMonths:1,onMonthChange:this.handleRightMonthChange,toMonth:s,renderDay:null!==(n=null==i?void 0:i.renderDay)&&void 0!==n?n:this.renderDay}))]},t.prototype.updateLeftView=function(e){var t=this.state.rightView.clone();e.isBefore(t)&&!this.props.contiguousCalendarMonths||(t=e.getNextMonth()),this.setViews(e,t)},t.prototype.updateRightView=function(e){var t=this.state.leftView.clone();e.isAfter(t)&&!this.props.contiguousCalendarMonths||(t=e.getPreviousMonth()),this.setViews(t,e)},t.prototype.setViews=function(e,t){this.setState({leftView:e,rightView:t})},t.defaultProps={allowSingleDayRange:!1,contiguousCalendarMonths:!0,dayPickerProps:{},maxDate:datePickerCore_1.getDefaultMaxDate(),minDate:datePickerCore_1.getDefaultMinDate(),reverseMonthAndYearMenus:!1,shortcuts:!0,singleMonthOnly:!1,timePickerProps:{}},t.displayName=core_1.DISPLAYNAME_PREFIX+".DateRangePicker",a=tslib_1.__decorate([react_lifecycles_compat_1.polyfill],t)}(core_1.AbstractPureComponent2);function getStateChange(e,t,a,n){if(null!=e&&null==t)return{value:[null,null]};if(null!=t){var r=a.leftView.clone(),i=a.rightView.clone(),o=monthAndYear_1.MonthAndYear.fromDate(t[0]),l=monthAndYear_1.MonthAndYear.fromDate(t[1]);return null==o&&null!=l?l.isSame(r)||l.isSame(i)||(i=l,r.isBefore(i)||(r=i.getPreviousMonth())):null!=o&&null==l?o.isSame(r)||o.isSame(i)||(r=o,i.isAfter(r)||(i=r.getNextMonth())):null!=o&&null!=l&&(o.isSame(l)?r.isSame(o)||i.isSame(o)||(r=o,i=o.getNextMonth()):(r.isSame(o)||(r=o,i=o.getNextMonth()),!1!==n||i.isSame(l)||(i=l))),{leftView:r,rightView:i,value:t}}return!0!==n||a.leftView.getNextMonth().isSameMonth(a.rightView)?{}:{rightView:a.leftView.getNextMonth()}}function getInitialValue(e){return null!=e.value?e.value:null!=e.defaultValue?e.defaultValue:[null,null]}function getInitialMonth(e,t){var a=new Date;if(null!=e.initialMonth)return e.initialMonth;if(null!=t[0])return DateUtils.clone(t[0]);if(null!=t[1]){var n=DateUtils.clone(t[1]);return DateUtils.areSameMonth(n,e.minDate)||n.setMonth(n.getMonth()-1),n}return DateUtils.isDayInRange(a,[e.minDate,e.maxDate])?a:DateUtils.getDateBetween([e.minDate,e.maxDate])}exports.DateRangePicker=DateRangePicker;