"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimePicker=exports.TimePrecision=void 0;var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),React=tslib_1.__importStar(require("react")),core_1=require("@blueprintjs/core"),Classes=tslib_1.__importStar(require("./common/classes")),DateUtils=tslib_1.__importStar(require("./common/dateUtils")),timeUnit_1=require("./common/timeUnit"),Utils=tslib_1.__importStar(require("./common/utils"));exports.TimePrecision={MILLISECOND:"millisecond",MINUTE:"minute",SECOND:"second"};var TimePicker=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.getInputChangeHandler=function(e){return function(t){var i=getStringValueFromInputEvent(t);switch(e){case timeUnit_1.TimeUnit.HOUR_12:case timeUnit_1.TimeUnit.HOUR_24:n.setState({hourText:i});break;case timeUnit_1.TimeUnit.MINUTE:n.setState({minuteText:i});break;case timeUnit_1.TimeUnit.SECOND:n.setState({secondText:i});break;case timeUnit_1.TimeUnit.MS:n.setState({millisecondText:i})}}},n.getInputBlurHandler=function(e){return function(t){var i,s,r=getStringValueFromInputEvent(t);n.updateTime(parseInt(r,10),e),null===(s=(i=n.props).onBlur)||void 0===s||s.call(i,t,e)}},n.getInputFocusHandler=function(e){return function(t){var i,s;n.props.selectAllOnFocus&&t.currentTarget.select(),null===(s=(i=n.props).onFocus)||void 0===s||s.call(i,t,e)}},n.getInputKeyDownHandler=function(e){return function(t){var i,s,r;handleKeyEvent(t,((i={})[core_1.Keys.ARROW_UP]=function(){return n.incrementTime(e)},i[core_1.Keys.ARROW_DOWN]=function(){return n.decrementTime(e)},i[core_1.Keys.ENTER]=function(){t.currentTarget.blur()},i)),null===(r=(s=n.props).onKeyDown)||void 0===r||r.call(s,t,e)}},n.getInputKeyUpHandler=function(e){return function(t){var i,s;null===(s=(i=n.props).onKeyUp)||void 0===s||s.call(i,t,e)}},n.handleAmPmChange=function(e){var t="pm"===e.currentTarget.value;if(t!==n.state.isPm){var i=DateUtils.convert24HourMeridiem(n.state.value.getHours(),t);n.setState({isPm:t},(function(){return n.updateTime(i,timeUnit_1.TimeUnit.HOUR_24)}))}},n.incrementTime=function(e){return n.shiftTime(e,1)},n.decrementTime=function(e){return n.shiftTime(e,-1)},n.state=n.getFullStateFromValue(n.getInitialValue(),t.useAmPm),n}return tslib_1.__extends(t,e),t.prototype.render=function(){var e,t=this.props.precision===exports.TimePrecision.MILLISECOND,i=t||this.props.precision===exports.TimePrecision.SECOND,n=this.props.useAmPm?timeUnit_1.TimeUnit.HOUR_12:timeUnit_1.TimeUnit.HOUR_24,s=classnames_1.default(Classes.TIMEPICKER,this.props.className,((e={})[core_1.Classes.DISABLED]=this.props.disabled,e));return React.createElement("div",{className:s},React.createElement("div",{className:Classes.TIMEPICKER_ARROW_ROW},this.maybeRenderArrowButton(!0,n),this.maybeRenderArrowButton(!0,timeUnit_1.TimeUnit.MINUTE),i&&this.maybeRenderArrowButton(!0,timeUnit_1.TimeUnit.SECOND),t&&this.maybeRenderArrowButton(!0,timeUnit_1.TimeUnit.MS)),React.createElement("div",{className:Classes.TIMEPICKER_INPUT_ROW},this.renderInput(Classes.TIMEPICKER_HOUR,n,this.state.hourText),this.renderDivider(),this.renderInput(Classes.TIMEPICKER_MINUTE,timeUnit_1.TimeUnit.MINUTE,this.state.minuteText),i&&this.renderDivider(),i&&this.renderInput(Classes.TIMEPICKER_SECOND,timeUnit_1.TimeUnit.SECOND,this.state.secondText),t&&this.renderDivider("."),t&&this.renderInput(Classes.TIMEPICKER_MILLISECOND,timeUnit_1.TimeUnit.MS,this.state.millisecondText)),this.maybeRenderAmPm(),React.createElement("div",{className:Classes.TIMEPICKER_ARROW_ROW},this.maybeRenderArrowButton(!1,n),this.maybeRenderArrowButton(!1,timeUnit_1.TimeUnit.MINUTE),i&&this.maybeRenderArrowButton(!1,timeUnit_1.TimeUnit.SECOND),t&&this.maybeRenderArrowButton(!1,timeUnit_1.TimeUnit.MS)))},t.prototype.componentDidUpdate=function(e){var t=e.minTime!==this.props.minTime,i=e.maxTime!==this.props.maxTime,n=t||i,s=e.value!==this.props.value,r=n||s,a=this.state.value;null==this.props.value&&(a=this.getInitialValue()),n&&(a=DateUtils.getTimeInRange(this.state.value,this.props.minTime,this.props.maxTime)),null==this.props.value||DateUtils.areSameTime(this.props.value,e.value)||(a=this.props.value),r&&this.setState(this.getFullStateFromValue(a,this.props.useAmPm))},t.prototype.maybeRenderArrowButton=function(e,t){var i=this;if(!this.props.showArrowButtons)return null;var n=classnames_1.default(Classes.TIMEPICKER_ARROW_BUTTON,timeUnit_1.getTimeUnitClassName(t));return React.createElement("span",{tabIndex:-1,className:n,onClick:function(){return(e?i.incrementTime:i.decrementTime)(t)}},React.createElement(core_1.Icon,{icon:e?"chevron-up":"chevron-down",title:e?"Increase":"Decrease"}))},t.prototype.renderDivider=function(e){return void 0===e&&(e=":"),React.createElement("span",{className:Classes.TIMEPICKER_DIVIDER_TEXT},e)},t.prototype.renderInput=function(e,t,i){var n,s=timeUnit_1.isTimeUnitValid(t,parseInt(i,10)),r=t===timeUnit_1.TimeUnit.HOUR_12||t===timeUnit_1.TimeUnit.HOUR_24;return React.createElement("input",{className:classnames_1.default(Classes.TIMEPICKER_INPUT,(n={},n[core_1.Classes.intentClass(core_1.Intent.DANGER)]=!s,n),e),onBlur:this.getInputBlurHandler(t),onChange:this.getInputChangeHandler(t),onFocus:this.getInputFocusHandler(t),onKeyDown:this.getInputKeyDownHandler(t),onKeyUp:this.getInputKeyUpHandler(t),value:i,disabled:this.props.disabled,autoFocus:r&&this.props.autoFocus})},t.prototype.maybeRenderAmPm=function(){return this.props.useAmPm?React.createElement(core_1.HTMLSelect,{className:Classes.TIMEPICKER_AMPM_SELECT,disabled:this.props.disabled,onChange:this.handleAmPmChange,value:this.state.isPm?"pm":"am"},React.createElement("option",{value:"am"},"AM"),React.createElement("option",{value:"pm"},"PM")):null},t.prototype.getFullStateFromValue=function(e,t){var i=DateUtils.getTimeInRange(e,this.props.minTime,this.props.maxTime),n=t?timeUnit_1.TimeUnit.HOUR_12:timeUnit_1.TimeUnit.HOUR_24;return{hourText:formatTime(i.getHours(),n),minuteText:formatTime(i.getMinutes(),timeUnit_1.TimeUnit.MINUTE),secondText:formatTime(i.getSeconds(),timeUnit_1.TimeUnit.SECOND),millisecondText:formatTime(i.getMilliseconds(),timeUnit_1.TimeUnit.MS),value:i,isPm:DateUtils.getIsPmFrom24Hour(i.getHours())}},t.prototype.shiftTime=function(e,t){if(!this.props.disabled){var i=timeUnit_1.getTimeUnit(e,this.state.value)+t;this.updateTime(timeUnit_1.wrapTimeAtUnit(e,i),e)}},t.prototype.updateTime=function(e,t){var i=DateUtils.clone(this.state.value);timeUnit_1.isTimeUnitValid(t,e)?(timeUnit_1.setTimeUnit(t,e,i,this.state.isPm),DateUtils.isTimeInRange(i,this.props.minTime,this.props.maxTime)?this.updateState({value:i}):this.updateState(this.getFullStateFromValue(this.state.value,this.props.useAmPm))):this.updateState(this.getFullStateFromValue(this.state.value,this.props.useAmPm))},t.prototype.updateState=function(e){var t,i,n=e,s=null!=n.value&&!DateUtils.areSameTime(n.value,this.state.value);null==this.props.value?(s&&(n=this.getFullStateFromValue(n.value,this.props.useAmPm)),this.setState(n)):s?this.setState(this.getFullStateFromValue(this.state.value,this.props.useAmPm)):this.setState(tslib_1.__assign(tslib_1.__assign({},n),{value:DateUtils.clone(this.state.value)})),s&&(null===(i=(t=this.props).onChange)||void 0===i||i.call(t,n.value))},t.prototype.getInitialValue=function(){var e=this.props.minTime;return null!=this.props.value?e=this.props.value:null!=this.props.defaultValue&&(e=this.props.defaultValue),e},t.defaultProps={autoFocus:!1,disabled:!1,maxTime:timeUnit_1.getDefaultMaxTime(),minTime:timeUnit_1.getDefaultMinTime(),precision:exports.TimePrecision.MINUTE,selectAllOnFocus:!1,showArrowButtons:!1,useAmPm:!1},t.displayName=core_1.DISPLAYNAME_PREFIX+".TimePicker",t}(React.Component);function formatTime(e,t){switch(t){case timeUnit_1.TimeUnit.HOUR_24:return e.toString();case timeUnit_1.TimeUnit.HOUR_12:return DateUtils.get12HourFrom24Hour(e).toString();case timeUnit_1.TimeUnit.MINUTE:case timeUnit_1.TimeUnit.SECOND:return Utils.padWithZeroes(e.toString(),2);case timeUnit_1.TimeUnit.MS:return Utils.padWithZeroes(e.toString(),3);default:throw Error("Invalid TimeUnit")}}function getStringValueFromInputEvent(e){return e.target.value}function handleKeyEvent(e,t,i){void 0===i&&(i=!0);for(var n=0,s=Object.keys(t);n<s.length;n++){var r=s[n],a=Number(r);e.which===a&&(i&&e.preventDefault(),t[a]())}}exports.TimePicker=TimePicker;