import{__assign,__extends}from"tslib";import classNames from"classnames";import*as React from"react";import{Classes as CoreClasses,DISPLAYNAME_PREFIX,HTMLSelect,Icon,Intent,Keys}from"@blueprintjs/core";import*as Classes from"./common/classes";import*as DateUtils from"./common/dateUtils";import{getDefaultMaxTime,getDefaultMinTime,getTimeUnit,getTimeUnitClassName,isTimeUnitValid,setTimeUnit,TimeUnit,wrapTimeAtUnit}from"./common/timeUnit";import*as Utils from"./common/utils";export var TimePrecision={MILLISECOND:"millisecond",MINUTE:"minute",SECOND:"second"};var TimePicker=function(e){function t(t,i){var s=e.call(this,t,i)||this;return s.getInputChangeHandler=function(e){return function(t){var i=getStringValueFromInputEvent(t);switch(e){case TimeUnit.HOUR_12:case TimeUnit.HOUR_24:s.setState({hourText:i});break;case TimeUnit.MINUTE:s.setState({minuteText:i});break;case TimeUnit.SECOND:s.setState({secondText:i});break;case TimeUnit.MS:s.setState({millisecondText:i})}}},s.getInputBlurHandler=function(e){return function(t){var i,n,a=getStringValueFromInputEvent(t);s.updateTime(parseInt(a,10),e),null===(n=(i=s.props).onBlur)||void 0===n||n.call(i,t,e)}},s.getInputFocusHandler=function(e){return function(t){var i,n;s.props.selectAllOnFocus&&t.currentTarget.select(),null===(n=(i=s.props).onFocus)||void 0===n||n.call(i,t,e)}},s.getInputKeyDownHandler=function(e){return function(t){var i,n,a;handleKeyEvent(t,((i={})[Keys.ARROW_UP]=function(){return s.incrementTime(e)},i[Keys.ARROW_DOWN]=function(){return s.decrementTime(e)},i[Keys.ENTER]=function(){t.currentTarget.blur()},i)),null===(a=(n=s.props).onKeyDown)||void 0===a||a.call(n,t,e)}},s.getInputKeyUpHandler=function(e){return function(t){var i,n;null===(n=(i=s.props).onKeyUp)||void 0===n||n.call(i,t,e)}},s.handleAmPmChange=function(e){var t="pm"===e.currentTarget.value;if(t!==s.state.isPm){var i=DateUtils.convert24HourMeridiem(s.state.value.getHours(),t);s.setState({isPm:t},(function(){return s.updateTime(i,TimeUnit.HOUR_24)}))}},s.incrementTime=function(e){return s.shiftTime(e,1)},s.decrementTime=function(e){return s.shiftTime(e,-1)},s.state=s.getFullStateFromValue(s.getInitialValue(),t.useAmPm),s}return __extends(t,e),t.prototype.render=function(){var e,t=this.props.precision===TimePrecision.MILLISECOND,i=t||this.props.precision===TimePrecision.SECOND,s=this.props.useAmPm?TimeUnit.HOUR_12:TimeUnit.HOUR_24,n=classNames(Classes.TIMEPICKER,this.props.className,((e={})[CoreClasses.DISABLED]=this.props.disabled,e));return React.createElement("div",{className:n},React.createElement("div",{className:Classes.TIMEPICKER_ARROW_ROW},this.maybeRenderArrowButton(!0,s),this.maybeRenderArrowButton(!0,TimeUnit.MINUTE),i&&this.maybeRenderArrowButton(!0,TimeUnit.SECOND),t&&this.maybeRenderArrowButton(!0,TimeUnit.MS)),React.createElement("div",{className:Classes.TIMEPICKER_INPUT_ROW},this.renderInput(Classes.TIMEPICKER_HOUR,s,this.state.hourText),this.renderDivider(),this.renderInput(Classes.TIMEPICKER_MINUTE,TimeUnit.MINUTE,this.state.minuteText),i&&this.renderDivider(),i&&this.renderInput(Classes.TIMEPICKER_SECOND,TimeUnit.SECOND,this.state.secondText),t&&this.renderDivider("."),t&&this.renderInput(Classes.TIMEPICKER_MILLISECOND,TimeUnit.MS,this.state.millisecondText)),this.maybeRenderAmPm(),React.createElement("div",{className:Classes.TIMEPICKER_ARROW_ROW},this.maybeRenderArrowButton(!1,s),this.maybeRenderArrowButton(!1,TimeUnit.MINUTE),i&&this.maybeRenderArrowButton(!1,TimeUnit.SECOND),t&&this.maybeRenderArrowButton(!1,TimeUnit.MS)))},t.prototype.componentDidUpdate=function(e){var t=e.minTime!==this.props.minTime,i=e.maxTime!==this.props.maxTime,s=t||i,n=e.value!==this.props.value,a=s||n,r=this.state.value;null==this.props.value&&(r=this.getInitialValue()),s&&(r=DateUtils.getTimeInRange(this.state.value,this.props.minTime,this.props.maxTime)),null==this.props.value||DateUtils.areSameTime(this.props.value,e.value)||(r=this.props.value),a&&this.setState(this.getFullStateFromValue(r,this.props.useAmPm))},t.prototype.maybeRenderArrowButton=function(e,t){var i=this;if(!this.props.showArrowButtons)return null;var s=classNames(Classes.TIMEPICKER_ARROW_BUTTON,getTimeUnitClassName(t));return React.createElement("span",{tabIndex:-1,className:s,onClick:function(){return(e?i.incrementTime:i.decrementTime)(t)}},React.createElement(Icon,{icon:e?"chevron-up":"chevron-down",title:e?"Increase":"Decrease"}))},t.prototype.renderDivider=function(e){return void 0===e&&(e=":"),React.createElement("span",{className:Classes.TIMEPICKER_DIVIDER_TEXT},e)},t.prototype.renderInput=function(e,t,i){var s,n=isTimeUnitValid(t,parseInt(i,10)),a=t===TimeUnit.HOUR_12||t===TimeUnit.HOUR_24;return React.createElement("input",{className:classNames(Classes.TIMEPICKER_INPUT,(s={},s[CoreClasses.intentClass(Intent.DANGER)]=!n,s),e),onBlur:this.getInputBlurHandler(t),onChange:this.getInputChangeHandler(t),onFocus:this.getInputFocusHandler(t),onKeyDown:this.getInputKeyDownHandler(t),onKeyUp:this.getInputKeyUpHandler(t),value:i,disabled:this.props.disabled,autoFocus:a&&this.props.autoFocus})},t.prototype.maybeRenderAmPm=function(){return this.props.useAmPm?React.createElement(HTMLSelect,{className:Classes.TIMEPICKER_AMPM_SELECT,disabled:this.props.disabled,onChange:this.handleAmPmChange,value:this.state.isPm?"pm":"am"},React.createElement("option",{value:"am"},"AM"),React.createElement("option",{value:"pm"},"PM")):null},t.prototype.getFullStateFromValue=function(e,t){var i=DateUtils.getTimeInRange(e,this.props.minTime,this.props.maxTime),s=t?TimeUnit.HOUR_12:TimeUnit.HOUR_24;return{hourText:formatTime(i.getHours(),s),minuteText:formatTime(i.getMinutes(),TimeUnit.MINUTE),secondText:formatTime(i.getSeconds(),TimeUnit.SECOND),millisecondText:formatTime(i.getMilliseconds(),TimeUnit.MS),value:i,isPm:DateUtils.getIsPmFrom24Hour(i.getHours())}},t.prototype.shiftTime=function(e,t){if(!this.props.disabled){var i=getTimeUnit(e,this.state.value)+t;this.updateTime(wrapTimeAtUnit(e,i),e)}},t.prototype.updateTime=function(e,t){var i=DateUtils.clone(this.state.value);isTimeUnitValid(t,e)?(setTimeUnit(t,e,i,this.state.isPm),DateUtils.isTimeInRange(i,this.props.minTime,this.props.maxTime)?this.updateState({value:i}):this.updateState(this.getFullStateFromValue(this.state.value,this.props.useAmPm))):this.updateState(this.getFullStateFromValue(this.state.value,this.props.useAmPm))},t.prototype.updateState=function(e){var t,i,s=e,n=null!=s.value&&!DateUtils.areSameTime(s.value,this.state.value);null==this.props.value?(n&&(s=this.getFullStateFromValue(s.value,this.props.useAmPm)),this.setState(s)):n?this.setState(this.getFullStateFromValue(this.state.value,this.props.useAmPm)):this.setState(__assign(__assign({},s),{value:DateUtils.clone(this.state.value)})),n&&(null===(i=(t=this.props).onChange)||void 0===i||i.call(t,s.value))},t.prototype.getInitialValue=function(){var e=this.props.minTime;return null!=this.props.value?e=this.props.value:null!=this.props.defaultValue&&(e=this.props.defaultValue),e},t.defaultProps={autoFocus:!1,disabled:!1,maxTime:getDefaultMaxTime(),minTime:getDefaultMinTime(),precision:TimePrecision.MINUTE,selectAllOnFocus:!1,showArrowButtons:!1,useAmPm:!1},t.displayName=DISPLAYNAME_PREFIX+".TimePicker",t}(React.Component);export{TimePicker};function formatTime(e,t){switch(t){case TimeUnit.HOUR_24:return e.toString();case TimeUnit.HOUR_12:return DateUtils.get12HourFrom24Hour(e).toString();case TimeUnit.MINUTE:case TimeUnit.SECOND:return Utils.padWithZeroes(e.toString(),2);case TimeUnit.MS:return Utils.padWithZeroes(e.toString(),3);default:throw Error("Invalid TimeUnit")}}function getStringValueFromInputEvent(e){return e.target.value}function handleKeyEvent(e,t,i){void 0===i&&(i=!0);for(var s=0,n=Object.keys(t);s<n.length;s++){var a=n[s],r=Number(a);e.which===r&&(i&&e.preventDefault(),t[r]())}}