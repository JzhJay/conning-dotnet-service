/*! For license information please see wijmo.grid.grouppanel.min.js.LICENSE.txt */
var wijmo,__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){var t;!function(t){"use strict";t.softGridFilter=function(){return e._getModule("wijmo.grid.filter")}}((t=e.grid||(e.grid={})).grouppanel||(t.grouppanel={}))}(wijmo||(wijmo={})),function(e){var t;!function(t){"use strict";e._addCultureInfo("GroupPanel",{dragDrop:"Drag and Drop columns here to create Groups."});var r=function(r){function i(t,i){var n=r.call(this,t)||this;n._hideGroupedCols=!0,n._showDragGlyphs=!0,n._maxGroups=6,n._hiddenCols=[],n._placeholder=null,n._dragEndBnd=n._dragEnd.bind(n);var o=n.getTemplate();n.applyTemplate("wj-grouppanel wj-control",o,{_divMarkers:"div-markers",_divPH:"div-ph"}),e.setCss(n._divMarkers.parentElement,{width:"100%",height:"100%",minHeight:"1em",overflow:"hidden",cursor:"default"});var l=n.hostElement,s=n.addEventListener.bind(n);return s(l,"dragstart",n._dragStart.bind(n)),s(l,"dragover",n._dragOver.bind(n)),s(l,"drop",n._drop.bind(n)),s(l,"dragend",n._dragEndBnd),s(l,"click",n._click.bind(n)),n.initialize(i),n}return __extends(i,r),Object.defineProperty(i.prototype,"hideGroupedColumns",{get:function(){return this._hideGroupedCols},set:function(t){t!=this._hideGroupedCols&&(this._hideGroupedCols=e.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showDragGlyphs",{get:function(){return this._showDragGlyphs},set:function(t){t!=this._showDragGlyphs&&(this._showDragGlyphs=e.asBoolean(t),this.refresh())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxGroups",{get:function(){return this._maxGroups},set:function(t){if(t!=this._maxGroups){this._maxGroups=e.asNumber(t);var r=this._gds,i=this._maxGroups;r&&i>-1&&i<r.length&&r.splice(i,r.length-i)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){e!=this._placeholder&&(this._placeholder=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"grid",{get:function(){return this._g},set:function(t){if((t=e.asType(t,e.grid.FlexGrid,!0))!=this._g){var r=this._g;r&&(r.draggingColumn.removeHandler(this._draggingColumn),r.itemsSourceChanging.removeHandler(this._itemsSourceChanging),r.itemsSourceChanged.removeHandler(this._itemsSourceChanged),r.columns.collectionChanged.removeHandler(this._itemsSourceChanged),r.removeEventListener(r.hostElement,"dragend",this._dragEndBnd)),r=this._g=t,this._hiddenCols=[],r&&(r.draggingColumn.addHandler(this._draggingColumn,this),r.itemsSourceChanging.addHandler(this._itemsSourceChanging,this),r.itemsSourceChanged.addHandler(this._itemsSourceChanged,this),r.columns.collectionChanged.addHandler(this._itemsSourceChanged,this),r.addEventListener(r.hostElement,"dragend",this._dragEndBnd)),this._itemsSourceChanged(r,null)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collectionView",{get:function(){return this._g?this._g.collectionView:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},set:function(r){if((r=e.asType(r,t.softGridFilter().FlexGridFilter,!0))!=this._filter){var i=this._filter;i&&(i.filterApplied.removeHandler(this.refresh,this),i.filterChanged.removeHandler(this._filterChanged,this)),(i=this._filter=r)&&(i.filterApplied.addHandler(this.refresh,this),i.filterChanged.addHandler(this._filterChanged,this)),this.refresh()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupDescriptionCreator",{get:function(){return this._gdc},set:function(e){this._gdc=e},enumerable:!0,configurable:!0}),i.prototype.refresh=function(){if(r.prototype.refresh.call(this),this._divMarkers.innerHTML="",this._dragMarker=this._dragCol=null,this._gds){for(var t=this._g,i=t.columnHeaders,n=0;n<this._gds.length;n++){var o=this._gds[n],l=-1,s=-1;if(o instanceof e.collections.PropertyGroupDescription)for(var a=i.rows.length-1;a>=0&&s<0;a--)for(var d=0;d<i.columns.length&&s<0;d++)if((u=t._getBindingColumn(i,a,i.columns[d]))&&u.binding==o.propertyName){s=d,l=a;break}if(s>-1&&l>-1){var h=document.createElement("div");if(t.cellFactory.updateCell(this._g.columnHeaders,l,s,h),h.setAttribute("class","wj-cell wj-header wj-groupmarker"),e.setCss(h,{position:"static",display:"inline-block",verticalAlign:"top",left:"",right:"",top:"",width:"",height:"",paddingLeft:"",paddingRight:""}),e.removeChild(h.querySelector(".wj-elem-filter")),e.removeChild(h.querySelector(".wj-column-selector")),this.showDragGlyphs){var g=e.createElement('<span class="wj-glyph-drag"></span>');h.insertBefore(g,h.firstChild)}var u=t._getBindingColumn(i,l,i.columns[s]),c=this._getColumnFilter(u);if(c){var p=e.createElement('<span class="wj-filter wj-glyph-filter"></span>',h);e.toggleClass(p,"wj-filter-on",c.isActive),e.toggleClass(p,"wj-filter-off",!c.isActive)}e.createElement('<span class="wj-remove">&times;</span>',h),this._divMarkers.appendChild(h)}}this._divPH.textContent=null!=this._placeholder?this._placeholder:e.culture.GroupPanel.dragDrop;var _=this._divMarkers.children.length>0;this._divPH.style.display=_?"none":"",this._divMarkers.style.display=_?"":"none"}},i.prototype.hitTest=function(t){var r=t instanceof HTMLElement?t:t instanceof MouseEvent?t.target:null;e.assert(null!=r,"MouseEvent or Element expected");var i=e.closest(r,".wj-cell");if(e.hasClass(i,"wj-cell")){var n=this._getElementIndex(i);return this._gds&&n>-1?this._gds[n]:null}return null},i.prototype._filterChanged=function(){this._filterMarker=null},i.prototype._getColumnFilter=function(e){var t=this._filter,r=null;return t&&(r=t.filterColumns&&t.filterColumns.indexOf(e.binding)<0?null:t.getColumnFilter(e)),r},i.prototype._editFilter=function(t){var r=this._gds,i=this._getElementIndex(t),n=r&&i>-1?r[i]:null,o=n instanceof e.collections.PropertyGroupDescription?n.propertyName:null,l=o?this._g.getColumn(o):null;l&&this._filter.editColumnFilter(l,null,t)},i.prototype._addGroup=function(t,r){for(var i=this._getIndex(r),n=this._gds,o=this._maxGroups,l=0;l<n.length;l++){var s=n[l];if(s instanceof e.collections.PropertyGroupDescription&&s.propertyName==t.binding){n.removeAt(l),l<i&&i--;break}}if(o>-1)for(l=o-1;l<n.length;l++)this._removeGroup(l,n),l<i&&i--;if(o<0||n.length<o){var a=this._gdc?this._gdc(t.binding):null;a||(a=new e.collections.PropertyGroupDescription(t.binding)),n.insert(i,a),t&&this.hideGroupedColumns&&(t.visible=!1,this._hiddenCols.push(t))}},i.prototype._moveGroup=function(e,t){var r=this._gds,i=this._getElementIndex(this._dragMarker),n=this._getIndex(t);n>i&&n--,n>=this._gds.length&&(n=this._gds.length),i!=n&&r.deferUpdate((function(){var e=r[i];r.removeAt(i),r.insert(n,e)}))},i.prototype._removeGroup=function(t,r){void 0===r&&(r=this._gds);var i=r&&t>-1?r[t]:null,n=i instanceof e.collections.PropertyGroupDescription?i.propertyName:null,o=n?this._g.columns.getColumn(n):null;if(o){o.visible=!0;var l=this._hiddenCols,s=l.indexOf(o);s>-1&&l.splice(s,1)}i&&r.removeAt(t)},i.prototype._getIndex=function(e){for(var t=e.clientX,r=this._divMarkers.children,i=0;i<r.length;i++){var n=r[i].getBoundingClientRect();if((t-n.left)*(t-n.right)<0)return i}return r.length},i.prototype._getElementIndex=function(e){if(e&&e.parentElement)for(var t=e.parentElement.children,r=0;r<t.length;r++)if(t[r]==e)return r;return-1},i.prototype._draggingColumn=function(e,t){var r=this._g,i=r._getBindingColumn(t.panel,t.row,r.columns[t.col]);this._dragCol=i.binding?i:null},i.prototype._itemsSourceChanging=function(e,t){this._hiddenCols.forEach((function(e){e.visible=!0})),this._hiddenCols=[]},i.prototype._itemsSourceChanged=function(e,t){this._view&&this._view.collectionChanged.removeHandler(this._collectionChanged),this._view=this._g?this._g.collectionView:null,this._gds=this._view?this._view.groupDescriptions:null,this._view&&this._view.collectionChanged.addHandler(this._collectionChanged,this),this.invalidate()},i.prototype._collectionChanged=function(t,r){r.action==e.collections.NotifyCollectionChangedAction.Reset&&this.invalidate()},i.prototype._dragStart=function(t){e._startDrag(t.dataTransfer,"move"),this._dragMarker=t.target,this._dragCol=null},i.prototype._dragOver=function(e){(this._dragCol||this._dragMarker)&&(e.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation())},i.prototype._drop=function(e){this._dragMarker?this._moveGroup(this._dragMarker,e):this._dragCol&&this._addGroup(this._dragCol,e)},i.prototype._dragEnd=function(e){this._dragMarker=this._dragCol=null},i.prototype._click=function(t){var r=t.target,i=e.closest(r,".wj-cell");if(e.hasClass(i,"wj-cell"))if(e.hasClass(r,"wj-filter")){if(i!=this._filterMarker)return this._editFilter(i),void(this._filterMarker=i)}else if(e.hasClass(r,"wj-remove")){var n=this._getElementIndex(i);this._removeGroup(n)}else this._updateSort(t,i);this._filterMarker=null,this.hostElement.focus()},i.prototype._updateSort=function(t,r){var i=this,n=this._g,o=n.collectionView;if(o&&o.canSort&&n.allowSorting!=e.grid.AllowSorting.None){var l=this._getElementIndex(r),s=this._gds[l],a=s instanceof e.collections.PropertyGroupDescription?s.propertyName:null,d=a?n.getColumn(a):null;if(d&&d.allowSorting){for(var h=d.sortMemberPath||d.binding,g=-1,u=o.sortDescriptions,c=0;c<u.length;c++)if(u[c].property==h){g=c;break}var p=new e.grid.CellRangeEventArgs(n.columnHeaders,new e.grid.CellRange(0,d.index),t);if(n.onSortingColumn(p)){var _=t.ctrlKey||t.metaKey,f=t.shiftKey;u.deferUpdate((function(){if(_&&f)u.clear();else if(g<0){i._g.allowSorting!=e.grid.AllowSorting.MultiColumn&&u.clear();var t=new e.collections.SortDescription(h,!0);u.push(t)}else{var r=u[g].ascending;_||i.isTouching&&!r?u.splice(g,1):(t=new e.collections.SortDescription(h,!r),u.splice(g,1,t))}})),n.onSortedColumn(p)}}}},i.controlTemplate='<div><div wj-part="div-ph"></div><div wj-part="div-markers"></div></div>',i}(e.Control);t.GroupPanel=r}((t=e.grid||(e.grid={})).grouppanel||(t.grouppanel={}))}(wijmo||(wijmo={})),function(e){var t;(t=e.grid||(e.grid={})).grouppanel||(t.grouppanel={}),e._registerModule("wijmo.grid.grouppanel",e.grid.grouppanel)}(wijmo||(wijmo={}));