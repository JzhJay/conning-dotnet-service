/*! For license information please see wijmo.grid.transposedmultirow.min.js.LICENSE.txt */
var wijmo,__extends=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){var e;!function(e){"use strict";var o=function(t){function e(e,o){var n=t.call(this,e)||this;return n._idxData=o,n}return __extends(e,t),e}(t.grid.Row);e._MultiRow=o}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;!function(e){"use strict";var o=function(e){function o(o){var n=e.call(this)||this;return n._row=n._col=0,n._rowspan=n._colspan=1,t.copy(n,o),n}return __extends(o,e),Object.defineProperty(o.prototype,"row",{get:function(){return this._row},set:function(e){this._row=t.asInt(e,!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"col",{get:function(){return this._col},set:function(e){this._col=t.asInt(e,!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"colspan",{get:function(){return this._colspan},set:function(e){this._colspan=t.asInt(e,!1,!0),t.assert(this._colspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rowspan",{get:function(){return this._rowspan},set:function(e){this._rowspan=t.asInt(e,!1,!0),t.assert(this._rowspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0}),o}(t.grid.Column);e._Cell=o}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;!function(e){"use strict";var o=function(o){function n(e,n){var r=o.call(this)||this;if(r._colstart=0,r._rowstart=0,r._layout=e,r._g=e._grid,t.copy(r,n),!r._cells)throw"Cell group with no cells?";var i=0,s=0;r._cells.forEach((function(t,e){for(;!r._cellFits(t,e,i,s);)0==(s=(s+1)%r.colspan)&&i++;t.row=i,t.col=s}));var l=1,a=1;return r._cells.forEach((function(t){l=Math.max(l,t.row+t.rowspan),a=Math.max(a,t.col+t.colspan)})),r.rowspan=l,r.colspan=a,r}return __extends(n,o),n.prototype._copy=function(o,n){var r=this;return"cells"==o&&(this._cells=[],t.isArray(n)&&n.forEach((function(o){var n=new e._Cell(o);n.binding&&!n.header&&(n.header=t.toHeaderCase(n.binding)),r._cells.push(n),r.colspan=Math.max(r.colspan,n.colspan)})),!0)},Object.defineProperty(n.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),n.prototype.closeGroup=function(e){var o=this;e>this.colspan&&(this._cells.forEach((function(t){t.col==o.colspan-1&&(t.colspan=e-t.col)})),this.colspan=e),this._cells.forEach((function(t){for(;t.col+t.colspan<o.colspan&&!o._slotTaken(t.row,t.col+t.colspan);)t.colspan++})),this._cells.forEach((function(t){for(;t.row+t.rowspan<o.rowspan&&!o._slotTaken(t.row+t.rowspan,t.col);)t.rowspan++}));for(var n=0;n<this.rowspan;n++)for(var r=0;r<this.colspan;r++)t.assert(this._slotTaken(n,r),"Invalid layout (empty cells).");this._cols=new t.grid.ColumnCollection(this._g,this._g.columns.defaultSize),this._rng=new Array(e*this.rowspan),this._cells.forEach((function(e){for(var n=0;n<e.rowspan;n++)for(var r=0;r<e.colspan;r++){var i=(e.row+n)*o.colspan+(e.col+r);o._cols.setAt(i,e);var s=new t.grid.CellRange(e.row,e.col,e.row+e.rowspan-1,e.col+e.colspan-1);s.isSingleCell||(o._rng[i]=s)}})),this._rng[-1]=new t.grid.CellRange(this._rowstart,this._colstart,this._rowstart+this._rowspan-1,this._colstart)},n.prototype.getMergedRange=function(e,o,n){if(n<0)return this._rng[-1];var r=o-this._rowstart,i=n%this.colspan,s=this._rng[r*this.colspan+i];e.cellType==t.grid.CellType.RowHeader&&n++;var l=o-r,a=n-i;return s?new t.grid.CellRange(l+s.row,a+s.col,l+s.row2,a+s.col2):null},n.prototype.getBindingColumn=function(t,e,o){if(o<0)return this;var n=e-this._rowstart,r=o%this.colspan;return this._cols[n*this.colspan+r]},n.prototype._cellFits=function(t,e,o,n){if(n>0&&n+t.colspan>this.colspan)return!1;for(var r=0;r<t.colspan;r++)if(this._slotTaken(o,n+r,e))return!1;return this.colspan=Math.max(this.colspan,n+t.colspan-1),!0},n.prototype._slotTaken=function(t,e,o){void 0===o&&(o=this._cells.length);for(var n=0;n<o;n++){var r=this._cells[n];if(t>=r.row&&t<=r.row+r.rowspan-1&&e>=r.col&&e<=r.col+r.colspan-1)return!0}return!1},n.prototype._updateCellTypes=function(e){this._cols.forEach((function(o){var n=o;null==n.dataType&&n._binding&&(n.dataType=t.getType(n._binding.getValue(e)))}))},n}(e._Cell);e._CellGroup=o}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;!function(e){"use strict";var o=function(o){function n(){return null!==o&&o.apply(this,arguments)||this}return __extends(n,o),n.prototype.getMergedRange=function(o,n,r,i){void 0===i&&(i=!0);var s=o.grid;if(n<0||n>=o.rows.length||r<0||r>=o.columns.length)return null;switch(o.cellType){case t.grid.CellType.Cell:case t.grid.CellType.RowHeader:var l=o.rows[n].dataItem._rowInfo.index,a=r;o.cellType==t.grid.CellType.RowHeader&&a--;var u=s._getGroupByRow(n);t.assert(u instanceof e._CellGroup,"Failed to get the group!");var c=u.getMergedRange(o,l,a);if(c){var p=l,g=n;n>0&&(p=o.rows[n-1].dataItem._rowInfo.index,g=n-1),c.row<=p?c.row=g:c.row=n;var d=l,h=n;n<o.rows.length-1&&(d=o.rows[n+1].dataItem._rowInfo.index,h=n+1),c.row2>=d?c.row2=h:c.row2=n}return t.assert(!c||c.contains(n,r),"Merged range must contain source cell"),c;case t.grid.CellType.ColumnHeader:var f=s.columnsPerItem,w=r-r%f,_=Math.min(w+f-1,o.columns.length-1);return new t.grid.CellRange(0,w,o.rows.length-1,_);case t.grid.CellType.TopLeft:return new t.grid.CellRange(0,0,o.rows.length-1,o.columns.length-1)}return null},n}(t.grid.MergeManager);e._MergeManager=o}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;!function(t){"use strict";var e=function(){function e(t,e){this._columnsPerItem=1,this._bindingGroups=[],this._groupsByRow={},this._grid=t,this._bindingGroups=this._parseCellGroups(e)}return Object.defineProperty(e.prototype,"totalRowSpan",{get:function(){var t=this._bindingGroups;if(t&&t.length){var e=t[t.length-1];return e._rowstart+e.rowspan}return 0},enumerable:!0,configurable:!0}),e.prototype._parseCellGroups=function(e){var o=[],n=1;if(e){for(var r=0,i=0;r<e.length;r++){var s=new t._CellGroup(this,e[r]);s._rowstart=i,i+=s._rowspan,n=Math.max(n,s._colspan),o.push(s)}o.forEach((function(t){t.closeGroup(n)})),this._columnsPerItem=n}return o},e.prototype._getGroupByRow=function(t){var e=this._getGroupIndexByRow(t);return e>-1?this._bindingGroups[e]:null},e.prototype._getGroupIndexByRow=function(t){var e=this._groupsByRow[t];if(e)return e;for(var o=this._bindingGroups,n=0;n<o.length;n++){var r=o[n];if(t>=r._rowstart&&t<=r._rowstart+r._rowspan-1)return this._groupsByRow[t]=n,n}return-1},e.prototype._updateCellTypes=function(t){this._bindingGroups.forEach((function(e){e._updateCellTypes(t)}))},e}();t._MultiRowLayout=e}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;!function(e){"use strict";var o=function(o){function n(n,r){var i=o.call(this,n)||this;return i._currentPos=-1,i._bindingColumns={},i._keyPrefix="item",t.addClass(i.hostElement,"wj-transposed-multirow"),i._layout=new e._MultiRowLayout(i,null),i.allowDragging=t.grid.AllowDragging.None,i.allowSorting=t.grid.AllowSorting.None,i.mergeManager=new e._MergeManager,i.formatItem.addHandler(i._formatItem,i),i._rowInfo=new t.grid.ColumnCollection(i,i.columns.defaultSize),i.initialize(r),i._rowInfo.collectionChanged.addHandler(i._rowInfoChanged,i),i}return __extends(n,o),Object.defineProperty(n.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(o){this._layoutDef=t.asArray(o),this._layout=new e._MultiRowLayout(this,o),this._rowInfoChanged()},enumerable:!0,configurable:!0}),n.prototype.getBindingColumn=function(e,o,n){if(e.cellType!=t.grid.CellType.Cell)return null;var r=e.rows[o].dataItem._rowInfo.index,i=r+"_"+n,s=this._bindingColumns[i];if(s)return s;var l=this._getGroupByRow(o).getBindingColumn(e,r,n);if(l){s=new t.grid.Column,t.grid.FlexGrid._getSerializableProperties(t.grid.Column).forEach((function(t){null!=l[t]&&(s[t]=l[t])}));var a=Math.floor(n/this.columnsPerItem),u=n%this.columnsPerItem;s.binding=this._keyPrefix+a+"_"+u,this._bindingColumns[i]=s}return s},Object.defineProperty(n.prototype,"columnsPerItem",{get:function(){return this._layout._columnsPerItem},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowAddNew",{get:function(){return!1},set:function(e){t.assert(!e,"TransposedMultiRow does not support items addition.")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowDelete",{get:function(){return!1},set:function(e){t.assert(!e,"TransposedMultiRow does not support items deletion.")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowDragging",{get:function(){return t.grid.AllowDragging.None},set:function(e){t.assert(e===t.grid.AllowDragging.None,"TransposedMultiRow does not support dragging."),e!==this._alDragging&&(this._alDragging=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowPinning",{get:function(){return!1},set:function(e){t.assert(!e,"TransposedMultiRow does not support pinning.")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowSorting",{get:function(){return t.grid.AllowSorting.None},set:function(e){t.assert(e===t.grid.AllowSorting.None,"TransposedMultiRow does not support sorting."),this._alSorting=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columnLayout",{get:function(){throw"TransposedMultiRow does not support column layout."},set:function(t){throw"TransposedMultiRow does not support column layout."},enumerable:!0,configurable:!0}),n.prototype.refresh=function(t){var e=this._rowInfo;e._dirty?(e._dirty=!1,this._rowInfoChanged()):o.prototype.refresh.call(this,t)},n.prototype.onLoadedRows=function(e){for(var n=this,r=this.columnHeaders.columns,i=0;i<r.length;i++)this.columnHeaders.setCellData(0,i,"");var s=this.columns;for(i=0;i<s.length;i++){var l=s[i];l.align=null,l.dataType=0}var a=this.rowHeaders.columns;for(this.rows.forEach((function(e){var o=e.dataItem._rowInfo;if(o)for(var r=a.length-2;r>=0;r--){var i=o.headers[r]||t.toHeaderCase(o.bindings[r]);n.rowHeaders.setCellData(e.index,r+1,i)}})),a[0].visible=!1,i=1;i<a.length;i++)a[i].align="left",a[i].visible=!0,a[i].width=this.columns.defaultSize;o.prototype.onLoadedRows.call(this,e)},n.prototype._getGroupByRow=function(o){var n=this.cells.rows[o].dataItem._rowInfo.index,r=this._layout._getGroupByRow(n);return t.assert(r instanceof e._CellGroup,"Failed to get the group!"),r},n.prototype._addBoundRow=function(t,o){var n=t[o];this.rows.push(new e._MultiRow(n,o))},n.prototype._updateColumnTypes=function(){o.prototype._updateColumnTypes.call(this);var e=this.collectionView;if(t.hasItems(e)&&this._layout){var n=e.items[0]._arr;n&&n.length>0&&this._layout._updateCellTypes(n[0])}},n.prototype._getBindingColumn=function(t,e,n){return this._layout?(t==this.cells&&(n=this.getBindingColumn(t,e,n.index)),n):o.prototype._getBindingColumn.call(this,t,e,n)},n.prototype._isTransposed=function(){return!0},n.prototype.onRowEditEnded=function(e){if(null!=this._view){var n=new t.collections.NotifyCollectionChangedEventArgs(t.collections.NotifyCollectionChangedAction.Change);this._view.collectionChanged.raise(this._view,n)}o.prototype.onRowEditEnded.call(this,e)},n.prototype._getCollectionView=function(e){var n=null;null!=this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged),t.isArray(e)?e=this._transposeItemsSource(e):e&&(this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged),this._view=t.tryCast(e,"ICollectionView"),this._view&&(this._view.collectionChanged.addHandler(this._sourceViewChanged,this),e instanceof t.collections.CollectionView&&(n=e.getError),e=this._transposeItemsSource(this._view.items))),this.autoGenerateColumns=!0;var r=o.prototype._getCollectionView.call(this,e);return r&&this._currentPos>=0&&(r.currentPosition=Math.min(r.items.length-1,this._currentPos)),n&&r instanceof t.collections.CollectionView&&(r.getError=function(t,e){if(null==e)return null;var o=t._keys.indexOf(e),r=o%t._bnd.length,i=Math.floor(o/t._bnd.length);return n(t._arr[i],t._bnd[r].path)}),r},n.prototype._rowInfoChanged=function(){try{var t=this.collectionView;this._currentPos=t?t.currentPosition:-1;var e=this.selection;this._bindingColumns={};var o=this.itemsSource;this.itemsSource=null,this.itemsSource=o,e&&e.isValid&&(this.selection=e)}finally{this._currentPos=-1}},n.prototype._formatItem=function(e,o){var n=this.columnsPerItem,r=o.panel,i=r.cellType,s=r.rows[o.range.row],l=(r.rows[o.range.row2],o.cell);if(i==t.grid.CellType.RowHeader&&t.toggleClass(l,"wj-group-header",0==o.range.row),i==t.grid.CellType.Cell||i==t.grid.CellType.RowHeader){var a=this._getGroupByRow(o.row);t.toggleClass(l,"wj-group-start",a._rowstart==o.range.row),t.toggleClass(l,"wj-group-end",a._rowstart+a._rowspan-1==o.range.row2)}n>1&&(i==t.grid.CellType.Cell||i==t.grid.CellType.ColumnHeader)&&(t.toggleClass(l,"wj-record-start",o.range.col%n==0),t.toggleClass(l,"wj-record-end",o.range.col2%n==n-1));var u=this.alternatingRowStep;if(u&&i==t.grid.CellType.Cell){var c=this._layout.totalRowSpan,p=this._layout._bindingGroups.length,g=Math.floor(s.dataIndex/c)*p,d=s.dataIndex%c,h=(g+=this._layout._getGroupIndexByRow(d)+1)%(u+1)==0;t.toggleClass(l,"wj-alt",h)}},n.prototype._sourceViewChanged=function(t,e){this.activeEditor||this.invalidate()},n.prototype._transposeItemsSource=function(e){var o=this,n=new t.collections.ObservableArray;return this._layout&&this._layout._bindingGroups.length&&(this._getRowInfo(e).forEach((function(t,r){var i=o._createKeys(e);if(o._supportsProxies()){var s=o._createProxy(e,t,i);n.push(s)}else{var l=o._createTransposedObject(e,t,i);n.push(l)}})),e instanceof t.collections.ObservableArray&&e.collectionChanged.addHandler((function(e,r){if(r.action===t.collections.NotifyCollectionChangedAction.Change)o.activeEditor||o.invalidate();else{var i=new t.collections.NotifyCollectionChangedEventArgs(t.collections.NotifyCollectionChangedAction.Reset);n.onCollectionChanged(i),o._rowInfoChanged()}}))),n},n.prototype._createKeys=function(t){var e=this,o=Array.apply(null,{length:this.columnsPerItem}),n=t.map((function(t,n){return o.map((function(t,o){return e._keyPrefix+n+"_"+o}))}));return[].concat.apply([],n)},n.prototype._supportsProxies=function(){return null!=window.Proxy},n.prototype._createProxy=function(e,o,n){var r={_arr:e,_rowInfo:o,_bnd:o.bindings.map((function(e){return new t.Binding(e)})),_keys:n};return new Proxy(r,{ownKeys:function(t){return t._keys},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0,writable:!0}},get:function(t,e){var o=t._keys.indexOf(e);if(o>-1){var n=t._bnd,r=t._arr,i=n.length,s=o%i,l=Math.floor(o/i);return n[s].getValue(r[l])}return t[e]},set:function(e,o,n){var r=e._keys.indexOf(o);if(r>-1){var i=e._bnd,s=e._arr,l=i.length,a=r%l,u=Math.floor(r/l);if(i[a].setValue(s[u],n),s instanceof t.collections.ObservableArray||s instanceof t.collections.CollectionView){var c=new t.collections.NotifyCollectionChangedEventArgs(t.collections.NotifyCollectionChangedAction.Change,s[u],u);s.onCollectionChanged(c)}return!0}return!1}})},n.prototype._createTransposedObject=function(e,o,n){for(var r={_arr:e,_rowInfo:o,_bnd:o.bindings.map((function(e){return new t.Binding(e)})),_keys:n},i=function(o){var i=n[o];Object.defineProperty(r,i,{enumerable:!0,get:function(){var t=r._bnd,n=t.length,i=o%n,s=Math.floor(o/n);return t[i].getValue(e[s])},set:function(n){var i=r._bnd,s=i.length,l=o%s,a=Math.floor(o/s);if(i[l].setValue(e[a],n),e instanceof t.collections.ObservableArray){var u=new t.collections.NotifyCollectionChangedEventArgs(t.collections.NotifyCollectionChangedAction.Change,e[a],a);e.onCollectionChanged(u)}return!0}})},s=0;s<n.length;s++)i(s);return r},n.prototype._getRowInfo=function(e){var o=[];if(this._layout){for(var n=this.rowHeaders.columns,r=this.columnsPerItem+1;n.length>r;)n.removeAt(n.length-1);for(;n.length<r;)n.push(new t.grid.Column);this._layout._bindingGroups.forEach((function(t){for(var e=0;e<t.rowspan;e++){for(var n={index:t._rowstart+e,bindings:[],headers:[]},r=0;r<t.colspan;r++)for(var i=0;i<t.cells.length;i++){var s=t.cells[i];if(e>=s.row&&e<s.row+s.rowspan&&r>=s.col&&r<s.col+s.colspan){n.bindings.push(s.binding),n.headers.push(s.header);break}}o.push(n)}}))}return o},n}(t.grid.FlexGrid);e.TransposedMultiRow=o}((e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}))}(wijmo||(wijmo={})),function(t){var e;(e=t.grid||(t.grid={})).transposedmultirow||(e.transposedmultirow={}),t._registerModule("wijmo.grid.transposedmultirow",t.grid.transposedmultirow)}(wijmo||(wijmo={}));