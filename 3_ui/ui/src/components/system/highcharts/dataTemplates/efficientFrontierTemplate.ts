import {Evaluation, IO, RiskMeasure} from '../../../../stores/io';
import {findOption} from '../../IO/internal/inputs/utility';
import {HighchartDataTemplate, mergeWithUserOptions, getMarkerObject} from './highchartDataTemplate'
import type {ChartUserOptions, PointStyle} from 'stores';
import {OptimizationTarget} from '../../../../stores/io/models';

export function getHighchartsEfficientFrontierObject(io: IO, userOptions: ChartUserOptions) {
	console.time("template");
	const assetAllocation = e => e.assetAllocation && io.allocationsAtLevel(userOptions.assetGroupLevel, e.assetAllocation);

	// const ifpoints = io.inefficientEvaluations.filter(i => i.risk != null && i.reward != null)
	const directionpoints = userOptions.showDirectionPoints ? getSeriesData(io, userOptions, "directionSeries") : [];
	const distancepoints = userOptions.showDistancePoints ? getSeriesData(io, userOptions, "distanceSeries") : [];
	const historicalPoints = userOptions.showHistoricalPoints ? getSeriesData(io, userOptions, "historicalSeries") : [];
	const randompoints = userOptions.showRandomPoints ? getSeriesData(io, userOptions, "randomSeries") : [];
	const efpoints = io.frontierPointEvaluations.map((e, i) => ({x: e.risk, y: e.reward, name: e.name, connAssetAllocation: assetAllocation(e), connEvalIndex: e.evaluationNumber})).filter(e => e.x != null);
	const fefpoints = (userOptions.showFullFrontier || userOptions.showFrontierLine) ? getSeriesData(io, userOptions, "fullFrontierSeries") : [];
	const lpoints = io.lambdaEvaluations.filter(l => l.risk != null).map((l, i) => {
		return {x: l.risk, y: l.reward, name: l.name, connAssetAllocation: assetAllocation(l), connEvalIndex: l.evaluationNumber}
	});
	const frontierPoints = (userOptions.showEfficientFrontier ? efpoints : lpoints).filter(e => e.connAssetAllocation != null);
	const additionalPoints = io.additionalPointEvaluations.map((e, i) => ({x: e.risk, y: e.reward, name: e.name, connAssetAllocation: assetAllocation(e), legendName: io.additionalPoints[i].name,connEvalIndex: e.evaluationNumber, displayName: e.displayName, groupName: e.groupName, groupColor: e.groupColor }));
	const groupedAdditionalPoints = additionalPoints.reduce((accu, point) => {
		const { groupName, groupColor } = point;
		if (groupColor) {
			accu[groupColor] = accu[groupColor] || {	// set default data if empty
				groupName,
				data: []
			};
			accu[groupColor].data.push(point);
		}

		return accu;
	}, {});

	const iterationPoints = (userOptions.showIterationPoints || userOptions.showIterationLines) ? getSeriesData(io, userOptions, "iterationSeries") : io.iterationEvaluations.map(l => []);
	const assets = io.assetGroups(userOptions.assetGroupLevel);

	const allocations = frontierPoints.concat(additionalPoints).map(p => p.connAssetAllocation).filter(p => p != null);
	//const maxAssetLength = _.max(assets.map(a => a.name.length));

	let assetSeries = assets.map((a, i) => {
		// Remove assets not in play when we have at least 1 point. Subsequent to that render all assets so legend can be correctly positioned.
		const showInLegend = allocations.length == 0 || allocations.find((d) => d[i] != 0) != null;

		return {data: [], showInLegend, visible: showInLegend,  name: a.name /*+ (showInLegend ? spaceFiller(maxAssetLength - a.name.length) : "")*/, color: a.color, type: "columnrange"};
	})
	// Efficient points and additional points are similar except that efficient points are connected with a line. Therefore they need to be separate series.
	const donutSeries = [generateUnderlyingDonutSeries(userOptions.showEfficientFrontier ? efpoints : userOptions.showLambdaPoints ? lpoints : [], false, userOptions),
							generateUnderlyingDonutSeries(userOptions.showAdditionalPoints ? additionalPoints : [], true, userOptions)];
	const groupedAdditionalPointsLineSeries = generateGroupedAdditionalPointsLineSeries(groupedAdditionalPoints, userOptions);

	const fullFrontierLine = generateLineSeries(fefpoints, "fullFrontierSeries", userOptions.fullFrontierPointStyle, "rgb(0,0,0)", 2, userOptions.showFullFrontier, userOptions.showFrontierLine)
	const iterationLines = iterationPoints.map(l => generateLineSeries(l, "iterationSeries", userOptions.iterationPointStyle, "rgb(0,192,0)", 2, userOptions.showIterationPoints, userOptions.showIterationLines))
	const titlePrefix =  io.relativeEvaluationIndex != null ? "Change in " : "";

	const directionSeries = generateInefficientSeries(directionpoints, "directionSeries", userOptions.directionPointStyle, userOptions.showDirectionPoints);
	const distanceSeries = generateInefficientSeries(distancepoints , "distanceSeries", userOptions.distancePointStyle, userOptions.showDistancePoints);
	const historicalSeries = generateInefficientSeries(historicalPoints , "historicalSeries", userOptions.historicalPointStyle, userOptions.showHistoricalPoints);
	const randomSeries = generateInefficientSeries(randompoints, "randomSeries", userOptions.randomPointStyle, userOptions.showRandomPoints);

	const optimizationTarget = io.optimizationInputs.optimizationTarget;
	const riskStatistic = findOption(io.inputOptions.optimizationTarget, ["riskMeasure", "statistic"]).options.find(o => o.name == optimizationTarget.riskMeasure.statistic).title;
	const rewardStatistic = findOption(io.inputOptions.optimizationTarget, ["rewardMeasure", "statistic"]).options.find(o => o.name == optimizationTarget.rewardMeasure.statistic).title;

	let result = {
        chart: {
            type: "scatter",
	        inverted: userOptions.isInverted,
	        //animation: false,
        },
		title: {text: "Risk vs. Reward"},
		assets,
		boost:{
			allowForce:false
		},
        plotOptions: {
            series: {
                //marker: {enabled: true}
	            stickyTracking: false, // Note: No effect on boosted series
	            states: {
		            inactive: {
			            opacity: 1
		            }
	            }
	            //animationDuration: 0,
            }
        },
		legend: {
			enabled: true,
			itemMarginTop: 6
		},
        xAxis: [{
	        title: {text: `${titlePrefix}Risk (${getStatisticTitle(io, optimizationTarget, riskStatistic, true)})`},
	        gridLineWidth: 1
        }],
        yAxis: [{
            title: {text: `${titlePrefix}Reward (${getStatisticTitle(io, optimizationTarget, rewardStatistic, false)})`}
        }],
        series: [randomSeries, directionSeries, distanceSeries, historicalSeries,
		  		...iterationLines, fullFrontierLine, ...donutSeries,
	            ...assetSeries, ...groupedAdditionalPointsLineSeries ].map((s, i) => ({...s, index: i}))
    }

    if (io.relativeEvaluationIndex != null) {
	    const relativePoint = io.evaluations[io.relativeEvaluationIndex];
	    result.series.forEach(s => (s.data as [{x: number, y: number}]).forEach(d => {
		    d.x -= relativePoint.risk;
		    d.y -= relativePoint.reward;
	    }))
    }

    if (userOptions.horizontalAxisDirection == null) {
    	userOptions = {...userOptions, horizontalAxisDirection: io.horizontalAxisDirectionDefault};
    }

	let res = mergeWithUserOptions(_.merge(new HighchartDataTemplate(userOptions), result), userOptions.highchartsOptions);

	console.timeEnd("template");
	return res;
}

export function getStatisticTitle(io: IO, optimizationTarget: OptimizationTarget, title: string, isRisk: boolean) {
	let measure = isRisk ? optimizationTarget.riskMeasure : optimizationTarget.rewardMeasure;
	let statistic = measure.statistic;
	if (statistic !='percentile' && statistic !='cte' && statistic != 'semistdev') {
		return title;
	} else {
		let percentile = measure.percentile;
		let area = measure.area;
		if (isRisk && statistic == 'semistdev') {
			let riskMeasure = measure as RiskMeasure;
			if (riskMeasure.thresholdType == 'percentile') {
				return getPercentile(percentile, statistic, area, title);
			} else {
				let thresholdType = findOption(io.inputOptions.optimizationTarget, ['riskMeasure', "thresholdType"]).options.find(o => o.name == riskMeasure.thresholdType).title;
				if(riskMeasure.thresholdType == 'fixed'){
					thresholdType = `${thresholdType} ${riskMeasure.fixedThreshold}`;
				}
				return `${title} ${measure.area} ${thresholdType}`;
			}
		} else {
			return getPercentile(percentile, statistic, area, title);
		}
	}
}

function getPercentile (percentile :number, statistic: string, area: string, title: string){
	percentile = percentile * 100;
	let strPercentile = percentile.toString();
	let ordinal = strPercentile.indexOf('.') == -1 ? (["st","nd","rd"][((percentile+90)%100-10)%10-1] || "th") : "th";
	strPercentile = `${strPercentile}${ordinal} Percentile`;
	if (statistic == 'cte' || statistic == 'semistdev') {
		strPercentile = `${title} ${area} ${strPercentile}`;
	}
	return strPercentile;
}

function spaceFiller(numSpace) {
	return numSpace > 0 ? `<span style="font-size:16px; color:#ffffff">${_.range(numSpace).map(_ => "_").join("")}</span>` : "";
}

function generateGroupedAdditionalPointsLineSeries(additionalAllocationGroups, userOptions) {
	const isShowAdditionalPointsGroups = userOptions.showAdditionalPoints && userOptions.showGroupAdditionalPoints;
	return Object.keys(additionalAllocationGroups).map((groupColor)=> {
		const { groupName, data } = additionalAllocationGroups[groupColor];
		const minX = Math.min(..._.map(data, d => d.x));
		const maxX = Math.max(..._.map(data, d => d.x));
		const calPointX = ((maxX - minX ) / 2) + minX;

		const seriesData = _.sortBy(data, d => {
			let angle = (d.x == calPointX) ? 90 : (Math.atan(d.y / (calPointX - d.x)) * 180 / Math.PI);
			(angle < 0) && (angle += 180);
			return angle;
		})

		return {
			type: 'line',
			animation: false,
			data: seriesData,
			name: groupName,
			connIsGroupedAdditionalPointLineSeries: true,
			color: groupColor,
			zIndex: 0,
			marker: {
				enabled: true,
				symbol: 'circle',
				radius: parseFloat(_.get(userOptions, "highchartsOptions.plotOptions.series.dataLabels.style.fontSize", 11)),
			},
			dataLabels: {
				enabled: false
			},
			showInLegend: isShowAdditionalPointsGroups,
			visible: isShowAdditionalPointsGroups,
			lineWidth: 2
		};
	});
}

export function transferShowAdditionalPointsGroup(additionalPoints, isShowGroup) {
	return additionalPoints.map((point)=> {
		const options = point.options || point; // first time, options is undefined
		const { groupColor = 'rgb(255, 255, 255)' } = options;

		return {
			...options,
			marker: {
				fillColor: (isShowGroup && groupColor) ? groupColor : 'rgb(255, 255, 255)',
			},
			dataLabels: {
				format: (isShowGroup && groupColor) ? '' : '{point.name}'
			}
		}
	});
}

function generateUnderlyingDonutSeries(data, isAddtionalPointSeries, userOptions) {
	const isShowAdditionalPointsGroups = userOptions.showAdditionalPoints && userOptions.showGroupAdditionalPoints;

	return {
		type: "scatter",
		lineWidth: 0,
		connIsAdditionalPointSeries: isAddtionalPointSeries,
		data: isAddtionalPointSeries ? transferShowAdditionalPointsGroup(data, isShowAdditionalPointsGroups) : data,
		color: "rgb(0, 73, 144)",
		boostThreshold: 0,
		name: "underlyingDonutSeries",
		zIndex: 1,
		marker: {
			symbol: "circle",
			//symbol: "url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSI1MCIgd2lkdGg9IjUwIiB2aWV3Qm94PSI2MCAxMDAwIDUwIDUwIj4NCiAgICA8ZyBkYXRhLXotaW5kZXg9IjIiIGNsYXNzPSJoaWdoY2hhcnRzLXNlcmllcyBoaWdoY2hhcnRzLXNlcmllcy0zMSBoaWdoY2hhcnRzLXBpZS1zZXJpZXMgIGhpZ2hjaGFydHMtdHJhY2tlciIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzQsNDYpIHNjYWxlKDEgMSkiIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjsiPjxwYXRoIGZpbGw9InJnYigyMDQuMTIxMjEyMTIxMjEyMTIsIDguODE4MTgxODE4MTgxODE4LCAzMi4wNjA2MDYwNjA2MDYwNikiIGQ9Ik0gOC42NDE5NjY5OTM0MzcwMjIgOTU4LjEzNjM2NDE1NDg5ODMgQSAyNSAyNSAwIDAgMSAxMy4zMTQ0MTkzNjcwNzgyOSA5NTguNTc1OTEyNzk0NDgxMiBMIDEwLjUxNDAwMzA0MDk0ODk1NyA5NzMuMzEyMTgzMjk5NjEwNiBBIDEwIDEwIDAgMCAwIDguNjQ1MDIyMDkxNDkyNDQ4IDk3My4xMzYzNjM4NDM3Nzc1IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTAgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigyMDAuMjQyNDI0MjQyNDI0MjUsIDE1LjYzNjM2MzYzNjM2MzYzNywgMzcuMTIxMjEyMTIxMjEyMTI1KSIgZD0iTSAxMy4zMzg5Nzc0ODAxNDY2ODUgOTU4LjU4MDU5MjQzNDQ3MTIgQSAyNSAyNSAwIDAgMSAxMy4zMTQ0MTkzNjcwNzgyOSA5NTguNTc1OTEyNzk0NDgxMiBMIDEwLjUxNDAwMzA0MDk0ODk1NyA5NzMuMzEyMTgzMjk5NjEwNiBBIDEwIDEwIDAgMCAwIDEwLjUyMzgyNjI4NjE3NjMxNCA5NzMuMzE0MDU1MTU1NjA2NiBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0xICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTk4LjMwMzAzMDMwMzAzMDMsIDE5LjA0NTQ1NDU0NTQ1NDU0NywgMzkuNjUxNTE1MTUxNTE1MTU2KSIgZD0iTSAxMy4zMzg5Nzc0ODAxNDY2ODUgOTU4LjU4MDU5MjQzNDQ3MTIgQSAyNSAyNSAwIDAgMSAxMy4zMTQ0MTkzNjcwNzgyOSA5NTguNTc1OTEyNzk0NDgxMiBMIDEwLjUxNDAwMzA0MDk0ODk1NyA5NzMuMzEyMTgzMjk5NjEwNiBBIDEwIDEwIDAgMCAwIDEwLjUyMzgyNjI4NjE3NjMxNCA5NzMuMzE0MDU1MTU1NjA2NiBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0yICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTk2LjM2MzYzNjM2MzYzNjM3LCAyMi40NTQ1NDU0NTQ1NDU0NTMsIDQyLjE4MTgxODE4MTgxODE4KSIgZD0iTSAxMy4zMzg5Nzc0ODAxNDY2ODUgOTU4LjU4MDU5MjQzNDQ3MTIgQSAyNSAyNSAwIDAgMSAxMy4zMTQ0MTkzNjcwNzgyOSA5NTguNTc1OTEyNzk0NDgxMiBMIDEwLjUxNDAwMzA0MDk0ODk1NyA5NzMuMzEyMTgzMjk5NjEwNiBBIDEwIDEwIDAgMCAwIDEwLjUyMzgyNjI4NjE3NjMxNCA5NzMuMzE0MDU1MTU1NjA2NiBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0zICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTk0LjQyNDI0MjQyNDI0MjQ0LCAyNS44NjM2MzYzNjM2MzYzNjMsIDQ0LjcxMjEyMTIxMjEyMTIxKSIgZD0iTSAxMy4zMzg5Nzc0ODAxNDY2ODUgOTU4LjU4MDU5MjQzNDQ3MTIgQSAyNSAyNSAwIDAgMSAxMy4zMTQ0MTkzNjcwNzgyOSA5NTguNTc1OTEyNzk0NDgxMiBMIDEwLjUxNDAwMzA0MDk0ODk1NyA5NzMuMzEyMTgzMjk5NjEwNiBBIDEwIDEwIDAgMCAwIDEwLjUyMzgyNjI4NjE3NjMxNCA5NzMuMzE0MDU1MTU1NjA2NiBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci00ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTkwLjU0NTQ1NDU0NTQ1NDU2LCAzMi42ODE4MTgxODE4MTgxOSwgNDkuNzcyNzI3MjcyNzI3MjcpIiBkPSJNIDEzLjMzODk3NzQ4MDE0NjY4NSA5NTguNTgwNTkyNDM0NDcxMiBBIDI1IDI1IDAgMCAxIDEzLjMxNDQxOTM2NzA3ODI5IDk1OC41NzU5MTI3OTQ0ODEyIEwgMTAuNTE0MDAzMDQwOTQ4OTU3IDk3My4zMTIxODMyOTk2MTA2IEEgMTAgMTAgMCAwIDAgMTAuNTIzODI2Mjg2MTc2MzE0IDk3My4zMTQwNTUxNTU2MDY2IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTUgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxODguNjA2MDYwNjA2MDYwNiwgMzYuMDkwOTA5MDkwOTA5MDksIDUyLjMwMzAzMDMwMzAzMDMwNSkiIGQ9Ik0gMTMuMzM4OTc3NDgwMTQ2Njg1IDk1OC41ODA1OTI0MzQ0NzEyIEEgMjUgMjUgMCAwIDEgMTMuMzE0NDE5MzY3MDc4MjkgOTU4LjU3NTkxMjc5NDQ4MTIgTCAxMC41MTQwMDMwNDA5NDg5NTcgOTczLjMxMjE4MzI5OTYxMDYgQSAxMCAxMCAwIDAgMCAxMC41MjM4MjYyODYxNzYzMTQgOTczLjMxNDA1NTE1NTYwNjYgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNiAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE4Ni42NjY2NjY2NjY2NjY2NiwgMzkuNSwgNTQuODMzMzMzMzMzMzMzMzMpIiBkPSJNIDEzLjMzODk3NzQ4MDE0NjY4NSA5NTguNTgwNTkyNDM0NDcxMiBBIDI1IDI1IDAgMCAxIDMyLjQzMjQxMTU2OTgxMTggOTkwLjgzNDIyMDEzODk4MjggTCAxOC4xNjExOTk5MjIwNDIzNiA5ODYuMjE1NTA2MjM3NDExMyBBIDEwIDEwIDAgMCAwIDEwLjUyMzgyNjI4NjE3NjMxNCA5NzMuMzE0MDU1MTU1NjA2NiBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci03ICAgICAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE4NC43MjcyNzI3MjcyNzI3MiwgNDIuOTA5MDkwOTA5MDkwOTEsIDU3LjM2MzYzNjM2MzYzNjM2KSIgZD0iTSAzMi40MjQ3MDE4MjE5MTY3OCA5OTAuODU4MDAxNjM4ODM3IEEgMjUgMjUgMCAwIDEgMzIuNDMyNDExNTY5ODExOCA5OTAuODM0MjIwMTM4OTgyOCBMIDE4LjE2MTE5OTkyMjA0MjM2IDk4Ni4yMTU1MDYyMzc0MTEzIEEgMTAgMTAgMCAwIDAgMTguMTU4MTE2MDIyODg0MzUgOTg2LjIyNTAxODgzNzM1MyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci04ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTgyLjc4Nzg3ODc4Nzg3ODc4LCA0Ni4zMTgxODE4MTgxODE4MiwgNTkuODkzOTM5MzkzOTM5MzkpIiBkPSJNIDMyLjQyNDcwMTgyMTkxNjc4IDk5MC44NTgwMDE2Mzg4MzcgQSAyNSAyNSAwIDAgMSAzMi40MzI0MTE1Njk4MTE4IDk5MC44MzQyMjAxMzg5ODI4IEwgMTguMTYxMTk5OTIyMDQyMzYgOTg2LjIxNTUwNjIzNzQxMTMgQSAxMCAxMCAwIDAgMCAxOC4xNTgxMTYwMjI4ODQzNSA5ODYuMjI1MDE4ODM3MzUzIFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTkgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxODAuODQ4NDg0ODQ4NDg0ODQsIDQ5LjcyNzI3MjcyNzI3MjczLCA2Mi40MjQyNDI0MjQyNDI0MikiIGQ9Ik0gMzIuNDI0NzAxODIxOTE2NzggOTkwLjg1ODAwMTYzODgzNyBBIDI1IDI1IDAgMCAxIDE5LjMxMzU1NDAyMTc4MzMzMiAxMDA1Ljc0NjY2ODM3MDgzNDMgTCAxMi45MTM2NTY5MDI4MzA5NzIgOTkyLjE4MDQ4NTUzMDE1MTkgQSAxMCAxMCAwIDAgMCAxOC4xNTgxMTYwMjI4ODQzNSA5ODYuMjI1MDE4ODM3MzUzIFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTAgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxNzYuOTY5Njk2OTY5Njk2OTcsIDU2LjU0NTQ1NDU0NTQ1NDU1LCA2Ny40ODQ4NDg0ODQ4NDg0OCkiIGQ9Ik0gMTkuMjkwOTM4Mzg3NTcwMDk0IDEwMDUuNzU3MzIzNTU5MTAzNCBBIDI1IDI1IDAgMCAxIDE5LjMxMzU1NDAyMTc4MzMzMiAxMDA1Ljc0NjY2ODM3MDgzNDMgTCAxMi45MTM2NTY5MDI4MzA5NzIgOTkyLjE4MDQ4NTUzMDE1MTkgQSAxMCAxMCAwIDAgMCAxMi45MDQ2MTA2NDkxNDU2NzggOTkyLjE4NDc0NzYwNTQ1OTUgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE3NS4wMzAzMDMwMzAzMDMwMywgNTkuOTU0NTQ1NDU0NTQ1NDUsIDcwLjAxNTE1MTUxNTE1MTUyKSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0yICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTczLjA5MDkwOTA5MDkwOTEsIDYzLjM2MzYzNjM2MzYzNjM3LCA3Mi41NDU0NTQ1NDU0NTQ1NSkiIGQ9Ik0gMTkuMjkwOTM4Mzg3NTcwMDk0IDEwMDUuNzU3MzIzNTU5MTAzNCBBIDI1IDI1IDAgMCAxIDE5LjMxMzU1NDAyMTc4MzMzMiAxMDA1Ljc0NjY2ODM3MDgzNDMgTCAxMi45MTM2NTY5MDI4MzA5NzIgOTkyLjE4MDQ4NTUzMDE1MTkgQSAxMCAxMCAwIDAgMCAxMi45MDQ2MTA2NDkxNDU2NzggOTkyLjE4NDc0NzYwNTQ1OTUgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMyAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE3MS4xNTE1MTUxNTE1MTUxNiwgNjYuNzcyNzI3MjcyNzI3MjcsIDc1LjA3NTc1NzU3NTc1NzU4KSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci00ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTY5LjIxMjEyMTIxMjEyMTIyLCA3MC4xODE4MTgxODE4MTgxOSwgNzcuNjA2MDYwNjA2MDYwNjEpIiBkPSJNIDE5LjI5MDkzODM4NzU3MDA5NCAxMDA1Ljc1NzMyMzU1OTEwMzQgQSAyNSAyNSAwIDAgMSAxOS4zMTM1NTQwMjE3ODMzMzIgMTAwNS43NDY2NjgzNzA4MzQzIEwgMTIuOTEzNjU2OTAyODMwOTcyIDk5Mi4xODA0ODU1MzAxNTE5IEEgMTAgMTAgMCAwIDAgMTIuOTA0NjEwNjQ5MTQ1Njc4IDk5Mi4xODQ3NDc2MDU0NTk1IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTUgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxNjcuMjcyNzI3MjcyNzI3MjgsIDczLjU5MDkwOTA5MDkwOTEsIDgwLjEzNjM2MzYzNjM2MzYzKSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci02ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTYzLjM5MzkzOTM5MzkzOTM4LCA4MC40MDkwOTA5MDkwOTA5LCA4NS4xOTY5Njk2OTY5Njk2OSkiIGQ9Ik0gMTkuMjkwOTM4Mzg3NTcwMDk0IDEwMDUuNzU3MzIzNTU5MTAzNCBBIDI1IDI1IDAgMCAxIDE5LjMxMzU1NDAyMTc4MzMzMiAxMDA1Ljc0NjY2ODM3MDgzNDMgTCAxMi45MTM2NTY5MDI4MzA5NzIgOTkyLjE4MDQ4NTUzMDE1MTkgQSAxMCAxMCAwIDAgMCAxMi45MDQ2MTA2NDkxNDU2NzggOTkyLjE4NDc0NzYwNTQ1OTUgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNyAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE2MS40NTQ1NDU0NTQ1NDU0NCwgODMuODE4MTgxODE4MTgxODEsIDg3LjcyNzI3MjcyNzI3MjcyKSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci04ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTU5LjUxNTE1MTUxNTE1MTUsIDg3LjIyNzI3MjcyNzI3MjczLCA5MC4yNTc1NzU3NTc1NzU3NSkiIGQ9Ik0gMTkuMjkwOTM4Mzg3NTcwMDk0IDEwMDUuNzU3MzIzNTU5MTAzNCBBIDI1IDI1IDAgMCAxIDE5LjMxMzU1NDAyMTc4MzMzMiAxMDA1Ljc0NjY2ODM3MDgzNDMgTCAxMi45MTM2NTY5MDI4MzA5NzIgOTkyLjE4MDQ4NTUzMDE1MTkgQSAxMCAxMCAwIDAgMCAxMi45MDQ2MTA2NDkxNDU2NzggOTkyLjE4NDc0NzYwNTQ1OTUgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItOSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE1Ny41NzU3NTc1NzU3NTc1NiwgOTAuNjM2MzYzNjM2MzYzNjQsIDkyLjc4Nzg3ODc4Nzg3ODc4KSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0wICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTU1LjYzNjM2MzYzNjM2MzYzLCA5NC4wNDU0NTQ1NDU0NTQ1NSwgOTUuMzE4MTgxODE4MTgxODEpIiBkPSJNIDE5LjI5MDkzODM4NzU3MDA5NCAxMDA1Ljc1NzMyMzU1OTEwMzQgQSAyNSAyNSAwIDAgMSAxOS4zMTM1NTQwMjE3ODMzMzIgMTAwNS43NDY2NjgzNzA4MzQzIEwgMTIuOTEzNjU2OTAyODMwOTcyIDk5Mi4xODA0ODU1MzAxNTE5IEEgMTAgMTAgMCAwIDAgMTIuOTA0NjEwNjQ5MTQ1Njc4IDk5Mi4xODQ3NDc2MDU0NTk1IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTEgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxNTMuNjk2OTY5Njk2OTY5NywgOTcuNDU0NTQ1NDU0NTQ1NDUsIDk3Ljg0ODQ4NDg0ODQ4NDg0KSIgZD0iTSAxOS4yOTA5MzgzODc1NzAwOTQgMTAwNS43NTczMjM1NTkxMDM0IEEgMjUgMjUgMCAwIDEgMTkuMzEzNTU0MDIxNzgzMzMyIDEwMDUuNzQ2NjY4MzcwODM0MyBMIDEyLjkxMzY1NjkwMjgzMDk3MiA5OTIuMTgwNDg1NTMwMTUxOSBBIDEwIDEwIDAgMCAwIDEyLjkwNDYxMDY0OTE0NTY3OCA5OTIuMTg0NzQ3NjA1NDU5NSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0yICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTUxLjc1NzU3NTc1NzU3NTc1LCAxMDAuODYzNjM2MzYzNjM2MzYsIDEwMC4zNzg3ODc4Nzg3ODc4OCkiIGQ9Ik0gMTkuMjkwOTM4Mzg3NTcwMDk0IDEwMDUuNzU3MzIzNTU5MTAzNCBBIDI1IDI1IDAgMCAxIC0xNC41OTE4MTMxMjIwNDU1MzggOTkyLjM1MzQ1ODExODc0NjQgTCAtMC42NDg0ODk5NTQ3MDA1NzQyIDk4Ni44MjMyMDE0MjkzMTY3IEEgMTAgMTAgMCAwIDAgMTIuOTA0NjEwNjQ5MTQ1Njc4IDk5Mi4xODQ3NDc2MDU0NTk1IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTMgICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTQ5LjgxODE4MTgxODE4MTgsIDEwNC4yNzI3MjcyNzI3MjcyNywgMTAyLjkwOTA5MDkwOTA5MDkpIiBkPSJNIC0xNC42MDEwMTg1OTU1NTY3MzMgOTkyLjMzMDIxNDY0MjEyNzEgQSAyNSAyNSAwIDAgMSAtMTQuNTkxODEzMTIyMDQ1NTM4IDk5Mi4zNTM0NTgxMTg3NDY0IEwgLTAuNjQ4NDg5OTU0NzAwNTc0MiA5ODYuODIzMjAxNDI5MzE2NyBBIDEwIDEwIDAgMCAwIC0wLjY1MjE3MjE0NDEwNTA1MzQgOTg2LjgxMzkwNDAzODY2OSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci00ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTQ3Ljg3ODc4Nzg3ODc4Nzg4LCAxMDcuNjgxODE4MTgxODE4MTksIDEwNS40MzkzOTM5MzkzOTM5NCkiIGQ9Ik0gLTE0LjYwMTAxODU5NTU1NjczMyA5OTIuMzMwMjE0NjQyMTI3MSBBIDI1IDI1IDAgMCAxIC0xNC41OTE4MTMxMjIwNDU1MzggOTkyLjM1MzQ1ODExODc0NjQgTCAtMC42NDg0ODk5NTQ3MDA1NzQyIDk4Ni44MjMyMDE0MjkzMTY3IEEgMTAgMTAgMCAwIDAgLTAuNjUyMTcyMTQ0MTA1MDUzNCA5ODYuODEzOTA0MDM4NjY5IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTUgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxNDUuOTM5MzkzOTM5MzkzOTQsIDExMS4wOTA5MDkwOTA5MDkxLCAxMDcuOTY5Njk2OTY5Njk2OTcpIiBkPSJNIC0xNC42MDEwMTg1OTU1NTY3MzMgOTkyLjMzMDIxNDY0MjEyNzEgQSAyNSAyNSAwIDAgMSAtMTQuNTkxODEzMTIyMDQ1NTM4IDk5Mi4zNTM0NTgxMTg3NDY0IEwgLTAuNjQ4NDg5OTU0NzAwNTc0MiA5ODYuODIzMjAxNDI5MzE2NyBBIDEwIDEwIDAgMCAwIC0wLjY1MjE3MjE0NDEwNTA1MzQgOTg2LjgxMzkwNDAzODY2OSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci02ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTQ0LCAxMTQuNSwgMTEwLjUpIiBkPSJNIC0xNC42MDEwMTg1OTU1NTY3MzMgOTkyLjMzMDIxNDY0MjEyNzEgQSAyNSAyNSAwIDAgMSAtMTQuNTkxODEzMTIyMDQ1NTM4IDk5Mi4zNTM0NTgxMTg3NDY0IEwgLTAuNjQ4NDg5OTU0NzAwNTc0MiA5ODYuODIzMjAxNDI5MzE2NyBBIDEwIDEwIDAgMCAwIC0wLjY1MjE3MjE0NDEwNTA1MzQgOTg2LjgxMzkwNDAzODY2OSBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci03ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTQyLjA2MDYwNjA2MDYwNjA2LCAxMTcuOTA5MDkwOTA5MDkwOSwgMTEzLjAzMDMwMzAzMDMwMzAzKSIgZD0iTSAtMTQuNjAxMDE4NTk1NTU2NzMzIDk5Mi4zMzAyMTQ2NDIxMjcxIEEgMjUgMjUgMCAwIDEgLTE0LjU5MTgxMzEyMjA0NTUzOCA5OTIuMzUzNDU4MTE4NzQ2NCBMIC0wLjY0ODQ4OTk1NDcwMDU3NDIgOTg2LjgyMzIwMTQyOTMxNjcgQSAxMCAxMCAwIDAgMCAtMC42NTIxNzIxNDQxMDUwNTM0IDk4Ni44MTM5MDQwMzg2NjkgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItOCAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDE0MC4xMjEyMTIxMjEyMTIxMiwgMTIxLjMxODE4MTgxODE4MTgxLCAxMTUuNTYwNjA2MDYwNjA2MDYpIiBkPSJNIC0xNC42MDEwMTg1OTU1NTY3MzMgOTkyLjMzMDIxNDY0MjEyNzEgQSAyNSAyNSAwIDAgMSAtMTYuMTUyODg3MzA4MzM1OTU2IDk4Ni4yOTI3MzM2ODA2NjcyIEwgLTEuMjcyOTE5NjI5MjE2NzQwOCA5ODQuMzk4OTExNjU0MDg1IEEgMTAgMTAgMCAwIDAgLTAuNjUyMTcyMTQ0MTA1MDUzNCA5ODYuODEzOTA0MDM4NjY5IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTkgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMzguMTgxODE4MTgxODE4MiwgMTI0LjcyNzI3MjcyNzI3MjczLCAxMTguMDkwOTA5MDkwOTA5MSkiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTAgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMzYuMjQyNDI0MjQyNDI0MjUsIDEyOC4xMzYzNjM2MzYzNjM2MywgMTIwLjYyMTIxMjEyMTIxMjEyKSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgLTE2LjE1Mjg4NzMwODMzNTk1NiA5ODYuMjkyNzMzNjgwNjY3MiBMIC0xLjI3MjkxOTYyOTIxNjc0MDggOTg0LjM5ODkxMTY1NDA4NSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDEzNC4zMDMwMzAzMDMwMzAzLCAxMzEuNTQ1NDU0NTQ1NDU0NTMsIDEyMy4xNTE1MTUxNTE1MTUxNikiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTIgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMzIuMzYzNjM2MzYzNjM2MzcsIDEzNC45NTQ1NDU0NTQ1NDU0NywgMTI1LjY4MTgxODE4MTgxODE5KSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgLTE2LjE1Mjg4NzMwODMzNTk1NiA5ODYuMjkyNzMzNjgwNjY3MiBMIC0xLjI3MjkxOTYyOTIxNjc0MDggOTg0LjM5ODkxMTY1NDA4NSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMyAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDEzMC40MjQyNDI0MjQyNDI0NCwgMTM4LjM2MzYzNjM2MzYzNjM3LCAxMjguMjEyMTIxMjEyMTIxMjIpIiBkPSJNIC0xNi4xNTYwMzEyNzc4ODIxNjQgOTg2LjI2NzkzMjE2MDQ4MzcgQSAyNSAyNSAwIDAgMSAtMTYuMTUyODg3MzA4MzM1OTU2IDk4Ni4yOTI3MzM2ODA2NjcyIEwgLTEuMjcyOTE5NjI5MjE2NzQwOCA5ODQuMzk4OTExNjU0MDg1IEEgMTAgMTAgMCAwIDAgLTEuMjc0MTc3MjE3MDM1MjI1MiA5ODQuMzg4OTkxMDQ2MDExNyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci00ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTI4LjQ4NDg0ODQ4NDg0ODUsIDE0MS43NzI3MjcyNzI3MjcyOCwgMTMwLjc0MjQyNDI0MjQyNDI1KSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgLTE2LjE1Mjg4NzMwODMzNTk1NiA5ODYuMjkyNzMzNjgwNjY3MiBMIC0xLjI3MjkxOTYyOTIxNjc0MDggOTg0LjM5ODkxMTY1NDA4NSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDEyNi41NDU0NTQ1NDU0NTQ1NSwgMTQ1LjE4MTgxODE4MTgxODIsIDEzMy4yNzI3MjcyNzI3MjcyNSkiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTYgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMjQuNjA2MDYwNjA2MDYwNjEsIDE0OC41OTA5MDkwOTA5MDkxLCAxMzUuODAzMDMwMzAzMDMwMykiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTcgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMjIuNjY2NjY2NjY2NjY2NjcsIDE1MiwgMTM4LjMzMzMzMzMzMzMzMzMxKSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgLTE2LjE1Mjg4NzMwODMzNTk1NiA5ODYuMjkyNzMzNjgwNjY3MiBMIC0xLjI3MjkxOTYyOTIxNjc0MDggOTg0LjM5ODkxMTY1NDA4NSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItOCAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDEyMC43MjcyNzI3MjcyNzI3MywgMTU1LjQwOTA5MDkwOTA5MDksIDE0MC44NjM2MzYzNjM2MzYzNykiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTkgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMTguNzg3ODc4Nzg3ODc4NzgsIDE1OC44MTgxODE4MTgxODE4LCAxNDMuMzkzOTM5MzkzOTM5MzgpIiBkPSJNIC0xNi4xNTYwMzEyNzc4ODIxNjQgOTg2LjI2NzkzMjE2MDQ4MzcgQSAyNSAyNSAwIDAgMSAtMTYuMTUyODg3MzA4MzM1OTU2IDk4Ni4yOTI3MzM2ODA2NjcyIEwgLTEuMjcyOTE5NjI5MjE2NzQwOCA5ODQuMzk4OTExNjU0MDg1IEEgMTAgMTAgMCAwIDAgLTEuMjc0MTc3MjE3MDM1MjI1MiA5ODQuMzg4OTkxMDQ2MDExNyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0wICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTE0LjkwOTA5MDkwOTA5MDksIDE2NS42MzYzNjM2MzYzNjM2MywgMTQ4LjQ1NDU0NTQ1NDU0NTQ0KSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgLTE2LjE1Mjg4NzMwODMzNTk1NiA5ODYuMjkyNzMzNjgwNjY3MiBMIC0xLjI3MjkxOTYyOTIxNjc0MDggOTg0LjM5ODkxMTY1NDA4NSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDExMi45Njk2OTY5Njk2OTY5NywgMTY5LjA0NTQ1NDU0NTQ1NDUzLCAxNTAuOTg0ODQ4NDg0ODQ4NSkiIGQ9Ik0gLTE2LjE1NjAzMTI3Nzg4MjE2NCA5ODYuMjY3OTMyMTYwNDgzNyBBIDI1IDI1IDAgMCAxIC0xNi4xNTI4ODczMDgzMzU5NTYgOTg2LjI5MjczMzY4MDY2NzIgTCAtMS4yNzI5MTk2MjkyMTY3NDA4IDk4NC4zOTg5MTE2NTQwODUgQSAxMCAxMCAwIDAgMCAtMS4yNzQxNzcyMTcwMzUyMjUyIDk4NC4zODg5OTEwNDYwMTE3IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTIgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMTEuMDMwMzAzMDMwMzAzMDMsIDE3Mi40NTQ1NDU0NTQ1NDU0NywgMTUzLjUxNTE1MTUxNTE1MTUpIiBkPSJNIC0xNi4xNTYwMzEyNzc4ODIxNjQgOTg2LjI2NzkzMjE2MDQ4MzcgQSAyNSAyNSAwIDAgMSAtMTYuMTUyODg3MzA4MzM1OTU2IDk4Ni4yOTI3MzM2ODA2NjcyIEwgLTEuMjcyOTE5NjI5MjE2NzQwOCA5ODQuMzk4OTExNjU0MDg1IEEgMTAgMTAgMCAwIDAgLTEuMjc0MTc3MjE3MDM1MjI1MiA5ODQuMzg4OTkxMDQ2MDExNyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0zICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTA5LjA5MDkwOTA5MDkwOTEsIDE3NS44NjM2MzYzNjM2MzYzNywgMTU2LjA0NTQ1NDU0NTQ1NDUzKSIgZD0iTSAtMTYuMTU2MDMxMjc3ODgyMTY0IDk4Ni4yNjc5MzIxNjA0ODM3IEEgMjUgMjUgMCAwIDEgMC44OTI0MDE2MDA1MDQzMDU0IDk1OS4zNjk0Njg3NzQ5NTIyIEwgNS41NDUxOTU5MzQzMTkzNjMgOTczLjYyOTYwNTY5MTc5OSBBIDEwIDEwIDAgMCAwIC0xLjI3NDE3NzIxNzAzNTIyNTIgOTg0LjM4ODk5MTA0NjAxMTcgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNCAgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYigxMDcuMTUxNTE1MTUxNTE1MTYsIDE3OS4yNzI3MjcyNzI3MjcyOCwgMTU4LjU3NTc1NzU3NTc1NzU2KSIgZD0iTSAwLjkxNjE3MjM2ODczMjg2NTEgOTU5LjM2MTcyNjAwMjQ2OCBBIDI1IDI1IDAgMCAxIDAuODkyNDAxNjAwNTA0MzA1NCA5NTkuMzY5NDY4Nzc0OTUyMiBMIDUuNTQ1MTk1OTM0MzE5MzYzIDk3My42Mjk2MDU2OTE3OTkgQSAxMCAxMCAwIDAgMCA1LjU1NDcwNDI0MTYxMDc4NiA5NzMuNjI2NTA4NTgyODA1NCBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci01ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoMTAxLjMzMzMzMzMzMzMzMzMzLCAxODkuNSwgMTY2LjE2NjY2NjY2NjY2NjY2KSIgZD0iTSAwLjkxNjE3MjM2ODczMjg2NTEgOTU5LjM2MTcyNjAwMjQ2OCBBIDI1IDI1IDAgMCAxIDAuODkyNDAxNjAwNTA0MzA1NCA5NTkuMzY5NDY4Nzc0OTUyMiBMIDUuNTQ1MTk1OTM0MzE5MzYzIDk3My42Mjk2MDU2OTE3OTkgQSAxMCAxMCAwIDAgMCA1LjU1NDcwNDI0MTYxMDc4NiA5NzMuNjI2NTA4NTgyODA1NCBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci02ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoOTkuMzkzOTM5MzkzOTM5MzksIDE5Mi45MDkwOTA5MDkwOTA5LCAxNjguNjk2OTY5Njk2OTY5NykiIGQ9Ik0gMC45MTYxNzIzNjg3MzI4NjUxIDk1OS4zNjE3MjYwMDI0NjggQSAyNSAyNSAwIDAgMSA3LjA2MzM5NTM4MDkwMDU1NiA5NTguMTg2NTczODU1Njc2NCBMIDguMDEzNTkzNDQ2NDc3ODYzIDk3My4xNTY0NDc3MjQwODg4IEEgMTAgMTAgMCAwIDAgNS41NTQ3MDQyNDE2MTA3ODYgOTczLjYyNjUwODU4MjgwNTQgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNyAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDk3LjQ1NDU0NTQ1NDU0NTQ1LCAxOTYuMzE4MTgxODE4MTgxOCwgMTcxLjIyNzI3MjcyNzI3MjcyKSIgZD0iTSA3LjA4ODM0NTk1ODM1NDYwOSA5NTguMTg1MDAyNjY3MzkxNiBBIDI1IDI1IDAgMCAxIDcuMDYzMzk1MzgwOTAwNTU2IDk1OC4xODY1NzM4NTU2NzY0IEwgOC4wMTM1OTM0NDY0Nzc4NjMgOTczLjE1NjQ0NzcyNDA4ODggQSAxMCAxMCAwIDAgMCA4LjAyMzU3MzY3NzQ1OTQ4NSA5NzMuMTU1ODE5MjQ4Nzc0OCBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci04ICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoOTMuNTc1NzU3NTc1NzU3NTgsIDIwMy4xMzYzNjM2MzYzNjM2MywgMTc2LjI4Nzg3ODc4Nzg3ODc4KSIgZD0iTSA3LjA4ODM0NTk1ODM1NDYwOSA5NTguMTg1MDAyNjY3MzkxNiBBIDI1IDI1IDAgMCAxIDguNjEyMzM0MzI1MDc3NjEgOTU4LjEzNjM4Nzc1MjE5MTEgTCA4LjYzMzE2OTAyNDE0ODY4NSA5NzMuMTM2MzczMjgyNjk0NiBBIDEwIDEwIDAgMCAwIDguMDIzNTczNjc3NDU5NDg1IDk3My4xNTU4MTkyNDg3NzQ4IFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTkgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYig5MS42MzYzNjM2MzYzNjM2NCwgMjA2LjU0NTQ1NDU0NTQ1NDUzLCAxNzguODE4MTgxODE4MTgxOCkiIGQ9Ik0gOC42MzczMzQzMTQxNTczNzcgOTU4LjEzNjM2NTUyNzY4NTQgQSAyNSAyNSAwIDAgMSA4LjYxMjMzNDMyNTA3NzYxIDk1OC4xMzYzODc3NTIxOTExIEwgOC42MzMxNjkwMjQxNDg2ODUgOTczLjEzNjM3MzI4MjY5NDYgQSAxMCAxMCAwIDAgMCA4LjY0MzE2OTAxOTc4MDU5MiA5NzMuMTM2MzY0MzkyODkyMyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0wICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoODkuNjk2OTY5Njk2OTY5NywgMjA5Ljk1NDU0NTQ1NDU0NTQ3LCAxODEuMzQ4NDg0ODQ4NDg0ODQpIiBkPSJNIDguNjM3MzM0MzE0MTU3Mzc3IDk1OC4xMzYzNjU1Mjc2ODU0IEEgMjUgMjUgMCAwIDEgOC42MTIzMzQzMjUwNzc2MSA5NTguMTM2Mzg3NzUyMTkxMSBMIDguNjMzMTY5MDI0MTQ4Njg1IDk3My4xMzYzNzMyODI2OTQ2IEEgMTAgMTAgMCAwIDAgOC42NDMxNjkwMTk3ODA1OTIgOTczLjEzNjM2NDM5Mjg5MjMgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDg3Ljc1NzU3NTc1NzU3NTc1LCAyMTMuMzYzNjM2MzYzNjM2MzcsIDE4My44Nzg3ODc4Nzg3ODc4OCkiIGQ9Ik0gOC42MzczMzQzMTQxNTczNzcgOTU4LjEzNjM2NTUyNzY4NTQgQSAyNSAyNSAwIDAgMSA4LjYxMjMzNDMyNTA3NzYxIDk1OC4xMzYzODc3NTIxOTExIEwgOC42MzMxNjkwMjQxNDg2ODUgOTczLjEzNjM3MzI4MjY5NDYgQSAxMCAxMCAwIDAgMCA4LjY0MzE2OTAxOTc4MDU5MiA5NzMuMTM2MzY0MzkyODkyMyBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImhpZ2hjaGFydHMtcG9pbnQgaGlnaGNoYXJ0cy1jb2xvci0yICAgICAgICAgICAgICAgICAiPjwvcGF0aD48cGF0aCBmaWxsPSJyZ2IoODUuODE4MTgxODE4MTgxODEsIDIxNi43NzI3MjcyNzI3MjcyOCwgMTg2LjQwOTA5MDkwOTA5MDkpIiBkPSJNIDguNjM3MzM0MzE0MTU3Mzc3IDk1OC4xMzYzNjU1Mjc2ODU0IEEgMjUgMjUgMCAwIDEgOC42MTIzMzQzMjUwNzc2MSA5NTguMTM2Mzg3NzUyMTkxMSBMIDguNjMzMTY5MDI0MTQ4Njg1IDk3My4xMzYzNzMyODI2OTQ2IEEgMTAgMTAgMCAwIDAgOC42NDMxNjkwMTk3ODA1OTIgOTczLjEzNjM2NDM5Mjg5MjMgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItMyAgICAgICAgICAgICAgICAgIj48L3BhdGg+PHBhdGggZmlsbD0icmdiKDgzLjg3ODc4Nzg3ODc4Nzg4LCAyMjAuMTgxODE4MTgxODE4MiwgMTg4LjkzOTM5MzkzOTM5Mzk0KSIgZD0iTSA4LjYzNzMzNDMxNDE1NzM3NyA5NTguMTM2MzY1NTI3Njg1NCBBIDI1IDI1IDAgMCAxIDguNjEyMzM0MzI1MDc3NjEgOTU4LjEzNjM4Nzc1MjE5MTEgTCA4LjYzMzE2OTAyNDE0ODY4NSA5NzMuMTM2MzczMjgyNjk0NiBBIDEwIDEwIDAgMCAwIDguNjQzMTY5MDE5NzgwNTkyIDk3My4xMzYzNjQzOTI4OTIzIFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMCkiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIxIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaGlnaGNoYXJ0cy1wb2ludCBoaWdoY2hhcnRzLWNvbG9yLTQgICAgICAgICAgICAgICAgICI+PC9wYXRoPjxwYXRoIGZpbGw9InJnYig4MCwgMjI3LCAxOTQpIiBkPSJNIDguNjM3MzM0MzE0MTU3Mzc3IDk1OC4xMzYzNjU1Mjc2ODU0IEEgMjUgMjUgMCAwIDEgOC42MTIzMzQzMjUwNzc2MSA5NTguMTM2Mzg3NzUyMTkxMSBMIDguNjMzMTY5MDI0MTQ4Njg1IDk3My4xMzYzNzMyODI2OTQ2IEEgMTAgMTAgMCAwIDAgOC42NDMxNjkwMTk3ODA1OTIgOTczLjEzNjM2NDM5Mjg5MjMgWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwwKSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjEiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJoaWdoY2hhcnRzLXBvaW50IGhpZ2hjaGFydHMtY29sb3ItNSAgICAgICAgICAgICAgICAgIj48L3BhdGg+PC9nPg0KPC9zdmc+)",
			radius: parseFloat(_.get(userOptions, "highchartsOptions.plotOptions.series.dataLabels.style.fontSize", 11)),
			fillColor: 'rgb(255, 255, 255)',
			enabled: true,
			states: {
				hover: {
					enabled: false
				}
			},
			// fillOpacity: 1
		},
		dataLabels: {
			enabled: true,
			align: 'center',
			verticalAlign: "middle",
			overflow: "allow",
			x: -1,
			y: -2,
			crop: false,
			allowOverlap: true,
			style: {"pointer-events": "none"},
			format: '{point.name}'
		},
		showInLegend: false
	}
}

function generateLineSeries(data:Array<{}> ,name:string, pointStyle:PointStyle, lineColor:string, lineWidth:number, showPoints:boolean, showLines:boolean) {
	return {
		data: data,
		name: name,
		color: lineColor,
		boostThreshold: 0,
		states: {
			hover: {
				enabled: true,
				lineWidth: 0,
				lineWidthPlus: 0,
				halo: { }
			}
		},
		marker: {
			symbol: pointStyle.symbol,
			radius: showPoints ? pointStyle.radius : 0,
			fillColor: `rgba(${pointStyle.color}, ${pointStyle.opacity})`
		},
		showInLegend: false,
		lineWidth: showLines? lineWidth : 0,
		zIndex: 0
	};
}

export function getSeriesData(io: IO, userOptions: ChartUserOptions, name: string, mapRelative : boolean = false): Array<any> {
	if (name == "directionSeries") {
		return mapEvaluations(io, userOptions, io.inefficientEvaluations.filter(i => i.risk != null && i.reward != null && i.source == 'G'), mapRelative);
	}
	if (name == "distanceSeries") {
		return mapEvaluations(io, userOptions, io.inefficientEvaluations.filter(i => i.risk != null && i.reward != null && i.source == 'D'), mapRelative);
	}
	if (name == "randomSeries") {
		return mapEvaluations(io, userOptions, io.inefficientEvaluations.filter(i => i.risk != null && i.reward != null && i.source == 'R'), mapRelative);
	}
	if (name == "historicalSeries") {
		return mapEvaluations(io, userOptions, io.inefficientEvaluations.filter(i => i.risk != null && i.reward != null && i.source == 'H'), mapRelative);
	}
	if (name == "fullFrontierSeries") {
		return mapEvaluations(io, userOptions, io.fullFrontierEvaluations.filter(i => i.risk != null && i.reward != null), mapRelative);
	}
	if (name == "iterationSeries") {
		return io.iterationEvaluations.map(l => mapEvaluations(io, userOptions, l.filter(i => i != null && i.risk != null && i.reward != null), mapRelative));
	}
}

function mapEvaluations(io: IO, userOptions: ChartUserOptions, evaluations : Array<Evaluation>, mapRelative : boolean = false) {
	const assetAllocation = e => e.assetAllocation && io.allocationsAtLevel(userOptions.assetGroupLevel, e.assetAllocation);
	const relativePoint = io.relativeEvaluationIndex && mapRelative ? io.evaluations[io.relativeEvaluationIndex] : {risk: 0, reward: 0};
	return evaluations.map((p, i) => ({
		x: p.risk - relativePoint.risk,
		y: p.reward - relativePoint.reward,
		name: i,
		connAssetAllocation: p.assetAllocation && assetAllocation(p),
		connEvalIndex: p.evaluationNumber
	}));
}

function generateInefficientSeries(data: Array<{x?: number,y?: number}>, name: string, pointStyle: PointStyle, showPoints) {
	return {
		type: "scatter",
		data: data,
		name: name,
		states: {
			hover: {
				enabled: true,
				halo: {
					size: pointStyle.radius,
					attributes:{
						fill: `rgba(${pointStyle.color}, ${pointStyle.opacity})`,
						stroke: `rgba(${pointStyle.color}, ${pointStyle.opacity})`,
						'stroke-width': 10
					}
				}
			}
		},
		boostThreshold: 1,
		visible: showPoints,
		marker: {
			symbol: pointStyle.symbol,
			radius: pointStyle.radius,
			fillColor: `rgba(${pointStyle.color}, ${pointStyle.opacity})`
		},
		showInLegend: false,
		zIndex: 0
	};
}